var hw=Object.defineProperty,cw=Object.defineProperties,uw=Object.getOwnPropertyDescriptors,z0=Object.getOwnPropertySymbols,dw=Object.prototype.hasOwnProperty,pw=Object.prototype.propertyIsEnumerable,mw=Math.pow,zm=(i,e,t)=>e in i?hw(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ae=(i,e)=>{for(var t in e||(e={}))dw.call(e,t)&&zm(i,t,e[t]);if(z0)for(var t of z0(e))pw.call(e,t)&&zm(i,t,e[t]);return i},hi=(i,e)=>cw(i,uw(e)),V0=(i,e,t)=>(zm(i,typeof e!="symbol"?e+"":e,t),t),Rr=(i,e,t)=>new Promise((r,s)=>{var a=l=>{try{o(t.next(l))}catch(h){s(h)}},n=l=>{try{o(t.throw(l))}catch(h){s(h)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,n);o((t=t.apply(i,e)).next())});const Vu="165",qa={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Ya={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},_d=1,og=2,Ar=3,gr=0,Si=1,Mt=2,As=2,Ro=5,Ji=100,fw=101,gw=102,Po=200,kh=201,yd=202,xd=203,ca=204,ua=205,Bh=206,Md=207,zh=208,bd=209,vw=210,_w=211,yw=212,xw=213,Mw=214,Vh=0,Lx=1,Nx=2,Kr=0,wd=1,Sd=2,Td=3,Ad=4,lg=5,Ed=6,hg=7,Vm="attached",Dx="detached",Cd=300,Es=301,da=302,Io=303,sh=304,Jo=306,jt=1e3,gi=1001,pa=1002,nt=1003,Rd=1004,an=1005,Vt=1006,_o=1007,Qr=1008,xn=1009,Lo=1012,cg=1013,Mn=1014,tr=1015,Ht=1016,ug=1017,dg=1018,ma=1020,fr=1023,No=1026,fa=1027,pg=1028,mg=1029,fg=1031,gg=1033,Su=33776,Tu=33777,Au=33778,Eu=33779,Hm=35840,Gm=35841,jm=35842,Wm=35843,Xm=36196,qm=37492,Ym=37496,Zm=37808,Km=37809,Qm=37810,Jm=37811,$m=37812,ef=37813,tf=37814,rf=37815,sf=37816,af=37817,nf=37818,of=37819,lf=37820,hf=37821,Cu=36492,cf=36494,uf=36495,df=36284,pf=36285,mf=36286,vg=2200,_g=2201,Do=2300,Oo=2301,Ru=2302,nn=2400,on=2401,ah=2402,Ox=2500,yg=2501,xg=3201,$a="",ft="srgb",Qt="srgb-linear",Pd="display-p3",Hh="display-p3-linear",nh="linear",mt="srgb",oh="rec709",lh="p3",Za=7680,bw=512,ww=513,Sw=514,Tw=515,Aw=516,Ew=517,Cw=518,Rw=519,hh=35044,ff="300 es",bn=2e3,ch=2001;class ts{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const _i=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let H0=1234567;const cn=Math.PI/180,Uo=180/Math.PI;function rr(){const i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(_i[255&i]+_i[i>>8&255]+_i[i>>16&255]+_i[i>>24&255]+"-"+_i[255&e]+_i[e>>8&255]+"-"+_i[e>>16&15|64]+_i[e>>24&255]+"-"+_i[63&t|128]+_i[t>>8&255]+"-"+_i[t>>16&255]+_i[t>>24&255]+_i[255&r]+_i[r>>8&255]+_i[r>>16&255]+_i[r>>24&255]).toLowerCase()}function Pt(i,e,t){return Math.max(e,Math.min(t,i))}function gf(i,e){return(i%e+e)%e}function jl(i,e,t){return(1-t)*i+t*e}function Li(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Oe(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(4294967295*i);case Uint16Array:return Math.round(65535*i);case Uint8Array:return Math.round(255*i);case Int32Array:return Math.round(2147483647*i);case Int16Array:return Math.round(32767*i);case Int8Array:return Math.round(127*i);default:throw new Error("Invalid component type.")}}const ti={DEG2RAD:cn,RAD2DEG:Uo,generateUUID:rr,clamp:Pt,euclideanModulo:gf,mapLinear:function(i,e,t,r,s){return r+(i-e)*(s-r)/(t-e)},inverseLerp:function(i,e,t){return i!==e?(t-i)/(e-i):0},lerp:jl,damp:function(i,e,t,r){return jl(i,e,1-Math.exp(-t*r))},pingpong:function(i,e=1){return e-Math.abs(gf(i,2*e)-e)},smoothstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e))*i*(3-2*i)},smootherstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e))*i*i*(i*(6*i-15)+10)},randInt:function(i,e){return i+Math.floor(Math.random()*(e-i+1))},randFloat:function(i,e){return i+Math.random()*(e-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){i!==void 0&&(H0=i);let e=H0+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(i){return i*cn},radToDeg:function(i){return i*Uo},isPowerOfTwo:function(i){return!(i&i-1)&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,e,t,r,s){const a=Math.cos,n=Math.sin,o=a(t/2),l=n(t/2),h=a((e+r)/2),c=n((e+r)/2),u=a((e-r)/2),d=n((e-r)/2),p=a((r-e)/2),f=n((r-e)/2);switch(s){case"XYX":i.set(o*c,l*u,l*d,o*h);break;case"YZY":i.set(l*d,o*c,l*u,o*h);break;case"ZXZ":i.set(l*u,l*d,o*c,o*h);break;case"XZX":i.set(o*c,l*f,l*p,o*h);break;case"YXY":i.set(l*p,o*c,l*f,o*h);break;case"ZYZ":i.set(l*f,l*p,o*c,o*h)}},normalize:Oe,denormalize:Li};class X{constructor(e=0,t=0){X.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6],this.y=s[1]*t+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Pt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),s=Math.sin(t),a=this.x-e.x,n=this.y-e.y;return this.x=a*r-n*s+e.x,this.y=a*s+n*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class De{constructor(e,t,r,s,a,n,o,l,h){De.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,s,a,n,o,l,h)}set(e,t,r,s,a,n,o,l,h){const c=this.elements;return c[0]=e,c[1]=s,c[2]=o,c[3]=t,c[4]=a,c[5]=l,c[6]=r,c[7]=n,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,s=t.elements,a=this.elements,n=r[0],o=r[3],l=r[6],h=r[1],c=r[4],u=r[7],d=r[2],p=r[5],f=r[8],v=s[0],m=s[3],g=s[6],_=s[1],y=s[4],x=s[7],M=s[2],b=s[5],w=s[8];return a[0]=n*v+o*_+l*M,a[3]=n*m+o*y+l*b,a[6]=n*g+o*x+l*w,a[1]=h*v+c*_+u*M,a[4]=h*m+c*y+u*b,a[7]=h*g+c*x+u*w,a[2]=d*v+p*_+f*M,a[5]=d*m+p*y+f*b,a[8]=d*g+p*x+f*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],c=e[8];return t*n*c-t*o*h-r*a*c+r*o*l+s*a*h-s*n*l}invert(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=c*n-o*h,d=o*l-c*a,p=h*a-n*l,f=t*u+r*d+s*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/f;return e[0]=u*v,e[1]=(s*h-c*r)*v,e[2]=(o*r-s*n)*v,e[3]=d*v,e[4]=(c*t-s*l)*v,e[5]=(s*a-o*t)*v,e[6]=p*v,e[7]=(r*l-h*t)*v,e[8]=(n*t-r*a)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,s,a,n,o){const l=Math.cos(a),h=Math.sin(a);return this.set(r*l,r*h,-r*(l*n+h*o)+n+e,-s*h,s*l,-s*(-h*n+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(lp.makeScale(e,t)),this}rotate(e){return this.premultiply(lp.makeRotation(-e)),this}translate(e,t){return this.premultiply(lp.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let s=0;s<9;s++)if(t[s]!==r[s])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const lp=new De;function Ux(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const Pw={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function oo(i,e){return new Pw[i](e)}function uh(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function Fx(){const i=uh("canvas");return i.style.display="block",i}const G0={};function Mg(i){i in G0||(G0[i]=!0)}const j0=new De().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),W0=new De().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),sc={[Qt]:{transfer:nh,primaries:oh,toReference:i=>i,fromReference:i=>i},[ft]:{transfer:mt,primaries:oh,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[Hh]:{transfer:nh,primaries:lh,toReference:i=>i.applyMatrix3(W0),fromReference:i=>i.applyMatrix3(j0)},[Pd]:{transfer:mt,primaries:lh,toReference:i=>i.convertSRGBToLinear().applyMatrix3(W0),fromReference:i=>i.applyMatrix3(j0).convertLinearToSRGB()}},Iw=new Set([Qt,Hh]),rt={enabled:!0,_workingColorSpace:Qt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!Iw.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const r=sc[e].toReference;return(0,sc[t].fromReference)(r(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return sc[i].primaries},getTransfer:function(i){return i===$a?nh:sc[i].transfer}};function yo(i){return i<.04045?.0773993808*i:Math.pow(.9478672986*i+.0521327014,2.4)}function hp(i){return i<.0031308?12.92*i:1.055*Math.pow(i,.41666)-.055}let Nn;class kx{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Nn===void 0&&(Nn=uh("canvas")),Nn.width=e.width,Nn.height=e.height;const r=Nn.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Nn}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=uh("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),a=s.data;for(let n=0;n<a.length;n++)a[n]=255*yo(a[n]/255);return r.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(255*yo(t[r]/255)):t[r]=yo(t[r]);return{data:t,width:e.width,height:e.height}}return e}}let Lw=0;class en{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Lw++}),this.uuid=rr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let a;if(Array.isArray(s)){a=[];for(let n=0,o=s.length;n<o;n++)s[n].isDataTexture?a.push(cp(s[n].image)):a.push(cp(s[n]))}else a=cp(s);r.url=a}return t||(e.images[this.uuid]=r),r}}function cp(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?kx.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:{}}let Nw=0;class pt extends ts{constructor(e=pt.DEFAULT_IMAGE,t=pt.DEFAULT_MAPPING,r=gi,s=gi,a=1006,n=1008,o=1023,l=1009,h=pt.DEFAULT_ANISOTROPY,c=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Nw++}),this.uuid=rr(),this.name="",this.source=new en(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=a,this.minFilter=n,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new X(0,0),this.repeat=new X(1,1),this.center=new X(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new De,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Cd)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case jt:e.x=e.x-Math.floor(e.x);break;case gi:e.x=e.x<0?0:1;break;case pa:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case jt:e.y=e.y-Math.floor(e.y);break;case gi:e.y=e.y<0?0:1;break;case pa:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}pt.DEFAULT_IMAGE=null,pt.DEFAULT_MAPPING=Cd,pt.DEFAULT_ANISOTROPY=1;class Ve{constructor(e=0,t=0,r=0,s=1){Ve.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,s){return this.x=e,this.y=t,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,s=this.z,a=this.w,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*s+n[12]*a,this.y=n[1]*t+n[5]*r+n[9]*s+n[13]*a,this.z=n[2]*t+n[6]*r+n[10]*s+n[14]*a,this.w=n[3]*t+n[7]*r+n[11]*s+n[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,s,a;const n=e.elements,o=n[0],l=n[4],h=n[8],c=n[1],u=n[5],d=n[9],p=n[2],f=n[6],v=n[10];if(Math.abs(l-c)<.01&&Math.abs(h-p)<.01&&Math.abs(d-f)<.01){if(Math.abs(l+c)<.1&&Math.abs(h+p)<.1&&Math.abs(d+f)<.1&&Math.abs(o+u+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const g=(o+1)/2,_=(u+1)/2,y=(v+1)/2,x=(l+c)/4,M=(h+p)/4,b=(d+f)/4;return g>_&&g>y?g<.01?(r=0,s=.707106781,a=.707106781):(r=Math.sqrt(g),s=x/r,a=M/r):_>y?_<.01?(r=.707106781,s=0,a=.707106781):(s=Math.sqrt(_),r=x/s,a=b/s):y<.01?(r=.707106781,s=.707106781,a=0):(a=Math.sqrt(y),r=M/a,s=b/a),this.set(r,s,a,t),this}let m=Math.sqrt((f-d)*(f-d)+(h-p)*(h-p)+(c-l)*(c-l));return Math.abs(m)<.001&&(m=1),this.x=(f-d)/m,this.y=(h-p)/m,this.z=(c-l)/m,this.w=Math.acos((o+u+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Bx extends ts{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ve(0,0,e,t),this.scissorTest=!1,this.viewport=new Ve(0,0,e,t);const s={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Vt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const a=new pt(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);a.flipY=!1,a.generateMipmaps=r.generateMipmaps,a.internalFormat=r.internalFormat,this.textures=[];const n=r.count;for(let o=0;o<n;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let s=0,a=this.textures.length;s<a;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,s=e.textures.length;r<s;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new en(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ht extends Bx{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class Hu extends pt{constructor(e=null,t=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:s},this.magFilter=nt,this.minFilter=nt,this.wrapR=gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class vf extends pt{constructor(e=null,t=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:s},this.magFilter=nt,this.minFilter=nt,this.wrapR=gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ke{constructor(e=0,t=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=s}static slerpFlat(e,t,r,s,a,n,o){let l=r[s+0],h=r[s+1],c=r[s+2],u=r[s+3];const d=a[n+0],p=a[n+1],f=a[n+2],v=a[n+3];if(o===0)return e[t+0]=l,e[t+1]=h,e[t+2]=c,void(e[t+3]=u);if(o===1)return e[t+0]=d,e[t+1]=p,e[t+2]=f,void(e[t+3]=v);if(u!==v||l!==d||h!==p||c!==f){let m=1-o;const g=l*d+h*p+c*f+u*v,_=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){const M=Math.sqrt(y),b=Math.atan2(M,g*_);m=Math.sin(m*b)/M,o=Math.sin(o*b)/M}const x=o*_;if(l=l*m+d*x,h=h*m+p*x,c=c*m+f*x,u=u*m+v*x,m===1-o){const M=1/Math.sqrt(l*l+h*h+c*c+u*u);l*=M,h*=M,c*=M,u*=M}}e[t]=l,e[t+1]=h,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,r,s,a,n){const o=r[s],l=r[s+1],h=r[s+2],c=r[s+3],u=a[n],d=a[n+1],p=a[n+2],f=a[n+3];return e[t]=o*f+c*u+l*p-h*d,e[t+1]=l*f+c*d+h*u-o*p,e[t+2]=h*f+c*p+o*d-l*u,e[t+3]=c*f-o*u-l*d-h*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,s){return this._x=e,this._y=t,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,s=e._y,a=e._z,n=e._order,o=Math.cos,l=Math.sin,h=o(r/2),c=o(s/2),u=o(a/2),d=l(r/2),p=l(s/2),f=l(a/2);switch(n){case"XYZ":this._x=d*c*u+h*p*f,this._y=h*p*u-d*c*f,this._z=h*c*f+d*p*u,this._w=h*c*u-d*p*f;break;case"YXZ":this._x=d*c*u+h*p*f,this._y=h*p*u-d*c*f,this._z=h*c*f-d*p*u,this._w=h*c*u+d*p*f;break;case"ZXY":this._x=d*c*u-h*p*f,this._y=h*p*u+d*c*f,this._z=h*c*f+d*p*u,this._w=h*c*u-d*p*f;break;case"ZYX":this._x=d*c*u-h*p*f,this._y=h*p*u+d*c*f,this._z=h*c*f-d*p*u,this._w=h*c*u+d*p*f;break;case"YZX":this._x=d*c*u+h*p*f,this._y=h*p*u+d*c*f,this._z=h*c*f-d*p*u,this._w=h*c*u-d*p*f;break;case"XZY":this._x=d*c*u-h*p*f,this._y=h*p*u-d*c*f,this._z=h*c*f+d*p*u,this._w=h*c*u+d*p*f}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],s=t[4],a=t[8],n=t[1],o=t[5],l=t[9],h=t[2],c=t[6],u=t[10],d=r+o+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(c-l)*p,this._y=(a-h)*p,this._z=(n-s)*p}else if(r>o&&r>u){const p=2*Math.sqrt(1+r-o-u);this._w=(c-l)/p,this._x=.25*p,this._y=(s+n)/p,this._z=(a+h)/p}else if(o>u){const p=2*Math.sqrt(1+o-r-u);this._w=(a-h)/p,this._x=(s+n)/p,this._y=.25*p,this._z=(l+c)/p}else{const p=2*Math.sqrt(1+u-r-o);this._w=(n-s)/p,this._x=(a+h)/p,this._y=(l+c)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Pt(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,t/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,s=e._y,a=e._z,n=e._w,o=t._x,l=t._y,h=t._z,c=t._w;return this._x=r*c+n*o+s*h-a*l,this._y=s*c+n*l+a*o-r*h,this._z=a*c+n*h+r*l-s*o,this._w=n*c-r*o-s*l-a*h,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,s=this._y,a=this._z,n=this._w;let o=n*e._w+r*e._x+s*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=n,this._x=r,this._y=s,this._z=a,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-t;return this._w=p*n+t*this._w,this._x=p*r+t*this._x,this._y=p*s+t*this._y,this._z=p*a+t*this._z,this.normalize(),this}const h=Math.sqrt(l),c=Math.atan2(h,o),u=Math.sin((1-t)*c)/h,d=Math.sin(t*c)/h;return this._w=n*u+this._w*d,this._x=r*u+this._x*d,this._y=s*u+this._y*d,this._z=a*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),a=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class S{constructor(e=0,t=0,r=0){S.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(X0.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(X0.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*t+a[3]*r+a[6]*s,this.y=a[1]*t+a[4]*r+a[7]*s,this.z=a[2]*t+a[5]*r+a[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,s=this.z,a=e.elements,n=1/(a[3]*t+a[7]*r+a[11]*s+a[15]);return this.x=(a[0]*t+a[4]*r+a[8]*s+a[12])*n,this.y=(a[1]*t+a[5]*r+a[9]*s+a[13])*n,this.z=(a[2]*t+a[6]*r+a[10]*s+a[14])*n,this}applyQuaternion(e){const t=this.x,r=this.y,s=this.z,a=e.x,n=e.y,o=e.z,l=e.w,h=2*(n*s-o*r),c=2*(o*t-a*s),u=2*(a*r-n*t);return this.x=t+l*h+n*u-o*c,this.y=r+l*c+o*h-a*u,this.z=s+l*u+a*c-n*h,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*s,this.y=a[1]*t+a[5]*r+a[9]*s,this.z=a[2]*t+a[6]*r+a[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,s=e.y,a=e.z,n=t.x,o=t.y,l=t.z;return this.x=s*l-a*o,this.y=a*n-r*l,this.z=r*o-s*n,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return up.copy(this).projectOnVector(e),this.sub(up)}reflect(e){return this.sub(up.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Pt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return t*t+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const s=Math.sin(t)*e;return this.x=s*Math.sin(r),this.y=Math.cos(t)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const up=new S,X0=new Ke;class vt{constructor(e=new S(1/0,1/0,1/0),t=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Mr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Mr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Mr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const a=r.getAttribute("position");if(t===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let n=0,o=a.count;n<o;n++)e.isMesh===!0?e.getVertexPosition(n,Mr):Mr.fromBufferAttribute(a,n),Mr.applyMatrix4(e.matrixWorld),this.expandByPoint(Mr);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ac.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),ac.copy(r.boundingBox)),ac.applyMatrix4(e.matrixWorld),this.union(ac)}const s=e.children;for(let a=0,n=s.length;a<n;a++)this.expandByObject(s[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Mr),Mr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(al),nc.subVectors(this.max,al),Dn.subVectors(e.a,al),On.subVectors(e.b,al),Un.subVectors(e.c,al),Us.subVectors(On,Dn),Fs.subVectors(Un,On),Ra.subVectors(Dn,Un);let t=[0,-Us.z,Us.y,0,-Fs.z,Fs.y,0,-Ra.z,Ra.y,Us.z,0,-Us.x,Fs.z,0,-Fs.x,Ra.z,0,-Ra.x,-Us.y,Us.x,0,-Fs.y,Fs.x,0,-Ra.y,Ra.x,0];return!!dp(t,Dn,On,Un,nc)&&(t=[1,0,0,0,1,0,0,0,1],!!dp(t,Dn,On,Un,nc)&&(oc.crossVectors(Us,Fs),t=[oc.x,oc.y,oc.z],dp(t,Dn,On,Un,nc)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Mr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Mr).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(os[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),os[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),os[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),os[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),os[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),os[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),os[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),os[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(os)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const os=[new S,new S,new S,new S,new S,new S,new S,new S],Mr=new S,ac=new vt,Dn=new S,On=new S,Un=new S,Us=new S,Fs=new S,Ra=new S,al=new S,nc=new S,oc=new S,Pa=new S;function dp(i,e,t,r,s){for(let a=0,n=i.length-3;a<=n;a+=3){Pa.fromArray(i,a);const o=s.x*Math.abs(Pa.x)+s.y*Math.abs(Pa.y)+s.z*Math.abs(Pa.z),l=e.dot(Pa),h=t.dot(Pa),c=r.dot(Pa);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>o)return!1}return!0}const Dw=new vt,nl=new S,pp=new S;class ii{constructor(e=new S,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):Dw.setFromPoints(e).getCenter(r);let s=0;for(let a=0,n=e.length;a<n;a++)s=Math.max(s,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;nl.subVectors(e,this.center);const t=nl.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),s=.5*(r-this.radius);this.center.addScaledVector(nl,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(pp.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(nl.copy(e.center).add(pp)),this.expandByPoint(nl.copy(e.center).sub(pp))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ls=new S,mp=new S,lc=new S,ks=new S,fp=new S,hc=new S,gp=new S;class Rn{constructor(e=new S,t=new S(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ls)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ls.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ls.copy(this.origin).addScaledVector(this.direction,t),ls.distanceToSquared(e))}distanceSqToSegment(e,t,r,s){mp.copy(e).add(t).multiplyScalar(.5),lc.copy(t).sub(e).normalize(),ks.copy(this.origin).sub(mp);const a=.5*e.distanceTo(t),n=-this.direction.dot(lc),o=ks.dot(this.direction),l=-ks.dot(lc),h=ks.lengthSq(),c=Math.abs(1-n*n);let u,d,p,f;if(c>0)if(u=n*l-o,d=n*o-l,f=a*c,u>=0)if(d>=-f)if(d<=f){const v=1/c;u*=v,d*=v,p=u*(u+n*d+2*o)+d*(n*u+d+2*l)+h}else d=a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+h;else d=-a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+h;else d<=-f?(u=Math.max(0,-(-n*a+o)),d=u>0?-a:Math.min(Math.max(-a,-l),a),p=-u*u+d*(d+2*l)+h):d<=f?(u=0,d=Math.min(Math.max(-a,-l),a),p=d*(d+2*l)+h):(u=Math.max(0,-(n*a+o)),d=u>0?a:Math.min(Math.max(-a,-l),a),p=-u*u+d*(d+2*l)+h);else d=n>0?-a:a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+h;return r&&r.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(mp).addScaledVector(lc,d),p}intersectSphere(e,t){ls.subVectors(e.center,this.origin);const r=ls.dot(this.direction),s=ls.dot(ls)-r*r,a=e.radius*e.radius;if(s>a)return null;const n=Math.sqrt(a-s),o=r-n,l=r+n;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0?!0:e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,s,a,n,o,l;const h=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,d=this.origin;return h>=0?(r=(e.min.x-d.x)*h,s=(e.max.x-d.x)*h):(r=(e.max.x-d.x)*h,s=(e.min.x-d.x)*h),c>=0?(a=(e.min.y-d.y)*c,n=(e.max.y-d.y)*c):(a=(e.max.y-d.y)*c,n=(e.min.y-d.y)*c),r>n||a>s?null:((a>r||isNaN(r))&&(r=a),(n<s||isNaN(s))&&(s=n),u>=0?(o=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),r>l||o>s?null:((o>r||r!=r)&&(r=o),(l<s||s!=s)&&(s=l),s<0?null:this.at(r>=0?r:s,t)))}intersectsBox(e){return this.intersectBox(e,ls)!==null}intersectTriangle(e,t,r,s,a){fp.subVectors(t,e),hc.subVectors(r,e),gp.crossVectors(fp,hc);let n,o=this.direction.dot(gp);if(o>0){if(s)return null;n=1}else{if(!(o<0))return null;n=-1,o=-o}ks.subVectors(this.origin,e);const l=n*this.direction.dot(hc.crossVectors(ks,hc));if(l<0)return null;const h=n*this.direction.dot(fp.cross(ks));if(h<0||l+h>o)return null;const c=-n*ks.dot(gp);return c<0?null:this.at(c/o,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class me{constructor(e,t,r,s,a,n,o,l,h,c,u,d,p,f,v,m){me.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,s,a,n,o,l,h,c,u,d,p,f,v,m)}set(e,t,r,s,a,n,o,l,h,c,u,d,p,f,v,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=s,g[1]=a,g[5]=n,g[9]=o,g[13]=l,g[2]=h,g[6]=c,g[10]=u,g[14]=d,g[3]=p,g[7]=f,g[11]=v,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new me().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,s=1/Fn.setFromMatrixColumn(e,0).length(),a=1/Fn.setFromMatrixColumn(e,1).length(),n=1/Fn.setFromMatrixColumn(e,2).length();return t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s,t[3]=0,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=0,t[8]=r[8]*n,t[9]=r[9]*n,t[10]=r[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,s=e.y,a=e.z,n=Math.cos(r),o=Math.sin(r),l=Math.cos(s),h=Math.sin(s),c=Math.cos(a),u=Math.sin(a);if(e.order==="XYZ"){const d=n*c,p=n*u,f=o*c,v=o*u;t[0]=l*c,t[4]=-l*u,t[8]=h,t[1]=p+f*h,t[5]=d-v*h,t[9]=-o*l,t[2]=v-d*h,t[6]=f+p*h,t[10]=n*l}else if(e.order==="YXZ"){const d=l*c,p=l*u,f=h*c,v=h*u;t[0]=d+v*o,t[4]=f*o-p,t[8]=n*h,t[1]=n*u,t[5]=n*c,t[9]=-o,t[2]=p*o-f,t[6]=v+d*o,t[10]=n*l}else if(e.order==="ZXY"){const d=l*c,p=l*u,f=h*c,v=h*u;t[0]=d-v*o,t[4]=-n*u,t[8]=f+p*o,t[1]=p+f*o,t[5]=n*c,t[9]=v-d*o,t[2]=-n*h,t[6]=o,t[10]=n*l}else if(e.order==="ZYX"){const d=n*c,p=n*u,f=o*c,v=o*u;t[0]=l*c,t[4]=f*h-p,t[8]=d*h+v,t[1]=l*u,t[5]=v*h+d,t[9]=p*h-f,t[2]=-h,t[6]=o*l,t[10]=n*l}else if(e.order==="YZX"){const d=n*l,p=n*h,f=o*l,v=o*h;t[0]=l*c,t[4]=v-d*u,t[8]=f*u+p,t[1]=u,t[5]=n*c,t[9]=-o*c,t[2]=-h*c,t[6]=p*u+f,t[10]=d-v*u}else if(e.order==="XZY"){const d=n*l,p=n*h,f=o*l,v=o*h;t[0]=l*c,t[4]=-u,t[8]=h*c,t[1]=d*u+v,t[5]=n*c,t[9]=p*u-f,t[2]=f*u-p,t[6]=o*c,t[10]=v*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Ow,e,Uw)}lookAt(e,t,r){const s=this.elements;return Xi.subVectors(e,t),Xi.lengthSq()===0&&(Xi.z=1),Xi.normalize(),Bs.crossVectors(r,Xi),Bs.lengthSq()===0&&(Math.abs(r.z)===1?Xi.x+=1e-4:Xi.z+=1e-4,Xi.normalize(),Bs.crossVectors(r,Xi)),Bs.normalize(),cc.crossVectors(Xi,Bs),s[0]=Bs.x,s[4]=cc.x,s[8]=Xi.x,s[1]=Bs.y,s[5]=cc.y,s[9]=Xi.y,s[2]=Bs.z,s[6]=cc.z,s[10]=Xi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,s=t.elements,a=this.elements,n=r[0],o=r[4],l=r[8],h=r[12],c=r[1],u=r[5],d=r[9],p=r[13],f=r[2],v=r[6],m=r[10],g=r[14],_=r[3],y=r[7],x=r[11],M=r[15],b=s[0],w=s[4],T=s[8],R=s[12],I=s[1],E=s[5],L=s[9],D=s[13],U=s[2],H=s[6],Z=s[10],te=s[14],ie=s[3],ve=s[7],be=s[11],J=s[15];return a[0]=n*b+o*I+l*U+h*ie,a[4]=n*w+o*E+l*H+h*ve,a[8]=n*T+o*L+l*Z+h*be,a[12]=n*R+o*D+l*te+h*J,a[1]=c*b+u*I+d*U+p*ie,a[5]=c*w+u*E+d*H+p*ve,a[9]=c*T+u*L+d*Z+p*be,a[13]=c*R+u*D+d*te+p*J,a[2]=f*b+v*I+m*U+g*ie,a[6]=f*w+v*E+m*H+g*ve,a[10]=f*T+v*L+m*Z+g*be,a[14]=f*R+v*D+m*te+g*J,a[3]=_*b+y*I+x*U+M*ie,a[7]=_*w+y*E+x*H+M*ve,a[11]=_*T+y*L+x*Z+M*be,a[15]=_*R+y*D+x*te+M*J,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],s=e[8],a=e[12],n=e[1],o=e[5],l=e[9],h=e[13],c=e[2],u=e[6],d=e[10],p=e[14];return e[3]*(+a*l*u-s*h*u-a*o*d+r*h*d+s*o*p-r*l*p)+e[7]*(+t*l*p-t*h*d+a*n*d-s*n*p+s*h*c-a*l*c)+e[11]*(+t*h*u-t*o*p-a*n*u+r*n*p+a*o*c-r*h*c)+e[15]*(-s*o*c-t*l*u+t*o*d+s*n*u-r*n*d+r*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],d=e[10],p=e[11],f=e[12],v=e[13],m=e[14],g=e[15],_=u*m*h-v*d*h+v*l*p-o*m*p-u*l*g+o*d*g,y=f*d*h-c*m*h-f*l*p+n*m*p+c*l*g-n*d*g,x=c*v*h-f*u*h+f*o*p-n*v*p-c*o*g+n*u*g,M=f*u*l-c*v*l-f*o*d+n*v*d+c*o*m-n*u*m,b=t*_+r*y+s*x+a*M;if(b===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return e[0]=_*w,e[1]=(v*d*a-u*m*a-v*s*p+r*m*p+u*s*g-r*d*g)*w,e[2]=(o*m*a-v*l*a+v*s*h-r*m*h-o*s*g+r*l*g)*w,e[3]=(u*l*a-o*d*a-u*s*h+r*d*h+o*s*p-r*l*p)*w,e[4]=y*w,e[5]=(c*m*a-f*d*a+f*s*p-t*m*p-c*s*g+t*d*g)*w,e[6]=(f*l*a-n*m*a-f*s*h+t*m*h+n*s*g-t*l*g)*w,e[7]=(n*d*a-c*l*a+c*s*h-t*d*h-n*s*p+t*l*p)*w,e[8]=x*w,e[9]=(f*u*a-c*v*a-f*r*p+t*v*p+c*r*g-t*u*g)*w,e[10]=(n*v*a-f*o*a+f*r*h-t*v*h-n*r*g+t*o*g)*w,e[11]=(c*o*a-n*u*a-c*r*h+t*u*h+n*r*p-t*o*p)*w,e[12]=M*w,e[13]=(c*v*s-f*u*s+f*r*d-t*v*d-c*r*m+t*u*m)*w,e[14]=(f*o*s-n*v*s-f*r*l+t*v*l+n*r*m-t*o*m)*w,e[15]=(n*u*s-c*o*s+c*r*l-t*u*l-n*r*d+t*o*d)*w,this}scale(e){const t=this.elements,r=e.x,s=e.y,a=e.z;return t[0]*=r,t[4]*=s,t[8]*=a,t[1]*=r,t[5]*=s,t[9]*=a,t[2]*=r,t[6]*=s,t[10]*=a,t[3]*=r,t[7]*=s,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,s))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),s=Math.sin(t),a=1-r,n=e.x,o=e.y,l=e.z,h=a*n,c=a*o;return this.set(h*n+r,h*o-s*l,h*l+s*o,0,h*o+s*l,c*o+r,c*l-s*n,0,h*l-s*o,c*l+s*n,a*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,s,a,n){return this.set(1,r,a,0,e,1,n,0,t,s,1,0,0,0,0,1),this}compose(e,t,r){const s=this.elements,a=t._x,n=t._y,o=t._z,l=t._w,h=a+a,c=n+n,u=o+o,d=a*h,p=a*c,f=a*u,v=n*c,m=n*u,g=o*u,_=l*h,y=l*c,x=l*u,M=r.x,b=r.y,w=r.z;return s[0]=(1-(v+g))*M,s[1]=(p+x)*M,s[2]=(f-y)*M,s[3]=0,s[4]=(p-x)*b,s[5]=(1-(d+g))*b,s[6]=(m+_)*b,s[7]=0,s[8]=(f+y)*w,s[9]=(m-_)*w,s[10]=(1-(d+v))*w,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,r){const s=this.elements;let a=Fn.set(s[0],s[1],s[2]).length();const n=Fn.set(s[4],s[5],s[6]).length(),o=Fn.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),e.x=s[12],e.y=s[13],e.z=s[14],br.copy(this);const l=1/a,h=1/n,c=1/o;return br.elements[0]*=l,br.elements[1]*=l,br.elements[2]*=l,br.elements[4]*=h,br.elements[5]*=h,br.elements[6]*=h,br.elements[8]*=c,br.elements[9]*=c,br.elements[10]*=c,t.setFromRotationMatrix(br),r.x=a,r.y=n,r.z=o,this}makePerspective(e,t,r,s,a,n,o=2e3){const l=this.elements,h=2*a/(t-e),c=2*a/(r-s),u=(t+e)/(t-e),d=(r+s)/(r-s);let p,f;if(o===bn)p=-(n+a)/(n-a),f=-2*n*a/(n-a);else{if(o!==ch)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-n/(n-a),f=-n*a/(n-a)}return l[0]=h,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,s,a,n,o=2e3){const l=this.elements,h=1/(t-e),c=1/(r-s),u=1/(n-a),d=(t+e)*h,p=(r+s)*c;let f,v;if(o===bn)f=(n+a)*u,v=-2*u;else{if(o!==ch)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);f=a*u,v=-1*u}return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let s=0;s<16;s++)if(t[s]!==r[s])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Fn=new S,br=new me,Ow=new S(0,0,0),Uw=new S(1,1,1),Bs=new S,cc=new S,Xi=new S,q0=new me,Y0=new Ke;class yt{constructor(e=0,t=0,r=0,s=yt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,s=this._order){return this._x=e,this._y=t,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const s=e.elements,a=s[0],n=s[4],o=s[8],l=s[1],h=s[5],c=s[9],u=s[2],d=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(Pt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Pt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(Pt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-n,h)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-Pt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-n,h));break;case"YZX":this._z=Math.asin(Pt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Pt(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,p),this._y=0)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return q0.makeRotationFromQuaternion(e),this.setFromRotationMatrix(q0,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Y0.setFromEuler(this),this.setFromQuaternion(Y0,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yt.DEFAULT_ORDER="XYZ";class Id{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let Fw=0;const Z0=new S,kn=new Ke,hs=new me,uc=new S,ol=new S,kw=new S,Bw=new Ke,K0=new S(1,0,0),Q0=new S(0,1,0),J0=new S(0,0,1),$0={type:"added"},zw={type:"removed"},Bn={type:"childadded",child:null},vp={type:"childremoved",child:null};class Ue extends ts{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Fw++}),this.uuid=rr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ue.DEFAULT_UP.clone();const e=new S,t=new yt,r=new Ke,s=new S(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new me},normalMatrix:{value:new De}}),this.matrix=new me,this.matrixWorld=new me,this.matrixAutoUpdate=Ue.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ue.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Id,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return kn.setFromAxisAngle(e,t),this.quaternion.multiply(kn),this}rotateOnWorldAxis(e,t){return kn.setFromAxisAngle(e,t),this.quaternion.premultiply(kn),this}rotateX(e){return this.rotateOnAxis(K0,e)}rotateY(e){return this.rotateOnAxis(Q0,e)}rotateZ(e){return this.rotateOnAxis(J0,e)}translateOnAxis(e,t){return Z0.copy(e).applyQuaternion(this.quaternion),this.position.add(Z0.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(K0,e)}translateY(e){return this.translateOnAxis(Q0,e)}translateZ(e){return this.translateOnAxis(J0,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(hs.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?uc.copy(e):uc.set(e,t,r);const s=this.parent;this.updateWorldMatrix(!0,!1),ol.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hs.lookAt(ol,uc,this.up):hs.lookAt(uc,ol,this.up),this.quaternion.setFromRotationMatrix(hs),s&&(hs.extractRotation(s.matrixWorld),kn.setFromRotationMatrix(hs),this.quaternion.premultiply(kn.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent($0),Bn.child=e,this.dispatchEvent(Bn),Bn.child=null),this}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(zw),vp.child=e,this.dispatchEvent(vp),vp.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),hs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),hs.multiply(e.parent.matrixWorld)),e.applyMatrix4(hs),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent($0),Bn.child=e,this.dispatchEvent(Bn),Bn.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const s=this.children;for(let a=0,n=s.length;a<n;a++)s[a].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ol,e,kw),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ol,Bw,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,s=t.length;r<s;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,s=t.length;r<s;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,s=t.length;r<s;r++){const a=t[r];a.matrixWorldAutoUpdate!==!0&&e!==!0||a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let a=0,n=s.length;a<n;a++){const o=s[a];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let h=0,c=l.length;h<c;h++){const u=l[h];a(e.shapes,u)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,h=this.material.length;l<h;l++)o.push(a(e.materials,this.material[l]));s.material=o}else s.material=a(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(a(e.animations,l))}}if(t){const o=n(e.geometries),l=n(e.materials),h=n(e.textures),c=n(e.images),u=n(e.shapes),d=n(e.skeletons),p=n(e.animations),f=n(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),h.length>0&&(r.textures=h),c.length>0&&(r.images=c),u.length>0&&(r.shapes=u),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=s,r;function n(o){const l=[];for(const h in o){const c=o[h];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}Ue.DEFAULT_UP=new S(0,1,0),Ue.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ue.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wr=new S,cs=new S,_p=new S,us=new S,zn=new S,Vn=new S,ev=new S,yp=new S,xp=new S,Mp=new S;class $i{constructor(e=new S,t=new S,r=new S){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,s){s.subVectors(r,t),wr.subVectors(e,t),s.cross(wr);const a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}static getBarycoord(e,t,r,s,a){wr.subVectors(s,t),cs.subVectors(r,t),_p.subVectors(e,t);const n=wr.dot(wr),o=wr.dot(cs),l=wr.dot(_p),h=cs.dot(cs),c=cs.dot(_p),u=n*h-o*o;if(u===0)return a.set(0,0,0),null;const d=1/u,p=(h*l-o*c)*d,f=(n*c-o*l)*d;return a.set(1-p-f,f,p)}static containsPoint(e,t,r,s){return this.getBarycoord(e,t,r,s,us)!==null&&us.x>=0&&us.y>=0&&us.x+us.y<=1}static getInterpolation(e,t,r,s,a,n,o,l){return this.getBarycoord(e,t,r,s,us)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(a,us.x),l.addScaledVector(n,us.y),l.addScaledVector(o,us.z),l)}static isFrontFacing(e,t,r,s){return wr.subVectors(r,t),cs.subVectors(e,t),wr.cross(cs).dot(s)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,s){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,r,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return wr.subVectors(this.c,this.b),cs.subVectors(this.a,this.b),.5*wr.cross(cs).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $i.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $i.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,s,a){return $i.getInterpolation(e,this.a,this.b,this.c,t,r,s,a)}containsPoint(e){return $i.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $i.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,s=this.b,a=this.c;let n,o;zn.subVectors(s,r),Vn.subVectors(a,r),yp.subVectors(e,r);const l=zn.dot(yp),h=Vn.dot(yp);if(l<=0&&h<=0)return t.copy(r);xp.subVectors(e,s);const c=zn.dot(xp),u=Vn.dot(xp);if(c>=0&&u<=c)return t.copy(s);const d=l*u-c*h;if(d<=0&&l>=0&&c<=0)return n=l/(l-c),t.copy(r).addScaledVector(zn,n);Mp.subVectors(e,a);const p=zn.dot(Mp),f=Vn.dot(Mp);if(f>=0&&p<=f)return t.copy(a);const v=p*h-l*f;if(v<=0&&h>=0&&f<=0)return o=h/(h-f),t.copy(r).addScaledVector(Vn,o);const m=c*f-p*u;if(m<=0&&u-c>=0&&p-f>=0)return ev.subVectors(a,s),o=(u-c)/(u-c+(p-f)),t.copy(s).addScaledVector(ev,o);const g=1/(m+v+d);return n=v*g,o=d*g,t.copy(r).addScaledVector(zn,n).addScaledVector(Vn,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const zx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},zs={h:0,s:0,l:0},dc={h:0,s:0,l:0};function bp(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+6*(e-i)*t:t<.5?e:t<2/3?i+6*(e-i)*(2/3-t):i}let oe=class{constructor(i,e,t){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(i,e,t)}set(i,e,t){if(e===void 0&&t===void 0){const r=i;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(i,e,t);return this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,e=ft){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(255&i)/255,rt.toWorkingColorSpace(this,e),this}setRGB(i,e,t,r=rt.workingColorSpace){return this.r=i,this.g=e,this.b=t,rt.toWorkingColorSpace(this,r),this}setHSL(i,e,t,r=rt.workingColorSpace){if(i=gf(i,1),e=Pt(e,0,1),t=Pt(t,0,1),e===0)this.r=this.g=this.b=t;else{const s=t<=.5?t*(1+e):t+e-t*e,a=2*t-s;this.r=bp(a,s,i+1/3),this.g=bp(a,s,i),this.b=bp(a,s,i-1/3)}return rt.toWorkingColorSpace(this,r),this}setStyle(i,e=ft){function t(s){}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(i)){let s;const a=r[1],n=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(i)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(s,16),e)}else if(i&&i.length>0)return this.setColorName(i,e);return this}setColorName(i,e=ft){const t=zx[i.toLowerCase()];return t!==void 0&&this.setHex(t,e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=yo(i.r),this.g=yo(i.g),this.b=yo(i.b),this}copyLinearToSRGB(i){return this.r=hp(i.r),this.g=hp(i.g),this.b=hp(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=ft){return rt.fromWorkingColorSpace(yi.copy(this),i),65536*Math.round(Pt(255*yi.r,0,255))+256*Math.round(Pt(255*yi.g,0,255))+Math.round(Pt(255*yi.b,0,255))}getHexString(i=ft){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,e=rt.workingColorSpace){rt.fromWorkingColorSpace(yi.copy(this),e);const t=yi.r,r=yi.g,s=yi.b,a=Math.max(t,r,s),n=Math.min(t,r,s);let o,l;const h=(n+a)/2;if(n===a)o=0,l=0;else{const c=a-n;switch(l=h<=.5?c/(a+n):c/(2-a-n),a){case t:o=(r-s)/c+(r<s?6:0);break;case r:o=(s-t)/c+2;break;case s:o=(t-r)/c+4}o/=6}return i.h=o,i.s=l,i.l=h,i}getRGB(i,e=rt.workingColorSpace){return rt.fromWorkingColorSpace(yi.copy(this),e),i.r=yi.r,i.g=yi.g,i.b=yi.b,i}getStyle(i=ft){rt.fromWorkingColorSpace(yi.copy(this),i);const e=yi.r,t=yi.g,r=yi.b;return i!==ft?`color(${i} ${e.toFixed(3)} ${t.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*t)},${Math.round(255*r)})`}offsetHSL(i,e,t){return this.getHSL(zs),this.setHSL(zs.h+i,zs.s+e,zs.l+t)}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,e){return this.r=i.r+e.r,this.g=i.g+e.g,this.b=i.b+e.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,e){return this.r+=(i.r-this.r)*e,this.g+=(i.g-this.g)*e,this.b+=(i.b-this.b)*e,this}lerpColors(i,e,t){return this.r=i.r+(e.r-i.r)*t,this.g=i.g+(e.g-i.g)*t,this.b=i.b+(e.b-i.b)*t,this}lerpHSL(i,e){this.getHSL(zs),i.getHSL(dc);const t=jl(zs.h,dc.h,e),r=jl(zs.s,dc.s,e),s=jl(zs.l,dc.l,e);return this.setHSL(t,r,s),this}setFromVector3(i){return this.r=i.x,this.g=i.y,this.b=i.z,this}applyMatrix3(i){const e=this.r,t=this.g,r=this.b,s=i.elements;return this.r=s[0]*e+s[3]*t+s[6]*r,this.g=s[1]*e+s[4]*t+s[7]*r,this.b=s[2]*e+s[5]*t+s[8]*r,this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,e=0){return this.r=i[e],this.g=i[e+1],this.b=i[e+2],this}toArray(i=[],e=0){return i[e]=this.r,i[e+1]=this.g,i[e+2]=this.b,i}fromBufferAttribute(i,e){return this.r=i.getX(e),this.g=i.getY(e),this.b=i.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const yi=new oe;oe.NAMES=zx;let Vw=0;class Xt extends ts{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Vw++}),this.uuid=rr(),this.name="",this.type="Material",this.blending=1,this.side=gr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ca,this.blendDst=ua,this.blendEquation=Ji,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new oe(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Za,this.stencilZFail=Za,this.stencilZPass=Za,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0)continue;const s=this[t];s!==void 0&&(s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[t]=r)}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function s(a){const n=[];for(const o in a){const l=a[o];delete l.metadata,n.push(l)}return n}if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(r.blending=this.blending),this.side!==gr&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==ca&&(r.blendSrc=this.blendSrc),this.blendDst!==ua&&(r.blendDst=this.blendDst),this.blendEquation!==Ji&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==3&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==519&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Za&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Za&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Za&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const a=s(e.textures),n=s(e.images);a.length>0&&(r.textures=a),n.length>0&&(r.images=n)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const s=t.length;r=new Array(s);for(let a=0;a!==s;++a)r[a]=t[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Wt extends Xt{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new oe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yt,this.combine=Vh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const xs=Hw();function Hw(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),r=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const h=l-127;h<-27?(r[l]=0,r[256|l]=32768,s[l]=24,s[256|l]=24):h<-14?(r[l]=1024>>-h-14,r[256|l]=1024>>-h-14|32768,s[l]=-h-1,s[256|l]=-h-1):h<=15?(r[l]=h+15<<10,r[256|l]=h+15<<10|32768,s[l]=13,s[256|l]=13):h<128?(r[l]=31744,r[256|l]=64512,s[l]=24,s[256|l]=24):(r[l]=31744,r[256|l]=64512,s[l]=13,s[256|l]=13)}const a=new Uint32Array(2048),n=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let h=l<<13,c=0;for(;!(8388608&h);)h<<=1,c-=8388608;h&=-8388609,c+=947912704,a[l]=h|c}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)n[l]=l<<23;n[31]=1199570944,n[32]=2147483648;for(let l=33;l<63;++l)n[l]=2147483648+(l-32<<23);n[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:s,mantissaTable:a,exponentTable:n,offsetTable:o}}function Ui(i){i=Pt(i,-65504,65504),xs.floatView[0]=i;const e=xs.uint32View[0],t=e>>23&511;return xs.baseTable[t]+((8388607&e)>>xs.shiftTable[t])}function Dl(i){const e=i>>10;return xs.uint32View[0]=xs.mantissaTable[xs.offsetTable[e]+(1023&i)]+xs.exponentTable[e],xs.floatView[0]}const Gw={toHalfFloat:Ui,fromHalfFloat:Dl},Yt=new S,pc=new X;class Ze{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=hh,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=tr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Mg("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let s=0,a=this.itemSize;s<a;s++)this.array[e+s]=t.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)pc.fromBufferAttribute(this,t),pc.applyMatrix3(e),this.setXY(t,pc.x,pc.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Yt.fromBufferAttribute(this,t),Yt.applyMatrix3(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Yt.fromBufferAttribute(this,t),Yt.applyMatrix4(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Yt.fromBufferAttribute(this,t),Yt.applyNormalMatrix(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Yt.fromBufferAttribute(this,t),Yt.transformDirection(e),this.setXYZ(t,Yt.x,Yt.y,Yt.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Li(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Oe(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Li(t,this.array)),t}setX(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Li(t,this.array)),t}setY(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Li(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Li(t,this.array)),t}setW(e,t){return this.normalized&&(t=Oe(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Oe(t,this.array),r=Oe(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,s){return e*=this.itemSize,this.normalized&&(t=Oe(t,this.array),r=Oe(r,this.array),s=Oe(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,t,r,s,a){return e*=this.itemSize,this.normalized&&(t=Oe(t,this.array),r=Oe(r,this.array),s=Oe(s,this.array),a=Oe(a,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==hh&&(e.usage=this.usage),e}}class Ld extends Ze{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class bg extends Ze{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class _e extends Ze{constructor(e,t,r){super(new Float32Array(e),t,r)}}let jw=0;const or=new me,wp=new Ue,Hn=new S,qi=new vt,ll=new vt,ni=new S;class Re extends ts{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:jw++}),this.uuid=rr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ux(e)?bg:Ld)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const a=new De().getNormalMatrix(e);r.applyNormalMatrix(a),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return or.makeRotationFromQuaternion(e),this.applyMatrix4(or),this}rotateX(e){return or.makeRotationX(e),this.applyMatrix4(or),this}rotateY(e){return or.makeRotationY(e),this.applyMatrix4(or),this}rotateZ(e){return or.makeRotationZ(e),this.applyMatrix4(or),this}translate(e,t,r){return or.makeTranslation(e,t,r),this.applyMatrix4(or),this}scale(e,t,r){return or.makeScale(e,t,r),this.applyMatrix4(or),this}lookAt(e){return wp.lookAt(e),wp.updateMatrix(),this.applyMatrix4(wp.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hn).negate(),this.translate(Hn.x,Hn.y,Hn.z),this}setFromPoints(e){const t=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new _e(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));else{if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){const a=t[r];qi.setFromBufferAttribute(a),this.morphTargetsRelative?(ni.addVectors(this.boundingBox.min,qi.min),this.boundingBox.expandByPoint(ni),ni.addVectors(this.boundingBox.max,qi.max),this.boundingBox.expandByPoint(ni)):(this.boundingBox.expandByPoint(qi.min),this.boundingBox.expandByPoint(qi.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ii);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new S,1/0);else if(e){const r=this.boundingSphere.center;if(qi.setFromBufferAttribute(e),t)for(let a=0,n=t.length;a<n;a++){const o=t[a];ll.setFromBufferAttribute(o),this.morphTargetsRelative?(ni.addVectors(qi.min,ll.min),qi.expandByPoint(ni),ni.addVectors(qi.max,ll.max),qi.expandByPoint(ni)):(qi.expandByPoint(ll.min),qi.expandByPoint(ll.max))}qi.getCenter(r);let s=0;for(let a=0,n=e.count;a<n;a++)ni.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(ni));if(t)for(let a=0,n=t.length;a<n;a++){const o=t[a],l=this.morphTargetsRelative;for(let h=0,c=o.count;h<c;h++)ni.fromBufferAttribute(o,h),l&&(Hn.fromBufferAttribute(e,h),ni.add(Hn)),s=Math.max(s,r.distanceToSquared(ni))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0)return;const r=t.position,s=t.normal,a=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ze(new Float32Array(4*r.count),4));const n=this.getAttribute("tangent"),o=[],l=[];for(let T=0;T<r.count;T++)o[T]=new S,l[T]=new S;const h=new S,c=new S,u=new S,d=new X,p=new X,f=new X,v=new S,m=new S;function g(T,R,I){h.fromBufferAttribute(r,T),c.fromBufferAttribute(r,R),u.fromBufferAttribute(r,I),d.fromBufferAttribute(a,T),p.fromBufferAttribute(a,R),f.fromBufferAttribute(a,I),c.sub(h),u.sub(h),p.sub(d),f.sub(d);const E=1/(p.x*f.y-f.x*p.y);isFinite(E)&&(v.copy(c).multiplyScalar(f.y).addScaledVector(u,-p.y).multiplyScalar(E),m.copy(u).multiplyScalar(p.x).addScaledVector(c,-f.x).multiplyScalar(E),o[T].add(v),o[R].add(v),o[I].add(v),l[T].add(m),l[R].add(m),l[I].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:e.count}]);for(let T=0,R=_.length;T<R;++T){const I=_[T],E=I.start;for(let L=E,D=E+I.count;L<D;L+=3)g(e.getX(L+0),e.getX(L+1),e.getX(L+2))}const y=new S,x=new S,M=new S,b=new S;function w(T){M.fromBufferAttribute(s,T),b.copy(M);const R=o[T];y.copy(R),y.sub(M.multiplyScalar(M.dot(R))).normalize(),x.crossVectors(b,R);const I=x.dot(l[T])<0?-1:1;n.setXYZW(T,y.x,y.y,y.z,I)}for(let T=0,R=_.length;T<R;++T){const I=_[T],E=I.start;for(let L=E,D=E+I.count;L<D;L+=3)w(e.getX(L+0)),w(e.getX(L+1)),w(e.getX(L+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Ze(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const s=new S,a=new S,n=new S,o=new S,l=new S,h=new S,c=new S,u=new S;if(e)for(let d=0,p=e.count;d<p;d+=3){const f=e.getX(d+0),v=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,f),a.fromBufferAttribute(t,v),n.fromBufferAttribute(t,m),c.subVectors(n,a),u.subVectors(s,a),c.cross(u),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,v),h.fromBufferAttribute(r,m),o.add(c),l.add(c),h.add(c),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(m,h.x,h.y,h.z)}else for(let d=0,p=t.count;d<p;d+=3)s.fromBufferAttribute(t,d+0),a.fromBufferAttribute(t,d+1),n.fromBufferAttribute(t,d+2),c.subVectors(n,a),u.subVectors(s,a),c.cross(u),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)ni.fromBufferAttribute(e,t),ni.normalize(),e.setXYZ(t,ni.x,ni.y,ni.z)}toNonIndexed(){function e(o,l){const h=o.array,c=o.itemSize,u=o.normalized,d=new h.constructor(l.length*c);let p=0,f=0;for(let v=0,m=l.length;v<m;v++){p=o.isInterleavedBufferAttribute?l[v]*o.data.stride+o.offset:l[v]*c;for(let g=0;g<c;g++)d[f++]=h[p++]}return new Ze(d,c,u)}if(this.index===null)return this;const t=new Re,r=this.index.array,s=this.attributes;for(const o in s){const l=e(s[o],r);t.setAttribute(o,l)}const a=this.morphAttributes;for(const o in a){const l=[],h=a[o];for(let c=0,u=h.length;c<u;c++){const d=e(h[c],r);l.push(d)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const n=this.groups;for(let o=0,l=n.length;o<l;o++){const h=n[o];t.addGroup(h.start,h.count,h.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const h in l)l[h]!==void 0&&(e[h]=l[h]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const h=r[l];e.data.attributes[l]=h.toJSON(e.data)}const s={};let a=!1;for(const l in this.morphAttributes){const h=this.morphAttributes[l],c=[];for(let u=0,d=h.length;u<d;u++){const p=h[u];c.push(p.toJSON(e.data))}c.length>0&&(s[l]=c,a=!0)}a&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const n=this.groups;n.length>0&&(e.data.groups=JSON.parse(JSON.stringify(n)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const s=e.attributes;for(const h in s){const c=s[h];this.setAttribute(h,c.clone(t))}const a=e.morphAttributes;for(const h in a){const c=[],u=a[h];for(let d=0,p=u.length;d<p;d++)c.push(u[d].clone(t));this.morphAttributes[h]=c}this.morphTargetsRelative=e.morphTargetsRelative;const n=e.groups;for(let h=0,c=n.length;h<c;h++){const u=n[h];this.addGroup(u.start,u.count,u.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const tv=new me,Ia=new Rn,mc=new ii,iv=new S,Gn=new S,jn=new S,Wn=new S,Sp=new S,fc=new S,gc=new X,vc=new X,_c=new X,rv=new S,sv=new S,av=new S,yc=new S,xc=new S;class ue extends Ue{constructor(e=new Re,t=new Wt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}getVertexPosition(e,t){const r=this.geometry,s=r.attributes.position,a=r.morphAttributes.position,n=r.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(a&&o){fc.set(0,0,0);for(let l=0,h=a.length;l<h;l++){const c=o[l],u=a[l];c!==0&&(Sp.fromBufferAttribute(u,e),n?fc.addScaledVector(Sp,c):fc.addScaledVector(Sp.sub(t),c))}t.add(fc)}return t}raycast(e,t){const r=this.geometry,s=this.material,a=this.matrixWorld;if(s!==void 0){if(r.boundingSphere===null&&r.computeBoundingSphere(),mc.copy(r.boundingSphere),mc.applyMatrix4(a),Ia.copy(e.ray).recast(e.near),mc.containsPoint(Ia.origin)===!1&&(Ia.intersectSphere(mc,iv)===null||Ia.origin.distanceToSquared(iv)>mw(e.far-e.near,2)))return;tv.copy(a).invert(),Ia.copy(e.ray).applyMatrix4(tv),r.boundingBox!==null&&Ia.intersectsBox(r.boundingBox)===!1||this._computeIntersections(e,t,Ia)}}_computeIntersections(e,t,r){let s;const a=this.geometry,n=this.material,o=a.index,l=a.attributes.position,h=a.attributes.uv,c=a.attributes.uv1,u=a.attributes.normal,d=a.groups,p=a.drawRange;if(o!==null)if(Array.isArray(n))for(let f=0,v=d.length;f<v;f++){const m=d[f],g=n[m.materialIndex];for(let _=Math.max(m.start,p.start),y=Math.min(o.count,Math.min(m.start+m.count,p.start+p.count));_<y;_+=3)s=Mc(this,g,e,r,h,c,u,o.getX(_),o.getX(_+1),o.getX(_+2)),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}else for(let f=Math.max(0,p.start),v=Math.min(o.count,p.start+p.count);f<v;f+=3)s=Mc(this,n,e,r,h,c,u,o.getX(f),o.getX(f+1),o.getX(f+2)),s&&(s.faceIndex=Math.floor(f/3),t.push(s));else if(l!==void 0)if(Array.isArray(n))for(let f=0,v=d.length;f<v;f++){const m=d[f],g=n[m.materialIndex];for(let _=Math.max(m.start,p.start),y=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));_<y;_+=3)s=Mc(this,g,e,r,h,c,u,_,_+1,_+2),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}else for(let f=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);f<v;f+=3)s=Mc(this,n,e,r,h,c,u,f,f+1,f+2),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}function Mc(i,e,t,r,s,a,n,o,l,h){i.getVertexPosition(o,Gn),i.getVertexPosition(l,jn),i.getVertexPosition(h,Wn);const c=function(u,d,p,f,v,m,g,_){let y;if(y=d.side===Si?f.intersectTriangle(g,m,v,!0,_):f.intersectTriangle(v,m,g,d.side===gr,_),y===null)return null;xc.copy(_),xc.applyMatrix4(u.matrixWorld);const x=p.ray.origin.distanceTo(xc);return x<p.near||x>p.far?null:{distance:x,point:xc.clone(),object:u}}(i,e,t,r,Gn,jn,Wn,yc);if(c){s&&(gc.fromBufferAttribute(s,o),vc.fromBufferAttribute(s,l),_c.fromBufferAttribute(s,h),c.uv=$i.getInterpolation(yc,Gn,jn,Wn,gc,vc,_c,new X)),a&&(gc.fromBufferAttribute(a,o),vc.fromBufferAttribute(a,l),_c.fromBufferAttribute(a,h),c.uv1=$i.getInterpolation(yc,Gn,jn,Wn,gc,vc,_c,new X)),n&&(rv.fromBufferAttribute(n,o),sv.fromBufferAttribute(n,l),av.fromBufferAttribute(n,h),c.normal=$i.getInterpolation(yc,Gn,jn,Wn,rv,sv,av,new S),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const u={a:o,b:l,c:h,normal:new S,materialIndex:0};$i.getNormal(Gn,jn,Wn,u.normal),c.face=u}return c}class St extends Re{constructor(e=1,t=1,r=1,s=1,a=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:s,heightSegments:a,depthSegments:n};const o=this;s=Math.floor(s),a=Math.floor(a),n=Math.floor(n);const l=[],h=[],c=[],u=[];let d=0,p=0;function f(v,m,g,_,y,x,M,b,w,T,R){const I=x/w,E=M/T,L=x/2,D=M/2,U=b/2,H=w+1,Z=T+1;let te=0,ie=0;const ve=new S;for(let be=0;be<Z;be++){const J=be*E-D;for(let ne=0;ne<H;ne++){const de=ne*I-L;ve[v]=de*_,ve[m]=J*y,ve[g]=U,h.push(ve.x,ve.y,ve.z),ve[v]=0,ve[m]=0,ve[g]=b>0?1:-1,c.push(ve.x,ve.y,ve.z),u.push(ne/w),u.push(1-be/T),te+=1}}for(let be=0;be<T;be++)for(let J=0;J<w;J++){const ne=d+J+H*be,de=d+J+H*(be+1),re=d+(J+1)+H*(be+1),N=d+(J+1)+H*be;l.push(ne,de,N),l.push(de,re,N),ie+=6}o.addGroup(p,ie,R),p+=ie,d+=te}f("z","y","x",-1,-1,r,t,e,n,a,0),f("z","y","x",1,-1,r,t,-e,n,a,1),f("x","z","y",1,1,e,r,t,s,n,2),f("x","z","y",1,-1,e,r,-t,s,n,3),f("x","y","z",1,-1,e,t,r,s,a,4),f("x","y","z",-1,-1,e,t,-r,s,a,5),this.setIndex(l),this.setAttribute("position",new _e(h,3)),this.setAttribute("normal",new _e(c,3)),this.setAttribute("uv",new _e(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new St(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Fo(i){const e={};for(const t in i){e[t]={};for(const r in i[t]){const s=i[t][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?e[t][r]=null:e[t][r]=s.clone():Array.isArray(s)?e[t][r]=s.slice():e[t][r]=s}}return e}function Ei(i){const e={};for(let t=0;t<i.length;t++){const r=Fo(i[t]);for(const s in r)e[s]=r[s]}return e}function Vx(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:rt.workingColorSpace}const Kt={clone:Fo,merge:Ei};class tt extends Xt{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Fo(e.uniforms),this.uniformsGroups=function(t){const r=[];for(let s=0;s<t.length;s++)r.push(t[s].clone());return r}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class Nd extends Ue{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new me,this.projectionMatrix=new me,this.projectionMatrixInverse=new me,this.coordinateSystem=bn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Vs=new S,nv=new X,ov=new X;class Gt extends Nd{constructor(e=50,t=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Uo*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*cn*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Uo*Math.atan(Math.tan(.5*cn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){Vs.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Vs.x,Vs.y).multiplyScalar(-e/Vs.z),Vs.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Vs.x,Vs.y).multiplyScalar(-e/Vs.z)}getViewSize(e,t){return this.getViewBounds(e,nv,ov),t.subVectors(ov,nv)}setViewOffset(e,t,r,s,a,n){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*cn*this.fov)/this.zoom,r=2*t,s=this.aspect*r,a=-.5*s;const n=this.view;if(this.view!==null&&this.view.enabled){const l=n.fullWidth,h=n.fullHeight;a+=n.offsetX*s/l,t-=n.offsetY*r/h,s*=n.width/l,r*=n.height/h}const o=this.filmOffset;o!==0&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+s,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Xn=-90;class Hx extends Ue{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Gt(Xn,1,e,t);s.layers=this.layers,this.add(s);const a=new Gt(Xn,1,e,t);a.layers=this.layers,this.add(a);const n=new Gt(Xn,1,e,t);n.layers=this.layers,this.add(n);const o=new Gt(Xn,1,e,t);o.layers=this.layers,this.add(o);const l=new Gt(Xn,1,e,t);l.layers=this.layers,this.add(l);const h=new Gt(Xn,1,e,t);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,s,a,n,o,l]=t;for(const h of t)this.remove(h);if(e===bn)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),n.up.set(0,0,1),n.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else{if(e!==ch)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),n.up.set(0,0,-1),n.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1)}for(const h of t)this.add(h),h.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,n,o,l,h,c]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,s),e.render(t,a),e.setRenderTarget(r,1,s),e.render(t,n),e.setRenderTarget(r,2,s),e.render(t,o),e.setRenderTarget(r,3,s),e.render(t,l),e.setRenderTarget(r,4,s),e.render(t,h),r.texture.generateMipmaps=v,e.setRenderTarget(r,5,s),e.render(t,c),e.setRenderTarget(u,d,p),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class dh extends pt{constructor(e,t,r,s,a,n,o,l,h,c){super(e=e!==void 0?e:[],t=t!==void 0?t:Es,r,s,a,n,o,l,h,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Gx extends ht{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new dh(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0&&t.generateMipmaps,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Vt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new St(5,5,5),a=new tt({name:"CubemapFromEquirect",uniforms:Fo(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Si,blending:0});a.uniforms.tEquirect.value=t;const n=new ue(s,a),o=t.minFilter;return t.minFilter===Qr&&(t.minFilter=Vt),new Hx(1,10,this).update(e,n),t.minFilter=o,n.geometry.dispose(),n.material.dispose(),this}clear(e,t,r,s){const a=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,s);e.setRenderTarget(a)}}const Tp=new S,Ww=new S,Xw=new De;class Cr{constructor(e=new S(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,s){return this.normal.set(e,t,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const s=Tp.subVectors(r,t).cross(Ww.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(Tp),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/s;return a<0||a>1?null:t.copy(e.start).addScaledVector(r,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||Xw.getNormalMatrix(e),s=this.coplanarPoint(Tp).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const La=new ii,bc=new S;class Gh{constructor(e=new Cr,t=new Cr,r=new Cr,s=new Cr,a=new Cr,n=new Cr){this.planes=[e,t,r,s,a,n]}set(e,t,r,s,a,n){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(s),o[4].copy(a),o[5].copy(n),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=2e3){const r=this.planes,s=e.elements,a=s[0],n=s[1],o=s[2],l=s[3],h=s[4],c=s[5],u=s[6],d=s[7],p=s[8],f=s[9],v=s[10],m=s[11],g=s[12],_=s[13],y=s[14],x=s[15];if(r[0].setComponents(l-a,d-h,m-p,x-g).normalize(),r[1].setComponents(l+a,d+h,m+p,x+g).normalize(),r[2].setComponents(l+n,d+c,m+f,x+_).normalize(),r[3].setComponents(l-n,d-c,m-f,x-_).normalize(),r[4].setComponents(l-o,d-u,m-v,x-y).normalize(),t===bn)r[5].setComponents(l+o,d+u,m+v,x+y).normalize();else{if(t!==ch)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(o,u,v,y).normalize()}return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),La.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),La.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(La)}intersectsSprite(e){return La.center.set(0,0,0),La.radius=.7071067811865476,La.applyMatrix4(e.matrixWorld),this.intersectsSphere(La)}intersectsSphere(e){const t=this.planes,r=e.center,s=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const s=t[r];if(bc.x=s.normal.x>0?e.max.x:e.min.x,bc.y=s.normal.y>0?e.max.y:e.min.y,bc.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(bc)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function jx(){let i=null,e=!1,t=null,r=null;function s(a,n){t(a,n),r=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(r=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){i=a}}}function qw(i){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const r=e.get(t);r&&(i.deleteBuffer(r.buffer),e.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const a=e.get(t);return void((!a||a.version<t.version)&&e.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=e.get(t);if(s===void 0)e.set(t,function(a,n){const o=a.array,l=a.usage,h=o.byteLength,c=i.createBuffer();let u;if(i.bindBuffer(n,c),i.bufferData(n,o,l),a.onUploadCallback(),o instanceof Float32Array)u=i.FLOAT;else if(o instanceof Uint16Array)u=a.isFloat16BufferAttribute?i.HALF_FLOAT:i.UNSIGNED_SHORT;else if(o instanceof Int16Array)u=i.SHORT;else if(o instanceof Uint32Array)u=i.UNSIGNED_INT;else if(o instanceof Int32Array)u=i.INT;else if(o instanceof Int8Array)u=i.BYTE;else if(o instanceof Uint8Array)u=i.UNSIGNED_BYTE;else{if(!(o instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+o);u=i.UNSIGNED_BYTE}return{buffer:c,type:u,bytesPerElement:o.BYTES_PER_ELEMENT,version:a.version,size:h}}(t,r));else if(s.version<t.version){if(s.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(a,n,o){const l=n.array,h=n._updateRange,c=n.updateRanges;if(i.bindBuffer(o,a),h.count===-1&&c.length===0&&i.bufferSubData(o,0,l),c.length!==0){for(let u=0,d=c.length;u<d;u++){const p=c[u];i.bufferSubData(o,p.start*l.BYTES_PER_ELEMENT,l,p.start,p.count)}n.clearUpdateRanges()}h.count!==-1&&(i.bufferSubData(o,h.offset*l.BYTES_PER_ELEMENT,l,h.offset,h.count),h.count=-1),n.onUploadCallback()})(s.buffer,t,r),s.version=t.version}}}}class as extends Re{constructor(e=1,t=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:s};const a=e/2,n=t/2,o=Math.floor(r),l=Math.floor(s),h=o+1,c=l+1,u=e/o,d=t/l,p=[],f=[],v=[],m=[];for(let g=0;g<c;g++){const _=g*d-n;for(let y=0;y<h;y++){const x=y*u-a;f.push(x,-_,0),v.push(0,0,1),m.push(y/o),m.push(1-g/l)}}for(let g=0;g<l;g++)for(let _=0;_<o;_++){const y=_+h*g,x=_+h*(g+1),M=_+1+h*(g+1),b=_+1+h*g;p.push(y,x,b),p.push(x,M,b)}this.setIndex(p),this.setAttribute("position",new _e(f,3)),this.setAttribute("normal",new _e(v,3)),this.setAttribute("uv",new _e(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new as(e.width,e.height,e.widthSegments,e.heightSegments)}}const Be={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex:`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex:`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( batchId );
	vColor.xyz *= batchingColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex:`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},ye={common:{diffuse:{value:new oe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new De},alphaMap:{value:null},alphaMapTransform:{value:new De},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new De}},envmap:{envMap:{value:null},envMapRotation:{value:new De},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new De}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new De}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new De},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new De},normalScale:{value:new X(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new De},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new De}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new De}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new De}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new oe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new oe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new De},alphaTest:{value:0},uvTransform:{value:new De}},sprite:{diffuse:{value:new oe(16777215)},opacity:{value:1},center:{value:new X(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new De},alphaMap:{value:null},alphaMapTransform:{value:new De},alphaTest:{value:0}}},Pi={basic:{uniforms:Ei([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.fog]),vertexShader:Be.meshbasic_vert,fragmentShader:Be.meshbasic_frag},lambert:{uniforms:Ei([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,ye.lights,{emissive:{value:new oe(0)}}]),vertexShader:Be.meshlambert_vert,fragmentShader:Be.meshlambert_frag},phong:{uniforms:Ei([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,ye.lights,{emissive:{value:new oe(0)},specular:{value:new oe(1118481)},shininess:{value:30}}]),vertexShader:Be.meshphong_vert,fragmentShader:Be.meshphong_frag},standard:{uniforms:Ei([ye.common,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.roughnessmap,ye.metalnessmap,ye.fog,ye.lights,{emissive:{value:new oe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Be.meshphysical_vert,fragmentShader:Be.meshphysical_frag},toon:{uniforms:Ei([ye.common,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.gradientmap,ye.fog,ye.lights,{emissive:{value:new oe(0)}}]),vertexShader:Be.meshtoon_vert,fragmentShader:Be.meshtoon_frag},matcap:{uniforms:Ei([ye.common,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,{matcap:{value:null}}]),vertexShader:Be.meshmatcap_vert,fragmentShader:Be.meshmatcap_frag},points:{uniforms:Ei([ye.points,ye.fog]),vertexShader:Be.points_vert,fragmentShader:Be.points_frag},dashed:{uniforms:Ei([ye.common,ye.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Be.linedashed_vert,fragmentShader:Be.linedashed_frag},depth:{uniforms:Ei([ye.common,ye.displacementmap]),vertexShader:Be.depth_vert,fragmentShader:Be.depth_frag},normal:{uniforms:Ei([ye.common,ye.bumpmap,ye.normalmap,ye.displacementmap,{opacity:{value:1}}]),vertexShader:Be.meshnormal_vert,fragmentShader:Be.meshnormal_frag},sprite:{uniforms:Ei([ye.sprite,ye.fog]),vertexShader:Be.sprite_vert,fragmentShader:Be.sprite_frag},background:{uniforms:{uvTransform:{value:new De},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Be.background_vert,fragmentShader:Be.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new De}},vertexShader:Be.backgroundCube_vert,fragmentShader:Be.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Be.cube_vert,fragmentShader:Be.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Be.equirect_vert,fragmentShader:Be.equirect_frag},distanceRGBA:{uniforms:Ei([ye.common,ye.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Be.distanceRGBA_vert,fragmentShader:Be.distanceRGBA_frag},shadow:{uniforms:Ei([ye.lights,ye.fog,{color:{value:new oe(0)},opacity:{value:1}}]),vertexShader:Be.shadow_vert,fragmentShader:Be.shadow_frag}};Pi.physical={uniforms:Ei([Pi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new De},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new De},clearcoatNormalScale:{value:new X(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new De},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new De},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new De},sheen:{value:0},sheenColor:{value:new oe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new De},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new De},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new De},transmissionSamplerSize:{value:new X},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new De},attenuationDistance:{value:0},attenuationColor:{value:new oe(0)},specularColor:{value:new oe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new De},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new De},anisotropyVector:{value:new X},anisotropyMap:{value:null},anisotropyMapTransform:{value:new De}}]),vertexShader:Be.meshphysical_vert,fragmentShader:Be.meshphysical_frag};const wc={r:0,b:0,g:0},Na=new yt,Yw=new me;function Zw(i,e,t,r,s,a,n){const o=new oe(0);let l,h,c=a===!0?0:1,u=null,d=0,p=null;function f(m){let g=m.isScene===!0?m.background:null;return g&&g.isTexture&&(g=(m.backgroundBlurriness>0?t:e).get(g)),g}function v(m,g){m.getRGB(wc,Vx(i)),r.buffers.color.setClear(wc.r,wc.g,wc.b,g,n)}return{getClearColor:function(){return o},setClearColor:function(m,g=1){o.set(m),c=g,v(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(m){c=m,v(o,c)},render:function(m){let g=!1;const _=f(m);_===null?v(o,c):_&&_.isColor&&(v(_,1),g=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?r.buffers.color.setClear(0,0,0,1,n):y==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,n),(i.autoClear||g)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))},addToRenderList:function(m,g){const _=f(g);_&&(_.isCubeTexture||_.mapping===Jo)?(h===void 0&&(h=new ue(new St(1,1,1),new tt({name:"BackgroundCubeMaterial",uniforms:Fo(Pi.backgroundCube.uniforms),vertexShader:Pi.backgroundCube.vertexShader,fragmentShader:Pi.backgroundCube.fragmentShader,side:Si,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(y,x,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),Na.copy(g.backgroundRotation),Na.x*=-1,Na.y*=-1,Na.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Na.y*=-1,Na.z*=-1),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(Yw.makeRotationFromEuler(Na)),h.material.toneMapped=rt.getTransfer(_.colorSpace)!==mt,u===_&&d===_.version&&p===i.toneMapping||(h.material.needsUpdate=!0,u=_,d=_.version,p=i.toneMapping),h.layers.enableAll(),m.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(l===void 0&&(l=new ue(new as(2,2),new tt({name:"BackgroundMaterial",uniforms:Fo(Pi.background.uniforms),vertexShader:Pi.background.vertexShader,fragmentShader:Pi.background.fragmentShader,side:gr,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=rt.getTransfer(_.colorSpace)!==mt,_.matrixAutoUpdate===!0&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),u===_&&d===_.version&&p===i.toneMapping||(l.material.needsUpdate=!0,u=_,d=_.version,p=i.toneMapping),l.layers.enableAll(),m.unshift(l,l.geometry,l.material,0,0,null))}}}function Kw(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),r={},s=h(null);let a=s,n=!1;function o(g){return i.bindVertexArray(g)}function l(g){return i.deleteVertexArray(g)}function h(g){const _=[],y=[],x=[];for(let M=0;M<t;M++)_[M]=0,y[M]=0,x[M]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:_,enabledAttributes:y,attributeDivisors:x,object:g,attributes:{},index:null}}function c(){const g=a.newAttributes;for(let _=0,y=g.length;_<y;_++)g[_]=0}function u(g){d(g,0)}function d(g,_){const y=a.newAttributes,x=a.enabledAttributes,M=a.attributeDivisors;y[g]=1,x[g]===0&&(i.enableVertexAttribArray(g),x[g]=1),M[g]!==_&&(i.vertexAttribDivisor(g,_),M[g]=_)}function p(){const g=a.newAttributes,_=a.enabledAttributes;for(let y=0,x=_.length;y<x;y++)_[y]!==g[y]&&(i.disableVertexAttribArray(y),_[y]=0)}function f(g,_,y,x,M,b,w){w===!0?i.vertexAttribIPointer(g,_,y,M,b):i.vertexAttribPointer(g,_,y,x,M,b)}function v(){m(),n=!0,a!==s&&(a=s,o(a.object))}function m(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(g,_,y,x,M){let b=!1;const w=function(T,R,I){const E=I.wireframe===!0;let L=r[T.id];L===void 0&&(L={},r[T.id]=L);let D=L[R.id];D===void 0&&(D={},L[R.id]=D);let U=D[E];return U===void 0&&(U=h(i.createVertexArray()),D[E]=U),U}(x,y,_);a!==w&&(a=w,o(a.object)),b=function(T,R,I,E){const L=a.attributes,D=R.attributes;let U=0;const H=I.getAttributes();for(const Z in H)if(H[Z].location>=0){const te=L[Z];let ie=D[Z];if(ie===void 0&&(Z==="instanceMatrix"&&T.instanceMatrix&&(ie=T.instanceMatrix),Z==="instanceColor"&&T.instanceColor&&(ie=T.instanceColor)),te===void 0||te.attribute!==ie||ie&&te.data!==ie.data)return!0;U++}return a.attributesNum!==U||a.index!==E}(g,x,y,M),b&&function(T,R,I,E){const L={},D=R.attributes;let U=0;const H=I.getAttributes();for(const Z in H)if(H[Z].location>=0){let te=D[Z];te===void 0&&(Z==="instanceMatrix"&&T.instanceMatrix&&(te=T.instanceMatrix),Z==="instanceColor"&&T.instanceColor&&(te=T.instanceColor));const ie={};ie.attribute=te,te&&te.data&&(ie.data=te.data),L[Z]=ie,U++}a.attributes=L,a.attributesNum=U,a.index=E}(g,x,y,M),M!==null&&e.update(M,i.ELEMENT_ARRAY_BUFFER),(b||n)&&(n=!1,function(T,R,I,E){c();const L=E.attributes,D=I.getAttributes(),U=R.defaultAttributeValues;for(const H in D){const Z=D[H];if(Z.location>=0){let te=L[H];if(te===void 0&&(H==="instanceMatrix"&&T.instanceMatrix&&(te=T.instanceMatrix),H==="instanceColor"&&T.instanceColor&&(te=T.instanceColor)),te!==void 0){const ie=te.normalized,ve=te.itemSize,be=e.get(te);if(be===void 0)continue;const J=be.buffer,ne=be.type,de=be.bytesPerElement,re=ne===i.INT||ne===i.UNSIGNED_INT||te.gpuType===cg;if(te.isInterleavedBufferAttribute){const N=te.data,P=N.stride,j=te.offset;if(N.isInstancedInterleavedBuffer){for(let K=0;K<Z.locationSize;K++)d(Z.location+K,N.meshPerAttribute);T.isInstancedMesh!==!0&&E._maxInstanceCount===void 0&&(E._maxInstanceCount=N.meshPerAttribute*N.count)}else for(let K=0;K<Z.locationSize;K++)u(Z.location+K);i.bindBuffer(i.ARRAY_BUFFER,J);for(let K=0;K<Z.locationSize;K++)f(Z.location+K,ve/Z.locationSize,ne,ie,P*de,(j+ve/Z.locationSize*K)*de,re)}else{if(te.isInstancedBufferAttribute){for(let N=0;N<Z.locationSize;N++)d(Z.location+N,te.meshPerAttribute);T.isInstancedMesh!==!0&&E._maxInstanceCount===void 0&&(E._maxInstanceCount=te.meshPerAttribute*te.count)}else for(let N=0;N<Z.locationSize;N++)u(Z.location+N);i.bindBuffer(i.ARRAY_BUFFER,J);for(let N=0;N<Z.locationSize;N++)f(Z.location+N,ve/Z.locationSize,ne,ie,ve*de,ve/Z.locationSize*N*de,re)}}else if(U!==void 0){const ie=U[H];if(ie!==void 0)switch(ie.length){case 2:i.vertexAttrib2fv(Z.location,ie);break;case 3:i.vertexAttrib3fv(Z.location,ie);break;case 4:i.vertexAttrib4fv(Z.location,ie);break;default:i.vertexAttrib1fv(Z.location,ie)}}}}p()}(g,_,y,x),M!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(M).buffer))},reset:v,resetDefaultState:m,dispose:function(){v();for(const g in r){const _=r[g];for(const y in _){const x=_[y];for(const M in x)l(x[M].object),delete x[M];delete _[y]}delete r[g]}},releaseStatesOfGeometry:function(g){if(r[g.id]===void 0)return;const _=r[g.id];for(const y in _){const x=_[y];for(const M in x)l(x[M].object),delete x[M];delete _[y]}delete r[g.id]},releaseStatesOfProgram:function(g){for(const _ in r){const y=r[_];if(y[g.id]===void 0)continue;const x=y[g.id];for(const M in x)l(x[M].object),delete x[M];delete y[g.id]}},initAttributes:c,enableAttribute:u,disableUnusedAttributes:p}}function Qw(i,e,t){let r;function s(a,n,o){o!==0&&(i.drawArraysInstanced(r,a,n,o),t.update(n,r,o))}this.setMode=function(a){r=a},this.render=function(a,n){i.drawArrays(r,a,n),t.update(n,r,1)},this.renderInstances=s,this.renderMultiDraw=function(a,n,o){if(o===0)return;const l=e.get("WEBGL_multi_draw");if(l===null)for(let h=0;h<o;h++)this.render(a[h],n[h]);else{l.multiDrawArraysWEBGL(r,a,0,n,0,o);let h=0;for(let c=0;c<o;c++)h+=n[c];t.update(h,r,1)}},this.renderMultiDrawInstances=function(a,n,o,l){if(o===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let c=0;c<a.length;c++)s(a[c],n[c],l[c]);else{h.multiDrawArraysInstancedWEBGL(r,a,0,n,0,l,0,o);let c=0;for(let u=0;u<o;u++)c+=n[u];for(let u=0;u<l.length;u++)t.update(c,r,l[u])}}}function Jw(i,e,t,r){let s;function a(u){if(u==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";u="mediump"}return u==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let n=t.precision!==void 0?t.precision:"highp";const o=a(n);o!==n&&(n=o);const l=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),c=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const u=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s},getMaxPrecision:a,textureFormatReadable:function(u){return u===fr||r.convert(u)===i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(u){const d=u===Ht&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(u!==xn&&r.convert(u)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&u!==tr&&!d)},precision:n,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:c,maxTextureSize:i.getParameter(i.MAX_TEXTURE_SIZE),maxCubemapSize:i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:i.getParameter(i.MAX_VERTEX_ATTRIBS),maxVertexUniforms:i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:i.getParameter(i.MAX_VARYING_VECTORS),maxFragmentUniforms:i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:c>0,maxSamples:i.getParameter(i.MAX_SAMPLES)}}function $w(i){const e=this;let t=null,r=0,s=!1,a=!1;const n=new Cr,o=new De,l={value:null,needsUpdate:!1};function h(c,u,d,p){const f=c!==null?c.length:0;let v=null;if(f!==0){if(v=l.value,p!==!0||v===null){const m=d+4*f,g=u.matrixWorldInverse;o.getNormalMatrix(g),(v===null||v.length<m)&&(v=new Float32Array(m));for(let _=0,y=d;_!==f;++_,y+=4)n.copy(c[_]).applyMatrix4(g,o),n.normal.toArray(v,y),v[y+3]=n.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=f,e.numIntersection=0,v}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(c,u){const d=c.length!==0||u||r!==0||s;return s=u,r=c.length,d},this.beginShadows=function(){a=!0,h(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(c,u){t=h(c,u,0)},this.setState=function(c,u,d){const p=c.clippingPlanes,f=c.clipIntersection,v=c.clipShadows,m=i.get(c);if(!s||p===null||p.length===0||a&&!v)a?h(null):function(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}();else{const g=a?0:r,_=4*g;let y=m.clippingState||null;l.value=y,y=h(p,u,_,d);for(let x=0;x!==_;++x)y[x]=t[x];m.clippingState=y,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=g}}}function eS(i){let e=new WeakMap;function t(s,a){return a===Io?s.mapping=Es:a===sh&&(s.mapping=da),s}function r(s){const a=s.target;a.removeEventListener("dispose",r);const n=e.get(a);n!==void 0&&(e.delete(a),n.dispose())}return{get:function(s){if(s&&s.isTexture){const a=s.mapping;if(a===Io||a===sh){if(e.has(s))return t(e.get(s).texture,s.mapping);{const n=s.image;if(n&&n.height>0){const o=new Gx(n.height);return o.fromEquirectangularTexture(i,s),e.set(s,o),s.addEventListener("dispose",r),t(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}class wn extends Nd{constructor(e=-1,t=1,r=1,s=-1,a=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=s,this.near=a,this.far=n,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,s,a,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let a=r-e,n=r+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=h*this.view.offsetX,n=a+h*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(a,n,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const lv=[.125,.215,.35,.446,.526,.582],Sc=20,Ap=new wn,hv=new oe;let Ep=null,Cp=0,Rp=0,Pp=!1;const Ka=(1+Math.sqrt(5))/2,qn=1/Ka,cv=[new S(-Ka,qn,0),new S(Ka,qn,0),new S(-qn,0,Ka),new S(qn,0,Ka),new S(0,Ka,-qn),new S(0,Ka,qn),new S(-1,1,-1),new S(1,1,-1),new S(-1,1,1),new S(1,1,1)];class _f{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,s=100){Ep=this._renderer.getRenderTarget(),Cp=this._renderer.getActiveCubeFace(),Rp=this._renderer.getActiveMipmapLevel(),Pp=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,r,s,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=pv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=dv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ep,Cp,Rp),this._renderer.xr.enabled=Pp,e.scissorTest=!1,Tc(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Es||e.mapping===da?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ep=this._renderer.getRenderTarget(),Cp=this._renderer.getActiveCubeFace(),Rp=this._renderer.getActiveMipmapLevel(),Pp=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Vt,minFilter:Vt,generateMipmaps:!1,type:Ht,format:fr,colorSpace:Qt,depthBuffer:!1},s=uv(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=uv(e,t,r);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(n){const o=[],l=[],h=[];let c=n;const u=n-4+1+lv.length;for(let d=0;d<u;d++){const p=Math.pow(2,c);l.push(p);let f=1/p;d>n-4?f=lv[d-n+4-1]:d===0&&(f=0),h.push(f);const v=1/(p-2),m=-v,g=1+v,_=[m,m,g,m,g,g,m,m,g,g,m,g],y=6,x=6,M=3,b=2,w=1,T=new Float32Array(M*x*y),R=new Float32Array(b*x*y),I=new Float32Array(w*x*y);for(let L=0;L<y;L++){const D=L%3*2/3-1,U=L>2?0:-1,H=[D,U,0,D+2/3,U,0,D+2/3,U+1,0,D,U,0,D+2/3,U+1,0,D,U+1,0];T.set(H,M*x*L),R.set(_,b*x*L);const Z=[L,L,L,L,L,L];I.set(Z,w*x*L)}const E=new Re;E.setAttribute("position",new Ze(T,M)),E.setAttribute("uv",new Ze(R,b)),E.setAttribute("faceIndex",new Ze(I,w)),o.push(E),c>4&&c--}return{lodPlanes:o,sizeLods:l,sigmas:h}}(a)),this._blurMaterial=function(n,o,l){const h=new Float32Array(Sc),c=new S(0,1,0);return new tt({name:"SphericalGaussianBlur",defines:{n:Sc,CUBEUV_TEXEL_WIDTH:1/o,CUBEUV_TEXEL_HEIGHT:1/l,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:h},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:c}},vertexShader:wg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(a,e,t)}return s}_compileMaterial(e){const t=new ue(this._lodPlanes[0],e);this._renderer.compile(t,Ap)}_sceneToCubeUV(e,t,r,s){const a=new Gt(90,1,t,r),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,h=l.autoClear,c=l.toneMapping;l.getClearColor(hv),l.toneMapping=Kr,l.autoClear=!1;const u=new Wt({name:"PMREM.Background",side:Si,depthWrite:!1,depthTest:!1}),d=new ue(new St,u);let p=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,p=!0):(u.color.copy(hv),p=!0);for(let v=0;v<6;v++){const m=v%3;m===0?(a.up.set(0,n[v],0),a.lookAt(o[v],0,0)):m===1?(a.up.set(0,0,n[v]),a.lookAt(0,o[v],0)):(a.up.set(0,n[v],0),a.lookAt(0,0,o[v]));const g=this._cubeSize;Tc(s,m*g,v>2?g:0,g,g),l.setRenderTarget(s),p&&l.render(d,a),l.render(e,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=c,l.autoClear=h,e.background=f}_textureToCubeUV(e,t){const r=this._renderer,s=e.mapping===Es||e.mapping===da;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=pv()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=dv());const a=s?this._cubemapMaterial:this._equirectMaterial,n=new ue(this._lodPlanes[0],a);a.uniforms.envMap.value=e;const o=this._cubeSize;Tc(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(n,Ap)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let a=1;a<s;a++){const n=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),o=cv[(s-a-1)%cv.length];this._blur(e,a-1,a,n,o)}t.autoClear=r}_blur(e,t,r,s,a){const n=this._pingPongRenderTarget;this._halfBlur(e,n,t,r,s,"latitudinal",a),this._halfBlur(n,e,r,r,s,"longitudinal",a)}_halfBlur(e,t,r,s,a,n,o){const l=this._renderer,h=this._blurMaterial,c=new ue(this._lodPlanes[s],h),u=h.uniforms,d=this._sizeLods[r]-1,p=isFinite(a)?Math.PI/(2*d):2*Math.PI/39,f=a/p,v=isFinite(a)?1+Math.floor(3*f):Sc,m=[];let g=0;for(let x=0;x<Sc;++x){const M=x/f,b=Math.exp(-M*M/2);m.push(b),x===0?g+=b:x<v&&(g+=2*b)}for(let x=0;x<m.length;x++)m[x]=m[x]/g;u.envMap.value=e.texture,u.samples.value=v,u.weights.value=m,u.latitudinal.value=n==="latitudinal",o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=p,u.mipInt.value=_-r;const y=this._sizeLods[s];Tc(t,3*y*(s>_-4?s-_+4:0),4*(this._cubeSize-y),3*y,2*y),l.setRenderTarget(t),l.render(c,Ap)}}function uv(i,e,t){const r=new ht(i,e,t);return r.texture.mapping=Jo,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Tc(i,e,t,r,s){i.viewport.set(e,t,r,s),i.scissor.set(e,t,r,s)}function dv(){return new tt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:wg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function pv(){return new tt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:wg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function wg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function tS(i){let e=new WeakMap,t=null;function r(s){const a=s.target;a.removeEventListener("dispose",r);const n=e.get(a);n!==void 0&&(e.delete(a),n.dispose())}return{get:function(s){if(s&&s.isTexture){const a=s.mapping,n=a===Io||a===sh,o=a===Es||a===da;if(n||o){let l=e.get(s);const h=l!==void 0?l.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==h)return t===null&&(t=new _f(i)),l=n?t.fromEquirectangular(s,l):t.fromCubemap(s,l),l.texture.pmremVersion=s.pmremVersion,e.set(s,l),l.texture;if(l!==void 0)return l.texture;{const c=s.image;return n&&c&&c.height>0||o&&c&&function(u){let d=0;const p=6;for(let f=0;f<p;f++)u[f]!==void 0&&d++;return d===p}(c)?(t===null&&(t=new _f(i)),l=n?t.fromEquirectangular(s):t.fromCubemap(s),l.texture.pmremVersion=s.pmremVersion,e.set(s,l),s.addEventListener("dispose",r),l.texture):null}}}return s},dispose:function(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}}}function iS(i){const e={};function t(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(r)}return e[r]=s,s}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const s=t(r);return s===null&&Mg("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function rS(i,e,t,r){const s={},a=new WeakMap;function n(l){const h=l.target;h.index!==null&&e.remove(h.index);for(const u in h.attributes)e.remove(h.attributes[u]);for(const u in h.morphAttributes){const d=h.morphAttributes[u];for(let p=0,f=d.length;p<f;p++)e.remove(d[p])}h.removeEventListener("dispose",n),delete s[h.id];const c=a.get(h);c&&(e.remove(c),a.delete(h)),r.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function o(l){const h=[],c=l.index,u=l.attributes.position;let d=0;if(c!==null){const v=c.array;d=c.version;for(let m=0,g=v.length;m<g;m+=3){const _=v[m+0],y=v[m+1],x=v[m+2];h.push(_,y,y,x,x,_)}}else{if(u===void 0)return;{const v=u.array;d=u.version;for(let m=0,g=v.length/3-1;m<g;m+=3){const _=m+0,y=m+1,x=m+2;h.push(_,y,y,x,x,_)}}}const p=new(Ux(h)?bg:Ld)(h,1);p.version=d;const f=a.get(l);f&&e.remove(f),a.set(l,p)}return{get:function(l,h){return s[h.id]===!0||(h.addEventListener("dispose",n),s[h.id]=!0,t.memory.geometries++),h},update:function(l){const h=l.attributes;for(const u in h)e.update(h[u],i.ARRAY_BUFFER);const c=l.morphAttributes;for(const u in c){const d=c[u];for(let p=0,f=d.length;p<f;p++)e.update(d[p],i.ARRAY_BUFFER)}},getWireframeAttribute:function(l){const h=a.get(l);if(h){const c=l.index;c!==null&&h.version<c.version&&o(l)}else o(l);return a.get(l)}}}function sS(i,e,t){let r,s,a;function n(o,l,h){h!==0&&(i.drawElementsInstanced(r,l,s,o*a,h),t.update(l,r,h))}this.setMode=function(o){r=o},this.setIndex=function(o){s=o.type,a=o.bytesPerElement},this.render=function(o,l){i.drawElements(r,l,s,o*a),t.update(l,r,1)},this.renderInstances=n,this.renderMultiDraw=function(o,l,h){if(h===0)return;const c=e.get("WEBGL_multi_draw");if(c===null)for(let u=0;u<h;u++)this.render(o[u]/a,l[u]);else{c.multiDrawElementsWEBGL(r,l,0,s,o,0,h);let u=0;for(let d=0;d<h;d++)u+=l[d];t.update(u,r,1)}},this.renderMultiDrawInstances=function(o,l,h,c){if(h===0)return;const u=e.get("WEBGL_multi_draw");if(u===null)for(let d=0;d<o.length;d++)n(o[d]/a,l[d],c[d]);else{u.multiDrawElementsInstancedWEBGL(r,l,0,s,o,0,c,0,h);let d=0;for(let p=0;p<h;p++)d+=l[p];for(let p=0;p<c.length;p++)t.update(d,r,c[p])}}}function aS(i){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,s){switch(e.calls++,r){case i.TRIANGLES:e.triangles+=s*(t/3);break;case i.LINES:e.lines+=s*(t/2);break;case i.LINE_STRIP:e.lines+=s*(t-1);break;case i.LINE_LOOP:e.lines+=s*t;break;case i.POINTS:e.points+=s*t}}}}function nS(i,e,t){const r=new WeakMap,s=new Ve;return{update:function(a,n,o){const l=a.morphTargetInfluences,h=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,c=h!==void 0?h.length:0;let u=r.get(n);if(u===void 0||u.count!==c){u!==void 0&&u.texture.dispose();const d=n.morphAttributes.position!==void 0,p=n.morphAttributes.normal!==void 0,f=n.morphAttributes.color!==void 0,v=n.morphAttributes.position||[],m=n.morphAttributes.normal||[],g=n.morphAttributes.color||[];let _=0;d===!0&&(_=1),p===!0&&(_=2),f===!0&&(_=3);let y=n.attributes.position.count*_,x=1;y>e.maxTextureSize&&(x=Math.ceil(y/e.maxTextureSize),y=e.maxTextureSize);const M=new Float32Array(y*x*4*c),b=new Hu(M,y,x,c);b.type=tr,b.needsUpdate=!0;const w=4*_;for(let T=0;T<c;T++){const R=v[T],I=m[T],E=g[T],L=y*x*4*T;for(let D=0;D<R.count;D++){const U=D*w;d===!0&&(s.fromBufferAttribute(R,D),M[L+U+0]=s.x,M[L+U+1]=s.y,M[L+U+2]=s.z,M[L+U+3]=0),p===!0&&(s.fromBufferAttribute(I,D),M[L+U+4]=s.x,M[L+U+5]=s.y,M[L+U+6]=s.z,M[L+U+7]=0),f===!0&&(s.fromBufferAttribute(E,D),M[L+U+8]=s.x,M[L+U+9]=s.y,M[L+U+10]=s.z,M[L+U+11]=E.itemSize===4?s.w:1)}}u={count:c,texture:b,size:new X(y,x)},r.set(n,u),n.addEventListener("dispose",function T(){b.dispose(),r.delete(n),n.removeEventListener("dispose",T)})}if(a.isInstancedMesh===!0&&a.morphTexture!==null)o.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let d=0;for(let f=0;f<l.length;f++)d+=l[f];const p=n.morphTargetsRelative?1:1-d;o.getUniforms().setValue(i,"morphTargetBaseInfluence",p),o.getUniforms().setValue(i,"morphTargetInfluences",l)}o.getUniforms().setValue(i,"morphTargetsTexture",u.texture,t),o.getUniforms().setValue(i,"morphTargetsTextureSize",u.size)}}}function oS(i,e,t,r){let s=new WeakMap;function a(n){const o=n.target;o.removeEventListener("dispose",a),t.remove(o.instanceMatrix),o.instanceColor!==null&&t.remove(o.instanceColor)}return{update:function(n){const o=r.render.frame,l=n.geometry,h=e.get(n,l);if(s.get(h)!==o&&(e.update(h),s.set(h,o)),n.isInstancedMesh&&(n.hasEventListener("dispose",a)===!1&&n.addEventListener("dispose",a),s.get(n)!==o&&(t.update(n.instanceMatrix,i.ARRAY_BUFFER),n.instanceColor!==null&&t.update(n.instanceColor,i.ARRAY_BUFFER),s.set(n,o))),n.isSkinnedMesh){const c=n.skeleton;s.get(c)!==o&&(c.update(),s.set(c,o))}return h},dispose:function(){s=new WeakMap}}}class jh extends pt{constructor(e,t,r,s,a,n,o,l,h,c=1026){if(c!==No&&c!==fa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===No&&(r=Mn),r===void 0&&c===fa&&(r=ma),super(null,s,a,n,o,l,c,r,h),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:nt,this.minFilter=l!==void 0?l:nt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const Wx=new pt,Xx=new jh(1,1);Xx.compareFunction=515;const qx=new Hu,Yx=new vf,Zx=new dh,mv=[],fv=[],gv=new Float32Array(16),vv=new Float32Array(9),_v=new Float32Array(4);function $o(i,e,t){const r=i[0];if(r<=0||r>0)return i;const s=e*t;let a=mv[s];if(a===void 0&&(a=new Float32Array(s),mv[s]=a),e!==0){r.toArray(a,0);for(let n=1,o=0;n!==e;++n)o+=t,i[n].toArray(a,o)}return a}function ri(i,e){if(i.length!==e.length)return!1;for(let t=0,r=i.length;t<r;t++)if(i[t]!==e[t])return!1;return!0}function si(i,e){for(let t=0,r=e.length;t<r;t++)i[t]=e[t]}function Dd(i,e){let t=fv[e];t===void 0&&(t=new Int32Array(e),fv[e]=t);for(let r=0;r!==e;++r)t[r]=i.allocateTextureUnit();return t}function lS(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function hS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ri(t,e))return;i.uniform2fv(this.addr,e),si(t,e)}}function cS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ri(t,e))return;i.uniform3fv(this.addr,e),si(t,e)}}function uS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ri(t,e))return;i.uniform4fv(this.addr,e),si(t,e)}}function dS(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(ri(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),si(t,e)}else{if(ri(t,r))return;_v.set(r),i.uniformMatrix2fv(this.addr,!1,_v),si(t,r)}}function pS(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(ri(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),si(t,e)}else{if(ri(t,r))return;vv.set(r),i.uniformMatrix3fv(this.addr,!1,vv),si(t,r)}}function mS(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(ri(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),si(t,e)}else{if(ri(t,r))return;gv.set(r),i.uniformMatrix4fv(this.addr,!1,gv),si(t,r)}}function fS(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function gS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ri(t,e))return;i.uniform2iv(this.addr,e),si(t,e)}}function vS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ri(t,e))return;i.uniform3iv(this.addr,e),si(t,e)}}function _S(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ri(t,e))return;i.uniform4iv(this.addr,e),si(t,e)}}function yS(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function xS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ri(t,e))return;i.uniform2uiv(this.addr,e),si(t,e)}}function MS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ri(t,e))return;i.uniform3uiv(this.addr,e),si(t,e)}}function bS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ri(t,e))return;i.uniform4uiv(this.addr,e),si(t,e)}}function wS(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s);const a=this.type===i.SAMPLER_2D_SHADOW?Xx:Wx;t.setTexture2D(e||a,s)}function SS(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTexture3D(e||Yx,s)}function TS(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTextureCube(e||Zx,s)}function AS(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTexture2DArray(e||qx,s)}function ES(i,e){i.uniform1fv(this.addr,e)}function CS(i,e){const t=$o(e,this.size,2);i.uniform2fv(this.addr,t)}function RS(i,e){const t=$o(e,this.size,3);i.uniform3fv(this.addr,t)}function PS(i,e){const t=$o(e,this.size,4);i.uniform4fv(this.addr,t)}function IS(i,e){const t=$o(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function LS(i,e){const t=$o(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function NS(i,e){const t=$o(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function DS(i,e){i.uniform1iv(this.addr,e)}function OS(i,e){i.uniform2iv(this.addr,e)}function US(i,e){i.uniform3iv(this.addr,e)}function FS(i,e){i.uniform4iv(this.addr,e)}function kS(i,e){i.uniform1uiv(this.addr,e)}function BS(i,e){i.uniform2uiv(this.addr,e)}function zS(i,e){i.uniform3uiv(this.addr,e)}function VS(i,e){i.uniform4uiv(this.addr,e)}function HS(i,e,t){const r=this.cache,s=e.length,a=Dd(t,s);ri(r,a)||(i.uniform1iv(this.addr,a),si(r,a));for(let n=0;n!==s;++n)t.setTexture2D(e[n]||Wx,a[n])}function GS(i,e,t){const r=this.cache,s=e.length,a=Dd(t,s);ri(r,a)||(i.uniform1iv(this.addr,a),si(r,a));for(let n=0;n!==s;++n)t.setTexture3D(e[n]||Yx,a[n])}function jS(i,e,t){const r=this.cache,s=e.length,a=Dd(t,s);ri(r,a)||(i.uniform1iv(this.addr,a),si(r,a));for(let n=0;n!==s;++n)t.setTextureCube(e[n]||Zx,a[n])}function WS(i,e,t){const r=this.cache,s=e.length,a=Dd(t,s);ri(r,a)||(i.uniform1iv(this.addr,a),si(r,a));for(let n=0;n!==s;++n)t.setTexture2DArray(e[n]||qx,a[n])}class XS{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=function(s){switch(s){case 5126:return lS;case 35664:return hS;case 35665:return cS;case 35666:return uS;case 35674:return dS;case 35675:return pS;case 35676:return mS;case 5124:case 35670:return fS;case 35667:case 35671:return gS;case 35668:case 35672:return vS;case 35669:case 35673:return _S;case 5125:return yS;case 36294:return xS;case 36295:return MS;case 36296:return bS;case 35678:case 36198:case 36298:case 36306:case 35682:return wS;case 35679:case 36299:case 36307:return SS;case 35680:case 36300:case 36308:case 36293:return TS;case 36289:case 36303:case 36311:case 36292:return AS}}(t.type)}}class qS{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(s){switch(s){case 5126:return ES;case 35664:return CS;case 35665:return RS;case 35666:return PS;case 35674:return IS;case 35675:return LS;case 35676:return NS;case 5124:case 35670:return DS;case 35667:case 35671:return OS;case 35668:case 35672:return US;case 35669:case 35673:return FS;case 5125:return kS;case 36294:return BS;case 36295:return zS;case 36296:return VS;case 35678:case 36198:case 36298:case 36306:case 35682:return HS;case 35679:case 36299:case 36307:return GS;case 35680:case 36300:case 36308:case 36293:return jS;case 36289:case 36303:case 36311:case 36292:return WS}}(t.type)}}class YS{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const s=this.seq;for(let a=0,n=s.length;a!==n;++a){const o=s[a];o.setValue(e,t[o.id],r)}}}const Ip=/(\w+)(\])?(\[|\.)?/g;function yv(i,e){i.seq.push(e),i.map[e.id]=e}function ZS(i,e,t){const r=i.name,s=r.length;for(Ip.lastIndex=0;;){const a=Ip.exec(r),n=Ip.lastIndex;let o=a[1];const l=a[2]==="]",h=a[3];if(l&&(o|=0),h===void 0||h==="["&&n+2===s){yv(t,h===void 0?new XS(o,i,e):new qS(o,i,e));break}{let c=t.map[o];c===void 0&&(c=new YS(o),yv(t,c)),t=c}}}class Pu{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const a=e.getActiveUniform(t,s);ZS(a,e.getUniformLocation(t,a.name),this)}}setValue(e,t,r,s){const a=this.map[t];a!==void 0&&a.setValue(e,r,s)}setOptional(e,t,r){const s=t[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,t,r,s){for(let a=0,n=t.length;a!==n;++a){const o=t[a],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const r=[];for(let s=0,a=e.length;s!==a;++s){const n=e[s];n.id in t&&r.push(n)}return r}}function xv(i,e,t){const r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}const KS=37297;let QS=0;function Mv(i,e,t){const r=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const n=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+function(o,l){const h=o.split(`
`),c=[],u=Math.max(l-6,0),d=Math.min(l+6,h.length);for(let p=u;p<d;p++){const f=p+1;c.push(`${f===l?">":" "} ${f}: ${h[p]}`)}return c.join(`
`)}(i.getShaderSource(e),n)}return s}function JS(i,e){const t=function(r){const s=rt.getPrimaries(rt.workingColorSpace),a=rt.getPrimaries(r);let n;switch(s===a?n="":s===lh&&a===oh?n="LinearDisplayP3ToLinearSRGB":s===oh&&a===lh&&(n="LinearSRGBToLinearDisplayP3"),r){case Qt:case Hh:return[n,"LinearTransferOETF"];case ft:case Pd:return[n,"sRGBTransferOETF"];default:return[n,"LinearTransferOETF"]}}(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function $S(i,e){let t;switch(e){case wd:t="Linear";break;case Sd:t="Reinhard";break;case Td:t="OptimizedCineon";break;case Ad:t="ACESFilmic";break;case Ed:t="AgX";break;case hg:t="Neutral";break;case lg:t="Custom";break;default:t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function hl(i){return i!==""}function bv(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function wv(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const eT=/^[ \t]*#include +<([\w\d./]+)>/gm;function yf(i){return i.replace(eT,iT)}const tT=new Map;function iT(i,e){let t=Be[e];if(t===void 0){const r=tT.get(e);if(r===void 0)throw new Error("Can not resolve #include <"+e+">");t=Be[r]}return yf(t)}const rT=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Sv(i){return i.replace(rT,sT)}function sT(i,e,t,r){let s="";for(let a=parseInt(e);a<parseInt(t);a++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function Tv(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function aT(i,e,t,r){const s=i.getContext(),a=t.defines;let n=t.vertexShader,o=t.fragmentShader;const l=function(E){let L="SHADOWMAP_TYPE_BASIC";return E.shadowMapType===_d?L="SHADOWMAP_TYPE_PCF":E.shadowMapType===og?L="SHADOWMAP_TYPE_PCF_SOFT":E.shadowMapType===Ar&&(L="SHADOWMAP_TYPE_VSM"),L}(t),h=function(E){let L="ENVMAP_TYPE_CUBE";if(E.envMap)switch(E.envMapMode){case Es:case da:L="ENVMAP_TYPE_CUBE";break;case Jo:L="ENVMAP_TYPE_CUBE_UV"}return L}(t),c=function(E){let L="ENVMAP_MODE_REFLECTION";return E.envMap&&E.envMapMode===da&&(L="ENVMAP_MODE_REFRACTION"),L}(t),u=function(E){let L="ENVMAP_BLENDING_NONE";if(E.envMap)switch(E.combine){case Vh:L="ENVMAP_BLENDING_MULTIPLY";break;case Lx:L="ENVMAP_BLENDING_MIX";break;case Nx:L="ENVMAP_BLENDING_ADD"}return L}(t),d=function(E){const L=E.envMapCubeUVHeight;if(L===null)return null;const D=Math.log2(L)-2,U=1/L;return{texelWidth:1/(3*Math.max(Math.pow(2,D),112)),texelHeight:U,maxMip:D}}(t),p=function(E){return[E.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",E.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hl).join(`
`)}(t),f=function(E){const L=[];for(const D in E){const U=E[D];U!==!1&&L.push("#define "+D+" "+U)}return L.join(`
`)}(a),v=s.createProgram();let m,g,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(hl).join(`
`),m.length>0&&(m+=`
`),g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(hl).join(`
`),g.length>0&&(g+=`
`)):(m=[Tv(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hl).join(`
`),g=[Tv(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Kr?"#define TONE_MAPPING":"",t.toneMapping!==Kr?Be.tonemapping_pars_fragment:"",t.toneMapping!==Kr?$S("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Be.colorspace_pars_fragment,JS("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(hl).join(`
`)),n=yf(n),n=bv(n,t),n=wv(n,t),o=yf(o),o=bv(o,t),o=wv(o,t),n=Sv(n),o=Sv(o),t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,m=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,g=["#define varying in",t.glslVersion===ff?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===ff?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const y=_+m+n,x=_+g+o,M=xv(s,s.VERTEX_SHADER,y),b=xv(s,s.FRAGMENT_SHADER,x);function w(E){if(i.debug.checkShaderErrors){const L=s.getProgramInfoLog(v).trim(),D=s.getShaderInfoLog(M).trim(),U=s.getShaderInfoLog(b).trim();let H=!0,Z=!0;s.getProgramParameter(v,s.LINK_STATUS)===!1?(H=!1,typeof i.debug.onShaderError=="function"?i.debug.onShaderError(s,v,M,b):(Mv(s,M,"vertex"),Mv(s,b,"fragment"))):L!==""||D!==""&&U!==""||(Z=!1),Z&&(E.diagnostics={runnable:H,programLog:L,vertexShader:{log:D,prefix:m},fragmentShader:{log:U,prefix:g}})}s.deleteShader(M),s.deleteShader(b),T=new Pu(s,v),R=function(L,D){const U={},H=L.getProgramParameter(D,L.ACTIVE_ATTRIBUTES);for(let Z=0;Z<H;Z++){const te=L.getActiveAttrib(D,Z),ie=te.name;let ve=1;te.type===L.FLOAT_MAT2&&(ve=2),te.type===L.FLOAT_MAT3&&(ve=3),te.type===L.FLOAT_MAT4&&(ve=4),U[ie]={type:te.type,location:L.getAttribLocation(D,ie),locationSize:ve}}return U}(s,v)}let T,R;s.attachShader(v,M),s.attachShader(v,b),t.index0AttributeName!==void 0?s.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v),this.getUniforms=function(){return T===void 0&&w(this),T},this.getAttributes=function(){return R===void 0&&w(this),R};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=s.getProgramParameter(v,KS)),I},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=QS++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=b,this}let nT=0;class oT{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(t),a=this._getShaderStage(r),n=this._getShaderCacheForMaterial(e);return n.has(s)===!1&&(n.add(s),s.usedTimes++),n.has(a)===!1&&(n.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new lT(e),t.set(e,r)),r}}class lT{constructor(e){this.id=nT++,this.code=e,this.usedTimes=0}}function hT(i,e,t,r,s,a,n){const o=new Id,l=new oT,h=new Set,c=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(m){return h.add(m),m===0?"uv":`uv${m}`}return{getParameters:function(m,g,_,y,x){const M=y.fog,b=x.geometry,w=m.isMeshStandardMaterial?y.environment:null,T=(m.isMeshStandardMaterial?t:e).get(m.envMap||w),R=T&&T.mapping===Jo?T.image.height:null,I=f[m.type];m.precision!==null&&(p=s.getMaxPrecision(m.precision),m.precision);const E=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,L=E!==void 0?E.length:0;let D,U,H,Z,te=0;if(b.morphAttributes.position!==void 0&&(te=1),b.morphAttributes.normal!==void 0&&(te=2),b.morphAttributes.color!==void 0&&(te=3),I){const Dt=Pi[I];D=Dt.vertexShader,U=Dt.fragmentShader}else D=m.vertexShader,U=m.fragmentShader,l.update(m),H=l.getVertexShaderID(m),Z=l.getFragmentShaderID(m);const ie=i.getRenderTarget(),ve=x.isInstancedMesh===!0,be=x.isBatchedMesh===!0,J=!!m.map,ne=!!m.matcap,de=!!T,re=!!m.aoMap,N=!!m.lightMap,P=!!m.bumpMap,j=!!m.normalMap,K=!!m.displacementMap,O=!!m.emissiveMap,B=!!m.metalnessMap,A=!!m.roughnessMap,k=m.anisotropy>0,F=m.clearcoat>0,se=m.dispersion>0,V=m.iridescence>0,ae=m.sheen>0,xe=m.transmission>0,ce=k&&!!m.anisotropyMap,z=F&&!!m.clearcoatMap,W=F&&!!m.clearcoatNormalMap,ee=F&&!!m.clearcoatRoughnessMap,ge=V&&!!m.iridescenceMap,Le=V&&!!m.iridescenceThicknessMap,Fe=ae&&!!m.sheenColorMap,Se=ae&&!!m.sheenRoughnessMap,ke=!!m.specularMap,He=!!m.specularColorMap,it=!!m.specularIntensityMap,Ce=xe&&!!m.transmissionMap,st=xe&&!!m.thicknessMap,ze=!!m.gradientMap,Nt=!!m.alphaMap,Oi=m.alphaTest>0,ns=!!m.alphaHash,G=!!m.extensions;let il=Kr;m.toneMapped&&(ie!==null&&ie.isXRRenderTarget!==!0||(il=i.toneMapping));const Aa={shaderID:I,shaderType:m.type,shaderName:m.name,vertexShader:D,fragmentShader:U,defines:m.defines,customVertexShaderID:H,customFragmentShaderID:Z,isRawShaderMaterial:m.isRawShaderMaterial===!0,glslVersion:m.glslVersion,precision:p,batching:be,batchingColor:be&&x._colorsTexture!==null,instancing:ve,instancingColor:ve&&x.instanceColor!==null,instancingMorph:ve&&x.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ie===null?i.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:Qt,alphaToCoverage:!!m.alphaToCoverage,map:J,matcap:ne,envMap:de,envMapMode:de&&T.mapping,envMapCubeUVHeight:R,aoMap:re,lightMap:N,bumpMap:P,normalMap:j,displacementMap:d&&K,emissiveMap:O,normalMapObjectSpace:j&&m.normalMapType===1,normalMapTangentSpace:j&&m.normalMapType===0,metalnessMap:B,roughnessMap:A,anisotropy:k,anisotropyMap:ce,clearcoat:F,clearcoatMap:z,clearcoatNormalMap:W,clearcoatRoughnessMap:ee,dispersion:se,iridescence:V,iridescenceMap:ge,iridescenceThicknessMap:Le,sheen:ae,sheenColorMap:Fe,sheenRoughnessMap:Se,specularMap:ke,specularColorMap:He,specularIntensityMap:it,transmission:xe,transmissionMap:Ce,thicknessMap:st,gradientMap:ze,opaque:m.transparent===!1&&m.blending===1&&m.alphaToCoverage===!1,alphaMap:Nt,alphaTest:Oi,alphaHash:ns,combine:m.combine,mapUv:J&&v(m.map.channel),aoMapUv:re&&v(m.aoMap.channel),lightMapUv:N&&v(m.lightMap.channel),bumpMapUv:P&&v(m.bumpMap.channel),normalMapUv:j&&v(m.normalMap.channel),displacementMapUv:K&&v(m.displacementMap.channel),emissiveMapUv:O&&v(m.emissiveMap.channel),metalnessMapUv:B&&v(m.metalnessMap.channel),roughnessMapUv:A&&v(m.roughnessMap.channel),anisotropyMapUv:ce&&v(m.anisotropyMap.channel),clearcoatMapUv:z&&v(m.clearcoatMap.channel),clearcoatNormalMapUv:W&&v(m.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ee&&v(m.clearcoatRoughnessMap.channel),iridescenceMapUv:ge&&v(m.iridescenceMap.channel),iridescenceThicknessMapUv:Le&&v(m.iridescenceThicknessMap.channel),sheenColorMapUv:Fe&&v(m.sheenColorMap.channel),sheenRoughnessMapUv:Se&&v(m.sheenRoughnessMap.channel),specularMapUv:ke&&v(m.specularMap.channel),specularColorMapUv:He&&v(m.specularColorMap.channel),specularIntensityMapUv:it&&v(m.specularIntensityMap.channel),transmissionMapUv:Ce&&v(m.transmissionMap.channel),thicknessMapUv:st&&v(m.thicknessMap.channel),alphaMapUv:Nt&&v(m.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(j||k),vertexColors:m.vertexColors,vertexAlphas:m.vertexColors===!0&&!!b.attributes.color&&b.attributes.color.itemSize===4,pointsUvs:x.isPoints===!0&&!!b.attributes.uv&&(J||Nt),fog:!!M,useFog:m.fog===!0,fogExp2:!!M&&M.isFogExp2,flatShading:m.flatShading===!0,sizeAttenuation:m.sizeAttenuation===!0,logarithmicDepthBuffer:u,skinning:x.isSkinnedMesh===!0,morphTargets:b.morphAttributes.position!==void 0,morphNormals:b.morphAttributes.normal!==void 0,morphColors:b.morphAttributes.color!==void 0,morphTargetsCount:L,morphTextureStride:te,numDirLights:g.directional.length,numPointLights:g.point.length,numSpotLights:g.spot.length,numSpotLightMaps:g.spotLightMap.length,numRectAreaLights:g.rectArea.length,numHemiLights:g.hemi.length,numDirLightShadows:g.directionalShadowMap.length,numPointLightShadows:g.pointShadowMap.length,numSpotLightShadows:g.spotShadowMap.length,numSpotLightShadowsWithMaps:g.numSpotLightShadowsWithMaps,numLightProbes:g.numLightProbes,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:m.dithering,shadowMapEnabled:i.shadowMap.enabled&&_.length>0,shadowMapType:i.shadowMap.type,toneMapping:il,decodeVideoTexture:J&&m.map.isVideoTexture===!0&&rt.getTransfer(m.map.colorSpace)===mt,premultipliedAlpha:m.premultipliedAlpha,doubleSided:m.side===Mt,flipSided:m.side===Si,useDepthPacking:m.depthPacking>=0,depthPacking:m.depthPacking||0,index0AttributeName:m.index0AttributeName,extensionClipCullDistance:G&&m.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:G&&m.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:m.customProgramCacheKey()};return Aa.vertexUv1s=h.has(1),Aa.vertexUv2s=h.has(2),Aa.vertexUv3s=h.has(3),h.clear(),Aa},getProgramCacheKey:function(m){const g=[];if(m.shaderID?g.push(m.shaderID):(g.push(m.customVertexShaderID),g.push(m.customFragmentShaderID)),m.defines!==void 0)for(const _ in m.defines)g.push(_),g.push(m.defines[_]);return m.isRawShaderMaterial===!1&&(function(_,y){_.push(y.precision),_.push(y.outputColorSpace),_.push(y.envMapMode),_.push(y.envMapCubeUVHeight),_.push(y.mapUv),_.push(y.alphaMapUv),_.push(y.lightMapUv),_.push(y.aoMapUv),_.push(y.bumpMapUv),_.push(y.normalMapUv),_.push(y.displacementMapUv),_.push(y.emissiveMapUv),_.push(y.metalnessMapUv),_.push(y.roughnessMapUv),_.push(y.anisotropyMapUv),_.push(y.clearcoatMapUv),_.push(y.clearcoatNormalMapUv),_.push(y.clearcoatRoughnessMapUv),_.push(y.iridescenceMapUv),_.push(y.iridescenceThicknessMapUv),_.push(y.sheenColorMapUv),_.push(y.sheenRoughnessMapUv),_.push(y.specularMapUv),_.push(y.specularColorMapUv),_.push(y.specularIntensityMapUv),_.push(y.transmissionMapUv),_.push(y.thicknessMapUv),_.push(y.combine),_.push(y.fogExp2),_.push(y.sizeAttenuation),_.push(y.morphTargetsCount),_.push(y.morphAttributeCount),_.push(y.numDirLights),_.push(y.numPointLights),_.push(y.numSpotLights),_.push(y.numSpotLightMaps),_.push(y.numHemiLights),_.push(y.numRectAreaLights),_.push(y.numDirLightShadows),_.push(y.numPointLightShadows),_.push(y.numSpotLightShadows),_.push(y.numSpotLightShadowsWithMaps),_.push(y.numLightProbes),_.push(y.shadowMapType),_.push(y.toneMapping),_.push(y.numClippingPlanes),_.push(y.numClipIntersection),_.push(y.depthPacking)}(g,m),function(_,y){o.disableAll(),y.supportsVertexTextures&&o.enable(0),y.instancing&&o.enable(1),y.instancingColor&&o.enable(2),y.instancingMorph&&o.enable(3),y.matcap&&o.enable(4),y.envMap&&o.enable(5),y.normalMapObjectSpace&&o.enable(6),y.normalMapTangentSpace&&o.enable(7),y.clearcoat&&o.enable(8),y.iridescence&&o.enable(9),y.alphaTest&&o.enable(10),y.vertexColors&&o.enable(11),y.vertexAlphas&&o.enable(12),y.vertexUv1s&&o.enable(13),y.vertexUv2s&&o.enable(14),y.vertexUv3s&&o.enable(15),y.vertexTangents&&o.enable(16),y.anisotropy&&o.enable(17),y.alphaHash&&o.enable(18),y.batching&&o.enable(19),y.dispersion&&o.enable(20),y.batchingColor&&o.enable(21),_.push(o.mask),o.disableAll(),y.fog&&o.enable(0),y.useFog&&o.enable(1),y.flatShading&&o.enable(2),y.logarithmicDepthBuffer&&o.enable(3),y.skinning&&o.enable(4),y.morphTargets&&o.enable(5),y.morphNormals&&o.enable(6),y.morphColors&&o.enable(7),y.premultipliedAlpha&&o.enable(8),y.shadowMapEnabled&&o.enable(9),y.doubleSided&&o.enable(10),y.flipSided&&o.enable(11),y.useDepthPacking&&o.enable(12),y.dithering&&o.enable(13),y.transmission&&o.enable(14),y.sheen&&o.enable(15),y.opaque&&o.enable(16),y.pointsUvs&&o.enable(17),y.decodeVideoTexture&&o.enable(18),y.alphaToCoverage&&o.enable(19),_.push(o.mask)}(g,m),g.push(i.outputColorSpace)),g.push(m.customProgramCacheKey),g.join()},getUniforms:function(m){const g=f[m.type];let _;if(g){const y=Pi[g];_=Kt.clone(y.uniforms)}else _=m.uniforms;return _},acquireProgram:function(m,g){let _;for(let y=0,x=c.length;y<x;y++){const M=c[y];if(M.cacheKey===g){_=M,++_.usedTimes;break}}return _===void 0&&(_=new aT(i,g,m,a),c.push(_)),_},releaseProgram:function(m){if(--m.usedTimes==0){const g=c.indexOf(m);c[g]=c[c.length-1],c.pop(),m.destroy()}},releaseShaderCache:function(m){l.remove(m)},programs:c,dispose:function(){l.dispose()}}}function cT(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return t===void 0&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function uT(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function Av(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Ev(){const i=[];let e=0;const t=[],r=[],s=[];function a(n,o,l,h,c,u){let d=i[e];return d===void 0?(d={id:n.id,object:n,geometry:o,material:l,groupOrder:h,renderOrder:n.renderOrder,z:c,group:u},i[e]=d):(d.id=n.id,d.object=n,d.geometry=o,d.material=l,d.groupOrder=h,d.renderOrder=n.renderOrder,d.z=c,d.group=u),e++,d}return{opaque:t,transmissive:r,transparent:s,init:function(){e=0,t.length=0,r.length=0,s.length=0},push:function(n,o,l,h,c,u){const d=a(n,o,l,h,c,u);l.transmission>0?r.push(d):l.transparent===!0?s.push(d):t.push(d)},unshift:function(n,o,l,h,c,u){const d=a(n,o,l,h,c,u);l.transmission>0?r.unshift(d):l.transparent===!0?s.unshift(d):t.unshift(d)},finish:function(){for(let n=e,o=i.length;n<o;n++){const l=i[n];if(l.id===null)break;l.id=null,l.object=null,l.geometry=null,l.material=null,l.group=null}},sort:function(n,o){t.length>1&&t.sort(n||uT),r.length>1&&r.sort(o||Av),s.length>1&&s.sort(o||Av)}}}function dT(){let i=new WeakMap;return{get:function(e,t){const r=i.get(e);let s;return r===void 0?(s=new Ev,i.set(e,[s])):t>=r.length?(s=new Ev,r.push(s)):s=r[t],s},dispose:function(){i=new WeakMap}}}function pT(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new S,color:new oe};break;case"SpotLight":t={position:new S,direction:new S,color:new oe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new S,color:new oe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new S,skyColor:new oe,groundColor:new oe};break;case"RectAreaLight":t={color:new oe,position:new S,halfWidth:new S,halfHeight:new S}}return i[e.id]=t,t}}}let mT=0;function fT(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function gT(i){const e=new pT,t=function(){const o={};return{get:function(l){if(o[l.id]!==void 0)return o[l.id];let h;switch(l.type){case"DirectionalLight":case"SpotLight":h={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new X};break;case"PointLight":h={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new X,shadowCameraNear:1,shadowCameraFar:1e3}}return o[l.id]=h,h}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)r.probe.push(new S);const s=new S,a=new me,n=new me;return{setup:function(o){let l=0,h=0,c=0;for(let w=0;w<9;w++)r.probe[w].set(0,0,0);let u=0,d=0,p=0,f=0,v=0,m=0,g=0,_=0,y=0,x=0,M=0;o.sort(fT);for(let w=0,T=o.length;w<T;w++){const R=o[w],I=R.color,E=R.intensity,L=R.distance,D=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)l+=I.r*E,h+=I.g*E,c+=I.b*E;else if(R.isLightProbe){for(let U=0;U<9;U++)r.probe[U].addScaledVector(R.sh.coefficients[U],E);M++}else if(R.isDirectionalLight){const U=e.get(R);if(U.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const H=R.shadow,Z=t.get(R);Z.shadowBias=H.bias,Z.shadowNormalBias=H.normalBias,Z.shadowRadius=H.radius,Z.shadowMapSize=H.mapSize,r.directionalShadow[u]=Z,r.directionalShadowMap[u]=D,r.directionalShadowMatrix[u]=R.shadow.matrix,m++}r.directional[u]=U,u++}else if(R.isSpotLight){const U=e.get(R);U.position.setFromMatrixPosition(R.matrixWorld),U.color.copy(I).multiplyScalar(E),U.distance=L,U.coneCos=Math.cos(R.angle),U.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),U.decay=R.decay,r.spot[p]=U;const H=R.shadow;if(R.map&&(r.spotLightMap[y]=R.map,y++,H.updateMatrices(R),R.castShadow&&x++),r.spotLightMatrix[p]=H.matrix,R.castShadow){const Z=t.get(R);Z.shadowBias=H.bias,Z.shadowNormalBias=H.normalBias,Z.shadowRadius=H.radius,Z.shadowMapSize=H.mapSize,r.spotShadow[p]=Z,r.spotShadowMap[p]=D,_++}p++}else if(R.isRectAreaLight){const U=e.get(R);U.color.copy(I).multiplyScalar(E),U.halfWidth.set(.5*R.width,0,0),U.halfHeight.set(0,.5*R.height,0),r.rectArea[f]=U,f++}else if(R.isPointLight){const U=e.get(R);if(U.color.copy(R.color).multiplyScalar(R.intensity),U.distance=R.distance,U.decay=R.decay,R.castShadow){const H=R.shadow,Z=t.get(R);Z.shadowBias=H.bias,Z.shadowNormalBias=H.normalBias,Z.shadowRadius=H.radius,Z.shadowMapSize=H.mapSize,Z.shadowCameraNear=H.camera.near,Z.shadowCameraFar=H.camera.far,r.pointShadow[d]=Z,r.pointShadowMap[d]=D,r.pointShadowMatrix[d]=R.shadow.matrix,g++}r.point[d]=U,d++}else if(R.isHemisphereLight){const U=e.get(R);U.skyColor.copy(R.color).multiplyScalar(E),U.groundColor.copy(R.groundColor).multiplyScalar(E),r.hemi[v]=U,v++}}f>0&&(i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=ye.LTC_FLOAT_1,r.rectAreaLTC2=ye.LTC_FLOAT_2):(r.rectAreaLTC1=ye.LTC_HALF_1,r.rectAreaLTC2=ye.LTC_HALF_2)),r.ambient[0]=l,r.ambient[1]=h,r.ambient[2]=c;const b=r.hash;b.directionalLength===u&&b.pointLength===d&&b.spotLength===p&&b.rectAreaLength===f&&b.hemiLength===v&&b.numDirectionalShadows===m&&b.numPointShadows===g&&b.numSpotShadows===_&&b.numSpotMaps===y&&b.numLightProbes===M||(r.directional.length=u,r.spot.length=p,r.rectArea.length=f,r.point.length=d,r.hemi.length=v,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=_+y-x,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=x,r.numLightProbes=M,b.directionalLength=u,b.pointLength=d,b.spotLength=p,b.rectAreaLength=f,b.hemiLength=v,b.numDirectionalShadows=m,b.numPointShadows=g,b.numSpotShadows=_,b.numSpotMaps=y,b.numLightProbes=M,r.version=mT++)},setupView:function(o,l){let h=0,c=0,u=0,d=0,p=0;const f=l.matrixWorldInverse;for(let v=0,m=o.length;v<m;v++){const g=o[v];if(g.isDirectionalLight){const _=r.directional[h];_.direction.setFromMatrixPosition(g.matrixWorld),s.setFromMatrixPosition(g.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(f),h++}else if(g.isSpotLight){const _=r.spot[u];_.position.setFromMatrixPosition(g.matrixWorld),_.position.applyMatrix4(f),_.direction.setFromMatrixPosition(g.matrixWorld),s.setFromMatrixPosition(g.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(f),u++}else if(g.isRectAreaLight){const _=r.rectArea[d];_.position.setFromMatrixPosition(g.matrixWorld),_.position.applyMatrix4(f),n.identity(),a.copy(g.matrixWorld),a.premultiply(f),n.extractRotation(a),_.halfWidth.set(.5*g.width,0,0),_.halfHeight.set(0,.5*g.height,0),_.halfWidth.applyMatrix4(n),_.halfHeight.applyMatrix4(n),d++}else if(g.isPointLight){const _=r.point[c];_.position.setFromMatrixPosition(g.matrixWorld),_.position.applyMatrix4(f),c++}else if(g.isHemisphereLight){const _=r.hemi[p];_.direction.setFromMatrixPosition(g.matrixWorld),_.direction.transformDirection(f),p++}}},state:r}}function Cv(i){const e=new gT(i),t=[],r=[],s={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(a){s.camera=a,t.length=0,r.length=0},state:s,setupLights:function(){e.setup(t)},setupLightsView:function(a){e.setupView(t,a)},pushLight:function(a){t.push(a)},pushShadow:function(a){r.push(a)}}}function vT(i){let e=new WeakMap;return{get:function(t,r=0){const s=e.get(t);let a;return s===void 0?(a=new Cv(i),e.set(t,[a])):r>=s.length?(a=new Cv(i),s.push(a)):a=s[r],a},dispose:function(){e=new WeakMap}}}class Od extends Xt{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Sg extends Xt{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function _T(i,e,t){let r=new Gh;const s=new X,a=new X,n=new Ve,o=new Od({depthPacking:xg}),l=new Sg,h={},c=t.maxTextureSize,u={[gr]:Si,[Si]:gr,[Mt]:Mt},d=new tt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new X},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Re;f.setAttribute("position",new Ze(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new ue(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_d;let g=this.type;function _(b,w){const T=e.update(v);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,p.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),b.mapPass===null&&(b.mapPass=new ht(s.x,s.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,i.setRenderTarget(b.mapPass),i.clear(),i.renderBufferDirect(w,null,T,d,v,null),p.uniforms.shadow_pass.value=b.mapPass.texture,p.uniforms.resolution.value=b.mapSize,p.uniforms.radius.value=b.radius,i.setRenderTarget(b.map),i.clear(),i.renderBufferDirect(w,null,T,p,v,null)}function y(b,w,T,R){let I=null;const E=T.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(E!==void 0)I=E;else if(I=T.isPointLight===!0?l:o,i.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const L=I.uuid,D=w.uuid;let U=h[L];U===void 0&&(U={},h[L]=U);let H=U[D];H===void 0&&(H=I.clone(),U[D]=H,w.addEventListener("dispose",M)),I=H}return I.visible=w.visible,I.wireframe=w.wireframe,I.side=R===Ar?w.shadowSide!==null?w.shadowSide:w.side:w.shadowSide!==null?w.shadowSide:u[w.side],I.alphaMap=w.alphaMap,I.alphaTest=w.alphaTest,I.map=w.map,I.clipShadows=w.clipShadows,I.clippingPlanes=w.clippingPlanes,I.clipIntersection=w.clipIntersection,I.displacementMap=w.displacementMap,I.displacementScale=w.displacementScale,I.displacementBias=w.displacementBias,I.wireframeLinewidth=w.wireframeLinewidth,I.linewidth=w.linewidth,T.isPointLight===!0&&I.isMeshDistanceMaterial===!0&&(i.properties.get(I).light=T),I}function x(b,w,T,R,I){if(b.visible===!1)return;if(b.layers.test(w.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&I===Ar)&&(!b.frustumCulled||r.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,b.matrixWorld);const L=e.update(b),D=b.material;if(Array.isArray(D)){const U=L.groups;for(let H=0,Z=U.length;H<Z;H++){const te=U[H],ie=D[te.materialIndex];if(ie&&ie.visible){const ve=y(b,ie,R,I);b.onBeforeShadow(i,b,w,T,L,ve,te),i.renderBufferDirect(T,null,L,ve,b,te),b.onAfterShadow(i,b,w,T,L,ve,te)}}}else if(D.visible){const U=y(b,D,R,I);b.onBeforeShadow(i,b,w,T,L,U,null),i.renderBufferDirect(T,null,L,U,b,null),b.onAfterShadow(i,b,w,T,L,U,null)}}const E=b.children;for(let L=0,D=E.length;L<D;L++)x(E[L],w,T,R,I)}function M(b){b.target.removeEventListener("dispose",M);for(const w in h){const T=h[w],R=b.target.uuid;R in T&&(T[R].dispose(),delete T[R])}}this.render=function(b,w,T){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||b.length===0)return;const R=i.getRenderTarget(),I=i.getActiveCubeFace(),E=i.getActiveMipmapLevel(),L=i.state;L.setBlending(0),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);const D=g!==Ar&&this.type===Ar,U=g===Ar&&this.type!==Ar;for(let H=0,Z=b.length;H<Z;H++){const te=b[H],ie=te.shadow;if(ie===void 0||ie.autoUpdate===!1&&ie.needsUpdate===!1)continue;s.copy(ie.mapSize);const ve=ie.getFrameExtents();if(s.multiply(ve),a.copy(ie.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(a.x=Math.floor(c/ve.x),s.x=a.x*ve.x,ie.mapSize.x=a.x),s.y>c&&(a.y=Math.floor(c/ve.y),s.y=a.y*ve.y,ie.mapSize.y=a.y)),ie.map===null||D===!0||U===!0){const J=this.type!==Ar?{minFilter:nt,magFilter:nt}:{};ie.map!==null&&ie.map.dispose(),ie.map=new ht(s.x,s.y,J),ie.map.texture.name=te.name+".shadowMap",ie.camera.updateProjectionMatrix()}i.setRenderTarget(ie.map),i.clear();const be=ie.getViewportCount();for(let J=0;J<be;J++){const ne=ie.getViewport(J);n.set(a.x*ne.x,a.y*ne.y,a.x*ne.z,a.y*ne.w),L.viewport(n),ie.updateMatrices(te,J),r=ie.getFrustum(),x(w,T,ie.camera,te,this.type)}ie.isPointLightShadow!==!0&&this.type===Ar&&_(ie,T),ie.needsUpdate=!1}g=this.type,m.needsUpdate=!1,i.setRenderTarget(R,I,E)}}function yT(i){const e=new function(){let A=!1;const k=new Ve;let F=null;const se=new Ve(0,0,0,0);return{setMask:function(V){F===V||A||(i.colorMask(V,V,V,V),F=V)},setLocked:function(V){A=V},setClear:function(V,ae,xe,ce,z){z===!0&&(V*=ce,ae*=ce,xe*=ce),k.set(V,ae,xe,ce),se.equals(k)===!1&&(i.clearColor(V,ae,xe,ce),se.copy(k))},reset:function(){A=!1,F=null,se.set(-1,0,0,0)}}},t=new function(){let A=!1,k=null,F=null,se=null;return{setTest:function(V){V?de(i.DEPTH_TEST):re(i.DEPTH_TEST)},setMask:function(V){k===V||A||(i.depthMask(V),k=V)},setFunc:function(V){if(F!==V){switch(V){case 0:i.depthFunc(i.NEVER);break;case 1:i.depthFunc(i.ALWAYS);break;case 2:i.depthFunc(i.LESS);break;case 3:default:i.depthFunc(i.LEQUAL);break;case 4:i.depthFunc(i.EQUAL);break;case 5:i.depthFunc(i.GEQUAL);break;case 6:i.depthFunc(i.GREATER);break;case 7:i.depthFunc(i.NOTEQUAL)}F=V}},setLocked:function(V){A=V},setClear:function(V){se!==V&&(i.clearDepth(V),se=V)},reset:function(){A=!1,k=null,F=null,se=null}}},r=new function(){let A=!1,k=null,F=null,se=null,V=null,ae=null,xe=null,ce=null,z=null;return{setTest:function(W){A||(W?de(i.STENCIL_TEST):re(i.STENCIL_TEST))},setMask:function(W){k===W||A||(i.stencilMask(W),k=W)},setFunc:function(W,ee,ge){F===W&&se===ee&&V===ge||(i.stencilFunc(W,ee,ge),F=W,se=ee,V=ge)},setOp:function(W,ee,ge){ae===W&&xe===ee&&ce===ge||(i.stencilOp(W,ee,ge),ae=W,xe=ee,ce=ge)},setLocked:function(W){A=W},setClear:function(W){z!==W&&(i.clearStencil(W),z=W)},reset:function(){A=!1,k=null,F=null,se=null,V=null,ae=null,xe=null,ce=null,z=null}}},s=new WeakMap,a=new WeakMap;let n={},o={},l=new WeakMap,h=[],c=null,u=!1,d=null,p=null,f=null,v=null,m=null,g=null,_=null,y=new oe(0,0,0),x=0,M=!1,b=null,w=null,T=null,R=null,I=null;const E=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let L=!1,D=0;const U=i.getParameter(i.VERSION);U.indexOf("WebGL")!==-1?(D=parseFloat(/^WebGL (\d)/.exec(U)[1]),L=D>=1):U.indexOf("OpenGL ES")!==-1&&(D=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),L=D>=2);let H=null,Z={};const te=i.getParameter(i.SCISSOR_BOX),ie=i.getParameter(i.VIEWPORT),ve=new Ve().fromArray(te),be=new Ve().fromArray(ie);function J(A,k,F,se){const V=new Uint8Array(4),ae=i.createTexture();i.bindTexture(A,ae),i.texParameteri(A,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(A,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let xe=0;xe<F;xe++)A===i.TEXTURE_3D||A===i.TEXTURE_2D_ARRAY?i.texImage3D(k,0,i.RGBA,1,1,se,0,i.RGBA,i.UNSIGNED_BYTE,V):i.texImage2D(k+xe,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,V);return ae}const ne={};function de(A){n[A]!==!0&&(i.enable(A),n[A]=!0)}function re(A){n[A]!==!1&&(i.disable(A),n[A]=!1)}ne[i.TEXTURE_2D]=J(i.TEXTURE_2D,i.TEXTURE_2D,1),ne[i.TEXTURE_CUBE_MAP]=J(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),ne[i.TEXTURE_2D_ARRAY]=J(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),ne[i.TEXTURE_3D]=J(i.TEXTURE_3D,i.TEXTURE_3D,1,1),e.setClear(0,0,0,1),t.setClear(1),r.setClear(0),de(i.DEPTH_TEST),t.setFunc(3),K(!1),O(1),de(i.CULL_FACE),j(0);const N={[Ji]:i.FUNC_ADD,[fw]:i.FUNC_SUBTRACT,[gw]:i.FUNC_REVERSE_SUBTRACT};N[103]=i.MIN,N[104]=i.MAX;const P={[Po]:i.ZERO,[kh]:i.ONE,[yd]:i.SRC_COLOR,[ca]:i.SRC_ALPHA,[vw]:i.SRC_ALPHA_SATURATE,[zh]:i.DST_COLOR,[Bh]:i.DST_ALPHA,[xd]:i.ONE_MINUS_SRC_COLOR,[ua]:i.ONE_MINUS_SRC_ALPHA,[bd]:i.ONE_MINUS_DST_COLOR,[Md]:i.ONE_MINUS_DST_ALPHA,[_w]:i.CONSTANT_COLOR,[yw]:i.ONE_MINUS_CONSTANT_COLOR,[xw]:i.CONSTANT_ALPHA,[Mw]:i.ONE_MINUS_CONSTANT_ALPHA};function j(A,k,F,se,V,ae,xe,ce,z,W){if(A!==0){if(u===!1&&(de(i.BLEND),u=!0),A===Ro)V=V||k,ae=ae||F,xe=xe||se,k===p&&V===m||(i.blendEquationSeparate(N[k],N[V]),p=k,m=V),F===f&&se===v&&ae===g&&xe===_||(i.blendFuncSeparate(P[F],P[se],P[ae],P[xe]),f=F,v=se,g=ae,_=xe),ce.equals(y)!==!1&&z===x||(i.blendColor(ce.r,ce.g,ce.b,z),y.copy(ce),x=z),d=A,M=!1;else if(A!==d||W!==M){if(p===Ji&&m===Ji||(i.blendEquation(i.FUNC_ADD),p=Ji,m=Ji),W)switch(A){case 1:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case As:i.blendFunc(i.ONE,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else switch(A){case 1:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case As:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFunc(i.ZERO,i.SRC_COLOR)}f=null,v=null,g=null,_=null,y.set(0,0,0),x=0,d=A,M=W}}else u===!0&&(re(i.BLEND),u=!1)}function K(A){b!==A&&(A?i.frontFace(i.CW):i.frontFace(i.CCW),b=A)}function O(A){A!==0?(de(i.CULL_FACE),A!==w&&(A===1?i.cullFace(i.BACK):A===2?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):re(i.CULL_FACE),w=A}function B(A,k,F){A?(de(i.POLYGON_OFFSET_FILL),R===k&&I===F||(i.polygonOffset(k,F),R=k,I=F)):re(i.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:t,stencil:r},enable:de,disable:re,bindFramebuffer:function(A,k){return o[A]!==k&&(i.bindFramebuffer(A,k),o[A]=k,A===i.DRAW_FRAMEBUFFER&&(o[i.FRAMEBUFFER]=k),A===i.FRAMEBUFFER&&(o[i.DRAW_FRAMEBUFFER]=k),!0)},drawBuffers:function(A,k){let F=h,se=!1;if(A){F=l.get(k),F===void 0&&(F=[],l.set(k,F));const V=A.textures;if(F.length!==V.length||F[0]!==i.COLOR_ATTACHMENT0){for(let ae=0,xe=V.length;ae<xe;ae++)F[ae]=i.COLOR_ATTACHMENT0+ae;F.length=V.length,se=!0}}else F[0]!==i.BACK&&(F[0]=i.BACK,se=!0);se&&i.drawBuffers(F)},useProgram:function(A){return c!==A&&(i.useProgram(A),c=A,!0)},setBlending:j,setMaterial:function(A,k){A.side===Mt?re(i.CULL_FACE):de(i.CULL_FACE);let F=A.side===Si;k&&(F=!F),K(F),A.blending===1&&A.transparent===!1?j(0):j(A.blending,A.blendEquation,A.blendSrc,A.blendDst,A.blendEquationAlpha,A.blendSrcAlpha,A.blendDstAlpha,A.blendColor,A.blendAlpha,A.premultipliedAlpha),t.setFunc(A.depthFunc),t.setTest(A.depthTest),t.setMask(A.depthWrite),e.setMask(A.colorWrite);const se=A.stencilWrite;r.setTest(se),se&&(r.setMask(A.stencilWriteMask),r.setFunc(A.stencilFunc,A.stencilRef,A.stencilFuncMask),r.setOp(A.stencilFail,A.stencilZFail,A.stencilZPass)),B(A.polygonOffset,A.polygonOffsetFactor,A.polygonOffsetUnits),A.alphaToCoverage===!0?de(i.SAMPLE_ALPHA_TO_COVERAGE):re(i.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:K,setCullFace:O,setLineWidth:function(A){A!==T&&(L&&i.lineWidth(A),T=A)},setPolygonOffset:B,setScissorTest:function(A){A?de(i.SCISSOR_TEST):re(i.SCISSOR_TEST)},activeTexture:function(A){A===void 0&&(A=i.TEXTURE0+E-1),H!==A&&(i.activeTexture(A),H=A)},bindTexture:function(A,k,F){F===void 0&&(F=H===null?i.TEXTURE0+E-1:H);let se=Z[F];se===void 0&&(se={type:void 0,texture:void 0},Z[F]=se),se.type===A&&se.texture===k||(H!==F&&(i.activeTexture(F),H=F),i.bindTexture(A,k||ne[A]),se.type=A,se.texture=k)},unbindTexture:function(){const A=Z[H];A!==void 0&&A.type!==void 0&&(i.bindTexture(A.type,null),A.type=void 0,A.texture=void 0)},compressedTexImage2D:function(){try{i.compressedTexImage2D.apply(i,arguments)}catch{}},compressedTexImage3D:function(){try{i.compressedTexImage3D.apply(i,arguments)}catch{}},texImage2D:function(){try{i.texImage2D.apply(i,arguments)}catch{}},texImage3D:function(){try{i.texImage3D.apply(i,arguments)}catch{}},updateUBOMapping:function(A,k){let F=a.get(k);F===void 0&&(F=new WeakMap,a.set(k,F));let se=F.get(A);se===void 0&&(se=i.getUniformBlockIndex(k,A.name),F.set(A,se))},uniformBlockBinding:function(A,k){const F=a.get(k).get(A);s.get(k)!==F&&(i.uniformBlockBinding(k,F,A.__bindingPointIndex),s.set(k,F))},texStorage2D:function(){try{i.texStorage2D.apply(i,arguments)}catch{}},texStorage3D:function(){try{i.texStorage3D.apply(i,arguments)}catch{}},texSubImage2D:function(){try{i.texSubImage2D.apply(i,arguments)}catch{}},texSubImage3D:function(){try{i.texSubImage3D.apply(i,arguments)}catch{}},compressedTexSubImage2D:function(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch{}},compressedTexSubImage3D:function(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch{}},scissor:function(A){ve.equals(A)===!1&&(i.scissor(A.x,A.y,A.z,A.w),ve.copy(A))},viewport:function(A){be.equals(A)===!1&&(i.viewport(A.x,A.y,A.z,A.w),be.copy(A))},reset:function(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),n={},H=null,Z={},o={},l=new WeakMap,h=[],c=null,u=!1,d=null,p=null,f=null,v=null,m=null,g=null,_=null,y=new oe(0,0,0),x=0,M=!1,b=null,w=null,T=null,R=null,I=null,ve.set(0,0,i.canvas.width,i.canvas.height),be.set(0,0,i.canvas.width,i.canvas.height),e.reset(),t.reset(),r.reset()}}}function xT(i,e,t,r,s,a,n){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),h=new X,c=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(N,P){return p?new OffscreenCanvas(N,P):uh("canvas")}function v(N,P,j){let K=1;const O=re(N);if((O.width>j||O.height>j)&&(K=j/Math.max(O.width,O.height)),K<1){if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap||typeof VideoFrame<"u"&&N instanceof VideoFrame){const B=Math.floor(K*O.width),A=Math.floor(K*O.height);u===void 0&&(u=f(B,A));const k=P?f(B,A):u;return k.width=B,k.height=A,k.getContext("2d").drawImage(N,0,0,B,A),k}return N}return N}function m(N){return N.generateMipmaps&&N.minFilter!==nt&&N.minFilter!==Vt}function g(N){i.generateMipmap(N)}function _(N,P,j,K,O=!1){if(N!==null&&i[N]!==void 0)return i[N];let B=P;if(P===i.RED&&(j===i.FLOAT&&(B=i.R32F),j===i.HALF_FLOAT&&(B=i.R16F),j===i.UNSIGNED_BYTE&&(B=i.R8)),P===i.RED_INTEGER&&(j===i.UNSIGNED_BYTE&&(B=i.R8UI),j===i.UNSIGNED_SHORT&&(B=i.R16UI),j===i.UNSIGNED_INT&&(B=i.R32UI),j===i.BYTE&&(B=i.R8I),j===i.SHORT&&(B=i.R16I),j===i.INT&&(B=i.R32I)),P===i.RG&&(j===i.FLOAT&&(B=i.RG32F),j===i.HALF_FLOAT&&(B=i.RG16F),j===i.UNSIGNED_BYTE&&(B=i.RG8)),P===i.RG_INTEGER&&(j===i.UNSIGNED_BYTE&&(B=i.RG8UI),j===i.UNSIGNED_SHORT&&(B=i.RG16UI),j===i.UNSIGNED_INT&&(B=i.RG32UI),j===i.BYTE&&(B=i.RG8I),j===i.SHORT&&(B=i.RG16I),j===i.INT&&(B=i.RG32I)),P===i.RGB&&j===i.UNSIGNED_INT_5_9_9_9_REV&&(B=i.RGB9_E5),P===i.RGBA){const A=O?nh:rt.getTransfer(K);j===i.FLOAT&&(B=i.RGBA32F),j===i.HALF_FLOAT&&(B=i.RGBA16F),j===i.UNSIGNED_BYTE&&(B=A===mt?i.SRGB8_ALPHA8:i.RGBA8),j===i.UNSIGNED_SHORT_4_4_4_4&&(B=i.RGBA4),j===i.UNSIGNED_SHORT_5_5_5_1&&(B=i.RGB5_A1)}return B!==i.R16F&&B!==i.R32F&&B!==i.RG16F&&B!==i.RG32F&&B!==i.RGBA16F&&B!==i.RGBA32F||e.get("EXT_color_buffer_float"),B}function y(N,P){let j;return N?P===null||P===Mn||P===ma?j=i.DEPTH24_STENCIL8:P===tr?j=i.DEPTH32F_STENCIL8:P===Lo&&(j=i.DEPTH24_STENCIL8):P===null||P===Mn||P===ma?j=i.DEPTH_COMPONENT24:P===tr?j=i.DEPTH_COMPONENT32F:P===Lo&&(j=i.DEPTH_COMPONENT16),j}function x(N,P){return m(N)===!0||N.isFramebufferTexture&&N.minFilter!==nt&&N.minFilter!==Vt?Math.log2(Math.max(P.width,P.height))+1:N.mipmaps!==void 0&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?P.mipmaps.length:1}function M(N){const P=N.target;P.removeEventListener("dispose",M),function(j){const K=r.get(j);if(K.__webglInit===void 0)return;const O=j.source,B=d.get(O);if(B){const A=B[K.__cacheKey];A.usedTimes--,A.usedTimes===0&&w(j),Object.keys(B).length===0&&d.delete(O)}r.remove(j)}(P),P.isVideoTexture&&c.delete(P)}function b(N){const P=N.target;P.removeEventListener("dispose",b),function(j){const K=r.get(j);if(j.depthTexture&&j.depthTexture.dispose(),j.isWebGLCubeRenderTarget)for(let B=0;B<6;B++){if(Array.isArray(K.__webglFramebuffer[B]))for(let A=0;A<K.__webglFramebuffer[B].length;A++)i.deleteFramebuffer(K.__webglFramebuffer[B][A]);else i.deleteFramebuffer(K.__webglFramebuffer[B]);K.__webglDepthbuffer&&i.deleteRenderbuffer(K.__webglDepthbuffer[B])}else{if(Array.isArray(K.__webglFramebuffer))for(let B=0;B<K.__webglFramebuffer.length;B++)i.deleteFramebuffer(K.__webglFramebuffer[B]);else i.deleteFramebuffer(K.__webglFramebuffer);if(K.__webglDepthbuffer&&i.deleteRenderbuffer(K.__webglDepthbuffer),K.__webglMultisampledFramebuffer&&i.deleteFramebuffer(K.__webglMultisampledFramebuffer),K.__webglColorRenderbuffer)for(let B=0;B<K.__webglColorRenderbuffer.length;B++)K.__webglColorRenderbuffer[B]&&i.deleteRenderbuffer(K.__webglColorRenderbuffer[B]);K.__webglDepthRenderbuffer&&i.deleteRenderbuffer(K.__webglDepthRenderbuffer)}const O=j.textures;for(let B=0,A=O.length;B<A;B++){const k=r.get(O[B]);k.__webglTexture&&(i.deleteTexture(k.__webglTexture),n.memory.textures--),r.remove(O[B])}r.remove(j)}(P)}function w(N){const P=r.get(N);i.deleteTexture(P.__webglTexture);const j=N.source;delete d.get(j)[P.__cacheKey],n.memory.textures--}let T=0;function R(N,P){const j=r.get(N);if(N.isVideoTexture&&function(K){const O=n.render.frame;c.get(K)!==O&&(c.set(K,O),K.update())}(N),N.isRenderTargetTexture===!1&&N.version>0&&j.__version!==N.version){const K=N.image;if(K!==null&&K.complete!==!1)return void H(j,N,P)}t.bindTexture(i.TEXTURE_2D,j.__webglTexture,i.TEXTURE0+P)}const I={[jt]:i.REPEAT,[gi]:i.CLAMP_TO_EDGE,[pa]:i.MIRRORED_REPEAT},E={[nt]:i.NEAREST,[Rd]:i.NEAREST_MIPMAP_NEAREST,[an]:i.NEAREST_MIPMAP_LINEAR,[Vt]:i.LINEAR,[_o]:i.LINEAR_MIPMAP_NEAREST,[Qr]:i.LINEAR_MIPMAP_LINEAR},L={[bw]:i.NEVER,[Rw]:i.ALWAYS,[ww]:i.LESS,[Tw]:i.LEQUAL,[Sw]:i.EQUAL,[Cw]:i.GEQUAL,[Aw]:i.GREATER,[Ew]:i.NOTEQUAL};function D(N,P){if(P.type===tr&&e.has("OES_texture_float_linear")===!1&&(P.magFilter===Vt||P.magFilter===_o||P.magFilter===an||P.magFilter===Qr||P.minFilter===Vt||P.minFilter===_o||P.minFilter===an||P.minFilter),i.texParameteri(N,i.TEXTURE_WRAP_S,I[P.wrapS]),i.texParameteri(N,i.TEXTURE_WRAP_T,I[P.wrapT]),N!==i.TEXTURE_3D&&N!==i.TEXTURE_2D_ARRAY||i.texParameteri(N,i.TEXTURE_WRAP_R,I[P.wrapR]),i.texParameteri(N,i.TEXTURE_MAG_FILTER,E[P.magFilter]),i.texParameteri(N,i.TEXTURE_MIN_FILTER,E[P.minFilter]),P.compareFunction&&(i.texParameteri(N,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(N,i.TEXTURE_COMPARE_FUNC,L[P.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(P.magFilter===nt||P.minFilter!==an&&P.minFilter!==Qr||P.type===tr&&e.has("OES_texture_float_linear")===!1)return;if(P.anisotropy>1||r.get(P).__currentAnisotropy){const j=e.get("EXT_texture_filter_anisotropic");i.texParameterf(N,j.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(P.anisotropy,s.getMaxAnisotropy())),r.get(P).__currentAnisotropy=P.anisotropy}}}function U(N,P){let j=!1;N.__webglInit===void 0&&(N.__webglInit=!0,P.addEventListener("dispose",M));const K=P.source;let O=d.get(K);O===void 0&&(O={},d.set(K,O));const B=function(A){const k=[];return k.push(A.wrapS),k.push(A.wrapT),k.push(A.wrapR||0),k.push(A.magFilter),k.push(A.minFilter),k.push(A.anisotropy),k.push(A.internalFormat),k.push(A.format),k.push(A.type),k.push(A.generateMipmaps),k.push(A.premultiplyAlpha),k.push(A.flipY),k.push(A.unpackAlignment),k.push(A.colorSpace),k.join()}(P);if(B!==N.__cacheKey){O[B]===void 0&&(O[B]={texture:i.createTexture(),usedTimes:0},n.memory.textures++,j=!0),O[B].usedTimes++;const A=O[N.__cacheKey];A!==void 0&&(O[N.__cacheKey].usedTimes--,A.usedTimes===0&&w(P)),N.__cacheKey=B,N.__webglTexture=O[B].texture}return j}function H(N,P,j){let K=i.TEXTURE_2D;(P.isDataArrayTexture||P.isCompressedArrayTexture)&&(K=i.TEXTURE_2D_ARRAY),P.isData3DTexture&&(K=i.TEXTURE_3D);const O=U(N,P),B=P.source;t.bindTexture(K,N.__webglTexture,i.TEXTURE0+j);const A=r.get(B);if(B.version!==A.__version||O===!0){t.activeTexture(i.TEXTURE0+j);const k=rt.getPrimaries(rt.workingColorSpace),F=P.colorSpace===$a?null:rt.getPrimaries(P.colorSpace),se=P.colorSpace===$a||k===F?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,P.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,P.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,P.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,se);let V=v(P.image,!1,s.maxTextureSize);V=de(P,V);const ae=a.convert(P.format,P.colorSpace),xe=a.convert(P.type);let ce,z=_(P.internalFormat,ae,xe,P.colorSpace,P.isVideoTexture);D(K,P);const W=P.mipmaps,ee=P.isVideoTexture!==!0,ge=A.__version===void 0||O===!0,Le=B.dataReady,Fe=x(P,V);if(P.isDepthTexture)z=y(P.format===fa,P.type),ge&&(ee?t.texStorage2D(i.TEXTURE_2D,1,z,V.width,V.height):t.texImage2D(i.TEXTURE_2D,0,z,V.width,V.height,0,ae,xe,null));else if(P.isDataTexture)if(W.length>0){ee&&ge&&t.texStorage2D(i.TEXTURE_2D,Fe,z,W[0].width,W[0].height);for(let Se=0,ke=W.length;Se<ke;Se++)ce=W[Se],ee?Le&&t.texSubImage2D(i.TEXTURE_2D,Se,0,0,ce.width,ce.height,ae,xe,ce.data):t.texImage2D(i.TEXTURE_2D,Se,z,ce.width,ce.height,0,ae,xe,ce.data);P.generateMipmaps=!1}else ee?(ge&&t.texStorage2D(i.TEXTURE_2D,Fe,z,V.width,V.height),Le&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,V.width,V.height,ae,xe,V.data)):t.texImage2D(i.TEXTURE_2D,0,z,V.width,V.height,0,ae,xe,V.data);else if(P.isCompressedTexture)if(P.isCompressedArrayTexture){ee&&ge&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Fe,z,W[0].width,W[0].height,V.depth);for(let Se=0,ke=W.length;Se<ke;Se++)if(ce=W[Se],P.format!==fr){if(ae!==null)if(ee){if(Le)if(P.layerUpdates.size>0){for(const He of P.layerUpdates){const it=ce.width*ce.height;t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Se,0,0,He,ce.width,ce.height,1,ae,ce.data.slice(it*He,it*(He+1)),0,0)}P.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Se,0,0,0,ce.width,ce.height,V.depth,ae,ce.data,0,0)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Se,z,ce.width,ce.height,V.depth,0,ce.data,0,0)}else ee?Le&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,Se,0,0,0,ce.width,ce.height,V.depth,ae,xe,ce.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Se,z,ce.width,ce.height,V.depth,0,ae,xe,ce.data)}else{ee&&ge&&t.texStorage2D(i.TEXTURE_2D,Fe,z,W[0].width,W[0].height);for(let Se=0,ke=W.length;Se<ke;Se++)ce=W[Se],P.format!==fr?ae!==null&&(ee?Le&&t.compressedTexSubImage2D(i.TEXTURE_2D,Se,0,0,ce.width,ce.height,ae,ce.data):t.compressedTexImage2D(i.TEXTURE_2D,Se,z,ce.width,ce.height,0,ce.data)):ee?Le&&t.texSubImage2D(i.TEXTURE_2D,Se,0,0,ce.width,ce.height,ae,xe,ce.data):t.texImage2D(i.TEXTURE_2D,Se,z,ce.width,ce.height,0,ae,xe,ce.data)}else if(P.isDataArrayTexture)if(ee){if(ge&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Fe,z,V.width,V.height,V.depth),Le)if(P.layerUpdates.size>0){let Se;switch(xe){case i.UNSIGNED_BYTE:switch(ae){case i.ALPHA:case i.LUMINANCE:Se=1;break;case i.LUMINANCE_ALPHA:Se=2;break;case i.RGB:Se=3;break;case i.RGBA:Se=4;break;default:throw new Error(`Unknown texel size for format ${ae}.`)}break;case i.UNSIGNED_SHORT_4_4_4_4:case i.UNSIGNED_SHORT_5_5_5_1:case i.UNSIGNED_SHORT_5_6_5:Se=1;break;default:throw new Error(`Unknown texel size for type ${xe}.`)}const ke=V.width*V.height*Se;for(const He of P.layerUpdates)t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,He,V.width,V.height,1,ae,xe,V.data.slice(ke*He,ke*(He+1)));P.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,V.width,V.height,V.depth,ae,xe,V.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,z,V.width,V.height,V.depth,0,ae,xe,V.data);else if(P.isData3DTexture)ee?(ge&&t.texStorage3D(i.TEXTURE_3D,Fe,z,V.width,V.height,V.depth),Le&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,V.width,V.height,V.depth,ae,xe,V.data)):t.texImage3D(i.TEXTURE_3D,0,z,V.width,V.height,V.depth,0,ae,xe,V.data);else if(P.isFramebufferTexture){if(ge)if(ee)t.texStorage2D(i.TEXTURE_2D,Fe,z,V.width,V.height);else{let Se=V.width,ke=V.height;for(let He=0;He<Fe;He++)t.texImage2D(i.TEXTURE_2D,He,z,Se,ke,0,ae,xe,null),Se>>=1,ke>>=1}}else if(W.length>0){if(ee&&ge){const Se=re(W[0]);t.texStorage2D(i.TEXTURE_2D,Fe,z,Se.width,Se.height)}for(let Se=0,ke=W.length;Se<ke;Se++)ce=W[Se],ee?Le&&t.texSubImage2D(i.TEXTURE_2D,Se,0,0,ae,xe,ce):t.texImage2D(i.TEXTURE_2D,Se,z,ae,xe,ce);P.generateMipmaps=!1}else if(ee){if(ge){const Se=re(V);t.texStorage2D(i.TEXTURE_2D,Fe,z,Se.width,Se.height)}Le&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,ae,xe,V)}else t.texImage2D(i.TEXTURE_2D,0,z,ae,xe,V);m(P)&&g(K),A.__version=B.version,P.onUpdate&&P.onUpdate(P)}N.__version=P.version}function Z(N,P,j,K,O,B){const A=a.convert(j.format,j.colorSpace),k=a.convert(j.type),F=_(j.internalFormat,A,k,j.colorSpace);if(!r.get(P).__hasExternalTextures){const se=Math.max(1,P.width>>B),V=Math.max(1,P.height>>B);O===i.TEXTURE_3D||O===i.TEXTURE_2D_ARRAY?t.texImage3D(O,B,F,se,V,P.depth,0,A,k,null):t.texImage2D(O,B,F,se,V,0,A,k,null)}t.bindFramebuffer(i.FRAMEBUFFER,N),ne(P)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,K,O,r.get(j).__webglTexture,0,J(P)):(O===i.TEXTURE_2D||O>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&O<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,K,O,r.get(j).__webglTexture,B),t.bindFramebuffer(i.FRAMEBUFFER,null)}function te(N,P,j){if(i.bindRenderbuffer(i.RENDERBUFFER,N),P.depthBuffer){const K=P.depthTexture,O=K&&K.isDepthTexture?K.type:null,B=y(P.stencilBuffer,O),A=P.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,k=J(P);ne(P)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,k,B,P.width,P.height):j?i.renderbufferStorageMultisample(i.RENDERBUFFER,k,B,P.width,P.height):i.renderbufferStorage(i.RENDERBUFFER,B,P.width,P.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,A,i.RENDERBUFFER,N)}else{const K=P.textures;for(let O=0;O<K.length;O++){const B=K[O],A=a.convert(B.format,B.colorSpace),k=a.convert(B.type),F=_(B.internalFormat,A,k,B.colorSpace),se=J(P);j&&ne(P)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,se,F,P.width,P.height):ne(P)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,se,F,P.width,P.height):i.renderbufferStorage(i.RENDERBUFFER,F,P.width,P.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function ie(N){const P=r.get(N),j=N.isWebGLCubeRenderTarget===!0;if(N.depthTexture&&!P.__autoAllocateDepthBuffer){if(j)throw new Error("target.depthTexture not supported in Cube render targets");(function(K,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,K),!O.depthTexture||!O.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(O.depthTexture).__webglTexture&&O.depthTexture.image.width===O.width&&O.depthTexture.image.height===O.height||(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),R(O.depthTexture,0);const B=r.get(O.depthTexture).__webglTexture,A=J(O);if(O.depthTexture.format===No)ne(O)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,B,0,A):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,B,0);else{if(O.depthTexture.format!==fa)throw new Error("Unknown depthTexture format");ne(O)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,B,0,A):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,B,0)}})(P.__webglFramebuffer,N)}else if(j){P.__webglDepthbuffer=[];for(let K=0;K<6;K++)t.bindFramebuffer(i.FRAMEBUFFER,P.__webglFramebuffer[K]),P.__webglDepthbuffer[K]=i.createRenderbuffer(),te(P.__webglDepthbuffer[K],N,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,P.__webglFramebuffer),P.__webglDepthbuffer=i.createRenderbuffer(),te(P.__webglDepthbuffer,N,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}const ve=[],be=[];function J(N){return Math.min(s.maxSamples,N.samples)}function ne(N){const P=r.get(N);return N.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&P.__useRenderToTexture!==!1}function de(N,P){const j=N.colorSpace;return N.format,N.type,N.isCompressedTexture===!0||N.isVideoTexture===!0||j!==Qt&&j!==$a&&rt.getTransfer(j),P}function re(N){return typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement?(h.width=N.naturalWidth||N.width,h.height=N.naturalHeight||N.height):typeof VideoFrame<"u"&&N instanceof VideoFrame?(h.width=N.displayWidth,h.height=N.displayHeight):(h.width=N.width,h.height=N.height),h}this.allocateTextureUnit=function(){const N=T;return s.maxTextures,T+=1,N},this.resetTextureUnits=function(){T=0},this.setTexture2D=R,this.setTexture2DArray=function(N,P){const j=r.get(N);N.version>0&&j.__version!==N.version?H(j,N,P):t.bindTexture(i.TEXTURE_2D_ARRAY,j.__webglTexture,i.TEXTURE0+P)},this.setTexture3D=function(N,P){const j=r.get(N);N.version>0&&j.__version!==N.version?H(j,N,P):t.bindTexture(i.TEXTURE_3D,j.__webglTexture,i.TEXTURE0+P)},this.setTextureCube=function(N,P){const j=r.get(N);N.version>0&&j.__version!==N.version?function(K,O,B){if(O.image.length!==6)return;const A=U(K,O),k=O.source;t.bindTexture(i.TEXTURE_CUBE_MAP,K.__webglTexture,i.TEXTURE0+B);const F=r.get(k);if(k.version!==F.__version||A===!0){t.activeTexture(i.TEXTURE0+B);const se=rt.getPrimaries(rt.workingColorSpace),V=O.colorSpace===$a?null:rt.getPrimaries(O.colorSpace),ae=O.colorSpace===$a||se===V?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,O.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,O.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,O.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,ae);const xe=O.isCompressedTexture||O.image[0].isCompressedTexture,ce=O.image[0]&&O.image[0].isDataTexture,z=[];for(let Ce=0;Ce<6;Ce++)z[Ce]=xe||ce?ce?O.image[Ce].image:O.image[Ce]:v(O.image[Ce],!0,s.maxCubemapSize),z[Ce]=de(O,z[Ce]);const W=z[0],ee=a.convert(O.format,O.colorSpace),ge=a.convert(O.type),Le=_(O.internalFormat,ee,ge,O.colorSpace),Fe=O.isVideoTexture!==!0,Se=F.__version===void 0||A===!0,ke=k.dataReady;let He,it=x(O,W);if(D(i.TEXTURE_CUBE_MAP,O),xe){Fe&&Se&&t.texStorage2D(i.TEXTURE_CUBE_MAP,it,Le,W.width,W.height);for(let Ce=0;Ce<6;Ce++){He=z[Ce].mipmaps;for(let st=0;st<He.length;st++){const ze=He[st];O.format!==fr?ee!==null&&(Fe?ke&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st,0,0,ze.width,ze.height,ee,ze.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st,Le,ze.width,ze.height,0,ze.data)):Fe?ke&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st,0,0,ze.width,ze.height,ee,ge,ze.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st,Le,ze.width,ze.height,0,ee,ge,ze.data)}}}else{if(He=O.mipmaps,Fe&&Se){He.length>0&&it++;const Ce=re(z[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,it,Le,Ce.width,Ce.height)}for(let Ce=0;Ce<6;Ce++)if(ce){Fe?ke&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,0,0,z[Ce].width,z[Ce].height,ee,ge,z[Ce].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,Le,z[Ce].width,z[Ce].height,0,ee,ge,z[Ce].data);for(let st=0;st<He.length;st++){const ze=He[st].image[Ce].image;Fe?ke&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st+1,0,0,ze.width,ze.height,ee,ge,ze.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st+1,Le,ze.width,ze.height,0,ee,ge,ze.data)}}else{Fe?ke&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,0,0,ee,ge,z[Ce]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0,Le,ee,ge,z[Ce]);for(let st=0;st<He.length;st++){const ze=He[st];Fe?ke&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st+1,0,0,ee,ge,ze.image[Ce]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,st+1,Le,ee,ge,ze.image[Ce])}}}m(O)&&g(i.TEXTURE_CUBE_MAP),F.__version=k.version,O.onUpdate&&O.onUpdate(O)}K.__version=O.version}(j,N,P):t.bindTexture(i.TEXTURE_CUBE_MAP,j.__webglTexture,i.TEXTURE0+P)},this.rebindTextures=function(N,P,j){const K=r.get(N);P!==void 0&&Z(K.__webglFramebuffer,N,N.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),j!==void 0&&ie(N)},this.setupRenderTarget=function(N){const P=N.texture,j=r.get(N),K=r.get(P);N.addEventListener("dispose",b);const O=N.textures,B=N.isWebGLCubeRenderTarget===!0,A=O.length>1;if(A||(K.__webglTexture===void 0&&(K.__webglTexture=i.createTexture()),K.__version=P.version,n.memory.textures++),B){j.__webglFramebuffer=[];for(let k=0;k<6;k++)if(P.mipmaps&&P.mipmaps.length>0){j.__webglFramebuffer[k]=[];for(let F=0;F<P.mipmaps.length;F++)j.__webglFramebuffer[k][F]=i.createFramebuffer()}else j.__webglFramebuffer[k]=i.createFramebuffer()}else{if(P.mipmaps&&P.mipmaps.length>0){j.__webglFramebuffer=[];for(let k=0;k<P.mipmaps.length;k++)j.__webglFramebuffer[k]=i.createFramebuffer()}else j.__webglFramebuffer=i.createFramebuffer();if(A)for(let k=0,F=O.length;k<F;k++){const se=r.get(O[k]);se.__webglTexture===void 0&&(se.__webglTexture=i.createTexture(),n.memory.textures++)}if(N.samples>0&&ne(N)===!1){j.__webglMultisampledFramebuffer=i.createFramebuffer(),j.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,j.__webglMultisampledFramebuffer);for(let k=0;k<O.length;k++){const F=O[k];j.__webglColorRenderbuffer[k]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,j.__webglColorRenderbuffer[k]);const se=a.convert(F.format,F.colorSpace),V=a.convert(F.type),ae=_(F.internalFormat,se,V,F.colorSpace,N.isXRRenderTarget===!0),xe=J(N);i.renderbufferStorageMultisample(i.RENDERBUFFER,xe,ae,N.width,N.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+k,i.RENDERBUFFER,j.__webglColorRenderbuffer[k])}i.bindRenderbuffer(i.RENDERBUFFER,null),N.depthBuffer&&(j.__webglDepthRenderbuffer=i.createRenderbuffer(),te(j.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(B){t.bindTexture(i.TEXTURE_CUBE_MAP,K.__webglTexture),D(i.TEXTURE_CUBE_MAP,P);for(let k=0;k<6;k++)if(P.mipmaps&&P.mipmaps.length>0)for(let F=0;F<P.mipmaps.length;F++)Z(j.__webglFramebuffer[k][F],N,P,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+k,F);else Z(j.__webglFramebuffer[k],N,P,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+k,0);m(P)&&g(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(A){for(let k=0,F=O.length;k<F;k++){const se=O[k],V=r.get(se);t.bindTexture(i.TEXTURE_2D,V.__webglTexture),D(i.TEXTURE_2D,se),Z(j.__webglFramebuffer,N,se,i.COLOR_ATTACHMENT0+k,i.TEXTURE_2D,0),m(se)&&g(i.TEXTURE_2D)}t.unbindTexture()}else{let k=i.TEXTURE_2D;if((N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(k=N.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(k,K.__webglTexture),D(k,P),P.mipmaps&&P.mipmaps.length>0)for(let F=0;F<P.mipmaps.length;F++)Z(j.__webglFramebuffer[F],N,P,i.COLOR_ATTACHMENT0,k,F);else Z(j.__webglFramebuffer,N,P,i.COLOR_ATTACHMENT0,k,0);m(P)&&g(k),t.unbindTexture()}N.depthBuffer&&ie(N)},this.updateRenderTargetMipmap=function(N){const P=N.textures;for(let j=0,K=P.length;j<K;j++){const O=P[j];if(m(O)){const B=N.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,A=r.get(O).__webglTexture;t.bindTexture(B,A),g(B),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function(N){if(N.samples>0){if(ne(N)===!1){const P=N.textures,j=N.width,K=N.height;let O=i.COLOR_BUFFER_BIT;const B=N.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,A=r.get(N),k=P.length>1;if(k)for(let F=0;F<P.length;F++)t.bindFramebuffer(i.FRAMEBUFFER,A.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+F,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,A.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+F,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,A.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,A.__webglFramebuffer);for(let F=0;F<P.length;F++){if(N.resolveDepthBuffer&&(N.depthBuffer&&(O|=i.DEPTH_BUFFER_BIT),N.stencilBuffer&&N.resolveStencilBuffer&&(O|=i.STENCIL_BUFFER_BIT)),k){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,A.__webglColorRenderbuffer[F]);const se=r.get(P[F]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,se,0)}i.blitFramebuffer(0,0,j,K,0,0,j,K,O,i.NEAREST),l===!0&&(ve.length=0,be.length=0,ve.push(i.COLOR_ATTACHMENT0+F),N.depthBuffer&&N.resolveDepthBuffer===!1&&(ve.push(B),be.push(B),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,be)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,ve))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),k)for(let F=0;F<P.length;F++){t.bindFramebuffer(i.FRAMEBUFFER,A.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+F,i.RENDERBUFFER,A.__webglColorRenderbuffer[F]);const se=r.get(P[F]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,A.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+F,i.TEXTURE_2D,se,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,A.__webglMultisampledFramebuffer)}else if(N.depthBuffer&&N.resolveDepthBuffer===!1&&l){const P=N.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[P])}}},this.setupDepthRenderbuffer=ie,this.setupFrameBufferTexture=Z,this.useMultisampledRTT=ne}function Kx(i,e){return{convert:function(t,r=""){let s;const a=rt.getTransfer(r);if(t===xn)return i.UNSIGNED_BYTE;if(t===ug)return i.UNSIGNED_SHORT_4_4_4_4;if(t===dg)return i.UNSIGNED_SHORT_5_5_5_1;if(t===35902)return i.UNSIGNED_INT_5_9_9_9_REV;if(t===1010)return i.BYTE;if(t===1011)return i.SHORT;if(t===Lo)return i.UNSIGNED_SHORT;if(t===cg)return i.INT;if(t===Mn)return i.UNSIGNED_INT;if(t===tr)return i.FLOAT;if(t===Ht)return i.HALF_FLOAT;if(t===1021)return i.ALPHA;if(t===1022)return i.RGB;if(t===fr)return i.RGBA;if(t===1024)return i.LUMINANCE;if(t===1025)return i.LUMINANCE_ALPHA;if(t===No)return i.DEPTH_COMPONENT;if(t===fa)return i.DEPTH_STENCIL;if(t===pg)return i.RED;if(t===mg)return i.RED_INTEGER;if(t===1030)return i.RG;if(t===fg)return i.RG_INTEGER;if(t===gg)return i.RGBA_INTEGER;if(t===Su||t===Tu||t===Au||t===Eu)if(a===mt){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s===null)return null;if(t===Su)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===Tu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===Au)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===Eu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),s===null)return null;if(t===Su)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Tu)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Au)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Eu)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Hm||t===Gm||t===jm||t===Wm){if(s=e.get("WEBGL_compressed_texture_pvrtc"),s===null)return null;if(t===Hm)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Gm)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===jm)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Wm)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Xm||t===qm||t===Ym){if(s=e.get("WEBGL_compressed_texture_etc"),s===null)return null;if(t===Xm||t===qm)return a===mt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(t===Ym)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(t===Zm||t===Km||t===Qm||t===Jm||t===$m||t===ef||t===tf||t===rf||t===sf||t===af||t===nf||t===of||t===lf||t===hf){if(s=e.get("WEBGL_compressed_texture_astc"),s===null)return null;if(t===Zm)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===Km)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===Qm)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===Jm)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===$m)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===ef)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===tf)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===rf)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===sf)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===af)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===nf)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===of)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===lf)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===hf)return a===mt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===Cu||t===cf||t===uf){if(s=e.get("EXT_texture_compression_bptc"),s===null)return null;if(t===Cu)return a===mt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(t===cf)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(t===uf)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(t===36283||t===df||t===pf||t===mf){if(s=e.get("EXT_texture_compression_rgtc"),s===null)return null;if(t===Cu)return s.COMPRESSED_RED_RGTC1_EXT;if(t===df)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===pf)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===mf)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===ma?i.UNSIGNED_INT_24_8:i[t]!==void 0?i[t]:null}}}class Qx extends Gt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class vi extends Ue{constructor(){super(),this.isGroup=!0,this.type="Group"}}const MT={type:"move"};class Lp{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new vi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new vi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new S,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new S),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new vi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new S,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new S),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let s=null,a=null,n=null;const o=this._targetRay,l=this._grip,h=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(h&&e.hand){n=!0;for(const v of e.hand.values()){const m=t.getJointPose(v,r),g=this._getHandJoint(h,v);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=m.radius),g.visible=m!==null}const c=h.joints["index-finger-tip"],u=h.joints["thumb-tip"],d=c.position.distanceTo(u.position),p=.02,f=.005;h.inputState.pinching&&d>p+f?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&d<=p-f&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,r),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,r),s===null&&a!==null&&(s=a),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(MT)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=a!==null),h!==null&&(h.visible=n!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new vi;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class bT{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const s=new pt;e.properties.get(s).__webglTexture=t.texture,t.depthNear==r.depthNear&&t.depthFar==r.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new tt({vertexShader:`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new ue(new as(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}}class wT extends ts{constructor(e,t){super();const r=this;let s=null,a=1,n=null,o="local-floor",l=1,h=null,c=null,u=null,d=null,p=null,f=null;const v=new bT,m=t.getContextAttributes();let g=null,_=null;const y=[],x=[],M=new X;let b=null;const w=new Gt;w.layers.enable(1),w.viewport=new Ve;const T=new Gt;T.layers.enable(2),T.viewport=new Ve;const R=[w,T],I=new Qx;I.layers.enable(1),I.layers.enable(2);let E=null,L=null;function D(J){const ne=x.indexOf(J.inputSource);if(ne===-1)return;const de=y[ne];de!==void 0&&(de.update(J.inputSource,J.frame,h||n),de.dispatchEvent({type:J.type,data:J.inputSource}))}function U(){s.removeEventListener("select",D),s.removeEventListener("selectstart",D),s.removeEventListener("selectend",D),s.removeEventListener("squeeze",D),s.removeEventListener("squeezestart",D),s.removeEventListener("squeezeend",D),s.removeEventListener("end",U),s.removeEventListener("inputsourceschange",H);for(let J=0;J<y.length;J++){const ne=x[J];ne!==null&&(x[J]=null,y[J].disconnect(ne))}E=null,L=null,v.reset(),e.setRenderTarget(g),p=null,d=null,u=null,s=null,_=null,be.stop(),r.isPresenting=!1,e.setPixelRatio(b),e.setSize(M.width,M.height,!1),r.dispatchEvent({type:"sessionend"})}function H(J){for(let ne=0;ne<J.removed.length;ne++){const de=J.removed[ne],re=x.indexOf(de);re>=0&&(x[re]=null,y[re].disconnect(de))}for(let ne=0;ne<J.added.length;ne++){const de=J.added[ne];let re=x.indexOf(de);if(re===-1){for(let P=0;P<y.length;P++){if(P>=x.length){x.push(de),re=P;break}if(x[P]===null){x[P]=de,re=P;break}}if(re===-1)break}const N=y[re];N&&N.connect(de)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(J){let ne=y[J];return ne===void 0&&(ne=new Lp,y[J]=ne),ne.getTargetRaySpace()},this.getControllerGrip=function(J){let ne=y[J];return ne===void 0&&(ne=new Lp,y[J]=ne),ne.getGripSpace()},this.getHand=function(J){let ne=y[J];return ne===void 0&&(ne=new Lp,y[J]=ne),ne.getHandSpace()},this.setFramebufferScaleFactor=function(J){a=J,r.isPresenting},this.setReferenceSpaceType=function(J){o=J,r.isPresenting},this.getReferenceSpace=function(){return h||n},this.setReferenceSpace=function(J){h=J},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=function(J){return Rr(this,null,function*(){if(s=J,s!==null){if(g=e.getRenderTarget(),s.addEventListener("select",D),s.addEventListener("selectstart",D),s.addEventListener("selectend",D),s.addEventListener("squeeze",D),s.addEventListener("squeezestart",D),s.addEventListener("squeezeend",D),s.addEventListener("end",U),s.addEventListener("inputsourceschange",H),m.xrCompatible!==!0&&(yield t.makeXRCompatible()),b=e.getPixelRatio(),e.getSize(M),s.renderState.layers===void 0){const ne={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(s,t,ne),s.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),_=new ht(p.framebufferWidth,p.framebufferHeight,{format:fr,type:xn,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let ne=null,de=null,re=null;m.depth&&(re=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ne=m.stencil?fa:No,de=m.stencil?ma:Mn);const N={colorFormat:t.RGBA8,depthFormat:re,scaleFactor:a};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(N),s.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),_=new ht(d.textureWidth,d.textureHeight,{format:fr,type:xn,depthTexture:new jh(d.textureWidth,d.textureHeight,de,void 0,void 0,void 0,void 0,void 0,void 0,ne),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}_.isXRRenderTarget=!0,this.setFoveation(l),h=null,n=yield s.requestReferenceSpace(o),be.setContext(s),be.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}})},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};const Z=new S,te=new S;function ie(J,ne){ne===null?J.matrixWorld.copy(J.matrix):J.matrixWorld.multiplyMatrices(ne.matrixWorld,J.matrix),J.matrixWorldInverse.copy(J.matrixWorld).invert()}this.updateCamera=function(J){if(s===null)return;v.texture!==null&&(J.near=v.depthNear,J.far=v.depthFar),I.near=T.near=w.near=J.near,I.far=T.far=w.far=J.far,E===I.near&&L===I.far||(s.updateRenderState({depthNear:I.near,depthFar:I.far}),E=I.near,L=I.far,w.near=E,w.far=L,T.near=E,T.far=L,w.updateProjectionMatrix(),T.updateProjectionMatrix(),J.updateProjectionMatrix());const ne=J.parent,de=I.cameras;ie(I,ne);for(let re=0;re<de.length;re++)ie(de[re],ne);de.length===2?function(re,N,P){Z.setFromMatrixPosition(N.matrixWorld),te.setFromMatrixPosition(P.matrixWorld);const j=Z.distanceTo(te),K=N.projectionMatrix.elements,O=P.projectionMatrix.elements,B=K[14]/(K[10]-1),A=K[14]/(K[10]+1),k=(K[9]+1)/K[5],F=(K[9]-1)/K[5],se=(K[8]-1)/K[0],V=(O[8]+1)/O[0],ae=B*se,xe=B*V,ce=j/(-se+V),z=ce*-se;N.matrixWorld.decompose(re.position,re.quaternion,re.scale),re.translateX(z),re.translateZ(ce),re.matrixWorld.compose(re.position,re.quaternion,re.scale),re.matrixWorldInverse.copy(re.matrixWorld).invert();const W=B+ce,ee=A+ce,ge=ae-z,Le=xe+(j-z),Fe=k*A/ee*W,Se=F*A/ee*W;re.projectionMatrix.makePerspective(ge,Le,Fe,Se,W,ee),re.projectionMatrixInverse.copy(re.projectionMatrix).invert()}(I,w,T):I.projectionMatrix.copy(w.projectionMatrix),function(re,N,P){P===null?re.matrix.copy(N.matrixWorld):(re.matrix.copy(P.matrixWorld),re.matrix.invert(),re.matrix.multiply(N.matrixWorld)),re.matrix.decompose(re.position,re.quaternion,re.scale),re.updateMatrixWorld(!0),re.projectionMatrix.copy(N.projectionMatrix),re.projectionMatrixInverse.copy(N.projectionMatrixInverse),re.isPerspectiveCamera&&(re.fov=2*Uo*Math.atan(1/re.projectionMatrix.elements[5]),re.zoom=1)}(J,I,ne)},this.getCamera=function(){return I},this.getFoveation=function(){return d===null&&p===null?void 0:l},this.setFoveation=function(J){l=J,d!==null&&(d.fixedFoveation=J),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=J)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(I)};let ve=null;const be=new jx;be.setAnimationLoop(function(J,ne){if(c=ne.getViewerPose(h||n),f=ne,c!==null){const de=c.views;p!==null&&(e.setRenderTargetFramebuffer(_,p.framebuffer),e.setRenderTarget(_));let re=!1;de.length!==I.cameras.length&&(I.cameras.length=0,re=!0);for(let P=0;P<de.length;P++){const j=de[P];let K=null;if(p!==null)K=p.getViewport(j);else{const B=u.getViewSubImage(d,j);K=B.viewport,P===0&&(e.setRenderTargetTextures(_,B.colorTexture,d.ignoreDepthValues?void 0:B.depthStencilTexture),e.setRenderTarget(_))}let O=R[P];O===void 0&&(O=new Gt,O.layers.enable(P),O.viewport=new Ve,R[P]=O),O.matrix.fromArray(j.transform.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale),O.projectionMatrix.fromArray(j.projectionMatrix),O.projectionMatrixInverse.copy(O.projectionMatrix).invert(),O.viewport.set(K.x,K.y,K.width,K.height),P===0&&(I.matrix.copy(O.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale)),re===!0&&I.cameras.push(O)}const N=s.enabledFeatures;if(N&&N.includes("depth-sensing")){const P=u.getDepthInformation(de[0]);P&&P.isValid&&P.texture&&v.init(e,P,s.renderState)}}for(let de=0;de<y.length;de++){const re=x[de],N=y[de];re!==null&&N!==void 0&&N.update(re,ne,h||n)}ve&&ve(J,ne),ne.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ne}),f=null}),this.setAnimationLoop=function(J){ve=J},this.dispose=function(){}}}const Da=new yt,ST=new me;function TT(i,e){function t(s,a){s.matrixAutoUpdate===!0&&s.updateMatrix(),a.value.copy(s.matrix)}function r(s,a){s.opacity.value=a.opacity,a.color&&s.diffuse.value.copy(a.color),a.emissive&&s.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),a.map&&(s.map.value=a.map,t(a.map,s.mapTransform)),a.alphaMap&&(s.alphaMap.value=a.alphaMap,t(a.alphaMap,s.alphaMapTransform)),a.bumpMap&&(s.bumpMap.value=a.bumpMap,t(a.bumpMap,s.bumpMapTransform),s.bumpScale.value=a.bumpScale,a.side===Si&&(s.bumpScale.value*=-1)),a.normalMap&&(s.normalMap.value=a.normalMap,t(a.normalMap,s.normalMapTransform),s.normalScale.value.copy(a.normalScale),a.side===Si&&s.normalScale.value.negate()),a.displacementMap&&(s.displacementMap.value=a.displacementMap,t(a.displacementMap,s.displacementMapTransform),s.displacementScale.value=a.displacementScale,s.displacementBias.value=a.displacementBias),a.emissiveMap&&(s.emissiveMap.value=a.emissiveMap,t(a.emissiveMap,s.emissiveMapTransform)),a.specularMap&&(s.specularMap.value=a.specularMap,t(a.specularMap,s.specularMapTransform)),a.alphaTest>0&&(s.alphaTest.value=a.alphaTest);const n=e.get(a),o=n.envMap,l=n.envMapRotation;o&&(s.envMap.value=o,Da.copy(l),Da.x*=-1,Da.y*=-1,Da.z*=-1,o.isCubeTexture&&o.isRenderTargetTexture===!1&&(Da.y*=-1,Da.z*=-1),s.envMapRotation.value.setFromMatrix4(ST.makeRotationFromEuler(Da)),s.flipEnvMap.value=o.isCubeTexture&&o.isRenderTargetTexture===!1?-1:1,s.reflectivity.value=a.reflectivity,s.ior.value=a.ior,s.refractionRatio.value=a.refractionRatio),a.lightMap&&(s.lightMap.value=a.lightMap,s.lightMapIntensity.value=a.lightMapIntensity,t(a.lightMap,s.lightMapTransform)),a.aoMap&&(s.aoMap.value=a.aoMap,s.aoMapIntensity.value=a.aoMapIntensity,t(a.aoMap,s.aoMapTransform))}return{refreshFogUniforms:function(s,a){a.color.getRGB(s.fogColor.value,Vx(i)),a.isFog?(s.fogNear.value=a.near,s.fogFar.value=a.far):a.isFogExp2&&(s.fogDensity.value=a.density)},refreshMaterialUniforms:function(s,a,n,o,l){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(s,a):a.isMeshToonMaterial?(r(s,a),function(h,c){c.gradientMap&&(h.gradientMap.value=c.gradientMap)}(s,a)):a.isMeshPhongMaterial?(r(s,a),function(h,c){h.specular.value.copy(c.specular),h.shininess.value=Math.max(c.shininess,1e-4)}(s,a)):a.isMeshStandardMaterial?(r(s,a),function(h,c){h.metalness.value=c.metalness,c.metalnessMap&&(h.metalnessMap.value=c.metalnessMap,t(c.metalnessMap,h.metalnessMapTransform)),h.roughness.value=c.roughness,c.roughnessMap&&(h.roughnessMap.value=c.roughnessMap,t(c.roughnessMap,h.roughnessMapTransform)),c.envMap&&(h.envMapIntensity.value=c.envMapIntensity)}(s,a),a.isMeshPhysicalMaterial&&function(h,c,u){h.ior.value=c.ior,c.sheen>0&&(h.sheenColor.value.copy(c.sheenColor).multiplyScalar(c.sheen),h.sheenRoughness.value=c.sheenRoughness,c.sheenColorMap&&(h.sheenColorMap.value=c.sheenColorMap,t(c.sheenColorMap,h.sheenColorMapTransform)),c.sheenRoughnessMap&&(h.sheenRoughnessMap.value=c.sheenRoughnessMap,t(c.sheenRoughnessMap,h.sheenRoughnessMapTransform))),c.clearcoat>0&&(h.clearcoat.value=c.clearcoat,h.clearcoatRoughness.value=c.clearcoatRoughness,c.clearcoatMap&&(h.clearcoatMap.value=c.clearcoatMap,t(c.clearcoatMap,h.clearcoatMapTransform)),c.clearcoatRoughnessMap&&(h.clearcoatRoughnessMap.value=c.clearcoatRoughnessMap,t(c.clearcoatRoughnessMap,h.clearcoatRoughnessMapTransform)),c.clearcoatNormalMap&&(h.clearcoatNormalMap.value=c.clearcoatNormalMap,t(c.clearcoatNormalMap,h.clearcoatNormalMapTransform),h.clearcoatNormalScale.value.copy(c.clearcoatNormalScale),c.side===Si&&h.clearcoatNormalScale.value.negate())),c.dispersion>0&&(h.dispersion.value=c.dispersion),c.iridescence>0&&(h.iridescence.value=c.iridescence,h.iridescenceIOR.value=c.iridescenceIOR,h.iridescenceThicknessMinimum.value=c.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum.value=c.iridescenceThicknessRange[1],c.iridescenceMap&&(h.iridescenceMap.value=c.iridescenceMap,t(c.iridescenceMap,h.iridescenceMapTransform)),c.iridescenceThicknessMap&&(h.iridescenceThicknessMap.value=c.iridescenceThicknessMap,t(c.iridescenceThicknessMap,h.iridescenceThicknessMapTransform))),c.transmission>0&&(h.transmission.value=c.transmission,h.transmissionSamplerMap.value=u.texture,h.transmissionSamplerSize.value.set(u.width,u.height),c.transmissionMap&&(h.transmissionMap.value=c.transmissionMap,t(c.transmissionMap,h.transmissionMapTransform)),h.thickness.value=c.thickness,c.thicknessMap&&(h.thicknessMap.value=c.thicknessMap,t(c.thicknessMap,h.thicknessMapTransform)),h.attenuationDistance.value=c.attenuationDistance,h.attenuationColor.value.copy(c.attenuationColor)),c.anisotropy>0&&(h.anisotropyVector.value.set(c.anisotropy*Math.cos(c.anisotropyRotation),c.anisotropy*Math.sin(c.anisotropyRotation)),c.anisotropyMap&&(h.anisotropyMap.value=c.anisotropyMap,t(c.anisotropyMap,h.anisotropyMapTransform))),h.specularIntensity.value=c.specularIntensity,h.specularColor.value.copy(c.specularColor),c.specularColorMap&&(h.specularColorMap.value=c.specularColorMap,t(c.specularColorMap,h.specularColorMapTransform)),c.specularIntensityMap&&(h.specularIntensityMap.value=c.specularIntensityMap,t(c.specularIntensityMap,h.specularIntensityMapTransform))}(s,a,l)):a.isMeshMatcapMaterial?(r(s,a),function(h,c){c.matcap&&(h.matcap.value=c.matcap)}(s,a)):a.isMeshDepthMaterial?r(s,a):a.isMeshDistanceMaterial?(r(s,a),function(h,c){const u=e.get(c).light;h.referencePosition.value.setFromMatrixPosition(u.matrixWorld),h.nearDistance.value=u.shadow.camera.near,h.farDistance.value=u.shadow.camera.far}(s,a)):a.isMeshNormalMaterial?r(s,a):a.isLineBasicMaterial?(function(h,c){h.diffuse.value.copy(c.color),h.opacity.value=c.opacity,c.map&&(h.map.value=c.map,t(c.map,h.mapTransform))}(s,a),a.isLineDashedMaterial&&function(h,c){h.dashSize.value=c.dashSize,h.totalSize.value=c.dashSize+c.gapSize,h.scale.value=c.scale}(s,a)):a.isPointsMaterial?function(h,c,u,d){h.diffuse.value.copy(c.color),h.opacity.value=c.opacity,h.size.value=c.size*u,h.scale.value=.5*d,c.map&&(h.map.value=c.map,t(c.map,h.uvTransform)),c.alphaMap&&(h.alphaMap.value=c.alphaMap,t(c.alphaMap,h.alphaMapTransform)),c.alphaTest>0&&(h.alphaTest.value=c.alphaTest)}(s,a,n,o):a.isSpriteMaterial?function(h,c){h.diffuse.value.copy(c.color),h.opacity.value=c.opacity,h.rotation.value=c.rotation,c.map&&(h.map.value=c.map,t(c.map,h.mapTransform)),c.alphaMap&&(h.alphaMap.value=c.alphaMap,t(c.alphaMap,h.alphaMapTransform)),c.alphaTest>0&&(h.alphaTest.value=c.alphaTest)}(s,a):a.isShadowMaterial?(s.color.value.copy(a.color),s.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function AT(i,e,t,r){let s={},a={},n=[];const o=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(u,d,p,f){const v=u.value,m=d+"_"+p;if(f[m]===void 0)return f[m]=typeof v=="number"||typeof v=="boolean"?v:v.clone(),!0;{const g=f[m];if(typeof v=="number"||typeof v=="boolean"){if(g!==v)return f[m]=v,!0}else if(g.equals(v)===!1)return g.copy(v),!0}return!1}function h(u){const d={boundary:0,storage:0};return typeof u=="number"||typeof u=="boolean"?(d.boundary=4,d.storage=4):u.isVector2?(d.boundary=8,d.storage=8):u.isVector3||u.isColor?(d.boundary=16,d.storage=12):u.isVector4?(d.boundary=16,d.storage=16):u.isMatrix3?(d.boundary=48,d.storage=48):u.isMatrix4?(d.boundary=64,d.storage=64):u.isTexture,d}function c(u){const d=u.target;d.removeEventListener("dispose",c);const p=n.indexOf(d.__bindingPointIndex);n.splice(p,1),i.deleteBuffer(s[d.id]),delete s[d.id],delete a[d.id]}return{bind:function(u,d){const p=d.program;r.uniformBlockBinding(u,p)},update:function(u,d){let p=s[u.id];p===void 0&&(function(m){const g=m.uniforms;let _=0;const y=16;for(let M=0,b=g.length;M<b;M++){const w=Array.isArray(g[M])?g[M]:[g[M]];for(let T=0,R=w.length;T<R;T++){const I=w[T],E=Array.isArray(I.value)?I.value:[I.value];for(let L=0,D=E.length;L<D;L++){const U=h(E[L]),H=_%y;H!==0&&y-H<U.boundary&&(_+=y-H),I.__data=new Float32Array(U.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=_,_+=U.storage}}}const x=_%y;x>0&&(_+=y-x),m.__size=_,m.__cache={}}(u),p=function(m){const g=function(){for(let M=0;M<o;M++)if(n.indexOf(M)===-1)return n.push(M),M;return 0}();m.__bindingPointIndex=g;const _=i.createBuffer(),y=m.__size,x=m.usage;return i.bindBuffer(i.UNIFORM_BUFFER,_),i.bufferData(i.UNIFORM_BUFFER,y,x),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,g,_),_}(u),s[u.id]=p,u.addEventListener("dispose",c));const f=d.program;r.updateUBOMapping(u,f);const v=e.render.frame;a[u.id]!==v&&(function(m){const g=s[m.id],_=m.uniforms,y=m.__cache;i.bindBuffer(i.UNIFORM_BUFFER,g);for(let x=0,M=_.length;x<M;x++){const b=Array.isArray(_[x])?_[x]:[_[x]];for(let w=0,T=b.length;w<T;w++){const R=b[w];if(l(R,x,w,y)===!0){const I=R.__offset,E=Array.isArray(R.value)?R.value:[R.value];let L=0;for(let D=0;D<E.length;D++){const U=E[D],H=h(U);typeof U=="number"||typeof U=="boolean"?(R.__data[0]=U,i.bufferSubData(i.UNIFORM_BUFFER,I+L,R.__data)):U.isMatrix3?(R.__data[0]=U.elements[0],R.__data[1]=U.elements[1],R.__data[2]=U.elements[2],R.__data[3]=0,R.__data[4]=U.elements[3],R.__data[5]=U.elements[4],R.__data[6]=U.elements[5],R.__data[7]=0,R.__data[8]=U.elements[6],R.__data[9]=U.elements[7],R.__data[10]=U.elements[8],R.__data[11]=0):(U.toArray(R.__data,L),L+=H.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,I,R.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}(u),a[u.id]=v)},dispose:function(){for(const u in s)i.deleteBuffer(s[u]);n=[],s={},a={}}}}class Jx{constructor(e={}){const{canvas:t=Fx(),context:r=null,depth:s=!0,stencil:a=!1,alpha:n=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:h=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;if(this.isWebGLRenderer=!0,r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=n;const p=new Uint32Array(4),f=new Int32Array(4);let v=null,m=null;const g=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ft,this.toneMapping=Kr,this.toneMappingExposure=1;const y=this;let x=!1,M=0,b=0,w=null,T=-1,R=null;const I=new Ve,E=new Ve;let L=null;const D=new oe(0);let U=0,H=t.width,Z=t.height,te=1,ie=null,ve=null;const be=new Ve(0,0,H,Z),J=new Ve(0,0,H,Z);let ne=!1;const de=new Gh;let re=!1,N=!1;const P=new me,j=new S,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let O=!1;function B(){return w===null?te:1}let A,k,F,se,V,ae,xe,ce,z,W,ee,ge,Le,Fe,Se,ke,He,it,Ce,st,ze,Nt,Oi,ns,G=r;function il(C,q){return t.getContext(C,q)}try{const C={alpha:!0,depth:s,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Vu}`),t.addEventListener("webglcontextlost",S0,!1),t.addEventListener("webglcontextrestored",T0,!1),t.addEventListener("webglcontextcreationerror",A0,!1),G===null){const q="webgl2";if(G=il(q,C),G===null)throw il(q)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(C){throw C}function Aa(){A=new iS(G),A.init(),Nt=new Kx(G,A),k=new Jw(G,A,e,Nt),F=new yT(G),se=new aS(G),V=new cT,ae=new xT(G,A,F,V,k,Nt,se),xe=new eS(y),ce=new tS(y),z=new qw(G),Oi=new Kw(G,z),W=new rS(G,z,se,Oi),ee=new oS(G,W,z,se),Ce=new nS(G,k,ae),ke=new $w(V),ge=new hT(y,xe,ce,A,k,Oi,ke),Le=new TT(y,V),Fe=new dT,Se=new vT(A),it=new Zw(y,xe,ce,F,ee,d,l),He=new _T(y,ee,k),ns=new AT(G,se,k,F),st=new Qw(G,A,se),ze=new sS(G,A,se),se.programs=ge.programs,y.capabilities=k,y.extensions=A,y.properties=V,y.renderLists=Fe,y.shadowMap=He,y.state=F,y.info=se}Aa();const Dt=new wT(y,G);function S0(C){C.preventDefault(),x=!0}function T0(){x=!1;const C=se.autoReset,q=He.enabled,Q=He.autoUpdate,le=He.needsUpdate,$=He.type;Aa(),se.autoReset=C,He.enabled=q,He.autoUpdate=Q,He.needsUpdate=le,He.type=$}function A0(C){}function E0(C){const q=C.target;q.removeEventListener("dispose",E0),function(Q){(function(le){const $=V.get(le).programs;$!==void 0&&($.forEach(function(fe){ge.releaseProgram(fe)}),le.isShaderMaterial&&ge.releaseShaderCache(le))})(Q),V.remove(Q)}(q)}function C0(C,q,Q){C.transparent===!0&&C.side===Mt&&C.forceSinglePass===!1?(C.side=Si,C.needsUpdate=!0,ic(C,q,Q),C.side=gr,C.needsUpdate=!0,ic(C,q,Q),C.side=Mt):ic(C,q,Q)}this.xr=Dt,this.getContext=function(){return G},this.getContextAttributes=function(){return G.getContextAttributes()},this.forceContextLoss=function(){const C=A.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){const C=A.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return te},this.setPixelRatio=function(C){C!==void 0&&(te=C,this.setSize(H,Z,!1))},this.getSize=function(C){return C.set(H,Z)},this.setSize=function(C,q,Q=!0){Dt.isPresenting||(H=C,Z=q,t.width=Math.floor(C*te),t.height=Math.floor(q*te),Q===!0&&(t.style.width=C+"px",t.style.height=q+"px"),this.setViewport(0,0,C,q))},this.getDrawingBufferSize=function(C){return C.set(H*te,Z*te).floor()},this.setDrawingBufferSize=function(C,q,Q){H=C,Z=q,te=Q,t.width=Math.floor(C*Q),t.height=Math.floor(q*Q),this.setViewport(0,0,C,q)},this.getCurrentViewport=function(C){return C.copy(I)},this.getViewport=function(C){return C.copy(be)},this.setViewport=function(C,q,Q,le){C.isVector4?be.set(C.x,C.y,C.z,C.w):be.set(C,q,Q,le),F.viewport(I.copy(be).multiplyScalar(te).round())},this.getScissor=function(C){return C.copy(J)},this.setScissor=function(C,q,Q,le){C.isVector4?J.set(C.x,C.y,C.z,C.w):J.set(C,q,Q,le),F.scissor(E.copy(J).multiplyScalar(te).round())},this.getScissorTest=function(){return ne},this.setScissorTest=function(C){F.setScissorTest(ne=C)},this.setOpaqueSort=function(C){ie=C},this.setTransparentSort=function(C){ve=C},this.getClearColor=function(C){return C.copy(it.getClearColor())},this.setClearColor=function(){it.setClearColor.apply(it,arguments)},this.getClearAlpha=function(){return it.getClearAlpha()},this.setClearAlpha=function(){it.setClearAlpha.apply(it,arguments)},this.clear=function(C=!0,q=!0,Q=!0){let le=0;if(C){let $=!1;if(w!==null){const fe=w.texture.format;$=fe===gg||fe===fg||fe===mg}if($){const fe=w.texture.type,Te=fe===xn||fe===Mn||fe===Lo||fe===ma||fe===ug||fe===dg,Ee=it.getClearColor(),Pe=it.getClearAlpha(),Ne=Ee.r,Ge=Ee.g,Ie=Ee.b;Te?(p[0]=Ne,p[1]=Ge,p[2]=Ie,p[3]=Pe,G.clearBufferuiv(G.COLOR,0,p)):(f[0]=Ne,f[1]=Ge,f[2]=Ie,f[3]=Pe,G.clearBufferiv(G.COLOR,0,f))}else le|=G.COLOR_BUFFER_BIT}q&&(le|=G.DEPTH_BUFFER_BIT),Q&&(le|=G.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),G.clear(le)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",S0,!1),t.removeEventListener("webglcontextrestored",T0,!1),t.removeEventListener("webglcontextcreationerror",A0,!1),Fe.dispose(),Se.dispose(),V.dispose(),xe.dispose(),ce.dispose(),ee.dispose(),Oi.dispose(),ns.dispose(),ge.dispose(),Dt.dispose(),Dt.removeEventListener("sessionstart",R0),Dt.removeEventListener("sessionend",P0),Ea.stop()},this.renderBufferDirect=function(C,q,Q,le,$,fe){q===null&&(q=K);const Te=$.isMesh&&$.matrixWorld.determinant()<0,Ee=function(at,Ot,Wi,Ye,je){Ot.isScene!==!0&&(Ot=K),ae.resetTextureUnits();const rl=Ot.fog,$b=Ye.isMeshStandardMaterial?Ot.environment:null,ew=w===null?y.outputColorSpace:w.isXRRenderTarget===!0?w.texture.colorSpace:Qt,rc=(Ye.isMeshStandardMaterial?ce:xe).get(Ye.envMap||$b),tw=Ye.vertexColors===!0&&!!Wi.attributes.color&&Wi.attributes.color.itemSize===4,iw=!!Wi.attributes.tangent&&(!!Ye.normalMap||Ye.anisotropy>0),rw=!!Wi.morphAttributes.position,sw=!!Wi.morphAttributes.normal,aw=!!Wi.morphAttributes.color;let U0=Kr;Ye.toneMapped&&(w!==null&&w.isXRRenderTarget!==!0||(U0=y.toneMapping));const F0=Wi.morphAttributes.position||Wi.morphAttributes.normal||Wi.morphAttributes.color,nw=F0!==void 0?F0.length:0,Je=V.get(Ye),ow=m.state.lights;if(re===!0&&(N===!0||at!==R)){const nr=at===R&&Ye.id===T;ke.setState(Ye,at,nr)}let yr=!1;Ye.version===Je.__version?Je.needsLights&&Je.lightsStateVersion!==ow.state.version||Je.outputColorSpace!==ew||je.isBatchedMesh&&Je.batching===!1?yr=!0:je.isBatchedMesh||Je.batching!==!0?je.isBatchedMesh&&Je.batchingColor===!0&&je.colorTexture===null||je.isBatchedMesh&&Je.batchingColor===!1&&je.colorTexture!==null||je.isInstancedMesh&&Je.instancing===!1?yr=!0:je.isInstancedMesh||Je.instancing!==!0?je.isSkinnedMesh&&Je.skinning===!1?yr=!0:je.isSkinnedMesh||Je.skinning!==!0?je.isInstancedMesh&&Je.instancingColor===!0&&je.instanceColor===null||je.isInstancedMesh&&Je.instancingColor===!1&&je.instanceColor!==null||je.isInstancedMesh&&Je.instancingMorph===!0&&je.morphTexture===null||je.isInstancedMesh&&Je.instancingMorph===!1&&je.morphTexture!==null||Je.envMap!==rc||Ye.fog===!0&&Je.fog!==rl?yr=!0:Je.numClippingPlanes===void 0||Je.numClippingPlanes===ke.numPlanes&&Je.numIntersection===ke.numIntersection?(Je.vertexAlphas!==tw||Je.vertexTangents!==iw||Je.morphTargets!==rw||Je.morphNormals!==sw||Je.morphColors!==aw||Je.toneMapping!==U0||Je.morphTargetsCount!==nw)&&(yr=!0):yr=!0:yr=!0:yr=!0:yr=!0:(yr=!0,Je.__version=Ye.version);let Ca=Je.currentProgram;yr===!0&&(Ca=ic(Ye,Ot,je));let k0=!1,sl=!1,ap=!1;const ai=Ca.getUniforms(),Os=Je.uniforms;if(F.useProgram(Ca.program)&&(k0=!0,sl=!0,ap=!0),Ye.id!==T&&(T=Ye.id,sl=!0),k0||R!==at){ai.setValue(G,"projectionMatrix",at.projectionMatrix),ai.setValue(G,"viewMatrix",at.matrixWorldInverse);const nr=ai.map.cameraPosition;nr!==void 0&&nr.setValue(G,j.setFromMatrixPosition(at.matrixWorld)),k.logarithmicDepthBuffer&&ai.setValue(G,"logDepthBufFC",2/(Math.log(at.far+1)/Math.LN2)),(Ye.isMeshPhongMaterial||Ye.isMeshToonMaterial||Ye.isMeshLambertMaterial||Ye.isMeshBasicMaterial||Ye.isMeshStandardMaterial||Ye.isShaderMaterial)&&ai.setValue(G,"isOrthographic",at.isOrthographicCamera===!0),R!==at&&(R=at,sl=!0,ap=!0)}if(je.isSkinnedMesh){ai.setOptional(G,je,"bindMatrix"),ai.setOptional(G,je,"bindMatrixInverse");const nr=je.skeleton;nr&&(nr.boneTexture===null&&nr.computeBoneTexture(),ai.setValue(G,"boneTexture",nr.boneTexture,ae))}je.isBatchedMesh&&(ai.setOptional(G,je,"batchingTexture"),ai.setValue(G,"batchingTexture",je._matricesTexture,ae),ai.setOptional(G,je,"batchingColorTexture"),je._colorsTexture!==null&&ai.setValue(G,"batchingColorTexture",je._colorsTexture,ae));const np=Wi.morphAttributes;np.position===void 0&&np.normal===void 0&&np.color===void 0||Ce.update(je,Wi,Ca),(sl||Je.receiveShadow!==je.receiveShadow)&&(Je.receiveShadow=je.receiveShadow,ai.setValue(G,"receiveShadow",je.receiveShadow)),Ye.isMeshGouraudMaterial&&Ye.envMap!==null&&(Os.envMap.value=rc,Os.flipEnvMap.value=rc.isCubeTexture&&rc.isRenderTargetTexture===!1?-1:1),Ye.isMeshStandardMaterial&&Ye.envMap===null&&Ot.environment!==null&&(Os.envMapIntensity.value=Ot.environmentIntensity),sl&&(ai.setValue(G,"toneMappingExposure",y.toneMappingExposure),Je.needsLights&&(xr=ap,(Ur=Os).ambientLightColor.needsUpdate=xr,Ur.lightProbe.needsUpdate=xr,Ur.directionalLights.needsUpdate=xr,Ur.directionalLightShadows.needsUpdate=xr,Ur.pointLights.needsUpdate=xr,Ur.pointLightShadows.needsUpdate=xr,Ur.spotLights.needsUpdate=xr,Ur.spotLightShadows.needsUpdate=xr,Ur.rectAreaLights.needsUpdate=xr,Ur.hemisphereLights.needsUpdate=xr),rl&&Ye.fog===!0&&Le.refreshFogUniforms(Os,rl),Le.refreshMaterialUniforms(Os,Ye,te,Z,m.state.transmissionRenderTarget[at.id]),Pu.upload(G,D0(Je),Os,ae));var Ur,xr;if(Ye.isShaderMaterial&&Ye.uniformsNeedUpdate===!0&&(Pu.upload(G,D0(Je),Os,ae),Ye.uniformsNeedUpdate=!1),Ye.isSpriteMaterial&&ai.setValue(G,"center",je.center),ai.setValue(G,"modelViewMatrix",je.modelViewMatrix),ai.setValue(G,"normalMatrix",je.normalMatrix),ai.setValue(G,"modelMatrix",je.matrixWorld),Ye.isShaderMaterial||Ye.isRawShaderMaterial){const nr=Ye.uniformsGroups;for(let op=0,lw=nr.length;op<lw;op++){const B0=nr[op];ns.update(B0,Ca),ns.bind(B0,Ca)}}return Ca}(C,q,Q,le,$);F.setMaterial(le,Te);let Pe=Q.index,Ne=1;if(le.wireframe===!0){if(Pe=W.getWireframeAttribute(Q),Pe===void 0)return;Ne=2}const Ge=Q.drawRange,Ie=Q.attributes.position;let $e=Ge.start*Ne,bt=(Ge.start+Ge.count)*Ne;fe!==null&&($e=Math.max($e,fe.start*Ne),bt=Math.min(bt,(fe.start+fe.count)*Ne)),Pe!==null?($e=Math.max($e,0),bt=Math.min(bt,Pe.count)):Ie!=null&&($e=Math.max($e,0),bt=Math.min(bt,Ie.count));const qt=bt-$e;if(qt<0||qt===1/0)return;let Jt;Oi.setup($,le,Ee,Q,Pe);let wt=st;if(Pe!==null&&(Jt=z.get(Pe),wt=ze,wt.setIndex(Jt)),$.isMesh)le.wireframe===!0?(F.setLineWidth(le.wireframeLinewidth*B()),wt.setMode(G.LINES)):wt.setMode(G.TRIANGLES);else if($.isLine){let at=le.linewidth;at===void 0&&(at=1),F.setLineWidth(at*B()),$.isLineSegments?wt.setMode(G.LINES):$.isLineLoop?wt.setMode(G.LINE_LOOP):wt.setMode(G.LINE_STRIP)}else $.isPoints?wt.setMode(G.POINTS):$.isSprite&&wt.setMode(G.TRIANGLES);if($.isBatchedMesh)$._multiDrawInstances!==null?wt.renderMultiDrawInstances($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount,$._multiDrawInstances):wt.renderMultiDraw($._multiDrawStarts,$._multiDrawCounts,$._multiDrawCount);else if($.isInstancedMesh)wt.renderInstances($e,qt,$.count);else if(Q.isInstancedBufferGeometry){const at=Q._maxInstanceCount!==void 0?Q._maxInstanceCount:1/0,Ot=Math.min(Q.instanceCount,at);wt.renderInstances($e,qt,Ot)}else wt.render($e,qt)},this.compile=function(C,q,Q=null){Q===null&&(Q=C),m=Se.get(Q),m.init(q),_.push(m),Q.traverseVisible(function($){$.isLight&&$.layers.test(q.layers)&&(m.pushLight($),$.castShadow&&m.pushShadow($))}),C!==Q&&C.traverseVisible(function($){$.isLight&&$.layers.test(q.layers)&&(m.pushLight($),$.castShadow&&m.pushShadow($))}),m.setupLights();const le=new Set;return C.traverse(function($){const fe=$.material;if(fe)if(Array.isArray(fe))for(let Te=0;Te<fe.length;Te++){const Ee=fe[Te];C0(Ee,Q,$),le.add(Ee)}else C0(fe,Q,$),le.add(fe)}),_.pop(),m=null,le},this.compileAsync=function(C,q,Q=null){const le=this.compile(C,q,Q);return new Promise($=>{function fe(){le.forEach(function(Te){V.get(Te).currentProgram.isReady()&&le.delete(Te)}),le.size!==0?setTimeout(fe,10):$(C)}A.get("KHR_parallel_shader_compile")!==null?fe():setTimeout(fe,10)})};let rp=null;function R0(){Ea.stop()}function P0(){Ea.start()}const Ea=new jx;function sp(C,q,Q,le){if(C.visible===!1)return;if(C.layers.test(q.layers)){if(C.isGroup)Q=C.renderOrder;else if(C.isLOD)C.autoUpdate===!0&&C.update(q);else if(C.isLight)m.pushLight(C),C.castShadow&&m.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||de.intersectsSprite(C)){le&&j.setFromMatrixPosition(C.matrixWorld).applyMatrix4(P);const fe=ee.update(C),Te=C.material;Te.visible&&v.push(C,fe,Te,Q,j.z,null)}}else if((C.isMesh||C.isLine||C.isPoints)&&(!C.frustumCulled||de.intersectsObject(C))){const fe=ee.update(C),Te=C.material;if(le&&(C.boundingSphere!==void 0?(C.boundingSphere===null&&C.computeBoundingSphere(),j.copy(C.boundingSphere.center)):(fe.boundingSphere===null&&fe.computeBoundingSphere(),j.copy(fe.boundingSphere.center)),j.applyMatrix4(C.matrixWorld).applyMatrix4(P)),Array.isArray(Te)){const Ee=fe.groups;for(let Pe=0,Ne=Ee.length;Pe<Ne;Pe++){const Ge=Ee[Pe],Ie=Te[Ge.materialIndex];Ie&&Ie.visible&&v.push(C,fe,Ie,Q,j.z,Ge)}}else Te.visible&&v.push(C,fe,Te,Q,j.z,null)}}const $=C.children;for(let fe=0,Te=$.length;fe<Te;fe++)sp($[fe],q,Q,le)}function I0(C,q,Q,le){const $=C.opaque,fe=C.transmissive,Te=C.transparent;m.setupLightsView(Q),re===!0&&ke.setGlobalState(y.clippingPlanes,Q),le&&F.viewport(I.copy(le)),$.length>0&&tc($,q,Q),fe.length>0&&tc(fe,q,Q),Te.length>0&&tc(Te,q,Q),F.buffers.depth.setTest(!0),F.buffers.depth.setMask(!0),F.buffers.color.setMask(!0),F.setPolygonOffset(!1)}function L0(C,q,Q,le){if((Q.isScene===!0?Q.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[le.id]===void 0&&(m.state.transmissionRenderTarget[le.id]=new ht(1,1,{generateMipmaps:!0,type:A.has("EXT_color_buffer_half_float")||A.has("EXT_color_buffer_float")?Ht:xn,minFilter:Qr,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:rt.workingColorSpace}));const $=m.state.transmissionRenderTarget[le.id],fe=le.viewport||I;$.setSize(fe.z,fe.w);const Te=y.getRenderTarget();y.setRenderTarget($),y.getClearColor(D),U=y.getClearAlpha(),U<1&&y.setClearColor(16777215,.5),O?it.render(Q):y.clear();const Ee=y.toneMapping;y.toneMapping=Kr;const Pe=le.viewport;if(le.viewport!==void 0&&(le.viewport=void 0),m.setupLightsView(le),re===!0&&ke.setGlobalState(y.clippingPlanes,le),tc(C,Q,le),ae.updateMultisampleRenderTarget($),ae.updateRenderTargetMipmap($),A.has("WEBGL_multisampled_render_to_texture")===!1){let Ne=!1;for(let Ge=0,Ie=q.length;Ge<Ie;Ge++){const $e=q[Ge],bt=$e.object,qt=$e.geometry,Jt=$e.material,wt=$e.group;if(Jt.side===Mt&&bt.layers.test(le.layers)){const at=Jt.side;Jt.side=Si,Jt.needsUpdate=!0,N0(bt,Q,le,qt,Jt,wt),Jt.side=at,Jt.needsUpdate=!0,Ne=!0}}Ne===!0&&(ae.updateMultisampleRenderTarget($),ae.updateRenderTargetMipmap($))}y.setRenderTarget(Te),y.setClearColor(D,U),Pe!==void 0&&(le.viewport=Pe),y.toneMapping=Ee}function tc(C,q,Q){const le=q.isScene===!0?q.overrideMaterial:null;for(let $=0,fe=C.length;$<fe;$++){const Te=C[$],Ee=Te.object,Pe=Te.geometry,Ne=le===null?Te.material:le,Ge=Te.group;Ee.layers.test(Q.layers)&&N0(Ee,q,Q,Pe,Ne,Ge)}}function N0(C,q,Q,le,$,fe){C.onBeforeRender(y,q,Q,le,$,fe),C.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),$.onBeforeRender(y,q,Q,le,C,fe),$.transparent===!0&&$.side===Mt&&$.forceSinglePass===!1?($.side=Si,$.needsUpdate=!0,y.renderBufferDirect(Q,q,le,$,C,fe),$.side=gr,$.needsUpdate=!0,y.renderBufferDirect(Q,q,le,$,C,fe),$.side=Mt):y.renderBufferDirect(Q,q,le,$,C,fe),C.onAfterRender(y,q,Q,le,$,fe)}function ic(C,q,Q){q.isScene!==!0&&(q=K);const le=V.get(C),$=m.state.lights,fe=m.state.shadowsArray,Te=$.state.version,Ee=ge.getParameters(C,$.state,fe,q,Q),Pe=ge.getProgramCacheKey(Ee);let Ne=le.programs;le.environment=C.isMeshStandardMaterial?q.environment:null,le.fog=q.fog,le.envMap=(C.isMeshStandardMaterial?ce:xe).get(C.envMap||le.environment),le.envMapRotation=le.environment!==null&&C.envMap===null?q.environmentRotation:C.envMapRotation,Ne===void 0&&(C.addEventListener("dispose",E0),Ne=new Map,le.programs=Ne);let Ge=Ne.get(Pe);if(Ge!==void 0){if(le.currentProgram===Ge&&le.lightsStateVersion===Te)return O0(C,Ee),Ge}else Ee.uniforms=ge.getUniforms(C),C.onBuild(Q,Ee,y),C.onBeforeCompile(Ee,y),Ge=ge.acquireProgram(Ee,Pe),Ne.set(Pe,Ge),le.uniforms=Ee.uniforms;const Ie=le.uniforms;return(C.isShaderMaterial||C.isRawShaderMaterial)&&C.clipping!==!0||(Ie.clippingPlanes=ke.uniform),O0(C,Ee),le.needsLights=function($e){return $e.isMeshLambertMaterial||$e.isMeshToonMaterial||$e.isMeshPhongMaterial||$e.isMeshStandardMaterial||$e.isShadowMaterial||$e.isShaderMaterial&&$e.lights===!0}(C),le.lightsStateVersion=Te,le.needsLights&&(Ie.ambientLightColor.value=$.state.ambient,Ie.lightProbe.value=$.state.probe,Ie.directionalLights.value=$.state.directional,Ie.directionalLightShadows.value=$.state.directionalShadow,Ie.spotLights.value=$.state.spot,Ie.spotLightShadows.value=$.state.spotShadow,Ie.rectAreaLights.value=$.state.rectArea,Ie.ltc_1.value=$.state.rectAreaLTC1,Ie.ltc_2.value=$.state.rectAreaLTC2,Ie.pointLights.value=$.state.point,Ie.pointLightShadows.value=$.state.pointShadow,Ie.hemisphereLights.value=$.state.hemi,Ie.directionalShadowMap.value=$.state.directionalShadowMap,Ie.directionalShadowMatrix.value=$.state.directionalShadowMatrix,Ie.spotShadowMap.value=$.state.spotShadowMap,Ie.spotLightMatrix.value=$.state.spotLightMatrix,Ie.spotLightMap.value=$.state.spotLightMap,Ie.pointShadowMap.value=$.state.pointShadowMap,Ie.pointShadowMatrix.value=$.state.pointShadowMatrix),le.currentProgram=Ge,le.uniformsList=null,Ge}function D0(C){if(C.uniformsList===null){const q=C.currentProgram.getUniforms();C.uniformsList=Pu.seqWithValue(q.seq,C.uniforms)}return C.uniformsList}function O0(C,q){const Q=V.get(C);Q.outputColorSpace=q.outputColorSpace,Q.batching=q.batching,Q.batchingColor=q.batchingColor,Q.instancing=q.instancing,Q.instancingColor=q.instancingColor,Q.instancingMorph=q.instancingMorph,Q.skinning=q.skinning,Q.morphTargets=q.morphTargets,Q.morphNormals=q.morphNormals,Q.morphColors=q.morphColors,Q.morphTargetsCount=q.morphTargetsCount,Q.numClippingPlanes=q.numClippingPlanes,Q.numIntersection=q.numClipIntersection,Q.vertexAlphas=q.vertexAlphas,Q.vertexTangents=q.vertexTangents,Q.toneMapping=q.toneMapping}Ea.setAnimationLoop(function(C){rp&&rp(C)}),typeof self<"u"&&Ea.setContext(self),this.setAnimationLoop=function(C){rp=C,Dt.setAnimationLoop(C),C===null?Ea.stop():Ea.start()},Dt.addEventListener("sessionstart",R0),Dt.addEventListener("sessionend",P0),this.render=function(C,q){if(q!==void 0&&q.isCamera!==!0||x===!0)return;if(C.matrixWorldAutoUpdate===!0&&C.updateMatrixWorld(),q.parent===null&&q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),Dt.enabled===!0&&Dt.isPresenting===!0&&(Dt.cameraAutoUpdate===!0&&Dt.updateCamera(q),q=Dt.getCamera()),C.isScene===!0&&C.onBeforeRender(y,C,q,w),m=Se.get(C,_.length),m.init(q),_.push(m),P.multiplyMatrices(q.projectionMatrix,q.matrixWorldInverse),de.setFromProjectionMatrix(P),N=this.localClippingEnabled,re=ke.init(this.clippingPlanes,N),v=Fe.get(C,g.length),v.init(),g.push(v),Dt.enabled===!0&&Dt.isPresenting===!0){const fe=y.xr.getDepthSensingMesh();fe!==null&&sp(fe,q,-1/0,y.sortObjects)}sp(C,q,0,y.sortObjects),v.finish(),y.sortObjects===!0&&v.sort(ie,ve),O=Dt.enabled===!1||Dt.isPresenting===!1||Dt.hasDepthSensing()===!1,O&&it.addToRenderList(v,C),this.info.render.frame++,re===!0&&ke.beginShadows();const Q=m.state.shadowsArray;He.render(Q,C,q),re===!0&&ke.endShadows(),this.info.autoReset===!0&&this.info.reset();const le=v.opaque,$=v.transmissive;if(m.setupLights(),q.isArrayCamera){const fe=q.cameras;if($.length>0)for(let Te=0,Ee=fe.length;Te<Ee;Te++)L0(le,$,C,fe[Te]);O&&it.render(C);for(let Te=0,Ee=fe.length;Te<Ee;Te++){const Pe=fe[Te];I0(v,C,Pe,Pe.viewport)}}else $.length>0&&L0(le,$,C,q),O&&it.render(C),I0(v,C,q);w!==null&&(ae.updateMultisampleRenderTarget(w),ae.updateRenderTargetMipmap(w)),C.isScene===!0&&C.onAfterRender(y,C,q),Oi.resetDefaultState(),T=-1,R=null,_.pop(),_.length>0?(m=_[_.length-1],re===!0&&ke.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,g.pop(),v=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(C,q,Q){V.get(C.texture).__webglTexture=q,V.get(C.depthTexture).__webglTexture=Q;const le=V.get(C);le.__hasExternalTextures=!0,le.__autoAllocateDepthBuffer=Q===void 0,le.__autoAllocateDepthBuffer||A.has("WEBGL_multisampled_render_to_texture")===!0&&(le.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(C,q){const Q=V.get(C);Q.__webglFramebuffer=q,Q.__useDefaultFramebuffer=q===void 0},this.setRenderTarget=function(C,q=0,Q=0){w=C,M=q,b=Q;let le=!0,$=null,fe=!1,Te=!1;if(C){const Ee=V.get(C);Ee.__useDefaultFramebuffer!==void 0?(F.bindFramebuffer(G.FRAMEBUFFER,null),le=!1):Ee.__webglFramebuffer===void 0?ae.setupRenderTarget(C):Ee.__hasExternalTextures&&ae.rebindTextures(C,V.get(C.texture).__webglTexture,V.get(C.depthTexture).__webglTexture);const Pe=C.texture;(Pe.isData3DTexture||Pe.isDataArrayTexture||Pe.isCompressedArrayTexture)&&(Te=!0);const Ne=V.get(C).__webglFramebuffer;C.isWebGLCubeRenderTarget?($=Array.isArray(Ne[q])?Ne[q][Q]:Ne[q],fe=!0):$=C.samples>0&&ae.useMultisampledRTT(C)===!1?V.get(C).__webglMultisampledFramebuffer:Array.isArray(Ne)?Ne[Q]:Ne,I.copy(C.viewport),E.copy(C.scissor),L=C.scissorTest}else I.copy(be).multiplyScalar(te).floor(),E.copy(J).multiplyScalar(te).floor(),L=ne;if(F.bindFramebuffer(G.FRAMEBUFFER,$)&&le&&F.drawBuffers(C,$),F.viewport(I),F.scissor(E),F.setScissorTest(L),fe){const Ee=V.get(C.texture);G.framebufferTexture2D(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,G.TEXTURE_CUBE_MAP_POSITIVE_X+q,Ee.__webglTexture,Q)}else if(Te){const Ee=V.get(C.texture),Pe=q||0;G.framebufferTextureLayer(G.FRAMEBUFFER,G.COLOR_ATTACHMENT0,Ee.__webglTexture,Q||0,Pe)}T=-1},this.readRenderTargetPixels=function(C,q,Q,le,$,fe,Te){if(!C||!C.isWebGLRenderTarget)return;let Ee=V.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&Te!==void 0&&(Ee=Ee[Te]),Ee){F.bindFramebuffer(G.FRAMEBUFFER,Ee);try{const Pe=C.texture,Ne=Pe.format,Ge=Pe.type;if(!k.textureFormatReadable(Ne)||!k.textureTypeReadable(Ge))return;q>=0&&q<=C.width-le&&Q>=0&&Q<=C.height-$&&G.readPixels(q,Q,le,$,Nt.convert(Ne),Nt.convert(Ge),fe)}finally{const Pe=w!==null?V.get(w).__webglFramebuffer:null;F.bindFramebuffer(G.FRAMEBUFFER,Pe)}}},this.readRenderTargetPixelsAsync=function(C,q,Q,le,$,fe,Te){return Rr(this,null,function*(){if(!C||!C.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ee=V.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&Te!==void 0&&(Ee=Ee[Te]),Ee){F.bindFramebuffer(G.FRAMEBUFFER,Ee);try{const Pe=C.texture,Ne=Pe.format,Ge=Pe.type;if(!k.textureFormatReadable(Ne))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!k.textureTypeReadable(Ge))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(q>=0&&q<=C.width-le&&Q>=0&&Q<=C.height-$){const Ie=G.createBuffer();G.bindBuffer(G.PIXEL_PACK_BUFFER,Ie),G.bufferData(G.PIXEL_PACK_BUFFER,fe.byteLength,G.STREAM_READ),G.readPixels(q,Q,le,$,Nt.convert(Ne),Nt.convert(Ge),0),G.flush();const $e=G.fenceSync(G.SYNC_GPU_COMMANDS_COMPLETE,0);yield function(bt,qt,Jt){return new Promise(function(wt,at){setTimeout(function Ot(){switch(bt.clientWaitSync(qt,bt.SYNC_FLUSH_COMMANDS_BIT,0)){case bt.WAIT_FAILED:at();break;case bt.TIMEOUT_EXPIRED:setTimeout(Ot,Jt);break;default:wt()}},Jt)})}(G,$e,4);try{G.bindBuffer(G.PIXEL_PACK_BUFFER,Ie),G.getBufferSubData(G.PIXEL_PACK_BUFFER,0,fe)}finally{G.deleteBuffer(Ie),G.deleteSync($e)}return fe}}finally{const Pe=w!==null?V.get(w).__webglFramebuffer:null;F.bindFramebuffer(G.FRAMEBUFFER,Pe)}}})},this.copyFramebufferToTexture=function(C,q=null,Q=0){C.isTexture!==!0&&(q=arguments[0]||null,C=arguments[1]);const le=Math.pow(2,-Q),$=Math.floor(C.image.width*le),fe=Math.floor(C.image.height*le),Te=q!==null?q.x:0,Ee=q!==null?q.y:0;ae.setTexture2D(C,0),G.copyTexSubImage2D(G.TEXTURE_2D,Q,0,0,Te,Ee,$,fe),F.unbindTexture()},this.copyTextureToTexture=function(C,q,Q=null,le=null,$=0){let fe,Te,Ee,Pe,Ne,Ge;C.isTexture!==!0&&(le=arguments[0]||null,C=arguments[1],q=arguments[2],$=arguments[3]||0,Q=null),Q!==null?(fe=Q.max.x-Q.min.x,Te=Q.max.y-Q.min.y,Ee=Q.min.x,Pe=Q.min.y):(fe=C.image.width,Te=C.image.height,Ee=0,Pe=0),le!==null?(Ne=le.x,Ge=le.y):(Ne=0,Ge=0);const Ie=Nt.convert(q.format),$e=Nt.convert(q.type);ae.setTexture2D(q,0),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,q.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,q.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,q.unpackAlignment);const bt=G.getParameter(G.UNPACK_ROW_LENGTH),qt=G.getParameter(G.UNPACK_IMAGE_HEIGHT),Jt=G.getParameter(G.UNPACK_SKIP_PIXELS),wt=G.getParameter(G.UNPACK_SKIP_ROWS),at=G.getParameter(G.UNPACK_SKIP_IMAGES),Ot=C.isCompressedTexture?C.mipmaps[$]:C.image;G.pixelStorei(G.UNPACK_ROW_LENGTH,Ot.width),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,Ot.height),G.pixelStorei(G.UNPACK_SKIP_PIXELS,Ee),G.pixelStorei(G.UNPACK_SKIP_ROWS,Pe),C.isDataTexture?G.texSubImage2D(G.TEXTURE_2D,$,Ne,Ge,fe,Te,Ie,$e,Ot.data):C.isCompressedTexture?G.compressedTexSubImage2D(G.TEXTURE_2D,$,Ne,Ge,Ot.width,Ot.height,Ie,Ot.data):G.texSubImage2D(G.TEXTURE_2D,$,Ne,Ge,Ie,$e,Ot),G.pixelStorei(G.UNPACK_ROW_LENGTH,bt),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,qt),G.pixelStorei(G.UNPACK_SKIP_PIXELS,Jt),G.pixelStorei(G.UNPACK_SKIP_ROWS,wt),G.pixelStorei(G.UNPACK_SKIP_IMAGES,at),$===0&&q.generateMipmaps&&G.generateMipmap(G.TEXTURE_2D),F.unbindTexture()},this.copyTextureToTexture3D=function(C,q,Q=null,le=null,$=0){let fe,Te,Ee,Pe,Ne,Ge,Ie,$e,bt;C.isTexture!==!0&&(Q=arguments[0]||null,le=arguments[1]||null,C=arguments[2],q=arguments[3],$=arguments[4]||0);const qt=C.isCompressedTexture?C.mipmaps[$]:C.image;Q!==null?(fe=Q.max.x-Q.min.x,Te=Q.max.y-Q.min.y,Ee=Q.max.z-Q.min.z,Pe=Q.min.x,Ne=Q.min.y,Ge=Q.min.z):(fe=qt.width,Te=qt.height,Ee=qt.depth,Pe=0,Ne=0,Ge=0),le!==null?(Ie=le.x,$e=le.y,bt=le.z):(Ie=0,$e=0,bt=0);const Jt=Nt.convert(q.format),wt=Nt.convert(q.type);let at;if(q.isData3DTexture)ae.setTexture3D(q,0),at=G.TEXTURE_3D;else{if(!q.isDataArrayTexture&&!q.isCompressedArrayTexture)return;ae.setTexture2DArray(q,0),at=G.TEXTURE_2D_ARRAY}G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,q.flipY),G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,q.premultiplyAlpha),G.pixelStorei(G.UNPACK_ALIGNMENT,q.unpackAlignment);const Ot=G.getParameter(G.UNPACK_ROW_LENGTH),Wi=G.getParameter(G.UNPACK_IMAGE_HEIGHT),Ye=G.getParameter(G.UNPACK_SKIP_PIXELS),je=G.getParameter(G.UNPACK_SKIP_ROWS),rl=G.getParameter(G.UNPACK_SKIP_IMAGES);G.pixelStorei(G.UNPACK_ROW_LENGTH,qt.width),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,qt.height),G.pixelStorei(G.UNPACK_SKIP_PIXELS,Pe),G.pixelStorei(G.UNPACK_SKIP_ROWS,Ne),G.pixelStorei(G.UNPACK_SKIP_IMAGES,Ge),C.isDataTexture||C.isData3DTexture?G.texSubImage3D(at,$,Ie,$e,bt,fe,Te,Ee,Jt,wt,qt.data):q.isCompressedArrayTexture?G.compressedTexSubImage3D(at,$,Ie,$e,bt,fe,Te,Ee,Jt,qt.data):G.texSubImage3D(at,$,Ie,$e,bt,fe,Te,Ee,Jt,wt,qt),G.pixelStorei(G.UNPACK_ROW_LENGTH,Ot),G.pixelStorei(G.UNPACK_IMAGE_HEIGHT,Wi),G.pixelStorei(G.UNPACK_SKIP_PIXELS,Ye),G.pixelStorei(G.UNPACK_SKIP_ROWS,je),G.pixelStorei(G.UNPACK_SKIP_IMAGES,rl),$===0&&q.generateMipmaps&&G.generateMipmap(at),F.unbindTexture()},this.initRenderTarget=function(C){V.get(C).__webglFramebuffer===void 0&&ae.setupRenderTarget(C)},this.initTexture=function(C){C.isCubeTexture?ae.setTextureCube(C,0):C.isData3DTexture?ae.setTexture3D(C,0):C.isDataArrayTexture||C.isCompressedArrayTexture?ae.setTexture2DArray(C,0):ae.setTexture2D(C,0),F.unbindTexture()},this.resetState=function(){M=0,b=0,w=null,F.reset(),Oi.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return bn}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Pd?"display-p3":"srgb",t.unpackColorSpace=rt.workingColorSpace===Hh?"display-p3":"srgb"}}class ko{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new oe(e),this.density=t}clone(){return new ko(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Bo{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new oe(e),this.near=t,this.far=r}clone(){return new Bo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class xf extends Ue{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new yt,this.environmentIntensity=1,this.environmentRotation=new yt,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Wh{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=hh,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=rr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Mg("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let s=0,a=this.stride;s<a;s++)this.array[e+s]=t.array[r+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=rr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=rr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ai=new S;class Bi{constructor(e,t,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)Ai.fromBufferAttribute(this,t),Ai.applyMatrix4(e),this.setXYZ(t,Ai.x,Ai.y,Ai.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Ai.fromBufferAttribute(this,t),Ai.applyNormalMatrix(e),this.setXYZ(t,Ai.x,Ai.y,Ai.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Ai.fromBufferAttribute(this,t),Ai.transformDirection(e),this.setXYZ(t,Ai.x,Ai.y,Ai.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=Li(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Oe(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=Oe(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Oe(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Oe(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Oe(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Li(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Li(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Li(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Li(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Oe(t,this.array),r=Oe(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Oe(t,this.array),r=Oe(r,this.array),s=Oe(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,t,r,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Oe(t,this.array),r=Oe(r,this.array),s=Oe(s,this.array),a=Oe(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=a,this}clone(e){if(e===void 0){const t=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[s+a])}return new Ze(new this.array.constructor(t),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Bi(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){const t=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[s+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Tg extends Xt{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new oe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Yn;const cl=new S,Zn=new S,Kn=new S,Qn=new X,ul=new X,$x=new me,Ac=new S,dl=new S,Ec=new S,Rv=new X,Np=new X,Pv=new X;class Iv extends Ue{constructor(e=new Tg){if(super(),this.isSprite=!0,this.type="Sprite",Yn===void 0){Yn=new Re;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Wh(t,5);Yn.setIndex([0,1,2,0,2,3]),Yn.setAttribute("position",new Bi(r,3,0,!1)),Yn.setAttribute("uv",new Bi(r,2,3,!1))}this.geometry=Yn,this.material=e,this.center=new X(.5,.5)}raycast(e,t){e.camera,Zn.setFromMatrixScale(this.matrixWorld),$x.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Kn.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Zn.multiplyScalar(-Kn.z);const r=this.material.rotation;let s,a;r!==0&&(a=Math.cos(r),s=Math.sin(r));const n=this.center;Cc(Ac.set(-.5,-.5,0),Kn,n,Zn,s,a),Cc(dl.set(.5,-.5,0),Kn,n,Zn,s,a),Cc(Ec.set(.5,.5,0),Kn,n,Zn,s,a),Rv.set(0,0),Np.set(1,0),Pv.set(1,1);let o=e.ray.intersectTriangle(Ac,dl,Ec,!1,cl);if(o===null&&(Cc(dl.set(-.5,.5,0),Kn,n,Zn,s,a),Np.set(0,1),o=e.ray.intersectTriangle(Ac,Ec,dl,!1,cl),o===null))return;const l=e.ray.origin.distanceTo(cl);l<e.near||l>e.far||t.push({distance:l,point:cl.clone(),uv:$i.getInterpolation(cl,Ac,dl,Ec,Rv,Np,Pv,new X),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Cc(i,e,t,r,s,a){Qn.subVectors(i,t).addScalar(.5).multiply(r),s!==void 0?(ul.x=a*Qn.x-s*Qn.y,ul.y=s*Qn.x+a*Qn.y):ul.copy(Qn),i.copy(e),i.x+=ul.x,i.y+=ul.y,i.applyMatrix4($x)}const Rc=new S,Lv=new S;class Nv extends Ue{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,s=t.length;r<s;r++){const a=t[r];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const s=this.levels;let a;for(a=0;a<s.length&&!(t<s[a].distance);a++);return s.splice(a,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,s;for(r=1,s=t.length;r<s;r++){let a=t[r].distance;if(t[r].object.visible&&(a-=a*t[r].hysteresis),e<a)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){Rc.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(Rc);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Rc.setFromMatrixPosition(e.matrixWorld),Lv.setFromMatrixPosition(this.matrixWorld);const r=Rc.distanceTo(Lv)/e.zoom;let s,a;for(t[0].object.visible=!0,s=1,a=t.length;s<a;s++){let n=t[s].distance;if(t[s].object.visible&&(n-=n*t[s].hysteresis),!(r>=n))break;t[s-1].object.visible=!1,t[s].object.visible=!0}for(this._currentLevel=s-1;s<a;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let s=0,a=r.length;s<a;s++){const n=r[s];t.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return t}}const Dv=new S,Ov=new Ve,Uv=new Ve,ET=new S,Fv=new me,Pc=new S,Dp=new ii,kv=new me,Op=new Rn;class Gu extends ue{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Vm,this.bindMatrix=new me,this.bindMatrixInverse=new me,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new vt),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,Pc),this.boundingBox.expandByPoint(Pc)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new ii),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,Pc),this.boundingSphere.expandByPoint(Pc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,s=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Dp.copy(this.boundingSphere),Dp.applyMatrix4(s),e.ray.intersectsSphere(Dp)!==!1&&(kv.copy(s).invert(),Op.copy(e.ray).applyMatrix4(kv),this.boundingBox!==null&&Op.intersectsBox(this.boundingBox)===!1||this._computeIntersections(e,t,Op)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ve,t=this.geometry.attributes.skinWeight;for(let r=0,s=t.count;r<s;r++){e.fromBufferAttribute(t,r);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===Vm?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Dx&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(e,t){const r=this.skeleton,s=this.geometry;Ov.fromBufferAttribute(s.attributes.skinIndex,e),Uv.fromBufferAttribute(s.attributes.skinWeight,e),Dv.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const n=Uv.getComponent(a);if(n!==0){const o=Ov.getComponent(a);Fv.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),t.addScaledVector(ET.copy(Dv).applyMatrix4(Fv),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}class zo extends Ue{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Ms extends pt{constructor(e=null,t=1,r=1,s,a,n,o,l,h=1003,c=1003,u,d){super(null,n,o,l,h,c,s,a,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Bv=new me,CT=new me;class Vo{constructor(e=[],t=[]){this.uuid=rr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),t.length===0)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new me)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new me;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let a=0,n=e.length;a<n;a++){const o=e[a]?e[a].matrixWorld:CT;Bv.multiplyMatrices(o,t[a]),Bv.toArray(r,16*a)}s!==null&&(s.needsUpdate=!0)}clone(){return new Vo(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new Ms(t,e,e,fr,tr);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){let a=t[e.bones[r]];a===void 0&&(a=new zo),this.bones.push(a),this.boneInverses.push(new me().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let s=0,a=t.length;s<a;s++){const n=t[s];e.bones.push(n.uuid);const o=r[s];e.boneInverses.push(o.toArray())}return e}}class un extends Ze{constructor(e,t,r,s=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Jn=new me,zv=new me,Ic=[],Vv=new vt,RT=new me,pl=new ue,ml=new ii;class Mf extends ue{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new un(new Float32Array(16*r),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,RT)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new vt),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Jn),Vv.copy(e.boundingBox).applyMatrix4(Jn),this.boundingBox.union(Vv)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new ii),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Jn),ml.copy(e.boundingSphere).applyMatrix4(Jn),this.boundingSphere.union(ml)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const r=t.morphTargetInfluences,s=this.morphTexture.source.data.data,a=e*(r.length+1)+1;for(let n=0;n<r.length;n++)r[n]=s[a+n]}raycast(e,t){const r=this.matrixWorld,s=this.count;if(pl.geometry=this.geometry,pl.material=this.material,pl.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ml.copy(this.boundingSphere),ml.applyMatrix4(r),e.ray.intersectsSphere(ml)!==!1))for(let a=0;a<s;a++){this.getMatrixAt(a,Jn),zv.multiplyMatrices(r,Jn),pl.matrixWorld=zv,pl.raycast(e,Ic);for(let n=0,o=Ic.length;n<o;n++){const l=Ic[n];l.instanceId=a,l.object=this,t.push(l)}Ic.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new un(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const r=t.morphTargetInfluences,s=r.length+1;this.morphTexture===null&&(this.morphTexture=new Ms(new Float32Array(s*this.count),s,this.count,pg,tr));const a=this.morphTexture.source.data.data;let n=0;for(let h=0;h<r.length;h++)n+=r[h];const o=this.geometry.morphTargetsRelative?1:1-n,l=s*e;a[l]=o,a.set(r,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function PT(i,e){return i.z-e.z}function IT(i,e){return e.z-i.z}class LT{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const a=r[this.index];s.push(a),this.index++,a.start=e.start,a.count=e.count,a.z=t}reset(){this.list.length=0,this.index=0}}const $n="batchId",Hs=new me,Up=new me,NT=new me,DT=new oe(1,1,1),Hv=new me,Fp=new Gh,Lc=new vt,Oa=new ii,fl=new S,Gv=new S,OT=new S,kp=new LT,xi=new ue,Nc=[];function UT(i,e,t=0){const r=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const s=i.count;for(let a=0;a<s;a++)for(let n=0;n<r;n++)e.setComponent(a+t,n,i.getComponent(a,n))}else e.array.set(i.array,t*r);e.needsUpdate=!0}class jv extends ue{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,r=2*t,s){super(new Re,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture(),this._colorsTexture=null}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new Ms(t,e,e,fr,tr);this._matricesTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxGeometryCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),r=new Ms(t,e,e,fr,tr);r.colorSpace=rt.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,s=this._maxGeometryCount,a=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const l=e.getAttribute(o),{array:h,itemSize:c,normalized:u}=l,d=new h.constructor(r*c),p=new Ze(d,c,u);t.setAttribute(o,p)}if(e.getIndex()!==null){const o=r>65536?new Uint32Array(a):new Uint16Array(a);t.setIndex(new Ze(o,1))}const n=s>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute($n,new Ze(n,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute($n))throw new Error(`BatchedMesh: Geometry cannot use attribute "${$n}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(r===$n)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const s=e.getAttribute(r),a=t.getAttribute(r);if(s.itemSize!==a.itemSize||s.normalized!==a.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vt);const e=this._geometryCount,t=this.boundingBox,r=this._active;t.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,Hs),this.getBoundingBoxAt(s,Lc).applyMatrix4(Hs),t.union(Lc))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ii);const e=this._geometryCount,t=this.boundingSphere,r=this._active;t.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,Hs),this.getBoundingSphereAt(s,Oa).applyMatrix4(Hs),t.union(Oa))}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let a=null;const n=this._reservedRanges,o=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(a=n[n.length-1]),s.vertexCount=t===-1?e.getAttribute("position").count:t,s.vertexStart=a===null?0:a.vertexStart+a.vertexCount;const h=e.getIndex(),c=h!==null;if(c&&(s.indexCount=r===-1?h.count:r,s.indexStart=a===null?0:a.indexStart+a.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,d=this._active,p=this._matricesTexture,f=this._matricesTexture.image.data,v=this._colorsTexture;u.push(!0),d.push(!0);const m=this._geometryCount;this._geometryCount++,NT.toArray(f,16*m),p.needsUpdate=!0,v!==null&&(DT.toArray(v.image.data,4*m),v.needsUpdate=!0),n.push(s),o.push({start:c?s.indexStart:s.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new vt,sphereInitialized:!1,sphere:new ii});const g=this.geometry.getAttribute($n);for(let _=0;_<s.vertexCount;_++)g.setX(s.vertexStart+_,m);return g.needsUpdate=!0,this.setGeometryAt(m,e),m}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,s=r.getIndex()!==null,a=r.getIndex(),n=t.getIndex(),o=this._reservedRanges[e];if(s&&n.count>o.indexCount||t.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,h=o.vertexCount;for(const p in r.attributes){if(p===$n)continue;const f=t.getAttribute(p),v=r.getAttribute(p);UT(f,v,l);const m=f.itemSize;for(let g=f.count,_=h;g<_;g++){const y=l+g;for(let x=0;x<m;x++)v.setComponent(y,x,0)}v.needsUpdate=!0,v.addUpdateRange(l*m,h*m)}if(s){const p=o.indexStart;for(let f=0;f<n.count;f++)a.setX(p+f,l+n.getX(f));for(let f=n.count,v=o.indexCount;f<v;f++)a.setX(p+f,l);a.needsUpdate=!0,a.addUpdateRange(p,o.indexCount)}const c=this._bounds[e];t.boundingBox!==null?(c.box.copy(t.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,t.boundingSphere!==null?(c.sphere.copy(t.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const u=this._drawRanges[e],d=t.getAttribute("position");return u.count=s?n.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1||(t[e]=!1,this._visibilityChanged=!0),this}getInstanceCountAt(e){return this._multiDrawInstances===null?null:this._multiDrawInstances[e]}setInstanceCountAt(e,t){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=t,e}getBoundingBoxAt(e,t){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.box,a=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const n=a.index,o=a.attributes.position,l=this._drawRanges[e];for(let h=l.start,c=l.start+l.count;h<c;h++){let u=h;n&&(u=n.getX(u)),s.expandByPoint(fl.fromBufferAttribute(o,u))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.sphere,a=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,Lc),Lc.getCenter(s.center);const n=a.index,o=a.attributes.position,l=this._drawRanges[e];let h=0;for(let c=l.start,u=l.start+l.count;c<u;c++){let d=c;n&&(d=n.getX(d)),fl.fromBufferAttribute(o,d),h=Math.max(h,s.center.distanceToSquared(fl))}s.radius=Math.sqrt(h),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const r=this._active,s=this._matricesTexture,a=this._matricesTexture.image.data;return e>=this._geometryCount||r[e]===!1||(t.toArray(a,16*e),s.needsUpdate=!0),this}getMatrixAt(e,t){const r=this._active,s=this._matricesTexture.image.data;return e>=this._geometryCount||r[e]===!1?null:t.fromArray(s,16*e)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const r=this._active,s=this._colorsTexture,a=this._colorsTexture.image.data;return e>=this._geometryCount||r[e]===!1||(t.toArray(a,4*e),s.needsUpdate=!0),this}getColorAt(e,t){const r=this._active,s=this._colorsTexture.image.data;return e>=this._geometryCount||r[e]===!1?null:t.fromArray(s,4*e)}setVisibleAt(e,t){const r=this._visibility,s=this._active;return e>=this._geometryCount||s[e]===!1||r[e]===t||(r[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){const t=this._visibility,r=this._active;return!(e>=this._geometryCount||r[e]===!1)&&t[e]}raycast(e,t){const r=this._visibility,s=this._active,a=this._drawRanges,n=this._geometryCount,o=this.matrixWorld,l=this.geometry;xi.material=this.material,xi.geometry.index=l.index,xi.geometry.attributes=l.attributes,xi.geometry.boundingBox===null&&(xi.geometry.boundingBox=new vt),xi.geometry.boundingSphere===null&&(xi.geometry.boundingSphere=new ii);for(let h=0;h<n;h++){if(!r[h]||!s[h])continue;const c=a[h];xi.geometry.setDrawRange(c.start,c.count),this.getMatrixAt(h,xi.matrixWorld).premultiply(o),this.getBoundingBoxAt(h,xi.geometry.boundingBox),this.getBoundingSphereAt(h,xi.geometry.boundingSphere),xi.raycast(e,Nc);for(let u=0,d=Nc.length;u<d;u++){const p=Nc[u];p.object=this,p.batchId=h,t.push(p)}Nc.length=0}xi.material=null,xi.geometry.index=null,xi.geometry.attributes={},xi.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>Ae({},t)),this._reservedRanges=e._reservedRanges.map(t=>Ae({},t)),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,r,s,a){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const n=s.getIndex(),o=n===null?1:n.array.BYTES_PER_ELEMENT,l=this._active,h=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,d=this._drawRanges,p=this.perObjectFrustumCulled;p&&(Hv.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),Fp.setFromProjectionMatrix(Hv,e.coordinateSystem));let f=0;if(this.sortObjects){Up.copy(this.matrixWorld).invert(),fl.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Up),Gv.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Up);for(let g=0,_=h.length;g<_;g++)if(h[g]&&l[g]){this.getMatrixAt(g,Hs),this.getBoundingSphereAt(g,Oa).applyMatrix4(Hs);let y=!1;if(p&&(y=!Fp.intersectsSphere(Oa)),!y){const x=OT.subVectors(Oa.center,fl).dot(Gv);kp.push(d[g],x)}}const v=kp.list,m=this.customSort;m===null?v.sort(a.transparent?IT:PT):m.call(this,v,r);for(let g=0,_=v.length;g<_;g++){const y=v[g];c[f]=y.start*o,u[f]=y.count,f++}kp.reset()}else for(let v=0,m=h.length;v<m;v++)if(h[v]&&l[v]){let g=!1;if(p&&(this.getMatrixAt(v,Hs),this.getBoundingSphereAt(v,Oa).applyMatrix4(Hs),g=!Fp.intersectsSphere(Oa)),!g){const _=d[v];c[f]=_.start*o,u[f]=_.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,r,s,a,n){this.onBeforeRender(e,null,s,a,n)}}class Bt extends Xt{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new oe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const ju=new S,Wu=new S,Wv=new me,gl=new Rn,Dc=new ii,Bp=new S,Xv=new S;class oi extends Ue{constructor(e=new Re,t=new Bt){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let s=1,a=t.count;s<a;s++)ju.fromBufferAttribute(t,s-1),Wu.fromBufferAttribute(t,s),r[s]=r[s-1],r[s]+=ju.distanceTo(Wu);e.setAttribute("lineDistance",new _e(r,1))}return this}raycast(e,t){const r=this.geometry,s=this.matrixWorld,a=e.params.Line.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Dc.copy(r.boundingSphere),Dc.applyMatrix4(s),Dc.radius+=a,e.ray.intersectsSphere(Dc)===!1)return;Wv.copy(s).invert(),gl.copy(e.ray).applyMatrix4(Wv);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=this.isLineSegments?2:1,c=r.index,u=r.attributes.position;if(c!==null){const d=Math.max(0,n.start),p=Math.min(c.count,n.start+n.count);for(let f=d,v=p-1;f<v;f+=h){const m=c.getX(f),g=c.getX(f+1),_=Oc(this,e,gl,l,m,g);_&&t.push(_)}if(this.isLineLoop){const f=c.getX(p-1),v=c.getX(d),m=Oc(this,e,gl,l,f,v);m&&t.push(m)}}else{const d=Math.max(0,n.start),p=Math.min(u.count,n.start+n.count);for(let f=d,v=p-1;f<v;f+=h){const m=Oc(this,e,gl,l,f,f+1);m&&t.push(m)}if(this.isLineLoop){const f=Oc(this,e,gl,l,p-1,d);f&&t.push(f)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}}function Oc(i,e,t,r,s,a){const n=i.geometry.attributes.position;if(ju.fromBufferAttribute(n,s),Wu.fromBufferAttribute(n,a),t.distanceSqToSegment(ju,Wu,Bp,Xv)>r)return;Bp.applyMatrix4(i.matrixWorld);const o=e.ray.origin.distanceTo(Bp);return o<e.near||o>e.far?void 0:{distance:o,point:Xv.clone().applyMatrix4(i.matrixWorld),index:s,face:null,faceIndex:null,object:i}}const qv=new S,Yv=new S;class Yi extends oi{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let s=0,a=t.count;s<a;s+=2)qv.fromBufferAttribute(t,s),Yv.fromBufferAttribute(t,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+qv.distanceTo(Yv);e.setAttribute("lineDistance",new _e(r,1))}return this}}class bf extends oi{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Ks extends Xt{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new oe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Zv=new me,wf=new Rn,Uc=new ii,Fc=new S;class na extends Ue{constructor(e=new Re,t=new Ks){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,s=this.matrixWorld,a=e.params.Points.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),Uc.copy(r.boundingSphere),Uc.applyMatrix4(s),Uc.radius+=a,e.ray.intersectsSphere(Uc)===!1)return;Zv.copy(s).invert(),wf.copy(e.ray).applyMatrix4(Zv);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,h=r.index,c=r.attributes.position;if(h!==null)for(let u=Math.max(0,n.start),d=Math.min(h.count,n.start+n.count);u<d;u++){const p=h.getX(u);Fc.fromBufferAttribute(c,p),Kv(Fc,p,l,s,e,t,this)}else for(let u=Math.max(0,n.start),d=Math.min(c.count,n.start+n.count);u<d;u++)Fc.fromBufferAttribute(c,u),Kv(Fc,u,l,s,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}}function Kv(i,e,t,r,s,a,n){const o=wf.distanceSqToPoint(i);if(o<t){const l=new S;wf.closestPointToPoint(i,l),l.applyMatrix4(r);const h=s.ray.origin.distanceTo(l);if(h<s.near||h>s.far)return;a.push({distance:h,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:n})}}class e1 extends pt{constructor(e,t,r,s,a,n,o,l,h){super(e,t,r,s,a,n,o,l,h),this.isVideoTexture=!0,this.minFilter=n!==void 0?n:Vt,this.magFilter=a!==void 0?a:Vt,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class kc extends pt{constructor(e,t,r,s,a,n,o,l,h,c,u,d){super(null,n,o,l,h,c,s,a,u,d),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class FT extends pt{constructor(e,t,r,s,a,n,o,l,h){super(e,t,r,s,a,n,o,l,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class _r{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,s=this.getPoint(0),a=0;t.push(0);for(let n=1;n<=e;n++)r=this.getPoint(n/e),a+=r.distanceTo(s),t.push(a),s=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let s=0;const a=r.length;let n;n=t||e*r[a-1];let o,l=0,h=a-1;for(;l<=h;)if(s=Math.floor(l+(h-l)/2),o=r[s]-n,o<0)l=s+1;else{if(!(o>0)){h=s;break}h=s-1}if(s=h,r[s]===n)return s/(a-1);const c=r[s];return(s+(n-c)/(r[s+1]-c))/(a-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),n=this.getPoint(s),o=t||(a.isVector2?new X:new S);return o.copy(n).sub(a).normalize(),o}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new S,s=[],a=[],n=[],o=new S,l=new me;for(let p=0;p<=e;p++){const f=p/e;s[p]=this.getTangentAt(f,new S)}a[0]=new S,n[0]=new S;let h=Number.MAX_VALUE;const c=Math.abs(s[0].x),u=Math.abs(s[0].y),d=Math.abs(s[0].z);c<=h&&(h=c,r.set(1,0,0)),u<=h&&(h=u,r.set(0,1,0)),d<=h&&r.set(0,0,1),o.crossVectors(s[0],r).normalize(),a[0].crossVectors(s[0],o),n[0].crossVectors(s[0],a[0]);for(let p=1;p<=e;p++){if(a[p]=a[p-1].clone(),n[p]=n[p-1].clone(),o.crossVectors(s[p-1],s[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(Pt(s[p-1].dot(s[p]),-1,1));a[p].applyMatrix4(l.makeRotationAxis(o,f))}n[p].crossVectors(s[p],a[p])}if(t===!0){let p=Math.acos(Pt(a[0].dot(a[e]),-1,1));p/=e,s[0].dot(o.crossVectors(a[0],a[e]))>0&&(p=-p);for(let f=1;f<=e;f++)a[f].applyMatrix4(l.makeRotationAxis(s[f],p*f)),n[f].crossVectors(s[f],a[f])}return{tangents:s,normals:a,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ud extends _r{constructor(e=0,t=0,r=1,s=1,a=0,n=2*Math.PI,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=s,this.aStartAngle=a,this.aEndAngle=n,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new X){const r=t,s=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const n=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=s;for(;a>s;)a-=s;a<Number.EPSILON&&(a=n?0:s),this.aClockwise!==!0||n||(a===s?a=-s:a-=s);const o=this.aStartAngle+e*a;let l=this.aX+this.xRadius*Math.cos(o),h=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,p=h-this.aY;l=d*c-p*u+this.aX,h=d*u+p*c+this.aY}return r.set(l,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class t1 extends Ud{constructor(e,t,r,s,a,n){super(e,t,r,r,s,a,n),this.isArcCurve=!0,this.type="ArcCurve"}}function Ag(){let i=0,e=0,t=0,r=0;function s(a,n,o,l){i=a,e=o,t=-3*a+3*n-2*o-l,r=2*a-2*n+o+l}return{initCatmullRom:function(a,n,o,l,h){s(n,o,h*(o-a),h*(l-n))},initNonuniformCatmullRom:function(a,n,o,l,h,c,u){let d=(n-a)/h-(o-a)/(h+c)+(o-n)/c,p=(o-n)/c-(l-n)/(c+u)+(l-o)/u;d*=c,p*=c,s(n,o,d,p)},calc:function(a){const n=a*a;return i+e*a+t*n+r*(n*a)}}}const Bc=new S,zp=new Ag,Vp=new Ag,Hp=new Ag;class Fd extends _r{constructor(e=[],t=!1,r="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=s}getPoint(e,t=new S){const r=t,s=this.points,a=s.length,n=(a-(this.closed?0:1))*e;let o,l,h=Math.floor(n),c=n-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/a)+1)*a:c===0&&h===a-1&&(h=a-2,c=1),this.closed||h>0?o=s[(h-1)%a]:(Bc.subVectors(s[0],s[1]).add(s[0]),o=Bc);const u=s[h%a],d=s[(h+1)%a];if(this.closed||h+2<a?l=s[(h+2)%a]:(Bc.subVectors(s[a-1],s[a-2]).add(s[a-1]),l=Bc),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(o.distanceToSquared(u),p),v=Math.pow(u.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(l),p);v<1e-4&&(v=1),f<1e-4&&(f=v),m<1e-4&&(m=v),zp.initNonuniformCatmullRom(o.x,u.x,d.x,l.x,f,v,m),Vp.initNonuniformCatmullRom(o.y,u.y,d.y,l.y,f,v,m),Hp.initNonuniformCatmullRom(o.z,u.z,d.z,l.z,f,v,m)}else this.curveType==="catmullrom"&&(zp.initCatmullRom(o.x,u.x,d.x,l.x,this.tension),Vp.initCatmullRom(o.y,u.y,d.y,l.y,this.tension),Hp.initCatmullRom(o.z,u.z,d.z,l.z,this.tension));return r.set(zp.calc(c),Vp.calc(c),Hp.calc(c)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(new S().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Qv(i,e,t,r,s){const a=.5*(r-e),n=.5*(s-t),o=i*i;return(2*t-2*r+a+n)*(i*o)+(-3*t+3*r-2*a-n)*o+a*i+t}function Wl(i,e,t,r){return function(s,a){const n=1-s;return n*n*a}(i,e)+function(s,a){return 2*(1-s)*s*a}(i,t)+function(s,a){return s*s*a}(i,r)}function Xl(i,e,t,r,s){return function(a,n){const o=1-a;return o*o*o*n}(i,e)+function(a,n){const o=1-a;return 3*o*o*a*n}(i,t)+function(a,n){return 3*(1-a)*a*a*n}(i,r)+function(a,n){return a*a*a*n}(i,s)}class Eg extends _r{constructor(e=new X,t=new X,r=new X,s=new X){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=s}getPoint(e,t=new X){const r=t,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(Xl(e,s.x,a.x,n.x,o.x),Xl(e,s.y,a.y,n.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class i1 extends _r{constructor(e=new S,t=new S,r=new S,s=new S){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=s}getPoint(e,t=new S){const r=t,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(Xl(e,s.x,a.x,n.x,o.x),Xl(e,s.y,a.y,n.y,o.y),Xl(e,s.z,a.z,n.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Cg extends _r{constructor(e=new X,t=new X){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new X){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new X){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class r1 extends _r{constructor(e=new S,t=new S){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new S){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new S){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Rg extends _r{constructor(e=new X,t=new X,r=new X){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new X){const r=t,s=this.v0,a=this.v1,n=this.v2;return r.set(Wl(e,s.x,a.x,n.x),Wl(e,s.y,a.y,n.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Pg extends _r{constructor(e=new S,t=new S,r=new S){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new S){const r=t,s=this.v0,a=this.v1,n=this.v2;return r.set(Wl(e,s.x,a.x,n.x),Wl(e,s.y,a.y,n.y),Wl(e,s.z,a.z,n.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ig extends _r{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new X){const r=t,s=this.points,a=(s.length-1)*e,n=Math.floor(a),o=a-n,l=s[n===0?n:n-1],h=s[n],c=s[n>s.length-2?s.length-1:n+1],u=s[n>s.length-3?s.length-1:n+2];return r.set(Qv(o,l.x,h.x,c.x,u.x),Qv(o,l.y,h.y,c.y,u.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(new X().fromArray(s))}return this}}var Xu=Object.freeze({__proto__:null,ArcCurve:t1,CatmullRomCurve3:Fd,CubicBezierCurve:Eg,CubicBezierCurve3:i1,EllipseCurve:Ud,LineCurve:Cg,LineCurve3:r1,QuadraticBezierCurve:Rg,QuadraticBezierCurve3:Pg,SplineCurve:Ig});class s1 extends _r{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Xu[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),s=this.getCurveLengths();let a=0;for(;a<s.length;){if(s[a]>=r){const n=s[a]-r,o=this.curves[a],l=o.getLength(),h=l===0?0:1-n/l;return o.getPointAt(h,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,s=this.curves.length;r<s;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let s=0,a=this.curves;s<a.length;s++){const n=a[s],o=n.isEllipseCurve?2*e:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?e*n.points.length:e,l=n.getPoints(o);for(let h=0;h<l.length;h++){const c=l[h];r&&r.equals(c)||(t.push(c),r=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const s=e.curves[t];this.curves.push(new Xu[s.type]().fromJSON(s))}return this}}class Ho extends s1{constructor(e){super(),this.type="Path",this.currentPoint=new X,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new Cg(this.currentPoint.clone(),new X(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,s){const a=new Rg(this.currentPoint.clone(),new X(e,t),new X(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}bezierCurveTo(e,t,r,s,a,n){const o=new Eg(this.currentPoint.clone(),new X(e,t),new X(r,s),new X(a,n));return this.curves.push(o),this.currentPoint.set(a,n),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new Ig(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,s,a,n){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,r,s,a,n),this}absarc(e,t,r,s,a,n){return this.absellipse(e,t,r,r,s,a,n),this}ellipse(e,t,r,s,a,n,o,l){const h=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+h,t+c,r,s,a,n,o,l),this}absellipse(e,t,r,s,a,n,o,l){const h=new Ud(e,t,r,s,a,n,o,l);if(this.curves.length>0){const u=h.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(h);const c=h.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Xh extends Re{constructor(e=[new X(0,-.5),new X(.5,0),new X(0,.5)],t=12,r=0,s=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:s},t=Math.floor(t),s=Pt(s,0,2*Math.PI);const a=[],n=[],o=[],l=[],h=[],c=1/t,u=new S,d=new X,p=new S,f=new S,v=new S;let m=0,g=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:m=e[_+1].x-e[_].x,g=e[_+1].y-e[_].y,p.x=1*g,p.y=-m,p.z=0*g,v.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(v.x,v.y,v.z);break;default:m=e[_+1].x-e[_].x,g=e[_+1].y-e[_].y,p.x=1*g,p.y=-m,p.z=0*g,f.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),l.push(p.x,p.y,p.z),v.copy(f)}for(let _=0;_<=t;_++){const y=r+_*c*s,x=Math.sin(y),M=Math.cos(y);for(let b=0;b<=e.length-1;b++){u.x=e[b].x*x,u.y=e[b].y,u.z=e[b].x*M,n.push(u.x,u.y,u.z),d.x=_/t,d.y=b/(e.length-1),o.push(d.x,d.y);const w=l[3*b+0]*x,T=l[3*b+1],R=l[3*b+0]*M;h.push(w,T,R)}}for(let _=0;_<t;_++)for(let y=0;y<e.length-1;y++){const x=y+_*e.length,M=x,b=x+e.length,w=x+e.length+1,T=x+1;a.push(M,b,T),a.push(w,T,b)}this.setIndex(a),this.setAttribute("position",new _e(n,3)),this.setAttribute("uv",new _e(o,2)),this.setAttribute("normal",new _e(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xh(e.points,e.segments,e.phiStart,e.phiLength)}}class qh extends Xh{constructor(e=1,t=1,r=4,s=8){const a=new Ho;a.absarc(0,-t/2,e,1.5*Math.PI,0),a.absarc(0,t/2,e,0,.5*Math.PI),super(a.getPoints(r),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:s}}static fromJSON(e){return new qh(e.radius,e.length,e.capSegments,e.radialSegments)}}class Yh extends Re{constructor(e=1,t=32,r=0,s=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:s},t=Math.max(3,t);const a=[],n=[],o=[],l=[],h=new S,c=new X;n.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const p=r+u/t*s;h.x=e*Math.cos(p),h.y=e*Math.sin(p),n.push(h.x,h.y,h.z),o.push(0,0,1),c.x=(n[d]/e+1)/2,c.y=(n[d+1]/e+1)/2,l.push(c.x,c.y)}for(let u=1;u<=t;u++)a.push(u,u+1,0);this.setIndex(a),this.setAttribute("position",new _e(n,3)),this.setAttribute("normal",new _e(o,3)),this.setAttribute("uv",new _e(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Rt extends Re{constructor(e=1,t=1,r=1,s=32,a=1,n=!1,o=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:s,heightSegments:a,openEnded:n,thetaStart:o,thetaLength:l};const h=this;s=Math.floor(s),a=Math.floor(a);const c=[],u=[],d=[],p=[];let f=0;const v=[],m=r/2;let g=0;function _(y){const x=f,M=new X,b=new S;let w=0;const T=y===!0?e:t,R=y===!0?1:-1;for(let E=1;E<=s;E++)u.push(0,m*R,0),d.push(0,R,0),p.push(.5,.5),f++;const I=f;for(let E=0;E<=s;E++){const L=E/s*l+o,D=Math.cos(L),U=Math.sin(L);b.x=T*U,b.y=m*R,b.z=T*D,u.push(b.x,b.y,b.z),d.push(0,R,0),M.x=.5*D+.5,M.y=.5*U*R+.5,p.push(M.x,M.y),f++}for(let E=0;E<s;E++){const L=x+E,D=I+E;y===!0?c.push(D,D+1,L):c.push(D+1,D,L),w+=3}h.addGroup(g,w,y===!0?1:2),g+=w}(function(){const y=new S,x=new S;let M=0;const b=(t-e)/r;for(let w=0;w<=a;w++){const T=[],R=w/a,I=R*(t-e)+e;for(let E=0;E<=s;E++){const L=E/s,D=L*l+o,U=Math.sin(D),H=Math.cos(D);x.x=I*U,x.y=-R*r+m,x.z=I*H,u.push(x.x,x.y,x.z),y.set(U,b,H).normalize(),d.push(y.x,y.y,y.z),p.push(L,1-R),T.push(f++)}v.push(T)}for(let w=0;w<s;w++)for(let T=0;T<a;T++){const R=v[T][w],I=v[T+1][w],E=v[T+1][w+1],L=v[T][w+1];c.push(R,I,L),c.push(I,E,L),M+=6}h.addGroup(g,M,0),g+=M})(),n===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new _e(u,3)),this.setAttribute("normal",new _e(d,3)),this.setAttribute("uv",new _e(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Rt(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Zh extends Rt{constructor(e=1,t=1,r=32,s=1,a=!1,n=0,o=2*Math.PI){super(0,e,t,r,s,a,n,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:n,thetaLength:o}}static fromJSON(e){return new Zh(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ba extends Re{constructor(e=[],t=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:s};const a=[],n=[];function o(d,p,f,v){const m=v+1,g=[];for(let _=0;_<=m;_++){g[_]=[];const y=d.clone().lerp(f,_/m),x=p.clone().lerp(f,_/m),M=m-_;for(let b=0;b<=M;b++)g[_][b]=b===0&&_===m?y:y.clone().lerp(x,b/M)}for(let _=0;_<m;_++)for(let y=0;y<2*(m-_)-1;y++){const x=Math.floor(y/2);y%2==0?(l(g[_][x+1]),l(g[_+1][x]),l(g[_][x])):(l(g[_][x+1]),l(g[_+1][x+1]),l(g[_+1][x]))}}function l(d){a.push(d.x,d.y,d.z)}function h(d,p){const f=3*d;p.x=e[f+0],p.y=e[f+1],p.z=e[f+2]}function c(d,p,f,v){v<0&&d.x===1&&(n[p]=d.x-1),f.x===0&&f.z===0&&(n[p]=v/2/Math.PI+.5)}function u(d){return Math.atan2(d.z,-d.x)}(function(d){const p=new S,f=new S,v=new S;for(let m=0;m<t.length;m+=3)h(t[m+0],p),h(t[m+1],f),h(t[m+2],v),o(p,f,v,d)})(s),function(d){const p=new S;for(let f=0;f<a.length;f+=3)p.x=a[f+0],p.y=a[f+1],p.z=a[f+2],p.normalize().multiplyScalar(d),a[f+0]=p.x,a[f+1]=p.y,a[f+2]=p.z}(r),function(){const d=new S;for(let f=0;f<a.length;f+=3){d.x=a[f+0],d.y=a[f+1],d.z=a[f+2];const v=u(d)/2/Math.PI+.5,m=(p=d,Math.atan2(-p.y,Math.sqrt(p.x*p.x+p.z*p.z))/Math.PI+.5);n.push(v,1-m)}var p;(function(){const f=new S,v=new S,m=new S,g=new S,_=new X,y=new X,x=new X;for(let M=0,b=0;M<a.length;M+=9,b+=6){f.set(a[M+0],a[M+1],a[M+2]),v.set(a[M+3],a[M+4],a[M+5]),m.set(a[M+6],a[M+7],a[M+8]),_.set(n[b+0],n[b+1]),y.set(n[b+2],n[b+3]),x.set(n[b+4],n[b+5]),g.copy(f).add(v).add(m).divideScalar(3);const w=u(g);c(_,b+0,f,w),c(y,b+2,v,w),c(x,b+4,m,w)}})(),function(){for(let f=0;f<n.length;f+=6){const v=n[f+0],m=n[f+2],g=n[f+4],_=Math.max(v,m,g),y=Math.min(v,m,g);_>.9&&y<.1&&(v<.2&&(n[f+0]+=1),m<.2&&(n[f+2]+=1),g<.2&&(n[f+4]+=1))}}()}(),this.setAttribute("position",new _e(a,3)),this.setAttribute("normal",new _e(a.slice(),3)),this.setAttribute("uv",new _e(n,2)),s===0?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ba(e.vertices,e.indices,e.radius,e.details)}}class kd extends ba{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,s=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new kd(e.radius,e.detail)}}const zc=new S,Vc=new S,Gp=new S,Hc=new $i;class a1 extends Re{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(cn*t),a=e.getIndex(),n=e.getAttribute("position"),o=a?a.count:n.count,l=[0,0,0],h=["a","b","c"],c=new Array(3),u={},d=[];for(let p=0;p<o;p+=3){a?(l[0]=a.getX(p),l[1]=a.getX(p+1),l[2]=a.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:f,b:v,c:m}=Hc;if(f.fromBufferAttribute(n,l[0]),v.fromBufferAttribute(n,l[1]),m.fromBufferAttribute(n,l[2]),Hc.getNormal(Gp),c[0]=`${Math.round(f.x*r)},${Math.round(f.y*r)},${Math.round(f.z*r)}`,c[1]=`${Math.round(v.x*r)},${Math.round(v.y*r)},${Math.round(v.z*r)}`,c[2]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let g=0;g<3;g++){const _=(g+1)%3,y=c[g],x=c[_],M=Hc[h[g]],b=Hc[h[_]],w=`${y}_${x}`,T=`${x}_${y}`;T in u&&u[T]?(Gp.dot(u[T].normal)<=s&&(d.push(M.x,M.y,M.z),d.push(b.x,b.y,b.z)),u[T]=null):w in u||(u[w]={index0:l[g],index1:l[_],normal:Gp.clone()})}}for(const p in u)if(u[p]){const{index0:f,index1:v}=u[p];zc.fromBufferAttribute(n,f),Vc.fromBufferAttribute(n,v),d.push(zc.x,zc.y,zc.z),d.push(Vc.x,Vc.y,Vc.z)}this.setAttribute("position",new _e(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class oa extends Ho{constructor(e){super(e),this.uuid=rr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,s=this.holes.length;r<s;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const s=e.holes[t];this.holes.push(new Ho().fromJSON(s))}return this}}const kT=function(i,e,t=2){const r=e&&e.length,s=r?e[0]*t:i.length;let a=Jv(i,0,s,t,!0);const n=[];if(!a||a.next===a.prev)return n;let o,l,h,c,u,d,p;if(r&&(a=function(f,v,m,g){const _=[];let y,x,M,b,w;for(y=0,x=v.length;y<x;y++)M=v[y]*g,b=y<x-1?v[y+1]*g:f.length,w=Jv(f,M,b,g,!1),w===w.next&&(w.steiner=!0),_.push(XT(w));for(_.sort(GT),y=0;y<_.length;y++)m=jT(_[y],m);return m}(i,e,a,t)),i.length>80*t){o=h=i[0],l=c=i[1];for(let f=t;f<s;f+=t)u=i[f],d=i[f+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=p!==0?32767/p:0}return ph(a,n,t,o,l,p,0),n};function Jv(i,e,t,r,s){let a,n;if(s===function(o,l,h,c){let u=0;for(let d=l,p=h-c;d<h;d+=c)u+=(o[p]-o[d])*(o[d+1]+o[p+1]),p=d;return u}(i,e,t,r)>0)for(a=e;a<t;a+=r)n=$v(a,i[a],i[a+1],n);else for(a=t-r;a>=e;a-=r)n=$v(a,i[a],i[a+1],n);return n&&Bd(n,n.next)&&(fh(n),n=n.next),n}function Sn(i,e){if(!i)return i;e||(e=i);let t,r=i;do if(t=!1,r.steiner||!Bd(r,r.next)&&At(r.prev,r,r.next)!==0)r=r.next;else{if(fh(r),r=e=r.prev,r===r.next)break;t=!0}while(t||r!==e);return e}function ph(i,e,t,r,s,a,n){if(!i)return;!n&&a&&function(c,u,d,p){let f=c;do f.z===0&&(f.z=Sf(f.x,f.y,u,d,p)),f.prevZ=f.prev,f.nextZ=f.next,f=f.next;while(f!==c);f.prevZ.nextZ=null,f.prevZ=null,function(v){let m,g,_,y,x,M,b,w,T=1;do{for(g=v,v=null,x=null,M=0;g;){for(M++,_=g,b=0,m=0;m<T&&(b++,_=_.nextZ,_);m++);for(w=T;b>0||w>0&&_;)b!==0&&(w===0||!_||g.z<=_.z)?(y=g,g=g.nextZ,b--):(y=_,_=_.nextZ,w--),x?x.nextZ=y:v=y,y.prevZ=x,x=y;g=_}x.nextZ=null,T*=2}while(M>1)}(f)}(i,r,s,a);let o,l,h=i;for(;i.prev!==i.next;)if(o=i.prev,l=i.next,a?zT(i,r,s,a):BT(i))e.push(o.i/t|0),e.push(i.i/t|0),e.push(l.i/t|0),fh(i),i=l.next,h=l.next;else if((i=l)===h){n?n===1?ph(i=VT(Sn(i),e,t),e,t,r,s,a,2):n===2&&HT(i,e,t,r,s,a):ph(Sn(i),e,t,r,s,a,1);break}}function BT(i){const e=i.prev,t=i,r=i.next;if(At(e,t,r)>=0)return!1;const s=e.x,a=t.x,n=r.x,o=e.y,l=t.y,h=r.y,c=s<a?s<n?s:n:a<n?a:n,u=o<l?o<h?o:h:l<h?l:h,d=s>a?s>n?s:n:a>n?a:n,p=o>l?o>h?o:h:l>h?l:h;let f=r.next;for(;f!==e;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&lo(s,o,a,l,n,h,f.x,f.y)&&At(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function zT(i,e,t,r){const s=i.prev,a=i,n=i.next;if(At(s,a,n)>=0)return!1;const o=s.x,l=a.x,h=n.x,c=s.y,u=a.y,d=n.y,p=o<l?o<h?o:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,v=o>l?o>h?o:h:l>h?l:h,m=c>u?c>d?c:d:u>d?u:d,g=Sf(p,f,e,t,r),_=Sf(v,m,e,t,r);let y=i.prevZ,x=i.nextZ;for(;y&&y.z>=g&&x&&x.z<=_;){if(y.x>=p&&y.x<=v&&y.y>=f&&y.y<=m&&y!==s&&y!==n&&lo(o,c,l,u,h,d,y.x,y.y)&&At(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=p&&x.x<=v&&x.y>=f&&x.y<=m&&x!==s&&x!==n&&lo(o,c,l,u,h,d,x.x,x.y)&&At(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=g;){if(y.x>=p&&y.x<=v&&y.y>=f&&y.y<=m&&y!==s&&y!==n&&lo(o,c,l,u,h,d,y.x,y.y)&&At(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=m&&x!==s&&x!==n&&lo(o,c,l,u,h,d,x.x,x.y)&&At(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function VT(i,e,t){let r=i;do{const s=r.prev,a=r.next.next;!Bd(s,a)&&n1(s,r,r.next,a)&&mh(s,a)&&mh(a,s)&&(e.push(s.i/t|0),e.push(r.i/t|0),e.push(a.i/t|0),fh(r),fh(r.next),r=i=a),r=r.next}while(r!==i);return Sn(r)}function HT(i,e,t,r,s,a){let n=i;do{let o=n.next.next;for(;o!==n.prev;){if(n.i!==o.i&&qT(n,o)){let l=o1(n,o);return n=Sn(n,n.next),l=Sn(l,l.next),ph(n,e,t,r,s,a,0),void ph(l,e,t,r,s,a,0)}o=o.next}n=n.next}while(n!==i)}function GT(i,e){return i.x-e.x}function jT(i,e){const t=function(s,a){let n,o=a,l=-1/0;const h=s.x,c=s.y;do{if(c<=o.y&&c>=o.next.y&&o.next.y!==o.y){const m=o.x+(c-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(m<=h&&m>l&&(l=m,n=o.x<o.next.x?o:o.next,m===h))return n}o=o.next}while(o!==a);if(!n)return null;const u=n,d=n.x,p=n.y;let f,v=1/0;o=n;do h>=o.x&&o.x>=d&&h!==o.x&&lo(c<p?h:l,c,d,p,c<p?l:h,c,o.x,o.y)&&(f=Math.abs(c-o.y)/(h-o.x),mh(o,s)&&(f<v||f===v&&(o.x>n.x||o.x===n.x&&WT(n,o)))&&(n=o,v=f)),o=o.next;while(o!==u);return n}(i,e);if(!t)return e;const r=o1(t,i);return Sn(r,r.next),Sn(t,t.next)}function WT(i,e){return At(i.prev,i,e.prev)<0&&At(e.next,i,i.next)<0}function Sf(i,e,t,r,s){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*s|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function XT(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function lo(i,e,t,r,s,a,n,o){return(s-n)*(e-o)>=(i-n)*(a-o)&&(i-n)*(r-o)>=(t-n)*(e-o)&&(t-n)*(a-o)>=(s-n)*(r-o)}function qT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,r){let s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==r.i&&s.next.i!==r.i&&n1(s,s.next,t,r))return!0;s=s.next}while(s!==t);return!1}(i,e)&&(mh(i,e)&&mh(e,i)&&function(t,r){let s=t,a=!1;const n=(t.x+r.x)/2,o=(t.y+r.y)/2;do s.y>o!=s.next.y>o&&s.next.y!==s.y&&n<(s.next.x-s.x)*(o-s.y)/(s.next.y-s.y)+s.x&&(a=!a),s=s.next;while(s!==t);return a}(i,e)&&(At(i.prev,i,e.prev)||At(i,e.prev,e))||Bd(i,e)&&At(i.prev,i,i.next)>0&&At(e.prev,e,e.next)>0)}function At(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function Bd(i,e){return i.x===e.x&&i.y===e.y}function n1(i,e,t,r){const s=jc(At(i,e,t)),a=jc(At(i,e,r)),n=jc(At(t,r,i)),o=jc(At(t,r,e));return s!==a&&n!==o||!(s!==0||!Gc(i,t,e))||!(a!==0||!Gc(i,r,e))||!(n!==0||!Gc(t,i,r))||!(o!==0||!Gc(t,e,r))}function Gc(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function jc(i){return i>0?1:i<0?-1:0}function mh(i,e){return At(i.prev,i,i.next)<0?At(i,e,i.next)>=0&&At(i,i.prev,e)>=0:At(i,e,i.prev)<0||At(i,i.next,e)<0}function o1(i,e){const t=new Tf(i.i,i.x,i.y),r=new Tf(e.i,e.x,e.y),s=i.next,a=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,r.next=t,t.prev=r,a.next=r,r.prev=a,r}function $v(i,e,t,r){const s=new Tf(i,e,t);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function fh(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Tf(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Ir{static area(e){const t=e.length;let r=0;for(let s=t-1,a=0;a<t;s=a++)r+=e[s].x*e[a].y-e[a].x*e[s].y;return .5*r}static isClockWise(e){return Ir.area(e)<0}static triangulateShape(e,t){const r=[],s=[],a=[];e_(e),t_(r,e);let n=e.length;t.forEach(e_);for(let l=0;l<t.length;l++)s.push(n),n+=t[l].length,t_(r,t[l]);const o=kT(r,s);for(let l=0;l<o.length;l+=3)a.push(o.slice(l,l+3));return a}}function e_(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function t_(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class Pn extends Re{constructor(e=new oa([new X(.5,.5),new X(-.5,.5),new X(-.5,-.5),new X(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,s=[],a=[];for(let o=0,l=e.length;o<l;o++)n(e[o]);function n(o){const l=[],h=t.curveSegments!==void 0?t.curveSegments:12,c=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled===void 0||t.bevelEnabled,p=t.bevelThickness!==void 0?t.bevelThickness:.2,f=t.bevelSize!==void 0?t.bevelSize:p-.1,v=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3;const g=t.extrudePath,_=t.UVGenerator!==void 0?t.UVGenerator:YT;let y,x,M,b,w,T=!1;g&&(y=g.getSpacedPoints(c),T=!0,d=!1,x=g.computeFrenetFrames(c,!1),M=new S,b=new S,w=new S),d||(m=0,p=0,f=0,v=0);const R=o.extractPoints(h);let I=R.shape;const E=R.holes;if(!Ir.isClockWise(I)){I=I.reverse();for(let O=0,B=E.length;O<B;O++){const A=E[O];Ir.isClockWise(A)&&(E[O]=A.reverse())}}const L=Ir.triangulateShape(I,E),D=I;for(let O=0,B=E.length;O<B;O++){const A=E[O];I=I.concat(A)}function U(O,B,A){return O.clone().addScaledVector(B,A)}const H=I.length,Z=L.length;function te(O,B,A){let k,F,se;const V=O.x-B.x,ae=O.y-B.y,xe=A.x-O.x,ce=A.y-O.y,z=V*V+ae*ae,W=V*ce-ae*xe;if(Math.abs(W)>Number.EPSILON){const ee=Math.sqrt(z),ge=Math.sqrt(xe*xe+ce*ce),Le=B.x-ae/ee,Fe=B.y+V/ee,Se=((A.x-ce/ge-Le)*ce-(A.y+xe/ge-Fe)*xe)/(V*ce-ae*xe);k=Le+V*Se-O.x,F=Fe+ae*Se-O.y;const ke=k*k+F*F;if(ke<=2)return new X(k,F);se=Math.sqrt(ke/2)}else{let ee=!1;V>Number.EPSILON?xe>Number.EPSILON&&(ee=!0):V<-Number.EPSILON?xe<-Number.EPSILON&&(ee=!0):Math.sign(ae)===Math.sign(ce)&&(ee=!0),ee?(k=-ae,F=V,se=Math.sqrt(z)):(k=V,F=ae,se=Math.sqrt(z/2))}return new X(k/se,F/se)}const ie=[];for(let O=0,B=D.length,A=B-1,k=O+1;O<B;O++,A++,k++)A===B&&(A=0),k===B&&(k=0),ie[O]=te(D[O],D[A],D[k]);const ve=[];let be,J=ie.concat();for(let O=0,B=E.length;O<B;O++){const A=E[O];be=[];for(let k=0,F=A.length,se=F-1,V=k+1;k<F;k++,se++,V++)se===F&&(se=0),V===F&&(V=0),be[k]=te(A[k],A[se],A[V]);ve.push(be),J=J.concat(be)}for(let O=0;O<m;O++){const B=O/m,A=p*Math.cos(B*Math.PI/2),k=f*Math.sin(B*Math.PI/2)+v;for(let F=0,se=D.length;F<se;F++){const V=U(D[F],ie[F],k);re(V.x,V.y,-A)}for(let F=0,se=E.length;F<se;F++){const V=E[F];be=ve[F];for(let ae=0,xe=V.length;ae<xe;ae++){const ce=U(V[ae],be[ae],k);re(ce.x,ce.y,-A)}}}const ne=f+v;for(let O=0;O<H;O++){const B=d?U(I[O],J[O],ne):I[O];T?(b.copy(x.normals[0]).multiplyScalar(B.x),M.copy(x.binormals[0]).multiplyScalar(B.y),w.copy(y[0]).add(b).add(M),re(w.x,w.y,w.z)):re(B.x,B.y,0)}for(let O=1;O<=c;O++)for(let B=0;B<H;B++){const A=d?U(I[B],J[B],ne):I[B];T?(b.copy(x.normals[O]).multiplyScalar(A.x),M.copy(x.binormals[O]).multiplyScalar(A.y),w.copy(y[O]).add(b).add(M),re(w.x,w.y,w.z)):re(A.x,A.y,u/c*O)}for(let O=m-1;O>=0;O--){const B=O/m,A=p*Math.cos(B*Math.PI/2),k=f*Math.sin(B*Math.PI/2)+v;for(let F=0,se=D.length;F<se;F++){const V=U(D[F],ie[F],k);re(V.x,V.y,u+A)}for(let F=0,se=E.length;F<se;F++){const V=E[F];be=ve[F];for(let ae=0,xe=V.length;ae<xe;ae++){const ce=U(V[ae],be[ae],k);T?re(ce.x,ce.y+y[c-1].y,y[c-1].x+A):re(ce.x,ce.y,u+A)}}}function de(O,B){let A=O.length;for(;--A>=0;){const k=A;let F=A-1;F<0&&(F=O.length-1);for(let se=0,V=c+2*m;se<V;se++){const ae=H*se,xe=H*(se+1);P(B+k+ae,B+F+ae,B+F+xe,B+k+xe)}}}function re(O,B,A){l.push(O),l.push(B),l.push(A)}function N(O,B,A){j(O),j(B),j(A);const k=s.length/3,F=_.generateTopUV(r,s,k-3,k-2,k-1);K(F[0]),K(F[1]),K(F[2])}function P(O,B,A,k){j(O),j(B),j(k),j(B),j(A),j(k);const F=s.length/3,se=_.generateSideWallUV(r,s,F-6,F-3,F-2,F-1);K(se[0]),K(se[1]),K(se[3]),K(se[1]),K(se[2]),K(se[3])}function j(O){s.push(l[3*O+0]),s.push(l[3*O+1]),s.push(l[3*O+2])}function K(O){a.push(O.x),a.push(O.y)}(function(){const O=s.length/3;if(d){let B=0,A=H*B;for(let k=0;k<Z;k++){const F=L[k];N(F[2]+A,F[1]+A,F[0]+A)}B=c+2*m,A=H*B;for(let k=0;k<Z;k++){const F=L[k];N(F[0]+A,F[1]+A,F[2]+A)}}else{for(let B=0;B<Z;B++){const A=L[B];N(A[2],A[1],A[0])}for(let B=0;B<Z;B++){const A=L[B];N(A[0]+H*c,A[1]+H*c,A[2]+H*c)}}r.addGroup(O,s.length/3-O,0)})(),function(){const O=s.length/3;let B=0;de(D,B),B+=D.length;for(let A=0,k=E.length;A<k;A++){const F=E[A];de(F,B),B+=F.length}r.addGroup(O,s.length/3-O,1)}()}this.setAttribute("position",new _e(s,3)),this.setAttribute("uv",new _e(a,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(t,r,s){if(s.shapes=[],Array.isArray(t))for(let a=0,n=t.length;a<n;a++){const o=t[a];s.shapes.push(o.uuid)}else s.shapes.push(t.uuid);return s.options=Object.assign({},r),r.extrudePath!==void 0&&(s.options.extrudePath=r.extrudePath.toJSON()),s}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let a=0,n=e.shapes.length;a<n;a++){const o=t[e.shapes[a]];r.push(o)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new Xu[s.type]().fromJSON(s)),new Pn(r,e.options)}}const YT={generateTopUV:function(i,e,t,r,s){const a=e[3*t],n=e[3*t+1],o=e[3*r],l=e[3*r+1],h=e[3*s],c=e[3*s+1];return[new X(a,n),new X(o,l),new X(h,c)]},generateSideWallUV:function(i,e,t,r,s,a){const n=e[3*t],o=e[3*t+1],l=e[3*t+2],h=e[3*r],c=e[3*r+1],u=e[3*r+2],d=e[3*s],p=e[3*s+1],f=e[3*s+2],v=e[3*a],m=e[3*a+1],g=e[3*a+2];return Math.abs(o-c)<Math.abs(n-h)?[new X(n,1-l),new X(h,1-u),new X(d,1-f),new X(v,1-g)]:[new X(o,1-l),new X(c,1-u),new X(p,1-f),new X(m,1-g)]}};class zd extends ba{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zd(e.radius,e.detail)}}class bs extends ba{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new bs(e.radius,e.detail)}}class Kh extends Re{constructor(e=.5,t=1,r=32,s=1,a=0,n=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:s,thetaStart:a,thetaLength:n},r=Math.max(3,r);const o=[],l=[],h=[],c=[];let u=e;const d=(t-e)/(s=Math.max(1,s)),p=new S,f=new X;for(let v=0;v<=s;v++){for(let m=0;m<=r;m++){const g=a+m/r*n;p.x=u*Math.cos(g),p.y=u*Math.sin(g),l.push(p.x,p.y,p.z),h.push(0,0,1),f.x=(p.x/t+1)/2,f.y=(p.y/t+1)/2,c.push(f.x,f.y)}u+=d}for(let v=0;v<s;v++){const m=v*(r+1);for(let g=0;g<r;g++){const _=g+m,y=_,x=_+r+1,M=_+r+2,b=_+1;o.push(y,x,b),o.push(x,M,b)}}this.setIndex(o),this.setAttribute("position",new _e(l,3)),this.setAttribute("normal",new _e(h,3)),this.setAttribute("uv",new _e(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Kh(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Vd extends Re{constructor(e=new oa([new X(0,.5),new X(-.5,-.5),new X(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],s=[],a=[],n=[];let o=0,l=0;if(Array.isArray(e)===!1)h(e);else for(let c=0;c<e.length;c++)h(e[c]),this.addGroup(o,l,c),o+=l,l=0;function h(c){const u=s.length/3,d=c.extractPoints(t);let p=d.shape;const f=d.holes;Ir.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,g=f.length;m<g;m++){const _=f[m];Ir.isClockWise(_)===!0&&(f[m]=_.reverse())}const v=Ir.triangulateShape(p,f);for(let m=0,g=f.length;m<g;m++){const _=f[m];p=p.concat(_)}for(let m=0,g=p.length;m<g;m++){const _=p[m];s.push(_.x,_.y,0),a.push(0,0,1),n.push(_.x,_.y)}for(let m=0,g=v.length;m<g;m++){const _=v[m],y=_[0]+u,x=_[1]+u,M=_[2]+u;r.push(y,x,M),l+=3}}this.setIndex(r),this.setAttribute("position",new _e(s,3)),this.setAttribute("normal",new _e(a,3)),this.setAttribute("uv",new _e(n,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(t,r){if(r.shapes=[],Array.isArray(t))for(let s=0,a=t.length;s<a;s++){const n=t[s];r.shapes.push(n.uuid)}else r.shapes.push(t.uuid);return r}(this.parameters.shapes,e)}static fromJSON(e,t){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const n=t[e.shapes[s]];r.push(n)}return new Vd(r,e.curveSegments)}}class Tn extends Re{constructor(e=1,t=32,r=16,s=0,a=2*Math.PI,n=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:s,phiLength:a,thetaStart:n,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(n+o,Math.PI);let h=0;const c=[],u=new S,d=new S,p=[],f=[],v=[],m=[];for(let g=0;g<=r;g++){const _=[],y=g/r;let x=0;g===0&&n===0?x=.5/t:g===r&&l===Math.PI&&(x=-.5/t);for(let M=0;M<=t;M++){const b=M/t;u.x=-e*Math.cos(s+b*a)*Math.sin(n+y*o),u.y=e*Math.cos(n+y*o),u.z=e*Math.sin(s+b*a)*Math.sin(n+y*o),f.push(u.x,u.y,u.z),d.copy(u).normalize(),v.push(d.x,d.y,d.z),m.push(b+x,1-y),_.push(h++)}c.push(_)}for(let g=0;g<r;g++)for(let _=0;_<t;_++){const y=c[g][_+1],x=c[g][_],M=c[g+1][_],b=c[g+1][_+1];(g!==0||n>0)&&p.push(y,x,b),(g!==r-1||l<Math.PI)&&p.push(x,M,b)}this.setIndex(p),this.setAttribute("position",new _e(f,3)),this.setAttribute("normal",new _e(v,3)),this.setAttribute("uv",new _e(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tn(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Hd extends ba{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Hd(e.radius,e.detail)}}class qr extends Re{constructor(e=1,t=.4,r=12,s=48,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:s,arc:a},r=Math.floor(r),s=Math.floor(s);const n=[],o=[],l=[],h=[],c=new S,u=new S,d=new S;for(let p=0;p<=r;p++)for(let f=0;f<=s;f++){const v=f/s*a,m=p/r*Math.PI*2;u.x=(e+t*Math.cos(m))*Math.cos(v),u.y=(e+t*Math.cos(m))*Math.sin(v),u.z=t*Math.sin(m),o.push(u.x,u.y,u.z),c.x=e*Math.cos(v),c.y=e*Math.sin(v),d.subVectors(u,c).normalize(),l.push(d.x,d.y,d.z),h.push(f/s),h.push(p/r)}for(let p=1;p<=r;p++)for(let f=1;f<=s;f++){const v=(s+1)*p+f-1,m=(s+1)*(p-1)+f-1,g=(s+1)*(p-1)+f,_=(s+1)*p+f;n.push(v,m,_),n.push(m,g,_)}this.setIndex(n),this.setAttribute("position",new _e(o,3)),this.setAttribute("normal",new _e(l,3)),this.setAttribute("uv",new _e(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new qr(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Gd extends Re{constructor(e=1,t=.4,r=64,s=8,a=2,n=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:s,p:a,q:n},r=Math.floor(r),s=Math.floor(s);const o=[],l=[],h=[],c=[],u=new S,d=new S,p=new S,f=new S,v=new S,m=new S,g=new S;for(let y=0;y<=r;++y){const x=y/r*a*Math.PI*2;_(x,a,n,e,p),_(x+.01,a,n,e,f),m.subVectors(f,p),g.addVectors(f,p),v.crossVectors(m,g),g.crossVectors(v,m),v.normalize(),g.normalize();for(let M=0;M<=s;++M){const b=M/s*Math.PI*2,w=-t*Math.cos(b),T=t*Math.sin(b);u.x=p.x+(w*g.x+T*v.x),u.y=p.y+(w*g.y+T*v.y),u.z=p.z+(w*g.z+T*v.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),h.push(d.x,d.y,d.z),c.push(y/r),c.push(M/s)}}for(let y=1;y<=r;y++)for(let x=1;x<=s;x++){const M=(s+1)*(y-1)+(x-1),b=(s+1)*y+(x-1),w=(s+1)*y+x,T=(s+1)*(y-1)+x;o.push(M,b,T),o.push(b,w,T)}function _(y,x,M,b,w){const T=Math.cos(y),R=Math.sin(y),I=M/x*y,E=Math.cos(I);w.x=b*(2+E)*.5*T,w.y=b*(2+E)*R*.5,w.z=b*Math.sin(I)*.5}this.setIndex(o),this.setAttribute("position",new _e(l,3)),this.setAttribute("normal",new _e(h,3)),this.setAttribute("uv",new _e(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Gd(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Cs extends Re{constructor(e=new Pg(new S(-1,-1,0),new S(-1,1,0),new S(1,1,0)),t=64,r=1,s=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:s,closed:a};const n=e.computeFrenetFrames(t,a);this.tangents=n.tangents,this.normals=n.normals,this.binormals=n.binormals;const o=new S,l=new S,h=new X;let c=new S;const u=[],d=[],p=[],f=[];function v(m){c=e.getPointAt(m/t,c);const g=n.normals[m],_=n.binormals[m];for(let y=0;y<=s;y++){const x=y/s*Math.PI*2,M=Math.sin(x),b=-Math.cos(x);l.x=b*g.x+M*_.x,l.y=b*g.y+M*_.y,l.z=b*g.z+M*_.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=c.x+r*l.x,o.y=c.y+r*l.y,o.z=c.z+r*l.z,u.push(o.x,o.y,o.z)}}(function(){for(let m=0;m<t;m++)v(m);v(a===!1?t:0),function(){for(let m=0;m<=t;m++)for(let g=0;g<=s;g++)h.x=m/t,h.y=g/s,p.push(h.x,h.y)}(),function(){for(let m=1;m<=t;m++)for(let g=1;g<=s;g++){const _=(s+1)*(m-1)+(g-1),y=(s+1)*m+(g-1),x=(s+1)*m+g,M=(s+1)*(m-1)+g;f.push(_,y,M),f.push(y,x,M)}}()})(),this.setIndex(f),this.setAttribute("position",new _e(u,3)),this.setAttribute("normal",new _e(d,3)),this.setAttribute("uv",new _e(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Cs(new Xu[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Lg extends Re{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,s=new S,a=new S;if(e.index!==null){const n=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let h=0,c=l.length;h<c;++h){const u=l[h],d=u.start;for(let p=d,f=d+u.count;p<f;p+=3)for(let v=0;v<3;v++){const m=o.getX(p+v),g=o.getX(p+(v+1)%3);s.fromBufferAttribute(n,m),a.fromBufferAttribute(n,g),i_(s,a,r)===!0&&(t.push(s.x,s.y,s.z),t.push(a.x,a.y,a.z))}}}else{const n=e.attributes.position;for(let o=0,l=n.count/3;o<l;o++)for(let h=0;h<3;h++){const c=3*o+h,u=3*o+(h+1)%3;s.fromBufferAttribute(n,c),a.fromBufferAttribute(n,u),i_(s,a,r)===!0&&(t.push(s.x,s.y,s.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new _e(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function i_(i,e,t){const r=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(r)!==!0&&t.has(s)!==!0&&(t.add(r),t.add(s),!0)}var r_=Object.freeze({__proto__:null,BoxGeometry:St,CapsuleGeometry:qh,CircleGeometry:Yh,ConeGeometry:Zh,CylinderGeometry:Rt,DodecahedronGeometry:kd,EdgesGeometry:a1,ExtrudeGeometry:Pn,IcosahedronGeometry:zd,LatheGeometry:Xh,OctahedronGeometry:bs,PlaneGeometry:as,PolyhedronGeometry:ba,RingGeometry:Kh,ShapeGeometry:Vd,SphereGeometry:Tn,TetrahedronGeometry:Hd,TorusGeometry:qr,TorusKnotGeometry:Gd,TubeGeometry:Cs,WireframeGeometry:Lg});class l1 extends Xt{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new oe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Ng extends tt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Go extends Xt{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new oe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yt,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ar extends Go{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new X(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Pt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new oe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new oe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new oe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class An extends Xt{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new oe(16777215),this.specular=new oe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yt,this.combine=Vh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Dg extends Xt{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new oe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class jd extends Xt{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Wd extends Xt{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new oe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new oe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yt,this.combine=Vh,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class h1 extends Xt{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new oe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new X(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class c1 extends Bt{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function ln(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function u1(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function d1(i){const e=i.length,t=new Array(e);for(let r=0;r!==e;++r)t[r]=r;return t.sort(function(r,s){return i[r]-i[s]}),t}function Af(i,e,t){const r=i.length,s=new i.constructor(r);for(let a=0,n=0;n!==r;++a){const o=t[a]*e;for(let l=0;l!==e;++l)s[n++]=i[o+l]}return s}function Og(i,e,t,r){let s=1,a=i[0];for(;a!==void 0&&a[r]===void 0;)a=i[s++];if(a===void 0)return;let n=a[r];if(n!==void 0)if(Array.isArray(n))do n=a[r],n!==void 0&&(e.push(a.time),t.push.apply(t,n)),a=i[s++];while(a!==void 0);else if(n.toArray!==void 0)do n=a[r],n!==void 0&&(e.push(a.time),n.toArray(t,t.length)),a=i[s++];while(a!==void 0);else do n=a[r],n!==void 0&&(e.push(a.time),t.push(n)),a=i[s++];while(a!==void 0)}const ZT={convertArray:ln,isTypedArray:u1,getKeyframeOrder:d1,sortedArray:Af,flattenJSON:Og,subclip:function(i,e,t,r,s=30){const a=i.clone();a.name=e;const n=[];for(let l=0;l<a.tracks.length;++l){const h=a.tracks[l],c=h.getValueSize(),u=[],d=[];for(let p=0;p<h.times.length;++p){const f=h.times[p]*s;if(!(f<t||f>=r)){u.push(h.times[p]);for(let v=0;v<c;++v)d.push(h.values[p*c+v])}}u.length!==0&&(h.times=ln(u,h.times.constructor),h.values=ln(d,h.values.constructor),n.push(h))}a.tracks=n;let o=1/0;for(let l=0;l<a.tracks.length;++l)o>a.tracks[l].times[0]&&(o=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*o);return a.resetDuration(),a},makeClipAdditive:function(i,e=0,t=i,r=30){r<=0&&(r=30);const s=t.tracks.length,a=e/r;for(let n=0;n<s;++n){const o=t.tracks[n],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const h=i.tracks.find(function(g){return g.name===o.name&&g.ValueTypeName===l});if(h===void 0)continue;let c=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);let d=0;const p=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let v;if(a<=o.times[0]){const g=c,_=u-c;v=o.values.slice(g,_)}else if(a>=o.times[f]){const g=f*u+c,_=g+u-c;v=o.values.slice(g,_)}else{const g=o.createInterpolant(),_=c,y=u-c;g.evaluate(a),v=g.resultBuffer.slice(_,y)}l==="quaternion"&&new Ke().fromArray(v).normalize().conjugate().toArray(v);const m=h.times.length;for(let g=0;g<m;++g){const _=g*p+d;if(l==="quaternion")Ke.multiplyQuaternionsFlat(h.values,_,v,0,h.values,_);else{const y=p-2*d;for(let x=0;x<y;++x)h.values[_+x]-=v[x]}}}return i.blendMode=yg,i}};class el{constructor(e,t,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,s=t[r],a=t[r-1];e:{t:{let n;i:{r:if(!(e<s)){for(let o=r+2;;){if(s===void 0){if(e<a)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(a=s,s=t[++r],e<s)break t}n=t.length;break i}if(e>=a)break e;{const o=t[1];e<o&&(r=2,a=o);for(let l=r-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(s=a,a=t[--r-1],e>=a)break t}n=r,r=0}}for(;r<n;){const o=r+n>>>1;e<t[o]?n=o:r=o+1}if(s=t[r],a=t[r-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,a,s)}return this.interpolate_(r,a,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s;for(let n=0;n!==s;++n)t[n]=r[a+n];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class p1 extends el{constructor(e,t,r,s){super(e,t,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:nn,endingEnd:nn}}intervalChanged_(e,t,r){const s=this.parameterPositions;let a=e-2,n=e+1,o=s[a],l=s[n];if(o===void 0)switch(this.getSettings_().endingStart){case on:a=e,o=2*t-r;break;case ah:a=s.length-2,o=t+s[a]-s[a+1];break;default:a=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case on:n=e,l=2*r-t;break;case ah:n=1,l=r+s[1]-s[0];break;default:n=e-1,l=t}const h=.5*(r-t),c=this.valueSize;this._weightPrev=h/(t-o),this._weightNext=h/(l-r),this._offsetPrev=a*c,this._offsetNext=n*c}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,c=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(r-t)/(s-t),v=f*f,m=v*f,g=-d*m+2*d*v-d*f,_=(1+d)*m+(-1.5-2*d)*v+(-.5+d)*f+1,y=(-1-p)*m+(1.5+p)*v+.5*f,x=p*m-p*v;for(let M=0;M!==o;++M)a[M]=g*n[c+M]+_*n[h+M]+y*n[l+M]+x*n[u+M];return a}}class Ug extends el{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,h=l-o,c=(r-t)/(s-t),u=1-c;for(let d=0;d!==o;++d)a[d]=n[h+d]*u+n[l+d]*c;return a}}class m1 extends el{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Lr{constructor(e,t,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=ln(t,this.TimeBufferType),this.values=ln(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:ln(e.times,Array),values:ln(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new m1(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Ug(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new p1(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Do:t=this.InterpolantFactoryMethodDiscrete;break;case Oo:t=this.InterpolantFactoryMethodLinear;break;case Ru:t=this.InterpolantFactoryMethodSmooth}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Do;case this.InterpolantFactoryMethodLinear:return Oo;case this.InterpolantFactoryMethodSmooth:return Ru}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,s=t.length;r!==s;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,s=t.length;r!==s;++r)t[r]*=e}return this}trim(e,t){const r=this.times,s=r.length;let a=0,n=s-1;for(;a!==s&&r[a]<e;)++a;for(;n!==-1&&r[n]>t;)--n;if(++n,a!==0||n!==s){a>=n&&(n=Math.max(n,1),a=n-1);const o=this.getValueSize();this.times=r.slice(a,n),this.values=this.values.slice(a*o,n*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(e=!1);const r=this.times,s=this.values,a=r.length;a===0&&(e=!1);let n=null;for(let o=0;o!==a;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){e=!1;break}if(n!==null&&n>l){e=!1;break}n=l}if(s!==void 0&&u1(s))for(let o=0,l=s.length;o!==l;++o){const h=s[o];if(isNaN(h)){e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),s=this.getInterpolation()===Ru,a=e.length-1;let n=1;for(let o=1;o<a;++o){let l=!1;const h=e[o];if(h!==e[o+1]&&(o!==1||h!==e[0]))if(s)l=!0;else{const c=o*r,u=c-r,d=c+r;for(let p=0;p!==r;++p){const f=t[c+p];if(f!==t[u+p]||f!==t[d+p]){l=!0;break}}}if(l){if(o!==n){e[n]=e[o];const c=o*r,u=n*r;for(let d=0;d!==r;++d)t[u+d]=t[c+d]}++n}}if(a>0){e[n]=e[a];for(let o=a*r,l=n*r,h=0;h!==r;++h)t[l+h]=t[o+h];++n}return n!==e.length?(this.times=e.slice(0,n),this.values=t.slice(0,n*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Lr.prototype.TimeBufferType=Float32Array,Lr.prototype.ValueBufferType=Float32Array,Lr.prototype.DefaultInterpolation=Oo;class tn extends Lr{constructor(e,t,r){super(e,t,r)}}tn.prototype.ValueTypeName="bool",tn.prototype.ValueBufferType=Array,tn.prototype.DefaultInterpolation=Do,tn.prototype.InterpolantFactoryMethodLinear=void 0,tn.prototype.InterpolantFactoryMethodSmooth=void 0;class Fg extends Lr{}Fg.prototype.ValueTypeName="color";class ga extends Lr{}ga.prototype.ValueTypeName="number";class f1 extends el{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=(r-t)/(s-t);let h=e*o;for(let c=h+o;h!==c;h+=4)Ke.slerpFlat(a,0,n,h-o,n,h,l);return a}}class Rs extends Lr{InterpolantFactoryMethodLinear(e){return new f1(this.times,this.values,this.getValueSize(),e)}}Rs.prototype.ValueTypeName="quaternion",Rs.prototype.InterpolantFactoryMethodSmooth=void 0;class rn extends Lr{constructor(e,t,r){super(e,t,r)}}rn.prototype.ValueTypeName="string",rn.prototype.ValueBufferType=Array,rn.prototype.DefaultInterpolation=Do,rn.prototype.InterpolantFactoryMethodLinear=void 0,rn.prototype.InterpolantFactoryMethodSmooth=void 0;class va extends Lr{}va.prototype.ValueTypeName="vector";class dn{constructor(e="",t=-1,r=[],s=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=s,this.uuid=rr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,s=1/(e.fps||1);for(let n=0,o=r.length;n!==o;++n)t.push(KT(r[n]).scale(s));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const t=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,n=r.length;a!==n;++a)t.push(Lr.toJSON(r[a]));return s}static CreateFromMorphTargetSequence(e,t,r,s){const a=t.length,n=[];for(let o=0;o<a;o++){let l=[],h=[];l.push((o+a-1)%a,o,(o+1)%a),h.push(0,1,0);const c=d1(l);l=Af(l,1,c),h=Af(h,1,c),s||l[0]!==0||(l.push(a),h.push(h[0])),n.push(new ga(".morphTargetInfluences["+t[o].name+"]",l,h).scale(1/r))}return new this(e,-1,n)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===t)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const s={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const h=e[o],c=h.name.match(a);if(c&&c.length>1){const u=c[1];let d=s[u];d||(s[u]=d=[]),d.push(h)}}const n=[];for(const o in s)n.push(this.CreateFromMorphTargetSequence(o,s[o],t,r));return n}static parseAnimation(e,t){if(!e)return null;const r=function(c,u,d,p,f){if(d.length!==0){const v=[],m=[];Og(d,v,m,p),v.length!==0&&f.push(new c(u,v,m))}},s=[],a=e.name||"default",n=e.fps||30,o=e.blendMode;let l=e.length||-1;const h=e.hierarchy||[];for(let c=0;c<h.length;c++){const u=h[c].keys;if(u&&u.length!==0)if(u[0].morphTargets){const d={};let p;for(p=0;p<u.length;p++)if(u[p].morphTargets)for(let f=0;f<u[p].morphTargets.length;f++)d[u[p].morphTargets[f]]=-1;for(const f in d){const v=[],m=[];for(let g=0;g!==u[p].morphTargets.length;++g){const _=u[p];v.push(_.time),m.push(_.morphTarget===f?1:0)}s.push(new ga(".morphTargetInfluence["+f+"]",v,m))}l=d.length*n}else{const d=".bones["+t[c].name+"]";r(va,d+".position",u,"pos",s),r(Rs,d+".quaternion",u,"rot",s),r(va,d+".scale",u,"scl",s)}}return s.length===0?null:new this(a,l,s,o)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const s=this.tracks[t];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function KT(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ga;case"vector":case"vector2":case"vector3":case"vector4":return va;case"color":return Fg;case"quaternion":return Rs;case"bool":case"boolean":return tn;case"string":return rn}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(i.type);if(i.times===void 0){const t=[],r=[];Og(i.keys,t,r,"value"),i.times=t,i.values=r}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const ws={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class Ef{constructor(e,t,r){const s=this;let a=!1,n=0,o=0,l;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(c){o++,a===!1&&s.onStart!==void 0&&s.onStart(c,n,o),a=!0},this.itemEnd=function(c){n++,s.onProgress!==void 0&&s.onProgress(c,n,o),n===o&&(a=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(c){s.onError!==void 0&&s.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,u){return h.push(c,u),this},this.removeHandler=function(c){const u=h.indexOf(c);return u!==-1&&h.splice(u,2),this},this.getHandler=function(c){for(let u=0,d=h.length;u<d;u+=2){const p=h[u],f=h[u+1];if(p.global&&(p.lastIndex=0),p.test(c))return f}return null}}}const kg=new Ef;class It{constructor(e){this.manager=e!==void 0?e:kg,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(s,a){r.load(e,s,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}It.DEFAULT_MATERIAL_NAME="__DEFAULT";const ds={};class QT extends Error{constructor(e,t){super(e),this.response=t}}class fi extends It{constructor(e){super(e)}load(e,t,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=ws.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(ds[e]!==void 0)return void ds[e].push({onLoad:t,onProgress:r,onError:s});ds[e]=[],ds[e].push({onLoad:t,onProgress:r,onError:s});const n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(n).then(h=>{if(h.status===200||h.status===0){if(h.status,typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const c=ds[e],u=h.body.getReader(),d=h.headers.get("X-File-Size")||h.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let v=0;const m=new ReadableStream({start(g){(function _(){u.read().then(({done:y,value:x})=>{if(y)g.close();else{v+=x.byteLength;const M=new ProgressEvent("progress",{lengthComputable:f,loaded:v,total:p});for(let b=0,w=c.length;b<w;b++){const T=c[b];T.onProgress&&T.onProgress(M)}g.enqueue(x),_()}},y=>{g.error(y)})})()}});return new Response(m)}throw new QT(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(l){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(c=>new DOMParser().parseFromString(c,o));case"json":return h.json();default:if(o===void 0)return h.text();{const c=/charset="?([^;"\s]*)"?/i.exec(o),u=c&&c[1]?c[1].toLowerCase():void 0,d=new TextDecoder(u);return h.arrayBuffer().then(p=>d.decode(p))}}}).then(h=>{ws.add(e,h);const c=ds[e];delete ds[e];for(let u=0,d=c.length;u<d;u++){const p=c[u];p.onLoad&&p.onLoad(h)}}).catch(h=>{const c=ds[e];if(c===void 0)throw this.manager.itemError(e),h;delete ds[e];for(let u=0,d=c.length;u<d;u++){const p=c[u];p.onError&&p.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ql extends It{constructor(e){super(e)}load(e,t,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,n=ws.get(e);if(n!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(n),a.manager.itemEnd(e)},0),n;const o=uh("img");function l(){c(),ws.add(e,this),t&&t(this),a.manager.itemEnd(e)}function h(u){c(),s&&s(u),a.manager.itemError(e),a.manager.itemEnd(e)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}class Cf extends It{constructor(e){super(e)}load(e,t,r,s){const a=new dh;a.colorSpace=ft;const n=new ql(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);let o=0;function l(h){n.load(e[h],function(c){a.images[h]=c,o++,o===6&&(a.needsUpdate=!0,t&&t(a))},void 0,s)}for(let h=0;h<e.length;++h)l(h);return a}}class is extends It{constructor(e){super(e)}load(e,t,r,s){const a=new pt,n=new ql(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(e,function(o){a.image=o,a.needsUpdate=!0,t!==void 0&&t(a)},r,s),a}}class Ls extends Ue{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new oe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class Rf extends Ls{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ue.DEFAULT_UP),this.updateMatrix(),this.groundColor=new oe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const jp=new me,s_=new S,a_=new S;class Bg{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new X(512,512),this.map=null,this.mapPass=null,this.matrix=new me,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Gh,this._frameExtents=new X(1,1),this._viewportCount=1,this._viewports=[new Ve(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;s_.setFromMatrixPosition(e.matrixWorld),t.position.copy(s_),a_.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(a_),t.updateMatrixWorld(),jp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jp),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(jp)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class JT extends Bg{constructor(){super(new Gt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*Uo*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;r===t.fov&&s===t.aspect&&a===t.far||(t.fov=r,t.aspect=s,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class gh extends Ls{constructor(e,t,r=0,s=Math.PI/3,a=0,n=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ue.DEFAULT_UP),this.updateMatrix(),this.target=new Ue,this.distance=r,this.angle=s,this.penumbra=a,this.decay=n,this.map=null,this.shadow=new JT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const n_=new me,vl=new S,Wp=new S;class $T extends Bg{constructor(){super(new Gt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new X(4,2),this._viewportCount=6,this._viewports=[new Ve(2,1,1,1),new Ve(0,1,1,1),new Ve(3,1,1,1),new Ve(1,1,1,1),new Ve(3,0,1,1),new Ve(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,s=this.matrix,a=e.distance||r.far;a!==r.far&&(r.far=a,r.updateProjectionMatrix()),vl.setFromMatrixPosition(e.matrixWorld),r.position.copy(vl),Wp.copy(r.position),Wp.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(Wp),r.updateMatrixWorld(),s.makeTranslation(-vl.x,-vl.y,-vl.z),n_.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n_)}}class jo extends Ls{constructor(e,t,r=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new $T}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class eA extends Bg{constructor(){super(new wn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class vh extends Ls{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ue.DEFAULT_UP),this.updateMatrix(),this.target=new Ue,this.shadow=new eA}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class qu extends Ls{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Pf extends Ls{constructor(e,t,r=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class g1{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new S)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,s=e.y,a=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*s),t.addScaledVector(n[2],.488603*a),t.addScaledVector(n[3],.488603*r),t.addScaledVector(n[4],r*s*1.092548),t.addScaledVector(n[5],s*a*1.092548),t.addScaledVector(n[6],.315392*(3*a*a-1)),t.addScaledVector(n[7],r*a*1.092548),t.addScaledVector(n[8],.546274*(r*r-s*s)),t}getIrradianceAt(e,t){const r=e.x,s=e.y,a=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*s),t.addScaledVector(n[2],1.023328*a),t.addScaledVector(n[3],1.023328*r),t.addScaledVector(n[4],.858086*r*s),t.addScaledVector(n[5],.858086*s*a),t.addScaledVector(n[6],.743125*a*a-.247708),t.addScaledVector(n[7],.858086*r*a),t.addScaledVector(n[8],.429043*(r*r-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const r=e.x,s=e.y,a=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*a,t[3]=.488603*r,t[4]=1.092548*r*s,t[5]=1.092548*s*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*r*a,t[8]=.546274*(r*r-s*s)}}class o_ extends Ls{constructor(e=new g1,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Yu extends It{constructor(e){super(e),this.textures={}}load(e,t,r,s){const a=this,n=new fi(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{t(a.parse(JSON.parse(o)))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}parse(e){const t=this.textures;function r(a){return t[a],t[a]}const s=Yu.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new oe().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const n=e.uniforms[a];switch(s.uniforms[a]={},n.type){case"t":s.uniforms[a].value=r(n.value);break;case"c":s.uniforms[a].value=new oe().setHex(n.value);break;case"v2":s.uniforms[a].value=new X().fromArray(n.value);break;case"v3":s.uniforms[a].value=new S().fromArray(n.value);break;case"v4":s.uniforms[a].value=new Ve().fromArray(n.value);break;case"m3":s.uniforms[a].value=new De().fromArray(n.value);break;case"m4":s.uniforms[a].value=new me().fromArray(n.value);break;default:s.uniforms[a].value=n.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)s.extensions[a]=e.extensions[a];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=r(e.map)),e.matcap!==void 0&&(s.matcap=r(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),s.normalScale=new X().fromArray(a)}return e.displacementMap!==void 0&&(s.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=r(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new X().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=r(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:l1,SpriteMaterial:Tg,RawShaderMaterial:Ng,ShaderMaterial:tt,PointsMaterial:Ks,MeshPhysicalMaterial:ar,MeshStandardMaterial:Go,MeshPhongMaterial:An,MeshToonMaterial:Dg,MeshNormalMaterial:jd,MeshLambertMaterial:Wd,MeshDepthMaterial:Od,MeshDistanceMaterial:Sg,MeshBasicMaterial:Wt,MeshMatcapMaterial:h1,LineDashedMaterial:c1,LineBasicMaterial:Bt,Material:Xt}[e]}}class Jr{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class zg extends Re{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class l_ extends It{constructor(e){super(e)}load(e,t,r,s){const a=this,n=new fi(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{t(a.parse(JSON.parse(o)))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}parse(e){const t={},r={};function s(u,d){if(t[d]!==void 0)return t[d];const p=u.interleavedBuffers[d],f=function(g,_){if(r[_]!==void 0)return r[_];const y=g.arrayBuffers,x=y[_],M=new Uint32Array(x).buffer;return r[_]=M,M}(u,p.buffer),v=oo(p.type,f),m=new Wh(v,p.stride);return m.uuid=p.uuid,t[d]=m,m}const a=e.isInstancedBufferGeometry?new zg:new Re,n=e.data.index;if(n!==void 0){const u=oo(n.type,n.array);a.setIndex(new Ze(u,1))}const o=e.data.attributes;for(const u in o){const d=o[u];let p;if(d.isInterleavedBufferAttribute){const f=s(e.data,d.data);p=new Bi(f,d.itemSize,d.offset,d.normalized)}else{const f=oo(d.type,d.array);p=new(d.isInstancedBufferAttribute?un:Ze)(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),a.setAttribute(u,p)}const l=e.data.morphAttributes;if(l)for(const u in l){const d=l[u],p=[];for(let f=0,v=d.length;f<v;f++){const m=d[f];let g;if(m.isInterleavedBufferAttribute){const _=s(e.data,m.data);g=new Bi(_,m.itemSize,m.offset,m.normalized)}else{const _=oo(m.type,m.array);g=new Ze(_,m.itemSize,m.normalized)}m.name!==void 0&&(g.name=m.name),p.push(g)}a.morphAttributes[u]=p}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let u=0,d=h.length;u!==d;++u){const p=h[u];a.addGroup(p.start,p.count,p.materialIndex)}const c=e.data.boundingSphere;if(c!==void 0){const u=new S;c.center!==void 0&&u.fromArray(c.center),a.boundingSphere=new ii(u,c.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}const tA={UVMapping:Cd,CubeReflectionMapping:Es,CubeRefractionMapping:da,EquirectangularReflectionMapping:Io,EquirectangularRefractionMapping:sh,CubeUVReflectionMapping:Jo},h_={RepeatWrapping:jt,ClampToEdgeWrapping:gi,MirroredRepeatWrapping:pa},c_={NearestFilter:nt,NearestMipmapNearestFilter:Rd,NearestMipmapLinearFilter:an,LinearFilter:Vt,LinearMipmapNearestFilter:_o,LinearMipmapLinearFilter:Qr};class v1 extends It{constructor(e){super(e),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,n=ws.get(e);if(n!==void 0)return a.manager.itemStart(e),n.then?void n.then(h=>{t&&t(h),a.manager.itemEnd(e)}).catch(h=>{s&&s(h)}):(setTimeout(function(){t&&t(n),a.manager.itemEnd(e)},0),n);const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(e,o).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(h){return ws.add(e,h),t&&t(h),a.manager.itemEnd(e),h}).catch(function(h){s&&s(h),ws.remove(e),a.manager.itemError(e),a.manager.itemEnd(e)});ws.add(e,l),a.manager.itemStart(e)}}let Wc;class Xp{static getContext(){return Wc===void 0&&(Wc=new(window.AudioContext||window.webkitAudioContext)),Wc}static setContext(e){Wc=e}}const u_=new me,d_=new me,Ua=new me;class _h{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=p_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=p_();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function p_(){return(typeof performance>"u"?Date:performance).now()}const Fa=new S,m_=new Ke,iA=new S,ka=new S;class f_ extends Ue{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0||this.hasPlaybackControl===!1)return;this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl!==!1&&this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Ba=new S,g_=new Ke,rA=new S,za=new S;class _1{constructor(e,t,r){let s,a,n;switch(this.binding=e,this.valueSize=r,t){case"quaternion":s=this._slerp,a=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":s=this._select,a=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:s=this._lerp,a=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=a,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,s=this.valueSize,a=e*s+s;let n=this.cumulativeWeight;if(n===0){for(let o=0;o!==s;++o)r[a+o]=r[o];n=t}else{n+=t;const o=t/n;this._mixBufferRegion(r,a,0,o,s)}this.cumulativeWeight=n}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,s=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,s=e*t+t,a=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const l=t*this._origIndex;this._mixBufferRegion(r,s,l,1-a,t)}n>0&&this._mixBufferRegionAdditive(r,s,this._addIndex*t,1,t);for(let l=t,h=t+t;l!==h;++l)if(r[l]!==r[l+t]){o.setValue(r,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,s=r*this._origIndex;e.getValue(t,s);for(let a=r,n=s;a!==n;++a)t[a]=t[s+a%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,s,a){if(s>=.5)for(let n=0;n!==a;++n)e[t+n]=e[r+n]}_slerp(e,t,r,s){Ke.slerpFlat(e,t,e,t,e,r,s)}_slerpAdditive(e,t,r,s,a){const n=this._workIndex*a;Ke.multiplyQuaternionsFlat(e,n,e,t,e,r),Ke.slerpFlat(e,t,e,t,e,n,s)}_lerp(e,t,r,s,a){const n=1-s;for(let o=0;o!==a;++o){const l=t+o;e[l]=e[l]*n+e[r+o]*s}}_lerpAdditive(e,t,r,s,a){for(let n=0;n!==a;++n){const o=t+n;e[o]=e[o]+e[r+n]*s}}}const Vg="\\[\\]\\.:\\/",sA=new RegExp("["+Vg+"]","g"),qp="[^"+Vg+"]",aA="[^"+Vg.replace("\\.","")+"]",nA=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",qp)+/(WCOD+)?/.source.replace("WCOD",aA)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qp)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qp)+"$"),oA=["material","materials","bones","map"];class qe{constructor(e,t,r){this.path=t,this.parsedPath=r||qe.parseTrackName(t),this.node=qe.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new qe.Composite(e,t,r):new qe(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(sA,"")}static parseTrackName(e){const t=nA.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const a=r.nodeName.substring(s+1);oA.indexOf(a)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=a)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(a){for(let n=0;n<a.length;n++){const o=a[n];if(o.name===t||o.uuid===t)return o;const l=r(o.children);if(l)return l}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)e[t++]=r[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,s=t.propertyName;let a=t.propertyIndex;if(e||(e=qe.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(r){let h=t.objectIndex;switch(r){case"materials":if(!e.material||!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===h){h=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material||!e.material.map)return;e=e.material.map;break;default:if(e[r]===void 0)return;e=e[r]}if(h!==void 0){if(e[h]===void 0)return;e=e[h]}}const n=e[s];if(n===void 0){t.nodeName;return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(a!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry||!e.geometry.morphAttributes)return;e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=a}else n.fromArray!==void 0&&n.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(l=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}qe.Composite=class{constructor(i,e,t){const r=t||qe.parseTrackName(e);this._targetGroup=i,this._bindings=i.subscribe_(e,r)}getValue(i,e){this.bind();const t=this._targetGroup.nCachedObjects_,r=this._bindings[t];r!==void 0&&r.getValue(i,e)}setValue(i,e){const t=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=t.length;r!==s;++r)t[r].setValue(i,e)}bind(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].bind()}unbind(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].unbind()}},qe.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},qe.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},qe.prototype.GetterByBindingType=[qe.prototype._getValue_direct,qe.prototype._getValue_array,qe.prototype._getValue_arrayElement,qe.prototype._getValue_toArray],qe.prototype.SetterByBindingTypeAndVersioning=[[qe.prototype._setValue_direct,qe.prototype._setValue_direct_setNeedsUpdate,qe.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[qe.prototype._setValue_array,qe.prototype._setValue_array_setNeedsUpdate,qe.prototype._setValue_array_setMatrixWorldNeedsUpdate],[qe.prototype._setValue_arrayElement,qe.prototype._setValue_arrayElement_setNeedsUpdate,qe.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[qe.prototype._setValue_fromArray,qe.prototype._setValue_fromArray_setNeedsUpdate,qe.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class y1{constructor(e,t,r=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=s;const a=t.tracks,n=a.length,o=new Array(n),l={endingStart:nn,endingEnd:nn};for(let h=0;h!==n;++h){const c=a[h].createInterpolant(null);o[h]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=_g,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const s=this._clip.duration,a=e._clip.duration,n=a/s,o=s/a;e.warp(1,n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const s=this._mixer,a=s.time,n=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,h=o.sampleValues;return l[0]=a,l[1]=a+r,h[0]=e/n,h[1]=t/n,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,s){if(!this.enabled)return void this._updateWeight(e);const a=this._startTime;if(a!==null){const l=(e-a)*r;l<0||r===0?t=0:(this._startTime=null,t=r*l)}t*=this._updateTimeScale(e);const n=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,h=this._propertyBindings;if(this.blendMode===yg)for(let c=0,u=l.length;c!==u;++c)l[c].evaluate(n),h[c].accumulateAdditive(o);else for(let c=0,u=l.length;c!==u;++c)l[c].evaluate(n),h[c].accumulate(s,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const s=r.evaluate(e)[0];t*=s,e>r.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;r!==null&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let s=this.time+e,a=this._loopCount;const n=r===2202;if(e===0)return a===-1||!n||1&~a?s:t-s;if(r===vg){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),s>=t||s<0){const o=Math.floor(s/t);s-=t*o,a+=Math.abs(o);const l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const h=e<0;this._setEndings(h,!h,n)}else this._setEndings(!1,!1,n);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(n&&!(1&~a))return t-s}return s}_setEndings(e,t,r){const s=this._interpolantSettings;r?(s.endingStart=on,s.endingEnd=on):(s.endingStart=e?this.zeroSlopeAtStart?on:nn:ah,s.endingEnd=t?this.zeroSlopeAtEnd?on:nn:ah)}_scheduleFading(e,t,r){const s=this._mixer,a=s.time;let n=this._weightInterpolant;n===null&&(n=s._lendControlInterpolant(),this._weightInterpolant=n);const o=n.parameterPositions,l=n.sampleValues;return o[0]=a,l[0]=t,o[1]=a+e,l[1]=r,this}}const lA=new Float32Array(1);class x1 extends ts{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,s=e._clip.tracks,a=s.length,n=e._propertyBindings,o=e._interpolants,l=r.uuid,h=this._bindingsByRootAndName;let c=h[l];c===void 0&&(c={},h[l]=c);for(let u=0;u!==a;++u){const d=s[u],p=d.name;let f=c[p];if(f!==void 0)++f.referenceCount,n[u]=f;else{if(f=n[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const v=t&&t._propertyBindings[u].binding.parsedPath;f=new _1(qe.create(r,p,v),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),n[u]=f}o[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,s=e._clip.uuid,a=this._actionsByClip[s];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,s,r)}const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];a.useCount++==0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];--a.useCount==0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const s=this._actions,a=this._actionsByClip;let n=a[t];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=n;else{const o=n.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=s.length,s.push(e),n.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],s=e._cacheIndex;r._cacheIndex=s,t[s]=r,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,n=this._actionsByClip,o=n[a],l=o.knownActions,h=l[l.length-1],c=e._byClipCacheIndex;h._byClipCacheIndex=c,l[c]=h,l.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],l.length===0&&delete n[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];--a.referenceCount==0&&this._removeInactiveBinding(a)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,s=this._nActiveActions++,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,s=--this._nActiveActions,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_addInactiveBinding(e,t,r){const s=this._bindingsByRootAndName,a=this._bindings;let n=s[t];n===void 0&&(n={},s[t]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,s=r.rootNode.uuid,a=r.path,n=this._bindingsByRootAndName,o=n[s],l=t[t.length-1],h=e._cacheIndex;l._cacheIndex=h,t[h]=l,t.pop(),delete o[a],Object.keys(o).length===0&&delete n[s]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,s=this._nActiveBindings++,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,s=--this._nActiveBindings,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new Ug(new Float32Array(2),new Float32Array(2),1,lA),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,s=--this._nActiveControlInterpolants,a=t[s];e.__cacheIndex=s,t[s]=e,a.__cacheIndex=r,t[r]=a}clipAction(e,t,r){const s=t||this._root,a=s.uuid;let n=typeof e=="string"?dn.findByName(s,e):e;const o=n!==null?n.uuid:e,l=this._actionsByClip[o];let h=null;if(r===void 0&&(r=n!==null?n.blendMode:Ox),l!==void 0){const u=l.actionByRoot[a];if(u!==void 0&&u.blendMode===r)return u;h=l.knownActions[0],n===null&&(n=h._clip)}if(n===null)return null;const c=new y1(this,n,t,r);return this._bindAction(c,h),this._addInactiveAction(c,o,a),c}existingAction(e,t){const r=t||this._root,s=r.uuid,a=typeof e=="string"?dn.findByName(r,e):e,n=a?a.uuid:e,o=this._actionsByClip[n];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,s=this.time+=e,a=Math.sign(e),n=this._accuIndex^=1;for(let h=0;h!==r;++h)t[h]._update(s,e,a,n);const o=this._bindings,l=this._nActiveBindings;for(let h=0;h!==l;++h)o[h].apply(n);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,s=this._actionsByClip,a=s[r];if(a!==void 0){const n=a.knownActions;for(let o=0,l=n.length;o!==l;++o){const h=n[o];this._deactivateAction(h);const c=h._cacheIndex,u=t[t.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(h)}delete s[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const a in r){const n=r[a].actionByRoot[t];n!==void 0&&(this._deactivateAction(n),this._removeInactiveAction(n))}const s=this._bindingsByRootAndName[t];if(s!==void 0)for(const a in s){const n=s[a];n.restoreOriginalState(),this._removeInactiveBinding(n)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Hg{constructor(e){this.value=e}clone(){return new Hg(this.value.clone===void 0?this.value:this.value.clone())}}let hA=0;class Zu extends Wh{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const v_=new me;class Xd{constructor(e,t,r=0,s=1/0){this.ray=new Rn(e,t),this.near=r,this.far=s,this.camera=null,this.layers=new Id,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)}setFromXRController(e){return v_.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(v_),this}intersectObject(e,t=!0,r=[]){return If(e,this,r,t),r.sort(__),r}intersectObjects(e,t=!0,r=[]){for(let s=0,a=e.length;s<a;s++)If(e[s],this,r,t);return r.sort(__),r}}function __(i,e){return i.distance-e.distance}function If(i,e,t,r){let s=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(s=!1),s===!0&&r===!0){const a=i.children;for(let n=0,o=a.length;n<o;n++)If(a[n],e,t,!0)}}class Lf{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Pt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const y_=new X,x_=new S,Xc=new S;class M1{constructor(e=new S,t=new S){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){x_.subVectors(e,this.start),Xc.subVectors(this.end,this.start);const r=Xc.dot(Xc);let s=Xc.dot(x_)/r;return t&&(s=Pt(s,0,1)),s}closestPointToPoint(e,t,r){const s=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const M_=new S,Gs=new S,qc=new me,Yp=new me;function b1(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,b1(i.children[t]));return e}const cA=new S,b_=new oe,w_=new oe;class w1 extends Yi{constructor(e=10,t=10,r=4473924,s=8947848){r=new oe(r),s=new oe(s);const a=t/2,n=e/t,o=e/2,l=[],h=[];for(let u=0,d=0,p=-o;u<=t;u++,p+=n){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);const f=u===a?r:s;f.toArray(h,d),d+=3,f.toArray(h,d),d+=3,f.toArray(h,d),d+=3,f.toArray(h,d),d+=3}const c=new Re;c.setAttribute("position",new _e(l,3)),c.setAttribute("color",new _e(h,3)),super(c,new Bt({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const S_=new S,Yc=new S,T_=new S,Zc=new S,Ct=new Nd;function Ut(i,e,t,r,s,a,n){Zc.set(s,a,n).unproject(r);const o=e[i];if(o!==void 0){const l=t.getAttribute("position");for(let h=0,c=o.length;h<c;h++)l.setXYZ(o[h],Zc.x,Zc.y,Zc.z)}}const Kc=new vt;class S1 extends Yi{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Re;s.setIndex(new Ze(r,1)),s.setAttribute("position",new _e([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(s,new Bt({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class T1 extends oi{constructor(e,t=1,r=16776960){const s=r,a=new Re;a.setAttribute("position",new _e([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),a.computeBoundingSphere(),super(a,new Bt({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const n=new Re;n.setAttribute("position",new _e([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new ue(n,new Wt({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const A_=new S;let Qc,Zp;class A1 extends Yi{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Re;r.setAttribute("position",new _e(t,3)),r.setAttribute("color",new _e([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Bt({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const s=new oe,a=this.geometry.attributes.color.array;return s.set(e),s.toArray(a,0),s.toArray(a,3),s.set(t),s.toArray(a,6),s.toArray(a,9),s.set(r),s.toArray(a,12),s.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class E1{constructor(){this.type="ShapePath",this.color=new oe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ho,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,s){return this.currentPath.quadraticCurveTo(e,t,r,s),this}bezierCurveTo(e,t,r,s,a,n){return this.currentPath.bezierCurveTo(e,t,r,s,a,n),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(m,g){const _=g.length;let y=!1;for(let x=_-1,M=0;M<_;x=M++){let b=g[x],w=g[M],T=w.x-b.x,R=w.y-b.y;if(Math.abs(R)>Number.EPSILON){if(R<0&&(b=g[M],T=-T,w=g[x],R=-R),m.y<b.y||m.y>w.y)continue;if(m.y===b.y){if(m.x===b.x)return!0}else{const I=R*(m.x-b.x)-T*(m.y-b.y);if(I===0)return!0;if(I<0)continue;y=!y}}else{if(m.y!==b.y)continue;if(w.x<=m.x&&m.x<=b.x||b.x<=m.x&&m.x<=w.x)return!0}}return y}const r=Ir.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,n,o;const l=[];if(s.length===1)return n=s[0],o=new oa,o.curves=n.curves,l.push(o),l;let h=!r(s[0].getPoints());h=e?!h:h;const c=[],u=[];let d,p,f=[],v=0;u[v]=void 0,f[v]=[];for(let m=0,g=s.length;m<g;m++)n=s[m],d=n.getPoints(),a=r(d),a=e?!a:a,a?(!h&&u[v]&&v++,u[v]={s:new oa,p:d},u[v].s.curves=n.curves,h&&v++,f[v]=[]):f[v].push({h:n,p:d[0]});if(!u[0])return function(m){const g=[];for(let _=0,y=m.length;_<y;_++){const x=m[_],M=new oa;M.curves=x.curves,g.push(M)}return g}(s);if(u.length>1){let m=!1,g=0;for(let _=0,y=u.length;_<y;_++)c[_]=[];for(let _=0,y=u.length;_<y;_++){const x=f[_];for(let M=0;M<x.length;M++){const b=x[M];let w=!0;for(let T=0;T<u.length;T++)t(b.p,u[T].p)&&(_!==T&&g++,w?(w=!1,c[T].push(b)):m=!0);w&&c[_].push(b)}}g>0&&m===!1&&(f=c)}for(let m=0,g=u.length;m<g;m++){o=u[m].s,l.push(o),p=f[m];for(let _=0,y=p.length;_<y;_++)o.holes.push(p[_].h)}return l}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Vu}})),typeof window<"u"&&(window.__THREE__||(window.__THREE__=Vu));const T3=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Ad,AddEquation:Ji,AddOperation:Nx,AdditiveAnimationBlendMode:yg,AdditiveBlending:As,AgXToneMapping:Ed,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:qu,AnimationAction:y1,AnimationClip:dn,AnimationLoader:class extends It{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new fi(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(n){try{e(s.parse(JSON.parse(n)))}catch(o){r&&r(o),s.manager.itemError(i)}},t,r)}parse(i){const e=[];for(let t=0;t<i.length;t++){const r=dn.parse(i[t]);e.push(r)}return e}},AnimationMixer:x1,AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=rr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let t=0,r=arguments.length;t!==r;++t)i[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const i=this._objects,e=this._indicesByUUID,t=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length;let n=i.length,o=this.nCachedObjects_;for(let l=0,h=arguments.length;l!==h;++l){const c=arguments[l],u=c.uuid;let d=e[u];if(d===void 0){d=n++,e[u]=d,i.push(c);for(let p=0,f=a;p!==f;++p)s[p].push(new qe(c,t[p],r[p]))}else if(d<o){i[d];const p=--o,f=i[p];e[f.uuid]=d,i[d]=f,e[u]=p,i[p]=c;for(let v=0,m=a;v!==m;++v){const g=s[v],_=g[p];let y=g[d];g[d]=_,y===void 0&&(y=new qe(c,t[v],r[v])),g[p]=y}}else i[d]}this.nCachedObjects_=o}remove(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,r=t.length;let s=this.nCachedObjects_;for(let a=0,n=arguments.length;a!==n;++a){const o=arguments[a],l=o.uuid,h=e[l];if(h!==void 0&&h>=s){const c=s++,u=i[c];e[u.uuid]=h,i[h]=u,e[l]=c,i[c]=o;for(let d=0,p=r;d!==p;++d){const f=t[d],v=f[c],m=f[h];f[h]=v,f[c]=m}}}this.nCachedObjects_=s}uncache(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,r=t.length;let s=this.nCachedObjects_,a=i.length;for(let n=0,o=arguments.length;n!==o;++n){const l=arguments[n].uuid,h=e[l];if(h!==void 0)if(delete e[l],h<s){const c=--s,u=i[c],d=--a,p=i[d];e[u.uuid]=h,i[h]=u,e[p.uuid]=c,i[c]=p,i.pop();for(let f=0,v=r;f!==v;++f){const m=t[f],g=m[c],_=m[d];m[h]=g,m[c]=_,m.pop()}}else{const c=--a,u=i[c];c>0&&(e[u.uuid]=h),i[h]=u,i.pop();for(let d=0,p=r;d!==p;++d){const f=t[d];f[h]=f[c],f.pop()}}}this.nCachedObjects_=s}subscribe_(i,e){const t=this._bindingsIndicesByPath;let r=t[i];const s=this._bindings;if(r!==void 0)return s[r];const a=this._paths,n=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);r=s.length,t[i]=r,a.push(i),n.push(e),s.push(c);for(let u=h,d=o.length;u!==d;++u){const p=o[u];c[u]=new qe(p,i,e)}return c}unsubscribe_(i){const e=this._bindingsIndicesByPath,t=e[i];if(t!==void 0){const r=this._paths,s=this._parsedPaths,a=this._bindings,n=a.length-1,o=a[n];e[i[n]]=t,a[t]=o,a.pop(),s[t]=s[n],s.pop(),r[t]=r[n],r.pop()}}},AnimationUtils:ZT,ArcCurve:t1,ArrayCamera:Qx,ArrowHelper:class extends Ue{constructor(i=new S(0,0,1),e=new S(0,0,0),t=1,r=16776960,s=.2*t,a=.2*s){super(),this.type="ArrowHelper",Qc===void 0&&(Qc=new Re,Qc.setAttribute("position",new _e([0,0,0,0,1,0],3)),Zp=new Rt(0,.5,1,5,1),Zp.translate(0,-.5,0)),this.position.copy(e),this.line=new oi(Qc,new Bt({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ue(Zp,new Wt({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(t,s,a)}setDirection(i){if(i.y>.99999)this.quaternion.set(0,0,0,1);else if(i.y<-.99999)this.quaternion.set(1,0,0,0);else{A_.set(i.z,0,-i.x).normalize();const e=Math.acos(i.y);this.quaternion.setFromAxisAngle(A_,e)}}setLength(i,e=.2*i,t=.2*e){this.line.scale.set(1,Math.max(1e-4,i-e),1),this.line.updateMatrix(),this.cone.scale.set(t,e,t),this.cone.position.y=i,this.cone.updateMatrix()}setColor(i){this.line.material.color.set(i),this.cone.material.color.set(i)}copy(i){return super.copy(i,!1),this.line.copy(i.line),this.cone.copy(i.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:Vm,Audio:f_,AudioAnalyser:class{constructor(i,e=2048){this.analyser=i.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),i.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let i=0;const e=this.getFrequencyData();for(let t=0;t<e.length;t++)i+=e[t];return i/e.length}},AudioContext:Xp,AudioListener:class extends Ue{constructor(){super(),this.type="AudioListener",this.context=Xp.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _h}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(i){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=i,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}updateMatrixWorld(i){super.updateMatrixWorld(i);const e=this.context.listener,t=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Fa,m_,iA),ka.set(0,0,-1).applyQuaternion(m_),e.positionX){const r=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Fa.x,r),e.positionY.linearRampToValueAtTime(Fa.y,r),e.positionZ.linearRampToValueAtTime(Fa.z,r),e.forwardX.linearRampToValueAtTime(ka.x,r),e.forwardY.linearRampToValueAtTime(ka.y,r),e.forwardZ.linearRampToValueAtTime(ka.z,r),e.upX.linearRampToValueAtTime(t.x,r),e.upY.linearRampToValueAtTime(t.y,r),e.upZ.linearRampToValueAtTime(t.z,r)}else e.setPosition(Fa.x,Fa.y,Fa.z),e.setOrientation(ka.x,ka.y,ka.z,t.x,t.y,t.z)}},AudioLoader:class extends It{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new fi(this.manager);function n(o){r&&r(o),s.manager.itemError(i)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(o){try{const l=o.slice(0);Xp.getContext().decodeAudioData(l,function(h){e(h)}).catch(n)}catch(l){n(l)}},t,r)}},AxesHelper:A1,BackSide:Si,BasicDepthPacking:3200,BasicShadowMap:0,BatchedMesh:jv,Bone:zo,BooleanKeyframeTrack:tn,Box2:class{constructor(i=new X(1/0,1/0),e=new X(-1/0,-1/0)){this.isBox2=!0,this.min=i,this.max=e}set(i,e){return this.min.copy(i),this.max.copy(e),this}setFromPoints(i){this.makeEmpty();for(let e=0,t=i.length;e<t;e++)this.expandByPoint(i[e]);return this}setFromCenterAndSize(i,e){const t=y_.copy(e).multiplyScalar(.5);return this.min.copy(i).sub(t),this.max.copy(i).add(t),this}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(i){return this.isEmpty()?i.set(0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y}getParameter(i,e){return e.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y)}clampPoint(i,e){return e.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return this.clampPoint(i,y_).distanceTo(i)}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}},Box3:vt,Box3Helper:S1,BoxGeometry:St,BoxHelper:class extends Yi{constructor(i,e=16776960){const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new Re;s.setIndex(new Ze(t,1)),s.setAttribute("position",new Ze(r,3)),super(s,new Bt({color:e,toneMapped:!1})),this.object=i,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(i){if(this.object!==void 0&&Kc.setFromObject(this.object),Kc.isEmpty())return;const e=Kc.min,t=Kc.max,r=this.geometry.attributes.position,s=r.array;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=e.x,s[7]=e.y,s[8]=t.z,s[9]=t.x,s[10]=e.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=e.z,s[15]=e.x,s[16]=t.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=t.x,s[22]=e.y,s[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(i){return this.object=i,this.update(),this}copy(i,e){return super.copy(i,e),this.object=i.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:Ze,BufferGeometry:Re,BufferGeometryLoader:l_,ByteType:1010,Cache:ws,Camera:Nd,CameraHelper:class extends Yi{constructor(i){const e=new Re,t=new Bt({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};function n(p,f){o(p),o(f)}function o(p){r.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(r.length/3-1)}n("n1","n2"),n("n2","n4"),n("n4","n3"),n("n3","n1"),n("f1","f2"),n("f2","f4"),n("f4","f3"),n("f3","f1"),n("n1","f1"),n("n2","f2"),n("n3","f3"),n("n4","f4"),n("p","n1"),n("p","n2"),n("p","n3"),n("p","n4"),n("u1","u2"),n("u2","u3"),n("u3","u1"),n("c","t"),n("p","c"),n("cn1","cn2"),n("cn3","cn4"),n("cf1","cf2"),n("cf3","cf4"),e.setAttribute("position",new _e(r,3)),e.setAttribute("color",new _e(s,3)),super(e,t),this.type="CameraHelper",this.camera=i,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new oe(16755200),h=new oe(16711680),c=new oe(43775),u=new oe(16777215),d=new oe(3355443);this.setColors(l,h,c,u,d)}setColors(i,e,t,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,i.r,i.g,i.b),a.setXYZ(1,i.r,i.g,i.b),a.setXYZ(2,i.r,i.g,i.b),a.setXYZ(3,i.r,i.g,i.b),a.setXYZ(4,i.r,i.g,i.b),a.setXYZ(5,i.r,i.g,i.b),a.setXYZ(6,i.r,i.g,i.b),a.setXYZ(7,i.r,i.g,i.b),a.setXYZ(8,i.r,i.g,i.b),a.setXYZ(9,i.r,i.g,i.b),a.setXYZ(10,i.r,i.g,i.b),a.setXYZ(11,i.r,i.g,i.b),a.setXYZ(12,i.r,i.g,i.b),a.setXYZ(13,i.r,i.g,i.b),a.setXYZ(14,i.r,i.g,i.b),a.setXYZ(15,i.r,i.g,i.b),a.setXYZ(16,i.r,i.g,i.b),a.setXYZ(17,i.r,i.g,i.b),a.setXYZ(18,i.r,i.g,i.b),a.setXYZ(19,i.r,i.g,i.b),a.setXYZ(20,i.r,i.g,i.b),a.setXYZ(21,i.r,i.g,i.b),a.setXYZ(22,i.r,i.g,i.b),a.setXYZ(23,i.r,i.g,i.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,t.r,t.g,t.b),a.setXYZ(33,t.r,t.g,t.b),a.setXYZ(34,t.r,t.g,t.b),a.setXYZ(35,t.r,t.g,t.b),a.setXYZ(36,t.r,t.g,t.b),a.setXYZ(37,t.r,t.g,t.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const i=this.geometry,e=this.pointMap;Ct.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ut("c",e,i,Ct,0,0,-1),Ut("t",e,i,Ct,0,0,1),Ut("n1",e,i,Ct,-1,-1,-1),Ut("n2",e,i,Ct,1,-1,-1),Ut("n3",e,i,Ct,-1,1,-1),Ut("n4",e,i,Ct,1,1,-1),Ut("f1",e,i,Ct,-1,-1,1),Ut("f2",e,i,Ct,1,-1,1),Ut("f3",e,i,Ct,-1,1,1),Ut("f4",e,i,Ct,1,1,1),Ut("u1",e,i,Ct,.7,1.1,-1),Ut("u2",e,i,Ct,-.7,1.1,-1),Ut("u3",e,i,Ct,0,2,-1),Ut("cf1",e,i,Ct,-1,0,1),Ut("cf2",e,i,Ct,1,0,1),Ut("cf3",e,i,Ct,0,-1,1),Ut("cf4",e,i,Ct,0,1,1),Ut("cn1",e,i,Ct,-1,0,-1),Ut("cn2",e,i,Ct,1,0,-1),Ut("cn3",e,i,Ct,0,-1,-1),Ut("cn4",e,i,Ct,0,1,-1),i.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:FT,CapsuleGeometry:qh,CatmullRomCurve3:Fd,CineonToneMapping:Td,CircleGeometry:Yh,ClampToEdgeWrapping:gi,Clock:_h,Color:oe,ColorKeyframeTrack:Fg,ColorManagement:rt,CompressedArrayTexture:class extends kc{constructor(i,e,t,r,s,a){super(i,e,t,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=gi,this.layerUpdates=new Set}addLayerUpdates(i){this.layerUpdates.add(i)}clearLayerUpdates(){this.layerUpdates.clear()}},CompressedCubeTexture:class extends kc{constructor(i,e,t){super(void 0,i[0].width,i[0].height,e,t,Es),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=i}},CompressedTexture:kc,CompressedTextureLoader:class extends It{constructor(i){super(i)}load(i,e,t,r){const s=this,a=[],n=new kc,o=new fi(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials);let l=0;function h(c){o.load(i[c],function(u){const d=s.parse(u,!0);a[c]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},l+=1,l===6&&(d.mipmapCount===1&&(n.minFilter=Vt),n.image=a,n.format=d.format,n.needsUpdate=!0,e&&e(n))},t,r)}if(Array.isArray(i))for(let c=0,u=i.length;c<u;++c)h(c);else o.load(i,function(c){const u=s.parse(c,!0);if(u.isCubemap){const d=u.mipmaps.length/u.mipmapCount;for(let p=0;p<d;p++){a[p]={mipmaps:[]};for(let f=0;f<u.mipmapCount;f++)a[p].mipmaps.push(u.mipmaps[p*u.mipmapCount+f]),a[p].format=u.format,a[p].width=u.width,a[p].height=u.height}n.image=a}else n.image.width=u.width,n.image.height=u.height,n.mipmaps=u.mipmaps;u.mipmapCount===1&&(n.minFilter=Vt),n.format=u.format,n.needsUpdate=!0,e&&e(n)},t,r);return n}},ConeGeometry:Zh,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeCamera:Hx,CubeReflectionMapping:Es,CubeRefractionMapping:da,CubeTexture:dh,CubeTextureLoader:Cf,CubeUVReflectionMapping:Jo,CubicBezierCurve:Eg,CubicBezierCurve3:i1,CubicInterpolant:p1,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:_r,CurvePath:s1,CustomBlending:Ro,CustomToneMapping:lg,CylinderGeometry:Rt,Cylindrical:class{constructor(i=1,e=0,t=0){return this.radius=i,this.theta=e,this.y=t,this}set(i,e,t){return this.radius=i,this.theta=e,this.y=t,this}copy(i){return this.radius=i.radius,this.theta=i.theta,this.y=i.y,this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,e,t){return this.radius=Math.sqrt(i*i+t*t),this.theta=Math.atan2(i,t),this.y=e,this}clone(){return new this.constructor().copy(this)}},Data3DTexture:vf,DataArrayTexture:Hu,DataTexture:Ms,DataTextureLoader:class extends It{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new Ms,n=new fi(this.manager);return n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setPath(this.path),n.setWithCredentials(s.withCredentials),n.load(i,function(o){let l;try{l=s.parse(o)}catch(h){if(r===void 0)return;r(h)}l.image!==void 0?a.image=l.image:l.data!==void 0&&(a.image.width=l.width,a.image.height=l.height,a.image.data=l.data),a.wrapS=l.wrapS!==void 0?l.wrapS:gi,a.wrapT=l.wrapT!==void 0?l.wrapT:gi,a.magFilter=l.magFilter!==void 0?l.magFilter:Vt,a.minFilter=l.minFilter!==void 0?l.minFilter:Vt,a.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0&&(a.colorSpace=l.colorSpace),l.flipY!==void 0&&(a.flipY=l.flipY),l.format!==void 0&&(a.format=l.format),l.type!==void 0&&(a.type=l.type),l.mipmaps!==void 0&&(a.mipmaps=l.mipmaps,a.minFilter=Qr),l.mipmapCount===1&&(a.minFilter=Vt),l.generateMipmaps!==void 0&&(a.generateMipmaps=l.generateMipmaps),a.needsUpdate=!0,e&&e(a,l)},t,r),a}},DataUtils:Gw,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:kg,DepthFormat:No,DepthStencilFormat:fa,DepthTexture:jh,DetachedBindMode:Dx,DirectionalLight:vh,DirectionalLightHelper:class extends Ue{constructor(i,e,t){super(),this.light=i,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new Re;r.setAttribute("position",new _e([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const s=new Bt({fog:!1,toneMapped:!1});this.lightPlane=new oi(r,s),this.add(this.lightPlane),r=new Re,r.setAttribute("position",new _e([0,0,0,0,0,1],3)),this.targetLine=new oi(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),S_.setFromMatrixPosition(this.light.matrixWorld),Yc.setFromMatrixPosition(this.light.target.matrixWorld),T_.subVectors(Yc,S_),this.lightPlane.lookAt(Yc),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Yc),this.targetLine.scale.z=T_.length()}},DiscreteInterpolant:m1,DisplayP3ColorSpace:Pd,DodecahedronGeometry:kd,DoubleSide:Mt,DstAlphaFactor:Bh,DstColorFactor:zh,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:a1,EllipseCurve:Ud,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:Io,EquirectangularRefractionMapping:sh,Euler:yt,EventDispatcher:ts,ExtrudeGeometry:Pn,FileLoader:fi,Float16BufferAttribute:class extends Ze{constructor(i,e,t){super(new Uint16Array(i),e,t),this.isFloat16BufferAttribute=!0}getX(i){let e=Dl(this.array[i*this.itemSize]);return this.normalized&&(e=Li(e,this.array)),e}setX(i,e){return this.normalized&&(e=Oe(e,this.array)),this.array[i*this.itemSize]=Ui(e),this}getY(i){let e=Dl(this.array[i*this.itemSize+1]);return this.normalized&&(e=Li(e,this.array)),e}setY(i,e){return this.normalized&&(e=Oe(e,this.array)),this.array[i*this.itemSize+1]=Ui(e),this}getZ(i){let e=Dl(this.array[i*this.itemSize+2]);return this.normalized&&(e=Li(e,this.array)),e}setZ(i,e){return this.normalized&&(e=Oe(e,this.array)),this.array[i*this.itemSize+2]=Ui(e),this}getW(i){let e=Dl(this.array[i*this.itemSize+3]);return this.normalized&&(e=Li(e,this.array)),e}setW(i,e){return this.normalized&&(e=Oe(e,this.array)),this.array[i*this.itemSize+3]=Ui(e),this}setXY(i,e,t){return i*=this.itemSize,this.normalized&&(e=Oe(e,this.array),t=Oe(t,this.array)),this.array[i+0]=Ui(e),this.array[i+1]=Ui(t),this}setXYZ(i,e,t,r){return i*=this.itemSize,this.normalized&&(e=Oe(e,this.array),t=Oe(t,this.array),r=Oe(r,this.array)),this.array[i+0]=Ui(e),this.array[i+1]=Ui(t),this.array[i+2]=Ui(r),this}setXYZW(i,e,t,r,s){return i*=this.itemSize,this.normalized&&(e=Oe(e,this.array),t=Oe(t,this.array),r=Oe(r,this.array),s=Oe(s,this.array)),this.array[i+0]=Ui(e),this.array[i+1]=Ui(t),this.array[i+2]=Ui(r),this.array[i+3]=Ui(s),this}},Float32BufferAttribute:_e,FloatType:tr,Fog:Bo,FogExp2:ko,FramebufferTexture:class extends pt{constructor(i,e){super({width:i,height:e}),this.isFramebufferTexture=!0,this.magFilter=nt,this.minFilter=nt,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:gr,Frustum:Gh,GLBufferAttribute:class{constructor(i,e,t,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=i,this.type=e,this.itemSize=t,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(i){i===!0&&this.version++}setBuffer(i){return this.buffer=i,this}setType(i,e){return this.type=i,this.elementSize=e,this}setItemSize(i){return this.itemSize=i,this}setCount(i){return this.count=i,this}},GLSL1:"100",GLSL3:ff,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:w1,Group:vi,HalfFloatType:Ht,HemisphereLight:Rf,HemisphereLightHelper:class extends Ue{constructor(i,e,t){super(),this.light=i,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="HemisphereLightHelper";const r=new bs(e);r.rotateY(.5*Math.PI),this.material=new Wt({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),a=new Float32Array(3*s.count);r.setAttribute("color",new Ze(a,3)),this.add(new ue(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const i=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=i.geometry.getAttribute("color");b_.copy(this.light.color),w_.copy(this.light.groundColor);for(let t=0,r=e.count;t<r;t++){const s=t<r/2?b_:w_;e.setXYZ(t,s.r,s.g,s.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),i.lookAt(cA.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:zd,ImageBitmapLoader:v1,ImageLoader:ql,ImageUtils:kx,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:un,InstancedBufferGeometry:zg,InstancedInterleavedBuffer:Zu,InstancedMesh:Mf,Int16BufferAttribute:class extends Ze{constructor(i,e,t){super(new Int16Array(i),e,t)}},Int32BufferAttribute:class extends Ze{constructor(i,e,t){super(new Int32Array(i),e,t)}},Int8BufferAttribute:class extends Ze{constructor(i,e,t){super(new Int8Array(i),e,t)}},IntType:cg,InterleavedBuffer:Wh,InterleavedBufferAttribute:Bi,Interpolant:el,InterpolateDiscrete:Do,InterpolateLinear:Oo,InterpolateSmooth:Ru,InvertStencilOp:5386,KeepStencilOp:Za,KeyframeTrack:Lr,LOD:Nv,LatheGeometry:Xh,Layers:Id,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:Ls,LightProbe:o_,Line:oi,Line3:M1,LineBasicMaterial:Bt,LineCurve:Cg,LineCurve3:r1,LineDashedMaterial:c1,LineLoop:bf,LineSegments:Yi,LinearDisplayP3ColorSpace:Hh,LinearFilter:Vt,LinearInterpolant:Ug,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:Qr,LinearMipmapNearestFilter:_o,LinearSRGBColorSpace:Qt,LinearToneMapping:wd,LinearTransfer:nh,Loader:It,LoaderUtils:Jr,LoadingManager:Ef,LoopOnce:vg,LoopPingPong:2202,LoopRepeat:_g,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:qa,Material:Xt,MaterialLoader:Yu,MathUtils:ti,Matrix3:De,Matrix4:me,MaxEquation:104,Mesh:ue,MeshBasicMaterial:Wt,MeshDepthMaterial:Od,MeshDistanceMaterial:Sg,MeshLambertMaterial:Wd,MeshMatcapMaterial:h1,MeshNormalMaterial:jd,MeshPhongMaterial:An,MeshPhysicalMaterial:ar,MeshStandardMaterial:Go,MeshToonMaterial:Dg,MinEquation:103,MirroredRepeatWrapping:pa,MixOperation:Lx,MultiplyBlending:4,MultiplyOperation:Vh,NearestFilter:nt,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:an,NearestMipmapNearestFilter:Rd,NeutralToneMapping:hg,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:$a,NoToneMapping:Kr,NormalAnimationBlendMode:Ox,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:ga,Object3D:Ue,ObjectLoader:class extends It{constructor(i){super(i)}load(i,e,t,r){const s=this,a=this.path===""?Jr.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||a;const n=new fi(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(i,function(o){let l=null;try{l=JSON.parse(o)}catch(c){return void(r!==void 0&&r(c))}const h=l.metadata;h!==void 0&&h.type!==void 0&&h.type.toLowerCase()!=="geometry"?s.parse(l,e):r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+i))},t,r)}loadAsync(i,e){return Rr(this,null,function*(){const t=this.path===""?Jr.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||t;const r=new fi(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=yield r.loadAsync(i,e),a=JSON.parse(s),n=a.metadata;if(n===void 0||n.type===void 0||n.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+i);return yield this.parseAsync(a)})}parse(i,e){const t=this.parseAnimations(i.animations),r=this.parseShapes(i.shapes),s=this.parseGeometries(i.geometries,r),a=this.parseImages(i.images,function(){e!==void 0&&e(l)}),n=this.parseTextures(i.textures,a),o=this.parseMaterials(i.materials,n),l=this.parseObject(i.object,s,o,n,t),h=this.parseSkeletons(i.skeletons,l);if(this.bindSkeletons(l,h),e!==void 0){let c=!1;for(const u in a)if(a[u].data instanceof HTMLImageElement){c=!0;break}c===!1&&e(l)}return l}parseAsync(i){return Rr(this,null,function*(){const e=this.parseAnimations(i.animations),t=this.parseShapes(i.shapes),r=this.parseGeometries(i.geometries,t),s=yield this.parseImagesAsync(i.images),a=this.parseTextures(i.textures,s),n=this.parseMaterials(i.materials,a),o=this.parseObject(i.object,r,n,a,e),l=this.parseSkeletons(i.skeletons,o);return this.bindSkeletons(o,l),o})}parseShapes(i){const e={};if(i!==void 0)for(let t=0,r=i.length;t<r;t++){const s=new oa().fromJSON(i[t]);e[s.uuid]=s}return e}parseSkeletons(i,e){const t={},r={};if(e.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),i!==void 0)for(let s=0,a=i.length;s<a;s++){const n=new Vo().fromJSON(i[s],r);t[n.uuid]=n}return t}parseGeometries(i,e){const t={};if(i!==void 0){const r=new l_;for(let s=0,a=i.length;s<a;s++){let n;const o=i[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":n=r.parse(o);break;default:o.type in r_&&(n=r_[o.type].fromJSON(o,e))}n.uuid=o.uuid,o.name!==void 0&&(n.name=o.name),o.userData!==void 0&&(n.userData=o.userData),t[o.uuid]=n}}return t}parseMaterials(i,e){const t={},r={};if(i!==void 0){const s=new Yu;s.setTextures(e);for(let a=0,n=i.length;a<n;a++){const o=i[a];t[o.uuid]===void 0&&(t[o.uuid]=s.parse(o)),r[o.uuid]=t[o.uuid]}}return r}parseAnimations(i){const e={};if(i!==void 0)for(let t=0;t<i.length;t++){const r=i[t],s=dn.parse(r);e[s.uuid]=s}return e}parseImages(i,e){const t=this,r={};let s;function a(n){if(typeof n=="string"){const o=n;return function(l){return t.manager.itemStart(l),s.load(l,function(){t.manager.itemEnd(l)},void 0,function(){t.manager.itemError(l),t.manager.itemEnd(l)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o)}return n.data?{data:oo(n.type,n.data),width:n.width,height:n.height}:null}if(i!==void 0&&i.length>0){const n=new Ef(e);s=new ql(n),s.setCrossOrigin(this.crossOrigin);for(let o=0,l=i.length;o<l;o++){const h=i[o],c=h.url;if(Array.isArray(c)){const u=[];for(let d=0,p=c.length;d<p;d++){const f=a(c[d]);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new Ms(f.data,f.width,f.height)))}r[h.uuid]=new en(u)}else{const u=a(h.url);r[h.uuid]=new en(u)}}}return r}parseImagesAsync(i){return Rr(this,null,function*(){const e=this,t={};let r;function s(a){return Rr(this,null,function*(){if(typeof a=="string"){const n=a,o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return yield r.loadAsync(o)}return a.data?{data:oo(a.type,a.data),width:a.width,height:a.height}:null})}if(i!==void 0&&i.length>0){r=new ql(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,n=i.length;a<n;a++){const o=i[a],l=o.url;if(Array.isArray(l)){const h=[];for(let c=0,u=l.length;c<u;c++){const d=l[c],p=yield s(d);p!==null&&(p instanceof HTMLImageElement?h.push(p):h.push(new Ms(p.data,p.width,p.height)))}t[o.uuid]=new en(h)}else{const h=yield s(o.url);t[o.uuid]=new en(h)}}}return t})}parseTextures(i,e){function t(s,a){return typeof s=="number"?s:a[s]}const r={};if(i!==void 0)for(let s=0,a=i.length;s<a;s++){const n=i[s];n.image,e[n.image];const o=e[n.image],l=o.data;let h;Array.isArray(l)?(h=new dh,l.length===6&&(h.needsUpdate=!0)):(h=l&&l.data?new Ms:new pt,l&&(h.needsUpdate=!0)),h.source=o,h.uuid=n.uuid,n.name!==void 0&&(h.name=n.name),n.mapping!==void 0&&(h.mapping=t(n.mapping,tA)),n.channel!==void 0&&(h.channel=n.channel),n.offset!==void 0&&h.offset.fromArray(n.offset),n.repeat!==void 0&&h.repeat.fromArray(n.repeat),n.center!==void 0&&h.center.fromArray(n.center),n.rotation!==void 0&&(h.rotation=n.rotation),n.wrap!==void 0&&(h.wrapS=t(n.wrap[0],h_),h.wrapT=t(n.wrap[1],h_)),n.format!==void 0&&(h.format=n.format),n.internalFormat!==void 0&&(h.internalFormat=n.internalFormat),n.type!==void 0&&(h.type=n.type),n.colorSpace!==void 0&&(h.colorSpace=n.colorSpace),n.minFilter!==void 0&&(h.minFilter=t(n.minFilter,c_)),n.magFilter!==void 0&&(h.magFilter=t(n.magFilter,c_)),n.anisotropy!==void 0&&(h.anisotropy=n.anisotropy),n.flipY!==void 0&&(h.flipY=n.flipY),n.generateMipmaps!==void 0&&(h.generateMipmaps=n.generateMipmaps),n.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=n.premultiplyAlpha),n.unpackAlignment!==void 0&&(h.unpackAlignment=n.unpackAlignment),n.compareFunction!==void 0&&(h.compareFunction=n.compareFunction),n.userData!==void 0&&(h.userData=n.userData),r[n.uuid]=h}return r}parseObject(i,e,t,r,s){let a,n,o;function l(u){return e[u],e[u]}function h(u){if(u!==void 0){if(Array.isArray(u)){const d=[];for(let p=0,f=u.length;p<f;p++){const v=u[p];t[v],d.push(t[v])}return d}return t[u],t[u]}}function c(u){return r[u],r[u]}switch(i.type){case"Scene":a=new xf,i.background!==void 0&&(Number.isInteger(i.background)?a.background=new oe(i.background):a.background=c(i.background)),i.environment!==void 0&&(a.environment=c(i.environment)),i.fog!==void 0&&(i.fog.type==="Fog"?a.fog=new Bo(i.fog.color,i.fog.near,i.fog.far):i.fog.type==="FogExp2"&&(a.fog=new ko(i.fog.color,i.fog.density)),i.fog.name!==""&&(a.fog.name=i.fog.name)),i.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=i.backgroundBlurriness),i.backgroundIntensity!==void 0&&(a.backgroundIntensity=i.backgroundIntensity),i.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(i.backgroundRotation),i.environmentIntensity!==void 0&&(a.environmentIntensity=i.environmentIntensity),i.environmentRotation!==void 0&&a.environmentRotation.fromArray(i.environmentRotation);break;case"PerspectiveCamera":a=new Gt(i.fov,i.aspect,i.near,i.far),i.focus!==void 0&&(a.focus=i.focus),i.zoom!==void 0&&(a.zoom=i.zoom),i.filmGauge!==void 0&&(a.filmGauge=i.filmGauge),i.filmOffset!==void 0&&(a.filmOffset=i.filmOffset),i.view!==void 0&&(a.view=Object.assign({},i.view));break;case"OrthographicCamera":a=new wn(i.left,i.right,i.top,i.bottom,i.near,i.far),i.zoom!==void 0&&(a.zoom=i.zoom),i.view!==void 0&&(a.view=Object.assign({},i.view));break;case"AmbientLight":a=new qu(i.color,i.intensity);break;case"DirectionalLight":a=new vh(i.color,i.intensity);break;case"PointLight":a=new jo(i.color,i.intensity,i.distance,i.decay);break;case"RectAreaLight":a=new Pf(i.color,i.intensity,i.width,i.height);break;case"SpotLight":a=new gh(i.color,i.intensity,i.distance,i.angle,i.penumbra,i.decay);break;case"HemisphereLight":a=new Rf(i.color,i.groundColor,i.intensity);break;case"LightProbe":a=new o_().fromJSON(i);break;case"SkinnedMesh":n=l(i.geometry),o=h(i.material),a=new Gu(n,o),i.bindMode!==void 0&&(a.bindMode=i.bindMode),i.bindMatrix!==void 0&&a.bindMatrix.fromArray(i.bindMatrix),i.skeleton!==void 0&&(a.skeleton=i.skeleton);break;case"Mesh":n=l(i.geometry),o=h(i.material),a=new ue(n,o);break;case"InstancedMesh":n=l(i.geometry),o=h(i.material);const u=i.count,d=i.instanceMatrix,p=i.instanceColor;a=new Mf(n,o,u),a.instanceMatrix=new un(new Float32Array(d.array),16),p!==void 0&&(a.instanceColor=new un(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":n=l(i.geometry),o=h(i.material),a=new jv(i.maxGeometryCount,i.maxVertexCount,i.maxIndexCount,o),a.geometry=n,a.perObjectFrustumCulled=i.perObjectFrustumCulled,a.sortObjects=i.sortObjects,a._drawRanges=i.drawRanges,a._reservedRanges=i.reservedRanges,a._visibility=i.visibility,a._active=i.active,a._bounds=i.bounds.map(f=>{const v=new vt;v.min.fromArray(f.boxMin),v.max.fromArray(f.boxMax);const m=new ii;return m.radius=f.sphereRadius,m.center.fromArray(f.sphereCenter),{boxInitialized:f.boxInitialized,box:v,sphereInitialized:f.sphereInitialized,sphere:m}}),a._maxGeometryCount=i.maxGeometryCount,a._maxVertexCount=i.maxVertexCount,a._maxIndexCount=i.maxIndexCount,a._geometryInitialized=i.geometryInitialized,a._geometryCount=i.geometryCount,a._matricesTexture=c(i.matricesTexture.uuid),i.colorsTexture!==void 0&&(a._colorsTexture=c(i.colorsTexture.uuid));break;case"LOD":a=new Nv;break;case"Line":a=new oi(l(i.geometry),h(i.material));break;case"LineLoop":a=new bf(l(i.geometry),h(i.material));break;case"LineSegments":a=new Yi(l(i.geometry),h(i.material));break;case"PointCloud":case"Points":a=new na(l(i.geometry),h(i.material));break;case"Sprite":a=new Iv(h(i.material));break;case"Group":a=new vi;break;case"Bone":a=new zo;break;default:a=new Ue}if(a.uuid=i.uuid,i.name!==void 0&&(a.name=i.name),i.matrix!==void 0?(a.matrix.fromArray(i.matrix),i.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=i.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(i.position!==void 0&&a.position.fromArray(i.position),i.rotation!==void 0&&a.rotation.fromArray(i.rotation),i.quaternion!==void 0&&a.quaternion.fromArray(i.quaternion),i.scale!==void 0&&a.scale.fromArray(i.scale)),i.up!==void 0&&a.up.fromArray(i.up),i.castShadow!==void 0&&(a.castShadow=i.castShadow),i.receiveShadow!==void 0&&(a.receiveShadow=i.receiveShadow),i.shadow&&(i.shadow.bias!==void 0&&(a.shadow.bias=i.shadow.bias),i.shadow.normalBias!==void 0&&(a.shadow.normalBias=i.shadow.normalBias),i.shadow.radius!==void 0&&(a.shadow.radius=i.shadow.radius),i.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(i.shadow.mapSize),i.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(i.shadow.camera))),i.visible!==void 0&&(a.visible=i.visible),i.frustumCulled!==void 0&&(a.frustumCulled=i.frustumCulled),i.renderOrder!==void 0&&(a.renderOrder=i.renderOrder),i.userData!==void 0&&(a.userData=i.userData),i.layers!==void 0&&(a.layers.mask=i.layers),i.children!==void 0){const u=i.children;for(let d=0;d<u.length;d++)a.add(this.parseObject(u[d],e,t,r,s))}if(i.animations!==void 0){const u=i.animations;for(let d=0;d<u.length;d++){const p=u[d];a.animations.push(s[p])}}if(i.type==="LOD"){i.autoUpdate!==void 0&&(a.autoUpdate=i.autoUpdate);const u=i.levels;for(let d=0;d<u.length;d++){const p=u[d],f=a.getObjectByProperty("uuid",p.object);f!==void 0&&a.addLevel(f,p.distance,p.hysteresis)}}return a}bindSkeletons(i,e){Object.keys(e).length!==0&&i.traverse(function(t){if(t.isSkinnedMesh===!0&&t.skeleton!==void 0){const r=e[t.skeleton];r===void 0||t.bind(r,t.bindMatrix)}})}},ObjectSpaceNormalMap:1,OctahedronGeometry:bs,OneFactor:kh,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:Md,OneMinusDstColorFactor:bd,OneMinusSrcAlphaFactor:ua,OneMinusSrcColorFactor:xd,OrthographicCamera:wn,P3Primaries:lh,PCFShadowMap:_d,PCFSoftShadowMap:og,PMREMGenerator:_f,Path:Ho,PerspectiveCamera:Gt,Plane:Cr,PlaneGeometry:as,PlaneHelper:T1,PointLight:jo,PointLightHelper:class extends ue{constructor(i,e,t){super(new Tn(e,4,2),new Wt({wireframe:!0,fog:!1,toneMapped:!1})),this.light=i,this.color=t,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:na,PointsMaterial:Ks,PolarGridHelper:class extends Yi{constructor(i=10,e=16,t=8,r=64,s=4473924,a=8947848){s=new oe(s),a=new oe(a);const n=[],o=[];if(e>1)for(let h=0;h<e;h++){const c=h/e*(2*Math.PI),u=Math.sin(c)*i,d=Math.cos(c)*i;n.push(0,0,0),n.push(u,0,d);const p=1&h?s:a;o.push(p.r,p.g,p.b),o.push(p.r,p.g,p.b)}for(let h=0;h<t;h++){const c=1&h?s:a,u=i-i/t*h;for(let d=0;d<r;d++){let p=d/r*(2*Math.PI),f=Math.sin(p)*u,v=Math.cos(p)*u;n.push(f,0,v),o.push(c.r,c.g,c.b),p=(d+1)/r*(2*Math.PI),f=Math.sin(p)*u,v=Math.cos(p)*u,n.push(f,0,v),o.push(c.r,c.g,c.b)}}const l=new Re;l.setAttribute("position",new _e(n,3)),l.setAttribute("color",new _e(o,3)),super(l,new Bt({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:ba,PositionalAudio:class extends f_{constructor(i){super(i),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(i){return this.panner.refDistance=i,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(i){return this.panner.rolloffFactor=i,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(i){return this.panner.distanceModel=i,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(i){return this.panner.maxDistance=i,this}setDirectionalCone(i,e,t){return this.panner.coneInnerAngle=i,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=t,this}updateMatrixWorld(i){if(super.updateMatrixWorld(i),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Ba,g_,rA),za.set(0,0,1).applyQuaternion(g_);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Ba.x,t),e.positionY.linearRampToValueAtTime(Ba.y,t),e.positionZ.linearRampToValueAtTime(Ba.z,t),e.orientationX.linearRampToValueAtTime(za.x,t),e.orientationY.linearRampToValueAtTime(za.y,t),e.orientationZ.linearRampToValueAtTime(za.z,t)}else e.setPosition(Ba.x,Ba.y,Ba.z),e.setOrientation(za.x,za.y,za.z)}},PropertyBinding:qe,PropertyMixer:_1,QuadraticBezierCurve:Rg,QuadraticBezierCurve3:Pg,Quaternion:Ke,QuaternionKeyframeTrack:Rs,QuaternionLinearInterpolant:f1,RED_GREEN_RGTC2_Format:pf,RED_RGTC1_Format:36283,REVISION:Vu,RGBADepthPacking:xg,RGBAFormat:fr,RGBAIntegerFormat:gg,RGBA_ASTC_10x10_Format:of,RGBA_ASTC_10x5_Format:sf,RGBA_ASTC_10x6_Format:af,RGBA_ASTC_10x8_Format:nf,RGBA_ASTC_12x10_Format:lf,RGBA_ASTC_12x12_Format:hf,RGBA_ASTC_4x4_Format:Zm,RGBA_ASTC_5x4_Format:Km,RGBA_ASTC_5x5_Format:Qm,RGBA_ASTC_6x5_Format:Jm,RGBA_ASTC_6x6_Format:$m,RGBA_ASTC_8x5_Format:ef,RGBA_ASTC_8x6_Format:tf,RGBA_ASTC_8x8_Format:rf,RGBA_BPTC_Format:Cu,RGBA_ETC2_EAC_Format:Ym,RGBA_PVRTC_2BPPV1_Format:Wm,RGBA_PVRTC_4BPPV1_Format:jm,RGBA_S3TC_DXT1_Format:Tu,RGBA_S3TC_DXT3_Format:Au,RGBA_S3TC_DXT5_Format:Eu,RGBFormat:1022,RGB_BPTC_SIGNED_Format:cf,RGB_BPTC_UNSIGNED_Format:uf,RGB_ETC1_Format:Xm,RGB_ETC2_Format:qm,RGB_PVRTC_2BPPV1_Format:Gm,RGB_PVRTC_4BPPV1_Format:Hm,RGB_S3TC_DXT1_Format:Su,RGFormat:1030,RGIntegerFormat:fg,RawShaderMaterial:Ng,Ray:Rn,Raycaster:Xd,Rec709Primaries:oh,RectAreaLight:Pf,RedFormat:pg,RedIntegerFormat:mg,ReinhardToneMapping:Sd,RenderTarget:Bx,RepeatWrapping:jt,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:Kh,SIGNED_RED_GREEN_RGTC2_Format:mf,SIGNED_RED_RGTC1_Format:df,SRGBColorSpace:ft,SRGBTransfer:mt,Scene:xf,ShaderChunk:Be,ShaderLib:Pi,ShaderMaterial:tt,ShadowMaterial:l1,Shape:oa,ShapeGeometry:Vd,ShapePath:E1,ShapeUtils:Ir,ShortType:1011,Skeleton:Vo,SkeletonHelper:class extends Yi{constructor(i){const e=b1(i),t=new Re,r=[],s=[],a=new oe(0,0,1),n=new oe(0,1,0);for(let o=0;o<e.length;o++){const l=e[o];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(a.r,a.g,a.b),s.push(n.r,n.g,n.b))}t.setAttribute("position",new _e(r,3)),t.setAttribute("color",new _e(s,3)),super(t,new Bt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=i,this.bones=e,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(i){const e=this.bones,t=this.geometry,r=t.getAttribute("position");Yp.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<e.length;s++){const n=e[s];n.parent&&n.parent.isBone&&(qc.multiplyMatrices(Yp,n.matrixWorld),Gs.setFromMatrixPosition(qc),r.setXYZ(a,Gs.x,Gs.y,Gs.z),qc.multiplyMatrices(Yp,n.parent.matrixWorld),Gs.setFromMatrixPosition(qc),r.setXYZ(a+1,Gs.x,Gs.y,Gs.z),a+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(i)}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:Gu,Source:en,Sphere:ii,SphereGeometry:Tn,Spherical:Lf,SphericalHarmonics3:g1,SplineCurve:Ig,SpotLight:gh,SpotLightHelper:class extends Ue{constructor(i,e){super(),this.light=i,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const t=new Re,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,n=1,o=32;a<o;a++,n++){const l=a/o*Math.PI*2,h=n/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(h),Math.sin(h),1)}t.setAttribute("position",new _e(r,3));const s=new Bt({fog:!1,toneMapped:!1});this.cone=new Yi(t,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const i=this.light.distance?this.light.distance:1e3,e=i*Math.tan(this.light.angle);this.cone.scale.set(e,e,i),M_.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(M_),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:Iv,SpriteMaterial:Tg,SrcAlphaFactor:ca,SrcAlphaSaturateFactor:210,SrcColorFactor:yd,StaticCopyUsage:35046,StaticDrawUsage:hh,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Gt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Gt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(i){const e=this._cache;if(e.focus!==i.focus||e.fov!==i.fov||e.aspect!==i.aspect*this.aspect||e.near!==i.near||e.far!==i.far||e.zoom!==i.zoom||e.eyeSep!==this.eyeSep){e.focus=i.focus,e.fov=i.fov,e.aspect=i.aspect*this.aspect,e.near=i.near,e.far=i.far,e.zoom=i.zoom,e.eyeSep=this.eyeSep,Ua.copy(i.projectionMatrix);const t=e.eyeSep/2,r=t*e.near/e.focus,s=e.near*Math.tan(cn*e.fov*.5)/e.zoom;let a,n;d_.elements[12]=-t,u_.elements[12]=t,a=-s*e.aspect+r,n=s*e.aspect+r,Ua.elements[0]=2*e.near/(n-a),Ua.elements[8]=(n+a)/(n-a),this.cameraL.projectionMatrix.copy(Ua),a=-s*e.aspect-r,n=s*e.aspect-r,Ua.elements[0]=2*e.near/(n-a),Ua.elements[8]=(n+a)/(n-a),this.cameraR.projectionMatrix.copy(Ua)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(d_),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(u_)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:rn,SubtractEquation:101,SubtractiveBlending:3,TOUCH:Ya,TangentSpaceNormalMap:0,TetrahedronGeometry:Hd,Texture:pt,TextureLoader:is,TorusGeometry:qr,TorusKnotGeometry:Gd,Triangle:$i,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Cs,UVMapping:Cd,Uint16BufferAttribute:Ld,Uint32BufferAttribute:bg,Uint8BufferAttribute:class extends Ze{constructor(i,e,t){super(new Uint8Array(i),e,t)}},Uint8ClampedBufferAttribute:class extends Ze{constructor(i,e,t){super(new Uint8ClampedArray(i),e,t)}},Uniform:Hg,UniformsGroup:class extends ts{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:hA++}),this.name="",this.usage=hh,this.uniforms=[]}add(i){return this.uniforms.push(i),this}remove(i){const e=this.uniforms.indexOf(i);return e!==-1&&this.uniforms.splice(e,1),this}setName(i){return this.name=i,this}setUsage(i){return this.usage=i,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(i){this.name=i.name,this.usage=i.usage;const e=i.uniforms;this.uniforms.length=0;for(let t=0,r=e.length;t<r;t++){const s=Array.isArray(e[t])?e[t]:[e[t]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}},UniformsLib:ye,UniformsUtils:Kt,UnsignedByteType:xn,UnsignedInt248Type:ma,UnsignedInt5999Type:35902,UnsignedIntType:Mn,UnsignedShort4444Type:ug,UnsignedShort5551Type:dg,UnsignedShortType:Lo,VSMShadowMap:Ar,Vector2:X,Vector3:S,Vector4:Ve,VectorKeyframeTrack:va,VideoTexture:e1,WebGL3DRenderTarget:class extends ht{constructor(i=1,e=1,t=1,r={}){super(i,e,r),this.isWebGL3DRenderTarget=!0,this.depth=t,this.texture=new vf(null,i,e,t),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends ht{constructor(i=1,e=1,t=1,r={}){super(i,e,r),this.isWebGLArrayRenderTarget=!0,this.depth=t,this.texture=new Hu(null,i,e,t),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:bn,WebGLCubeRenderTarget:Gx,WebGLMultipleRenderTargets:class extends ht{constructor(i=1,e=1,t=1,r={}){super(i,e,hi(Ae({},r),{count:t})),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}},WebGLRenderTarget:ht,WebGLRenderer:Jx,WebGLUtils:Kx,WebGPUCoordinateSystem:ch,WireframeGeometry:Lg,WrapAroundEnding:ah,ZeroCurvatureEnding:nn,ZeroFactor:Po,ZeroSlopeEnding:on,ZeroStencilOp:0,createCanvasElement:Fx},Symbol.toStringTag,{value:"Module"}));function ms(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function C1(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}var Gg,Ti,xt,Tt,Xr,Nf,jg,R1,P1,ho,yh,_l,Jc,Kp,E_,C_,R_,sr={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Wo={duration:.5,overwrite:!1,delay:0},Ss=1e8,Di=1e-8,Df=2*Math.PI,uA=Df/4,dA=0,I1=Math.sqrt,pA=Math.cos,mA=Math.sin,ci=function(i){return typeof i=="string"},Lt=function(i){return typeof i=="function"},Ps=function(i){return typeof i=="number"},Wg=function(i){return i===void 0},rs=function(i){return typeof i=="object"},Vi=function(i){return i!==!1},Xg=function(){return typeof window<"u"},$c=function(i){return Lt(i)||ci(i)},L1=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},bi=Array.isArray,Of=/(?:-?\.?\d|\.)+/gi,N1=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,co=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Qp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,D1=/[+-]=-?[.\d]+/,O1=/[^,'"\[\]\s]+/gi,fA=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ir={},Ku={},U1=function(i){return(Ku=En(i,ir))&&Gi},xh=function(i,e){return!e&&void 0},F1=function(i,e){return i&&(ir[i]=e)&&Ku&&(Ku[i]=e)||ir},Mh=function(){return 0},gA={suppressEvents:!0,isStart:!0,kill:!1},Iu={suppressEvents:!0,kill:!1},vA={suppressEvents:!0},qg={},la=[],Uf={},Zi={},Jp={},P_=30,Lu=[],Yg="",Zg=function(i){var e,t,r=i[0];if(rs(r)||Lt(r)||(i=[i]),!(e=(r._gsap||{}).harness)){for(t=Lu.length;t--&&!Lu[t].targetTest(r););e=Lu[t]}for(t=i.length;t--;)i[t]&&(i[t]._gsap||(i[t]._gsap=new sM(i[t],e)))||i.splice(t,1);return i},pn=function(i){return i._gsap||Zg(mr(i))[0]._gsap},k1=function(i,e,t){return(t=i[e])&&Lt(t)?i[e]():Wg(t)&&i.getAttribute&&i.getAttribute(e)||t},zi=function(i,e){return(i=i.split(",")).forEach(e)||i},zt=function(i){return Math.round(1e5*i)/1e5||0},li=function(i){return Math.round(1e7*i)/1e7||0},xo=function(i,e){var t=e.charAt(0),r=parseFloat(e.substr(2));return i=parseFloat(i),t==="+"?i+r:t==="-"?i-r:t==="*"?i*r:i/r},_A=function(i,e){for(var t=e.length,r=0;i.indexOf(e[r])<0&&++r<t;);return r<t},Qu=function(){var i,e,t=la.length,r=la.slice(0);for(Uf={},la.length=0,i=0;i<t;i++)(e=r[i])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},B1=function(i,e,t,r){la.length&&!Ti&&Qu(),i.render(e,t,Ti&&e<0&&(i._initted||i._startAt)),la.length&&!Ti&&Qu()},z1=function(i){var e=parseFloat(i);return(e||e===0)&&(i+"").match(O1).length<2?e:ci(i)?i.trim():i},V1=function(i){return i},vr=function(i,e){for(var t in e)t in i||(i[t]=e[t]);return i},En=function(i,e){for(var t in e)i[t]=e[t];return i},I_=function i(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=rs(t[r])?i(e[r]||(e[r]={}),t[r]):t[r]);return e},Ju=function(i,e){var t,r={};for(t in i)t in e||(r[t]=i[t]);return r},Yl=function(i){var e,t=i.parent||Tt,r=i.keyframes?(e=bi(i.keyframes),function(s,a){for(var n in a)n in s||n==="duration"&&e||n==="ease"||(s[n]=a[n])}):vr;if(Vi(i.inherit))for(;t;)r(i,t.vars.defaults),t=t.parent||t._dp;return i},H1=function(i,e,t,r,s){var a,n=i[r];if(s)for(a=e[s];n&&n[s]>a;)n=n._prev;return n?(e._next=n._next,n._next=e):(e._next=i[t],i[t]=e),e._next?e._next._prev=e:i[r]=e,e._prev=n,e.parent=e._dp=i,e},qd=function(i,e,t,r){t===void 0&&(t="_first"),r===void 0&&(r="_last");var s=e._prev,a=e._next;s?s._next=a:i[t]===e&&(i[t]=a),a?a._prev=s:i[r]===e&&(i[r]=s),e._next=e._prev=e.parent=null},_a=function(i,e){i.parent&&(!e||i.parent.autoRemoveChildren)&&i.parent.remove&&i.parent.remove(i),i._act=0},mn=function(i,e){if(i&&(!e||e._end>i._dur||e._start<0))for(var t=i;t;)t._dirty=1,t=t.parent;return i},$p=function(i,e,t,r){return i._startAt&&(Ti?i._startAt.revert(Iu):i.vars.immediateRender&&!i.vars.autoRevert||i._startAt.render(e,!0,r))},yA=function i(e){return!e||e._ts&&i(e.parent)},L_=function(i){return i._repeat?Mo(i._tTime,i=i.duration()+i._rDelay)*i:0},Mo=function(i,e){var t=Math.floor(i/=e);return i&&t===i?t-1:t},$u=function(i,e){return(i-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Yd=function(i){return i._end=li(i._start+(i._tDur/Math.abs(i._ts||i._rts||Di)||0))},Zd=function(i,e){var t=i._dp;return t&&t.smoothChildTiming&&i._ts&&(i._start=li(t._time-(i._ts>0?e/i._ts:((i._dirty?i.totalDuration():i._tDur)-e)/-i._ts)),Yd(i),t._dirty||mn(t,i)),i},G1=function(i,e){var t;if((e._time||!e._dur&&e._initted||e._start<i._time&&(e._dur||!e.add))&&(t=$u(i.rawTime(),e),(!e._dur||Qh(0,e.totalDuration(),t)-e._tTime>Di)&&e.render(t,!0)),mn(i,e)._dp&&i._initted&&i._time>=i._dur&&i._ts){if(i._dur<i.duration())for(t=i;t._dp;)t.rawTime()>=0&&t.totalTime(t._tTime),t=t._dp;i._zTime=-1e-8}},Yr=function(i,e,t,r){return e.parent&&_a(e),e._start=li((Ps(t)?t:t||i!==Tt?hr(i,t,e):i._time)+e._delay),e._end=li(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),H1(i,e,"_first","_last",i._sort?"_start":0),Ff(e)||(i._recent=e),r||G1(i,e),i._ts<0&&Zd(i,i._tTime),i},j1=function(i,e){return ir.ScrollTrigger?ir.ScrollTrigger.create(e,i):void 0},N_=function(i,e,t,r,s){return Hf(i,e,s),i._initted?!t&&i._pt&&!Ti&&(i._dur&&i.vars.lazy!==!1||!i._dur&&i.vars.lazy)&&P1!==er.frame?(la.push(i),i._lazy=[s,r],1):void 0:1},xA=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},Ff=function(i){var e=i.data;return e==="isFromStart"||e==="isStart"},Xo=function(i,e,t,r){var s=i._repeat,a=li(e)||0,n=i._tTime/i._tDur;return n&&!r&&(i._time*=a/i._dur),i._dur=a,i._tDur=s?s<0?1e10:li(a*(s+1)+i._rDelay*s):a,n>0&&!r&&Zd(i,i._tTime=i._tDur*n),i.parent&&Yd(i),t||mn(i.parent,i),i},D_=function(i){return i instanceof Ni?mn(i):Xo(i,i._dur)},MA={_start:0,endTime:Mh,totalDuration:Mh},hr=function i(e,t,r){var s,a,n,o=e.labels,l=e._recent||MA,h=e.duration()>=Ss?l.endTime(!1):e._dur;return ci(t)&&(isNaN(t)||t in o)?(a=t.charAt(0),n=t.substr(-1)==="%",s=t.indexOf("="),a==="<"||a===">"?(s>=0&&(t=t.replace(/=/,"")),(a==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(t.substr(1))||0)*(n?(s<0?l:r).totalDuration()/100:1)):s<0?(t in o||(o[t]=h),o[t]):(a=parseFloat(t.charAt(s-1)+t.substr(s+1)),n&&r&&(a=a/100*(bi(r)?r[0]:r).totalDuration()),s>1?i(e,t.substr(0,s-1),r)+a:h+a)):t==null?h:+t},Zl=function(i,e,t){var r,s,a=Ps(e[1]),n=(a?2:1)+(i<2?0:1),o=e[n];if(a&&(o.duration=e[1]),o.parent=t,i){for(r=o,s=t;s&&!("immediateRender"in r);)r=s.vars.defaults||{},s=Vi(s.vars.inherit)&&s.parent;o.immediateRender=Vi(r.immediateRender),i<2?o.runBackwards=1:o.startAt=e[n-1]}return new Zt(e[0],o,e[n+1])},Qs=function(i,e){return i||i===0?e(i):e},Qh=function(i,e,t){return t<i?i:t>e?e:t},wi=function(i,e){return ci(i)&&(e=fA.exec(i))?e[1]:""},kf=[].slice,W1=function(i,e){return i&&rs(i)&&"length"in i&&(!e&&!i.length||i.length-1 in i&&rs(i[0]))&&!i.nodeType&&i!==Xr},bA=function(i,e,t){return t===void 0&&(t=[]),i.forEach(function(r){var s;return ci(r)&&!e||W1(r,1)?(s=t).push.apply(s,mr(r)):t.push(r)})||t},mr=function(i,e,t){return xt&&!e&&xt.selector?xt.selector(i):!ci(i)||t||!Nf&&qo()?bi(i)?bA(i,t):W1(i)?kf.call(i,0):i?[i]:[]:kf.call((e||jg).querySelectorAll(i),0)},Bf=function(i){return i=mr(i)[0]||xh()||{},function(e){var t=i.current||i.nativeElement||i;return mr(e,t.querySelectorAll?t:t===i?xh()||jg.createElement("div"):i)}},X1=function(i){return i.sort(function(){return .5-Math.random()})},q1=function(i){if(Lt(i))return i;var e=rs(i)?i:{each:i},t=fn(e.ease),r=e.from||0,s=parseFloat(e.base)||0,a={},n=r>0&&r<1,o=isNaN(r)||n,l=e.axis,h=r,c=r;return ci(r)?h=c={center:.5,edges:.5,end:1}[r]||0:!n&&o&&(h=r[0],c=r[1]),function(u,d,p){var f,v,m,g,_,y,x,M,b,w=(p||e).length,T=a[w];if(!T){if(!(b=e.grid==="auto"?0:(e.grid||[1,Ss])[1])){for(x=-1e8;x<(x=p[b++].getBoundingClientRect().left)&&b<w;);b<w&&b--}for(T=a[w]=[],f=o?Math.min(b,w)*h-.5:r%b,v=b===Ss?0:o?w*c/b-.5:r/b|0,x=0,M=Ss,y=0;y<w;y++)m=y%b-f,g=v-(y/b|0),T[y]=_=l?Math.abs(l==="y"?g:m):I1(m*m+g*g),_>x&&(x=_),_<M&&(M=_);r==="random"&&X1(T),T.max=x-M,T.min=M,T.v=w=(parseFloat(e.amount)||parseFloat(e.each)*(b>w?w-1:l?l==="y"?w/b:b:Math.max(b,w/b))||0)*(r==="edges"?-1:1),T.b=w<0?s-w:s,T.u=wi(e.amount||e.each)||0,t=t&&w<0?tM(t):t}return w=(T[u]-T.min)/T.max||0,li(T.b+(t?t(w):w)*T.v)+T.u}},zf=function(i){var e=Math.pow(10,((i+"").split(".")[1]||"").length);return function(t){var r=li(Math.round(parseFloat(t)/i)*i*e);return(r-r%1)/e+(Ps(t)?0:wi(t))}},Y1=function(i,e){var t,r,s=bi(i);return!s&&rs(i)&&(t=s=i.radius||Ss,i.values?(i=mr(i.values),(r=!Ps(i[0]))&&(t*=t)):i=zf(i.increment)),Qs(e,s?Lt(i)?function(a){return r=i(a),Math.abs(r-a)<=t?r:a}:function(a){for(var n,o,l=parseFloat(r?a.x:a),h=parseFloat(r?a.y:0),c=Ss,u=0,d=i.length;d--;)(n=r?(n=i[d].x-l)*n+(o=i[d].y-h)*o:Math.abs(i[d]-l))<c&&(c=n,u=d);return u=!t||c<=t?i[u]:a,r||u===a||Ps(a)?u:u+wi(a)}:zf(i))},Z1=function(i,e,t,r){return Qs(bi(i)?!e:t===!0?!!(t=0):!r,function(){return bi(i)?i[~~(Math.random()*i.length)]:(t=t||1e-5)&&(r=t<1?Math.pow(10,(t+"").length-2):1)&&Math.floor(Math.round((i-t/2+Math.random()*(e-i+.99*t))/t)*t*r)/r})},O_=function(i,e,t){return Qs(t,function(r){return i[~~e(r)]})},bh=function(i){for(var e,t,r,s,a=0,n="";~(e=i.indexOf("random(",a));)r=i.indexOf(")",e),s=i.charAt(e+7)==="[",t=i.substr(e+7,r-e-7).match(s?O1:Of),n+=i.substr(a,e-a)+Z1(s?t:+t[0],s?0:+t[1],+t[2]||1e-5),a=r+1;return n+i.substr(a,i.length-a)},U_=function(i,e,t,r,s){var a=e-i,n=r-t;return Qs(s,function(o){return t+((o-i)/a*n||0)})},F_=function(i,e,t){var r,s,a,n=i.labels,o=Ss;for(r in n)(s=n[r]-e)<0==!!t&&s&&o>(s=Math.abs(s))&&(a=r,o=s);return a},Ki=function(i,e,t){var r,s,a,n=i.vars,o=n[e],l=xt,h=i._ctx;if(o)return r=n[e+"Params"],s=n.callbackScope||i,t&&la.length&&Qu(),h&&(xt=h),a=r?o.apply(s,r):o.call(s),xt=l,a},Ol=function(i){return _a(i),i.scrollTrigger&&i.scrollTrigger.kill(!!Ti),i.progress()<1&&Ki(i,"onInterrupt"),i},K1=[],Q1=function(i){if(i)if(i=!i.name&&i.default||i,Xg()||i.headless){var e=i.name,t=Lt(i),r=e&&!t&&i.init?function(){this._props=[]}:i,s={init:Mh,render:Gf,add:Kg,kill:NA,modifier:LA,rawVars:0},a={targetTest:0,get:0,getSetter:Jg,aliases:{},register:0};if(qo(),i!==r){if(Zi[e])return;vr(r,vr(Ju(i,s),a)),En(r.prototype,En(s,Ju(i,a))),Zi[r.prop=e]=r,i.targetTest&&(Lu.push(r),qg[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}F1(e,r),i.register&&i.register(Gi,r,Hi)}else K1.push(i)},dt=255,Ul={aqua:[0,dt,dt],lime:[0,dt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,dt],navy:[0,0,128],white:[dt,dt,dt],olive:[128,128,0],yellow:[dt,dt,0],orange:[dt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[dt,0,0],pink:[dt,192,203],cyan:[0,dt,dt],transparent:[dt,dt,dt,0]},em=function(i,e,t){return(6*(i+=i<0?1:i>1?-1:0)<1?e+(t-e)*i*6:i<.5?t:3*i<2?e+(t-e)*(2/3-i)*6:e)*dt+.5|0},J1=function(i,e,t){var r,s,a,n,o,l,h,c,u,d,p=i?Ps(i)?[i>>16,i>>8&dt,i&dt]:0:Ul.black;if(!p){if(i.substr(-1)===","&&(i=i.substr(0,i.length-1)),Ul[i])p=Ul[i];else if(i.charAt(0)==="#"){if(i.length<6&&(r=i.charAt(1),s=i.charAt(2),a=i.charAt(3),i="#"+r+r+s+s+a+a+(i.length===5?i.charAt(4)+i.charAt(4):"")),i.length===9)return[(p=parseInt(i.substr(1,6),16))>>16,p>>8&dt,p&dt,parseInt(i.substr(7),16)/255];p=[(i=parseInt(i.substr(1),16))>>16,i>>8&dt,i&dt]}else if(i.substr(0,3)==="hsl")if(p=d=i.match(Of),e){if(~i.indexOf("="))return p=i.match(N1),t&&p.length<4&&(p[3]=1),p}else n=+p[0]%360/360,o=+p[1]/100,r=2*(l=+p[2]/100)-(s=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=em(n+1/3,r,s),p[1]=em(n,r,s),p[2]=em(n-1/3,r,s);else p=i.match(Of)||Ul.transparent;p=p.map(Number)}return e&&!d&&(r=p[0]/dt,s=p[1]/dt,a=p[2]/dt,l=((h=Math.max(r,s,a))+(c=Math.min(r,s,a)))/2,h===c?n=o=0:(u=h-c,o=l>.5?u/(2-h-c):u/(h+c),n=h===r?(s-a)/u+(s<a?6:0):h===s?(a-r)/u+2:(r-s)/u+4,n*=60),p[0]=~~(n+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),t&&p.length<4&&(p[3]=1),p},$1=function(i){var e=[],t=[],r=-1;return i.split(ha).forEach(function(s){var a=s.match(co)||[];e.push.apply(e,a),t.push(r+=a.length+1)}),e.c=t,e},k_=function(i,e,t){var r,s,a,n,o="",l=(i+o).match(ha),h=e?"hsla(":"rgba(",c=0;if(!l)return i;if(l=l.map(function(u){return(u=J1(u,e,1))&&h+(e?u[0]+","+u[1]+"%,"+u[2]+"%,"+u[3]:u.join(","))+")"}),t&&(a=$1(i),(r=t.c).join(o)!==a.c.join(o)))for(n=(s=i.replace(ha,"1").split(co)).length-1;c<n;c++)o+=s[c]+(~r.indexOf(c)?l.shift()||h+"0,0,0,0)":(a.length?a:l.length?l:t).shift());if(!s)for(n=(s=i.split(ha)).length-1;c<n;c++)o+=s[c]+l[c];return o+s[n]},ha=function(){var i,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(i in Ul)e+="|"+i+"\\b";return new RegExp(e+")","gi")}(),wA=/hsl[a]?\(/,eM=function(i){var e,t=i.join(" ");if(ha.lastIndex=0,ha.test(t))return e=wA.test(t),i[1]=k_(i[1],e),i[0]=k_(i[0],e,$1(i[1])),!0},er=function(){var i,e,t,r,s,a,n=Date.now,o=500,l=33,h=n(),c=h,u=1e3/240,d=u,p=[],f=function v(m){var g,_,y,x,M=n()-c,b=m===!0;if((M>o||M<0)&&(h+=M-l),((g=(y=(c+=M)-h)-d)>0||b)&&(x=++r.frame,s=y-1e3*r.time,r.time=y/=1e3,d+=g+(g>=u?4:u-g),_=1),b||(i=e(v)),_)for(a=0;a<p.length;a++)p[a](y,s,x,m)};return r={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(v){return s/(1e3/(v||60))},wake:function(){R1&&(!Nf&&Xg()&&(Xr=Nf=window,jg=Xr.document||{},ir.gsap=Gi,(Xr.gsapVersions||(Xr.gsapVersions=[])).push(Gi.version),U1(Ku||Xr.GreenSockGlobals||!Xr.gsap&&Xr||{}),K1.forEach(Q1)),t=typeof requestAnimationFrame<"u"&&requestAnimationFrame,i&&r.sleep(),e=t||function(v){return setTimeout(v,d-1e3*r.time+1|0)},yh=1,f(2))},sleep:function(){(t?cancelAnimationFrame:clearTimeout)(i),yh=0,e=Mh},lagSmoothing:function(v,m){o=v||1/0,l=Math.min(m||33,o)},fps:function(v){u=1e3/(v||240),d=1e3*r.time+u},add:function(v,m,g){var _=m?function(y,x,M,b){v(y,x,M,b),r.remove(_)}:v;return r.remove(v),p[g?"unshift":"push"](_),qo(),_},remove:function(v,m){~(m=p.indexOf(v))&&p.splice(m,1)&&a>=m&&a--},_listeners:p},r}(),qo=function(){return!yh&&er.wake()},et={},SA=/^[\d.\-M][\d.\-,\s]/,TA=/["']/g,AA=function(i){for(var e,t,r,s={},a=i.substr(1,i.length-3).split(":"),n=a[0],o=1,l=a.length;o<l;o++)t=a[o],e=o!==l-1?t.lastIndexOf(","):t.length,r=t.substr(0,e),s[n]=isNaN(r)?r.replace(TA,"").trim():+r,n=t.substr(e+1).trim();return s},tM=function(i){return function(e){return 1-i(1-e)}},iM=function i(e,t){for(var r,s=e._first;s;)s instanceof Ni?i(s,t):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===t||(s.timeline?i(s.timeline,t):(r=s._ease,s._ease=s._yEase,s._yEase=r,s._yoyo=t)),s=s._next},fn=function(i,e){return i&&(Lt(i)?i:et[i]||function(t){var r,s,a,n,o=(t+"").split("("),l=et[o[0]];return l&&o.length>1&&l.config?l.config.apply(null,~t.indexOf("{")?[AA(o[1])]:(r=t,s=r.indexOf("(")+1,a=r.indexOf(")"),n=r.indexOf("(",s),r.substring(s,~n&&n<a?r.indexOf(")",a+1):a)).split(",").map(z1)):et._CE&&SA.test(t)?et._CE("",t):l}(i))||e},Va=function(i,e,t,r){t===void 0&&(t=function(n){return 1-e(1-n)}),r===void 0&&(r=function(n){return n<.5?e(2*n)/2:1-e(2*(1-n))/2});var s,a={easeIn:e,easeOut:t,easeInOut:r};return zi(i,function(n){for(var o in et[n]=ir[n]=a,et[s=n.toLowerCase()]=t,a)et[s+(o==="easeIn"?".in":o==="easeOut"?".out":".inOut")]=et[n+"."+o]=a[o]}),a},rM=function(i){return function(e){return e<.5?(1-i(1-2*e))/2:.5+i(2*(e-.5))/2}},tm=function i(e,t,r){var s=t>=1?t:1,a=(r||(e?.3:.45))/(t<1?t:1),n=a/Df*(Math.asin(1/s)||0),o=function(h){return h===1?1:s*Math.pow(2,-10*h)*mA((h-n)*a)+1},l=e==="out"?o:e==="in"?function(h){return 1-o(1-h)}:rM(o);return a=Df/a,l.config=function(h,c){return i(e,h,c)},l},im=function i(e,t){t===void 0&&(t=1.70158);var r=function(a){return a?--a*a*((t+1)*a+t)+1:0},s=e==="out"?r:e==="in"?function(a){return 1-r(1-a)}:rM(r);return s.config=function(a){return i(e,a)},s};zi("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;Va(i+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(2*r,t)/2:1-Math.pow(2*(1-r),t)/2})}),et.Linear.easeNone=et.none=et.Linear.easeIn,Va("Elastic",tm("in"),tm("out"),tm()),_l=7.5625,E_=2*(Kp=1/(Jc=2.75)),C_=2.5*Kp,Va("Bounce",function(i){return 1-R_(1-i)},R_=function(i){return i<Kp?_l*i*i:i<E_?_l*Math.pow(i-1.5/Jc,2)+.75:i<C_?_l*(i-=2.25/Jc)*i+.9375:_l*Math.pow(i-2.625/Jc,2)+.984375}),Va("Expo",function(i){return i?Math.pow(2,10*(i-1)):0}),Va("Circ",function(i){return-(I1(1-i*i)-1)}),Va("Sine",function(i){return i===1?1:1-pA(i*uA)}),Va("Back",im("in"),im("out"),im()),et.SteppedEase=et.steps=ir.SteppedEase={config:function(i,e){i===void 0&&(i=1);var t=1/i,r=i+(e?0:1),s=e?1:0;return function(a){return((r*Qh(0,.99999999,a)|0)+s)*t}}},Wo.ease=et["quad.out"],zi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return Yg+=i+","+i+"Params,"});var sM=function(i,e){this.id=dA++,i._gsap=this,this.target=i,this.harness=e,this.get=e?e.get:k1,this.set=e?e.getSetter:Jg},wh=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Xo(this,+t.duration,1,1),this.data=t.data,xt&&(this._ctx=xt,xt.data.push(this)),yh||er.wake()}var e=i.prototype;return e.delay=function(t){return t||t===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,Xo(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,r){if(qo(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(Zd(this,t),!s._dp||s.parent||G1(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Yr(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Di||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),B1(this,t,r)),this},e.time=function(t,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+L_(this))%(this._dur+this._rDelay)||(t?this._dur:0),r):this._time},e.totalProgress=function(t,r){return arguments.length?this.totalTime(this.totalDuration()*t,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,r){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+L_(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*s,r):this._repeat?Mo(this._tTime,s)+1:1},e.timeScale=function(t,r){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===t)return this;var s=this.parent&&this._ts?$u(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-1e-8?0:this._rts,this.totalTime(Qh(-Math.abs(this._delay),this._tDur,s),r!==!1),Yd(this),function(a){for(var n=a.parent;n&&n.parent;)n._dirty=1,n.totalDuration(),n=n.parent;return a}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(qo(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Di&&(this._tTime-=Di)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&Yr(r,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(Vi(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var r=this.parent||this._dp;return r?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?$u(r.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){t===void 0&&(t=vA);var r=Ti;return Ti=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),this.data!=="nested"&&t.kill!==!1&&this.kill(),Ti=r,this},e.globalTime=function(t){for(var r=this,s=arguments.length?t:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(t):s},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,D_(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var r=this._time;return this._rDelay=t,D_(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,r){return this.totalTime(hr(this,t),Vi(r))},e.restart=function(t,r){return this.play().totalTime(t?-this._delay:0,Vi(r))},e.play=function(t,r){return t!=null&&this.seek(t,r),this.reversed(!1).paused(!1)},e.reverse=function(t,r){return t!=null&&this.seek(t||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(t,r){return t!=null&&this.seek(t,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,r=this.parent||this._dp,s=this._start;return!(r&&!(this._ts&&this._initted&&r.isActive()&&(t=r.rawTime(!0))>=s&&t<this.endTime(!0)-Di))},e.eventCallback=function(t,r,s){var a=this.vars;return arguments.length>1?(r?(a[t]=r,s&&(a[t+"Params"]=s),t==="onUpdate"&&(this._onUpdate=r)):delete a[t],this):a[t]},e.then=function(t){var r=this;return new Promise(function(s){var a=Lt(t)?t:V1,n=function(){var o=r.then;r.then=null,Lt(a)&&(a=a(r))&&(a.then||a===r)&&(r.then=o),s(a),r.then=o};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?n():r._prom=n})},e.kill=function(){Ol(this)},i}();vr(wh.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Ni=function(i){function e(r,s){var a;return r===void 0&&(r={}),(a=i.call(this,r)||this).labels={},a.smoothChildTiming=!!r.smoothChildTiming,a.autoRemoveChildren=!!r.autoRemoveChildren,a._sort=Vi(r.sortChildren),Tt&&Yr(r.parent||Tt,ms(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),r.scrollTrigger&&j1(ms(a),r.scrollTrigger),a}C1(e,i);var t=e.prototype;return t.to=function(r,s,a){return Zl(0,arguments,this),this},t.from=function(r,s,a){return Zl(1,arguments,this),this},t.fromTo=function(r,s,a,n){return Zl(2,arguments,this),this},t.set=function(r,s,a){return s.duration=0,s.parent=this,Yl(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new Zt(r,s,hr(this,a),1),this},t.call=function(r,s,a){return Yr(this,Zt.delayedCall(0,r,s),a)},t.staggerTo=function(r,s,a,n,o,l,h){return a.duration=s,a.stagger=a.stagger||n,a.onComplete=l,a.onCompleteParams=h,a.parent=this,new Zt(r,a,hr(this,o)),this},t.staggerFrom=function(r,s,a,n,o,l,h){return a.runBackwards=1,Yl(a).immediateRender=Vi(a.immediateRender),this.staggerTo(r,s,a,n,o,l,h)},t.staggerFromTo=function(r,s,a,n,o,l,h,c){return n.startAt=a,Yl(n).immediateRender=Vi(n.immediateRender),this.staggerTo(r,s,n,o,l,h,c)},t.render=function(r,s,a){var n,o,l,h,c,u,d,p,f,v,m,g,_=this._time,y=this._dirty?this.totalDuration():this._tDur,x=this._dur,M=r<=0?0:li(r),b=this._zTime<0!=r<0&&(this._initted||!x);if(this!==Tt&&M>y&&r>=0&&(M=y),M!==this._tTime||a||b){if(_!==this._time&&x&&(M+=this._time-_,r+=this._time-_),n=M,f=this._start,u=!(p=this._ts),b&&(x||(_=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(m=this._yoyo,c=x+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(100*c+r,s,a);if(n=li(M%c),M===y?(h=this._repeat,n=x):((h=~~(M/c))&&h===M/c&&(n=x,h--),n>x&&(n=x)),v=Mo(this._tTime,c),!_&&this._tTime&&v!==h&&this._tTime-v*c-this._dur<=0&&(v=h),m&&1&h&&(n=x-n,g=1),h!==v&&!this._lock){var w=m&&1&v,T=w===(m&&1&h);if(h<v&&(w=!w),_=w?0:M%x?x:M,this._lock=1,this.render(_||(g?0:li(h*c)),s,!x)._lock=0,this._tTime=M,!s&&this.parent&&Ki(this,"onRepeat"),this.vars.repeatRefresh&&!g&&(this.invalidate()._lock=1),_&&_!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(x=this._dur,y=this._tDur,T&&(this._lock=2,_=w?x:-1e-4,this.render(_,!0),this.vars.repeatRefresh&&!g&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;iM(this,g)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(d=function(I,E,L){var D;if(L>E)for(D=I._first;D&&D._start<=L;){if(D.data==="isPause"&&D._start>E)return D;D=D._next}else for(D=I._last;D&&D._start>=L;){if(D.data==="isPause"&&D._start<E)return D;D=D._prev}}(this,li(_),li(n)),d&&(M-=n-(n=d._start))),this._tTime=M,this._time=n,this._act=!p,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,_=0),!_&&n&&!s&&!h&&(Ki(this,"onStart"),this._tTime!==M))return this;if(n>=_&&r>=0)for(o=this._first;o;){if(l=o._next,(o._act||n>=o._start)&&o._ts&&d!==o){if(o.parent!==this)return this.render(r,s,a);if(o.render(o._ts>0?(n-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(n-o._start)*o._ts,s,a),n!==this._time||!this._ts&&!u){d=0,l&&(M+=this._zTime=-1e-8);break}}o=l}else{o=this._last;for(var R=r<0?r:n;o;){if(l=o._prev,(o._act||R<=o._end)&&o._ts&&d!==o){if(o.parent!==this)return this.render(r,s,a);if(o.render(o._ts>0?(R-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(R-o._start)*o._ts,s,a||Ti&&(o._initted||o._startAt)),n!==this._time||!this._ts&&!u){d=0,l&&(M+=this._zTime=R?-1e-8:Di);break}}o=l}}if(d&&!s&&(this.pause(),d.render(n>=_?0:-1e-8)._zTime=n>=_?1:-1,this._ts))return this._start=f,Yd(this),this.render(r,s,a);this._onUpdate&&!s&&Ki(this,"onUpdate",!0),(M===y&&this._tTime>=this.totalDuration()||!M&&_)&&(f!==this._start&&Math.abs(p)===Math.abs(this._ts)||this._lock||((r||!x)&&(M===y&&this._ts>0||!M&&this._ts<0)&&_a(this,1),s||r<0&&!_||!M&&!_&&y||(Ki(this,M===y&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(M<y&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var a=this;if(Ps(s)||(s=hr(this,s,r)),!(r instanceof wh)){if(bi(r))return r.forEach(function(n){return a.add(n,s)}),this;if(ci(r))return this.addLabel(r,s);if(!Lt(r))return this;r=Zt.delayedCall(0,r)}return this!==r?Yr(this,r,s):this},t.getChildren=function(r,s,a,n){r===void 0&&(r=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),n===void 0&&(n=-1e8);for(var o=[],l=this._first;l;)l._start>=n&&(l instanceof Zt?s&&o.push(l):(a&&o.push(l),r&&o.push.apply(o,l.getChildren(!0,s,a)))),l=l._next;return o},t.getById=function(r){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===r)return s[a]},t.remove=function(r){return ci(r)?this.removeLabel(r):Lt(r)?this.killTweensOf(r):(qd(this,r),r===this._recent&&(this._recent=this._last),mn(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=li(er.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),i.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=hr(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,a){var n=Zt.delayedCall(0,s||Mh,a);return n.data="isPause",this._hasPause=1,Yr(this,n,hr(this,r))},t.removePause=function(r){var s=this._first;for(r=hr(this,r);s;)s._start===r&&s.data==="isPause"&&_a(s),s=s._next},t.killTweensOf=function(r,s,a){for(var n=this.getTweensOf(r,a),o=n.length;o--;)Js!==n[o]&&n[o].kill(r,s);return this},t.getTweensOf=function(r,s){for(var a,n=[],o=mr(r),l=this._first,h=Ps(s);l;)l instanceof Zt?_A(l._targets,o)&&(h?(!Js||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&n.push(l):(a=l.getTweensOf(o,s)).length&&n.push.apply(n,a),l=l._next;return n},t.tweenTo=function(r,s){s=s||{};var a,n=this,o=hr(n,r),l=s,h=l.startAt,c=l.onStart,u=l.onStartParams,d=l.immediateRender,p=Zt.to(n,vr({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(h&&"time"in h?h.time:n._time))/n.timeScale())||Di,onStart:function(){if(n.pause(),!a){var f=s.duration||Math.abs((o-(h&&"time"in h?h.time:n._time))/n.timeScale());p._dur!==f&&Xo(p,f,0,1).render(p._time,!0,!0),a=1}c&&c.apply(p,u||[])}},s));return d?p.render(0):p},t.tweenFromTo=function(r,s,a){return this.tweenTo(s,vr({startAt:{time:hr(this,r)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),F_(this,hr(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),F_(this,hr(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Di)},t.shiftChildren=function(r,s,a){a===void 0&&(a=0);for(var n,o=this._first,l=this.labels;o;)o._start>=a&&(o._start+=r,o._end+=r),o=o._next;if(s)for(n in l)l[n]>=a&&(l[n]+=r);return mn(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return i.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s,a=this._first;a;)s=a._next,this.remove(a),a=s;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),mn(this)},t.totalDuration=function(r){var s,a,n,o=0,l=this,h=l._last,c=Ss;if(arguments.length)return l.timeScale((l._repeat<0?l.duration():l.totalDuration())/(l.reversed()?-r:r));if(l._dirty){for(n=l.parent;h;)s=h._prev,h._dirty&&h.totalDuration(),(a=h._start)>c&&l._sort&&h._ts&&!l._lock?(l._lock=1,Yr(l,h,a-h._delay,1)._lock=0):c=a,a<0&&h._ts&&(o-=a,(!n&&!l._dp||n&&n.smoothChildTiming)&&(l._start+=a/l._ts,l._time-=a,l._tTime-=a),l.shiftChildren(-a,!1,-1/0),c=0),h._end>o&&h._ts&&(o=h._end),h=s;Xo(l,l===Tt&&l._time>o?l._time:o,1,1),l._dirty=0}return l._tDur},e.updateRoot=function(r){if(Tt._ts&&(B1(Tt,$u(r,Tt)),P1=er.frame),er.frame>=P_){P_+=sr.autoSleep||120;var s=Tt._first;if((!s||!s._ts)&&sr.autoSleep&&er._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||er.sleep()}}},e}(wh);vr(Ni.prototype,{_lock:0,_hasPause:0,_forcing:0});var Js,Vf,EA=function(i,e,t,r,s,a,n){var o,l,h,c,u,d,p,f,v=new Hi(this._pt,i,e,0,1,cM,null,s),m=0,g=0;for(v.b=t,v.e=r,t+="",(p=~(r+="").indexOf("random("))&&(r=bh(r)),a&&(a(f=[t,r],i,e),t=f[0],r=f[1]),l=t.match(Qp)||[];o=Qp.exec(r);)c=o[0],u=r.substring(m,o.index),h?h=(h+1)%5:u.substr(-5)==="rgba("&&(h=1),c!==l[g++]&&(d=parseFloat(l[g-1])||0,v._pt={_next:v._pt,p:u||g===1?u:",",s:d,c:c.charAt(1)==="="?xo(d,c)-d:parseFloat(c)-d,m:h&&h<4?Math.round:0},m=Qp.lastIndex);return v.c=m<r.length?r.substring(m,r.length):"",v.fp=n,(D1.test(r)||p)&&(v.e=0),this._pt=v,v},Kg=function(i,e,t,r,s,a,n,o,l,h){Lt(r)&&(r=r(s||0,i,a));var c,u=i[e],d=t!=="get"?t:Lt(u)?l?i[e.indexOf("set")||!Lt(i["get"+e.substr(3)])?e:"get"+e.substr(3)](l):i[e]():u,p=Lt(u)?l?RA:lM:Qg;if(ci(r)&&(~r.indexOf("random(")&&(r=bh(r)),r.charAt(1)==="="&&((c=xo(d,r)+(wi(d)||0))||c===0)&&(r=c)),!h||d!==r||Vf)return isNaN(d*r)||r===""?EA.call(this,i,e,d,r,p,o||sr.stringFilter,l):(c=new Hi(this._pt,i,e,+d||0,r-(d||0),typeof u=="boolean"?IA:hM,0,p),l&&(c.fp=l),n&&c.modifier(n,this,i),this._pt=c)},aM=function(i,e,t,r,s,a){var n,o,l,h;if(Zi[i]&&(n=new Zi[i]).init(s,n.rawVars?e[i]:function(c,u,d,p,f){if(Lt(c)&&(c=Kl(c,f,u,d,p)),!rs(c)||c.style&&c.nodeType||bi(c)||L1(c))return ci(c)?Kl(c,f,u,d,p):c;var v,m={};for(v in c)m[v]=Kl(c[v],f,u,d,p);return m}(e[i],r,s,a,t),t,r,a)!==!1&&(t._pt=o=new Hi(t._pt,s,i,0,1,n.render,n,0,n.priority),t!==ho))for(l=t._ptLookup[t._targets.indexOf(s)],h=n._props.length;h--;)l[n._props[h]]=o;return n},Hf=function i(e,t,r){var s,a,n,o,l,h,c,u,d,p,f,v,m,g=e.vars,_=g.ease,y=g.startAt,x=g.immediateRender,M=g.lazy,b=g.onUpdate,w=g.runBackwards,T=g.yoyoEase,R=g.keyframes,I=g.autoRevert,E=e._dur,L=e._startAt,D=e._targets,U=e.parent,H=U&&U.data==="nested"?U.vars.targets:D,Z=e._overwrite==="auto"&&!Gg,te=e.timeline;if(te&&(!R||!_)&&(_="none"),e._ease=fn(_,Wo.ease),e._yEase=T?tM(fn(T===!0?_:T,Wo.ease)):0,T&&e._yoyo&&!e._repeat&&(T=e._yEase,e._yEase=e._ease,e._ease=T),e._from=!te&&!!g.runBackwards,!te||R&&!g.stagger){if(v=(u=D[0]?pn(D[0]).harness:0)&&g[u.prop],s=Ju(g,qg),L&&(L._zTime<0&&L.progress(1),t<0&&w&&x&&!I?L.render(-1,!0):L.revert(w&&E?Iu:gA),L._lazy=0),y){if(_a(e._startAt=Zt.set(D,vr({data:"isStart",overwrite:!1,parent:U,immediateRender:!0,lazy:!L&&Vi(M),startAt:null,delay:0,onUpdate:b&&function(){return Ki(e,"onUpdate")},stagger:0},y))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ti||!x&&!I)&&e._startAt.revert(Iu),x&&E&&t<=0&&r<=0)return void(t&&(e._zTime=t))}else if(w&&E&&!L)if(t&&(x=!1),n=vr({overwrite:!1,data:"isFromStart",lazy:x&&!L&&Vi(M),immediateRender:x,stagger:0,parent:U},s),v&&(n[u.prop]=v),_a(e._startAt=Zt.set(D,n)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ti?e._startAt.revert(Iu):e._startAt.render(-1,!0)),e._zTime=t,x){if(!t)return}else i(e._startAt,Di,Di);for(e._pt=e._ptCache=0,M=E&&Vi(M)||M&&!E,a=0;a<D.length;a++){if(c=(l=D[a])._gsap||Zg(D)[a]._gsap,e._ptLookup[a]=p={},Uf[c.id]&&la.length&&Qu(),f=H===D?a:H.indexOf(l),u&&(d=new u).init(l,v||s,e,f,H)!==!1&&(e._pt=o=new Hi(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach(function(ie){p[ie]=o}),d.priority&&(h=1)),!u||v)for(n in s)Zi[n]&&(d=aM(n,s,e,f,l,H))?d.priority&&(h=1):p[n]=o=Kg.call(e,l,n,"get",s[n],f,H,0,g.stringFilter);e._op&&e._op[a]&&e.kill(l,e._op[a]),Z&&e._pt&&(Js=e,Tt.killTweensOf(l,p,e.globalTime(t)),m=!e.parent,Js=0),e._pt&&M&&(Uf[c.id]=1)}h&&uM(e),e._onInit&&e._onInit(e)}e._onUpdate=b,e._initted=(!e._op||e._pt)&&!m,R&&t<=0&&te.render(Ss,!0,!0)},CA=function(i,e,t,r){var s,a,n=e.ease||r||"power1.inOut";if(bi(e))a=t[i]||(t[i]=[]),e.forEach(function(o,l){return a.push({t:l/(e.length-1)*100,v:o,e:n})});else for(s in e)a=t[s]||(t[s]=[]),s==="ease"||a.push({t:parseFloat(i),v:e[s],e:n})},Kl=function(i,e,t,r,s){return Lt(i)?i.call(e,t,r,s):ci(i)&&~i.indexOf("random(")?bh(i):i},nM=Yg+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",oM={};zi(nM+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return oM[i]=1});var Zt=function(i){function e(r,s,a,n){var o;typeof s=="number"&&(a.duration=s,s=a,a=null);var l,h,c,u,d,p,f,v,m=(o=i.call(this,n?s:Yl(s))||this).vars,g=m.duration,_=m.delay,y=m.immediateRender,x=m.stagger,M=m.overwrite,b=m.keyframes,w=m.defaults,T=m.scrollTrigger,R=m.yoyoEase,I=s.parent||Tt,E=(bi(r)||L1(r)?Ps(r[0]):"length"in s)?[r]:mr(r);if(o._targets=E.length?Zg(E):xh(0,!sr.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=M,b||x||$c(g)||$c(_)){if(s=o.vars,(l=o.timeline=new Ni({data:"nested",defaults:w||{},targets:I&&I.data==="nested"?I.vars.targets:E})).kill(),l.parent=l._dp=ms(o),l._start=0,x||$c(g)||$c(_)){if(u=E.length,f=x&&q1(x),rs(x))for(d in x)~nM.indexOf(d)&&(v||(v={}),v[d]=x[d]);for(h=0;h<u;h++)(c=Ju(s,oM)).stagger=0,R&&(c.yoyoEase=R),v&&En(c,v),p=E[h],c.duration=+Kl(g,ms(o),h,p,E),c.delay=(+Kl(_,ms(o),h,p,E)||0)-o._delay,!x&&u===1&&c.delay&&(o._delay=_=c.delay,o._start+=_,c.delay=0),l.to(p,c,f?f(h,p,E):0),l._ease=et.none;l.duration()?g=_=0:o.timeline=0}else if(b){Yl(vr(l.vars.defaults,{ease:"none"})),l._ease=fn(b.ease||s.ease||"none");var L,D,U,H=0;if(bi(b))b.forEach(function(Z){return l.to(E,Z,">")}),l.duration();else{for(d in c={},b)d==="ease"||d==="easeEach"||CA(d,b[d],c,b.easeEach);for(d in c)for(L=c[d].sort(function(Z,te){return Z.t-te.t}),H=0,h=0;h<L.length;h++)(U={ease:(D=L[h]).e,duration:(D.t-(h?L[h-1].t:0))/100*g})[d]=D.v,l.to(E,U,H),H+=U.duration;l.duration()<g&&l.to({},{duration:g-l.duration()})}}g||o.duration(g=l.duration())}else o.timeline=0;return M!==!0||Gg||(Js=ms(o),Tt.killTweensOf(E),Js=0),Yr(I,ms(o),a),s.reversed&&o.reverse(),s.paused&&o.paused(!0),(y||!g&&!b&&o._start===li(I._time)&&Vi(y)&&yA(ms(o))&&I.data!=="nested")&&(o._tTime=-1e-8,o.render(Math.max(0,-_)||0)),T&&j1(ms(o),T),o}C1(e,i);var t=e.prototype;return t.render=function(r,s,a){var n,o,l,h,c,u,d,p,f,v=this._time,m=this._tDur,g=this._dur,_=r<0,y=r>m-Di&&!_?m:r<Di?0:r;if(g){if(y!==this._tTime||!r||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==_){if(n=y,p=this.timeline,this._repeat){if(h=g+this._rDelay,this._repeat<-1&&_)return this.totalTime(100*h+r,s,a);if(n=li(y%h),y===m?(l=this._repeat,n=g):((l=~~(y/h))&&l===li(y/h)&&(n=g,l--),n>g&&(n=g)),(u=this._yoyo&&1&l)&&(f=this._yEase,n=g-n),c=Mo(this._tTime,h),n===v&&!a&&this._initted&&l===c)return this._tTime=y,this;l!==c&&(p&&this._yEase&&iM(p,u),this.vars.repeatRefresh&&!u&&!this._lock&&this._time!==h&&this._initted&&(this._lock=a=1,this.render(li(h*l),!0).invalidate()._lock=0))}if(!this._initted){if(N_(this,_?r:n,a,s,y))return this._tTime=0,this;if(!(v===this._time||a&&this.vars.repeatRefresh&&l!==c))return this;if(g!==this._dur)return this.render(r,s,a)}if(this._tTime=y,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=d=(f||this._ease)(n/g),this._from&&(this.ratio=d=1-d),n&&!v&&!s&&!l&&(Ki(this,"onStart"),this._tTime!==y))return this;for(o=this._pt;o;)o.r(d,o.d),o=o._next;p&&p.render(r<0?r:p._dur*p._ease(n/this._dur),s,a)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(_&&$p(this,r,0,a),Ki(this,"onUpdate")),this._repeat&&l!==c&&this.vars.onRepeat&&!s&&this.parent&&Ki(this,"onRepeat"),y!==this._tDur&&y||this._tTime!==y||(_&&!this._onUpdate&&$p(this,r,0,!0),(r||!g)&&(y===this._tDur&&this._ts>0||!y&&this._ts<0)&&_a(this,1),s||_&&!v||!(y||v||u)||(Ki(this,y===m?"onComplete":"onReverseComplete",!0),this._prom&&!(y<m&&this.timeScale()>0)&&this._prom()))}}else(function(x,M,b,w){var T,R,I,E=x.ratio,L=M<0||!M&&(!x._start&&xA(x)&&(x._initted||!Ff(x))||(x._ts<0||x._dp._ts<0)&&!Ff(x))?0:1,D=x._rDelay,U=0;if(D&&x._repeat&&(U=Qh(0,x._tDur,M),R=Mo(U,D),x._yoyo&&1&R&&(L=1-L),R!==Mo(x._tTime,D)&&(E=1-L,x.vars.repeatRefresh&&x._initted&&x.invalidate())),L!==E||Ti||w||x._zTime===Di||!M&&x._zTime){if(!x._initted&&N_(x,M,w,b,U))return;for(I=x._zTime,x._zTime=M||(b?Di:0),b||(b=M&&!I),x.ratio=L,x._from&&(L=1-L),x._time=0,x._tTime=U,T=x._pt;T;)T.r(L,T.d),T=T._next;M<0&&$p(x,M,0,!0),x._onUpdate&&!b&&Ki(x,"onUpdate"),U&&x._repeat&&!b&&x.parent&&Ki(x,"onRepeat"),(M>=x._tDur||M<0)&&x.ratio===L&&(L&&_a(x,1),b||Ti||(Ki(x,L?"onComplete":"onReverseComplete",!0),x._prom&&x._prom()))}else x._zTime||(x._zTime=M)})(this,r,s,a);return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),i.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,a,n,o){yh||er.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||Hf(this,l),function(h,c,u,d,p,f,v,m){var g,_,y,x,M=(h._pt&&h._ptCache||(h._ptCache={}))[c];if(!M)for(M=h._ptCache[c]=[],y=h._ptLookup,x=h._targets.length;x--;){if((g=y[x][c])&&g.d&&g.d._pt)for(g=g.d._pt;g&&g.p!==c&&g.fp!==c;)g=g._next;if(!g)return Vf=1,h.vars[c]="+=0",Hf(h,v),Vf=0,m?xh():1;M.push(g)}for(x=M.length;x--;)(g=(_=M[x])._pt||_).s=!d&&d!==0||p?g.s+(d||0)+f*g.c:d,g.c=u-g.s,_.e&&(_.e=zt(u)+wi(_.e)),_.b&&(_.b=g.s+wi(_.b))}(this,r,s,a,n,this._ease(l/this._dur),l,o)?this.resetTo(r,s,a,n,1):(Zd(this,0),this.parent||H1(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!(r||s&&s!=="all"))return this._lazy=this._pt=0,this.parent?Ol(this):this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,Js&&Js.vars.overwrite!==!0)._first||Ol(this),this.parent&&a!==this.timeline.totalDuration()&&Xo(this,this._dur*this.timeline._tDur/a,0,1),this}var n,o,l,h,c,u,d,p=this._targets,f=r?mr(r):p,v=this._ptLookup,m=this._pt;if((!s||s==="all")&&function(g,_){for(var y=g.length,x=y===_.length;x&&y--&&g[y]===_[y];);return y<0}(p,f))return s==="all"&&(this._pt=0),Ol(this);for(n=this._op=this._op||[],s!=="all"&&(ci(s)&&(c={},zi(s,function(g){return c[g]=1}),s=c),s=function(g,_){var y,x,M,b,w=g[0]?pn(g[0]).harness:0,T=w&&w.aliases;if(!T)return _;for(x in y=En({},_),T)if(x in y)for(M=(b=T[x].split(",")).length;M--;)y[b[M]]=y[x];return y}(p,s)),d=p.length;d--;)if(~f.indexOf(p[d]))for(c in o=v[d],s==="all"?(n[d]=s,h=o,l={}):(l=n[d]=n[d]||{},h=s),h)(u=o&&o[c])&&("kill"in u.d&&u.d.kill(c)!==!0||qd(this,u,"_pt"),delete o[c]),l!=="all"&&(l[c]=1);return this._initted&&!this._pt&&m&&Ol(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return Zl(1,arguments)},e.delayedCall=function(r,s,a,n){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:n})},e.fromTo=function(r,s,a){return Zl(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,a){return Tt.killTweensOf(r,s,a)},e}(wh);vr(Zt.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),zi("staggerTo,staggerFrom,staggerFromTo",function(i){Zt[i]=function(){var e=new Ni,t=kf.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var Qg=function(i,e,t){return i[e]=t},lM=function(i,e,t){return i[e](t)},RA=function(i,e,t,r){return i[e](r.fp,t)},PA=function(i,e,t){return i.setAttribute(e,t)},Jg=function(i,e){return Lt(i[e])?lM:Wg(i[e])&&i.setAttribute?PA:Qg},hM=function(i,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*i))/1e6,e)},IA=function(i,e){return e.set(e.t,e.p,!!(e.s+e.c*i),e)},cM=function(i,e){var t=e._pt,r="";if(!i&&e.b)r=e.b;else if(i===1&&e.e)r=e.e;else{for(;t;)r=t.p+(t.m?t.m(t.s+t.c*i):Math.round(1e4*(t.s+t.c*i))/1e4)+r,t=t._next;r+=e.c}e.set(e.t,e.p,r,e)},Gf=function(i,e){for(var t=e._pt;t;)t.r(i,t.d),t=t._next},LA=function(i,e,t,r){for(var s,a=this._pt;a;)s=a._next,a.p===r&&a.modifier(i,e,t),a=s},NA=function(i){for(var e,t,r=this._pt;r;)t=r._next,r.p===i&&!r.op||r.op===i?qd(this,r,"_pt"):r.dep||(e=1),r=t;return!e},DA=function(i,e,t,r){r.mSet(i,e,r.m.call(r.tween,t,r.mt),r)},uM=function(i){for(var e,t,r,s,a=i._pt;a;){for(e=a._next,t=r;t&&t.pr>a.pr;)t=t._next;(a._prev=t?t._prev:s)?a._prev._next=a:r=a,(a._next=t)?t._prev=a:s=a,a=e}i._pt=r},Hi=function(){function i(e,t,r,s,a,n,o,l,h){this.t=t,this.s=s,this.c=a,this.p=r,this.r=n||hM,this.d=o||this,this.set=l||Qg,this.pr=h||0,this._next=e,e&&(e._prev=this)}return i.prototype.modifier=function(e,t,r){this.mSet=this.mSet||this.set,this.set=DA,this.m=e,this.mt=r,this.tween=t},i}();zi(Yg+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return qg[i]=1}),ir.TweenMax=ir.TweenLite=Zt,ir.TimelineLite=ir.TimelineMax=Ni,Tt=new Ni({sortChildren:!1,defaults:Wo,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),sr.stringFilter=eM;var gn=[],Nu={},OA=[],B_=0,UA=0,rm=function(i){return(Nu[i]||OA).map(function(e){return e()})},jf=function(){var i=Date.now(),e=[];i-B_>2&&(rm("matchMediaInit"),gn.forEach(function(t){var r,s,a,n,o=t.queries,l=t.conditions;for(s in o)(r=Xr.matchMedia(o[s]).matches)&&(a=1),r!==l[s]&&(l[s]=r,n=1);n&&(t.revert(),a&&e.push(t))}),rm("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t,function(r){return t.add(null,r)})}),B_=i,rm("matchMedia"))},dM=function(){function i(t,r){this.selector=r&&Bf(r),this.data=[],this._r=[],this.isReverted=!1,this.id=UA++,t&&this.add(t)}var e=i.prototype;return e.add=function(t,r,s){Lt(t)&&(s=r,r=t,t=Lt);var a=this,n=function(){var o,l=xt,h=a.selector;return l&&l!==a&&l.data.push(a),s&&(a.selector=Bf(s)),xt=a,o=r.apply(a,arguments),Lt(o)&&a._r.push(o),xt=l,a.selector=h,a.isReverted=!1,o};return a.last=n,t===Lt?n(a,function(o){return a.add(null,o)}):t?a[t]=n:n},e.ignore=function(t){var r=xt;xt=null,t(this),xt=r},e.getTweens=function(){var t=[];return this.data.forEach(function(r){return r instanceof i?t.push.apply(t,r.getTweens()):r instanceof Zt&&!(r.parent&&r.parent.data==="nested")&&t.push(r)}),t},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,r){var s=this;if(t?function(){for(var n,o=s.getTweens(),l=s.data.length;l--;)(n=s.data[l]).data==="isFlip"&&(n.revert(),n.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,c){return c.g-h.g||-1/0}).forEach(function(h){return h.t.revert(t)}),l=s.data.length;l--;)(n=s.data[l])instanceof Ni?n.data!=="nested"&&(n.scrollTrigger&&n.scrollTrigger.revert(),n.kill()):!(n instanceof Zt)&&n.revert&&n.revert(t);s._r.forEach(function(h){return h(t,s)}),s.isReverted=!0}():this.data.forEach(function(n){return n.kill&&n.kill()}),this.clear(),r)for(var a=gn.length;a--;)gn[a].id===this.id&&gn.splice(a,1)},e.revert=function(t){this.kill(t||{})},i}(),FA=function(){function i(t){this.contexts=[],this.scope=t,xt&&xt.data.push(this)}var e=i.prototype;return e.add=function(t,r,s){rs(t)||(t={matches:t});var a,n,o,l=new dM(0,s||this.scope),h=l.conditions={};for(n in xt&&!l.selector&&(l.selector=xt.selector),this.contexts.push(l),r=l.add("onMatch",r),l.queries=t,t)n==="all"?o=1:(a=Xr.matchMedia(t[n]))&&(gn.indexOf(l)<0&&gn.push(l),(h[n]=a.matches)&&(o=1),a.addListener?a.addListener(jf):a.addEventListener("change",jf));return o&&r(l,function(c){return l.add(null,c)}),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(r){return r.kill(t,!0)})},i}(),ed={registerPlugin:function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e.forEach(function(r){return Q1(r)})},timeline:function(i){return new Ni(i)},getTweensOf:function(i,e){return Tt.getTweensOf(i,e)},getProperty:function(i,e,t,r){ci(i)&&(i=mr(i)[0]);var s=pn(i||{}).get,a=t?V1:z1;return t==="native"&&(t=""),i&&(e?a((Zi[e]&&Zi[e].get||s)(i,e,t,r)):function(n,o,l){return a((Zi[n]&&Zi[n].get||s)(i,n,o,l))})},quickSetter:function(i,e,t){if((i=mr(i)).length>1){var r=i.map(function(h){return Gi.quickSetter(h,e,t)}),s=r.length;return function(h){for(var c=s;c--;)r[c](h)}}i=i[0]||{};var a=Zi[e],n=pn(i),o=n.harness&&(n.harness.aliases||{})[e]||e,l=a?function(h){var c=new a;ho._pt=0,c.init(i,t?h+t:h,ho,0,[i]),c.render(1,c),ho._pt&&Gf(1,ho)}:n.set(i,o);return a?l:function(h){return l(i,o,t?h+t:h,n,1)}},quickTo:function(i,e,t){var r,s=Gi.to(i,En(((r={})[e]="+=0.1",r.paused=!0,r),t||{})),a=function(n,o,l){return s.resetTo(e,n,o,l)};return a.tween=s,a},isTweening:function(i){return Tt.getTweensOf(i,!0).length>0},defaults:function(i){return i&&i.ease&&(i.ease=fn(i.ease,Wo.ease)),I_(Wo,i||{})},config:function(i){return I_(sr,i||{})},registerEffect:function(i){var e=i.name,t=i.effect,r=i.plugins,s=i.defaults,a=i.extendTimeline;(r||"").split(",").forEach(function(n){return n&&!Zi[n]&&!ir[n]&&xh()}),Jp[e]=function(n,o,l){return t(mr(n),vr(o||{},s),l)},a&&(Ni.prototype[e]=function(n,o,l){return this.add(Jp[e](n,rs(o)?o:(l=o)&&{},this),l)})},registerEase:function(i,e){et[i]=fn(e)},parseEase:function(i,e){return arguments.length?fn(i,e):et},getById:function(i){return Tt.getById(i)},exportRoot:function(i,e){i===void 0&&(i={});var t,r,s=new Ni(i);for(s.smoothChildTiming=Vi(i.smoothChildTiming),Tt.remove(s),s._dp=0,s._time=s._tTime=Tt._time,t=Tt._first;t;)r=t._next,!e&&!t._dur&&t instanceof Zt&&t.vars.onComplete===t._targets[0]||Yr(s,t,t._start-t._delay),t=r;return Yr(Tt,s,0),s},context:function(i,e){return i?new dM(i,e):xt},matchMedia:function(i){return new FA(i)},matchMediaRefresh:function(){return gn.forEach(function(i){var e,t,r=i.conditions;for(t in r)r[t]&&(r[t]=!1,e=1);e&&i.revert()})||jf()},addEventListener:function(i,e){var t=Nu[i]||(Nu[i]=[]);~t.indexOf(e)||t.push(e)},removeEventListener:function(i,e){var t=Nu[i],r=t&&t.indexOf(e);r>=0&&t.splice(r,1)},utils:{wrap:function i(e,t,r){var s=t-e;return bi(e)?O_(e,i(0,e.length),t):Qs(r,function(a){return(s+(a-e)%s)%s+e})},wrapYoyo:function i(e,t,r){var s=t-e,a=2*s;return bi(e)?O_(e,i(0,e.length-1),t):Qs(r,function(n){return e+((n=(a+(n-e)%a)%a||0)>s?a-n:n)})},distribute:q1,random:Z1,snap:Y1,normalize:function(i,e,t){return U_(i,e,0,1,t)},getUnit:wi,clamp:function(i,e,t){return Qs(t,function(r){return Qh(i,e,r)})},splitColor:J1,toArray:mr,selector:Bf,mapRange:U_,pipe:function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(r){return e.reduce(function(s,a){return a(s)},r)}},unitize:function(i,e){return function(t){return i(parseFloat(t))+(e||wi(t))}},interpolate:function i(e,t,r,s){var a=isNaN(e+t)?0:function(p){return(1-p)*e+p*t};if(!a){var n,o,l,h,c,u=ci(e),d={};if(r===!0&&(s=1)&&(r=null),u)e={p:e},t={p:t};else if(bi(e)&&!bi(t)){for(l=[],h=e.length,c=h-2,o=1;o<h;o++)l.push(i(e[o-1],e[o]));h--,a=function(p){p*=h;var f=Math.min(c,~~p);return l[f](p-f)},r=t}else s||(e=En(bi(e)?[]:{},e));if(!l){for(n in t)Kg.call(d,e,n,"get",t[n]);a=function(p){return Gf(p,d)||(u?e.p:e)}}}return Qs(r,a)},shuffle:X1},install:U1,effects:Jp,ticker:er,updateRoot:Ni.updateRoot,plugins:Zi,globalTimeline:Tt,core:{PropTween:Hi,globals:F1,Tween:Zt,Timeline:Ni,Animation:wh,getCache:pn,_removeLinkedListItem:qd,reverting:function(){return Ti},context:function(i){return i&&xt&&(xt.data.push(i),i._ctx=xt),xt},suppressOverwrites:function(i){return Gg=i}}};zi("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return ed[i]=Zt[i]}),er.add(Ni.updateRoot),ho=ed.to({},{duration:0});var kA=function(i,e){for(var t=i._pt;t&&t.p!==e&&t.op!==e&&t.fp!==e;)t=t._next;return t},sm=function(i,e){return{name:i,rawVars:1,init:function(t,r,s){s._onInit=function(a){var n,o;if(ci(r)&&(n={},zi(r,function(l){return n[l]=1}),r=n),e){for(o in n={},r)n[o]=e(r[o]);r=n}(function(l,h){var c,u,d,p=l._targets;for(c in h)for(u=p.length;u--;)(d=l._ptLookup[u][c])&&(d=d.d)&&(d._pt&&(d=kA(d,c)),d&&d.modifier&&d.modifier(h[c],l,p[u],c))})(a,r)}}}},Gi=ed.registerPlugin({name:"attr",init:function(i,e,t,r,s){var a,n,o;for(a in this.tween=t,e)o=i.getAttribute(a)||"",(n=this.add(i,"setAttribute",(o||0)+"",e[a],r,s,0,0,a)).op=a,n.b=o,this._props.push(a)},render:function(i,e){for(var t=e._pt;t;)Ti?t.set(t.t,t.p,t.b,t):t.r(i,t.d),t=t._next}},{name:"endArray",init:function(i,e){for(var t=e.length;t--;)this.add(i,t,i[t]||0,e[t],0,0,0,0,0,1)}},sm("roundProps",zf),sm("modifiers"),sm("snap",Y1))||ed;Zt.version=Ni.version=Gi.version="3.12.5",R1=1,Xg()&&qo(),et.Power0,et.Power1,et.Power2,et.Power3,et.Power4,et.Linear,et.Quad,et.Cubic,et.Quart,et.Quint,et.Strong,et.Elastic,et.Back,et.SteppedEase,et.Bounce,et.Sine,et.Expo,et.Circ;var z_,$s,bo,$g,hn,V_,e0,pM,Is={},Qa=180/Math.PI,wo=Math.PI/180,eo=Math.atan2,t0=/([A-Z])/g,BA=/(left|right|width|margin|padding|x)/i,zA=/[\s,\(]\S/,Zr={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Wf=function(i,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*i))/1e4+e.u,e)},VA=function(i,e){return e.set(e.t,e.p,i===1?e.e:Math.round(1e4*(e.s+e.c*i))/1e4+e.u,e)},HA=function(i,e){return e.set(e.t,e.p,i?Math.round(1e4*(e.s+e.c*i))/1e4+e.u:e.b,e)},GA=function(i,e){var t=e.s+e.c*i;e.set(e.t,e.p,~~(t+(t<0?-.5:.5))+e.u,e)},mM=function(i,e){return e.set(e.t,e.p,i?e.e:e.b,e)},fM=function(i,e){return e.set(e.t,e.p,i!==1?e.b:e.e,e)},jA=function(i,e,t){return i.style[e]=t},WA=function(i,e,t){return i.style.setProperty(e,t)},XA=function(i,e,t){return i._gsap[e]=t},qA=function(i,e,t){return i._gsap.scaleX=i._gsap.scaleY=t},YA=function(i,e,t,r,s){var a=i._gsap;a.scaleX=a.scaleY=t,a.renderTransform(s,a)},ZA=function(i,e,t,r,s){var a=i._gsap;a[e]=t,a.renderTransform(s,a)},Et="transform",ji=Et+"Origin",KA=function i(e,t){var r=this,s=this.target,a=s.style,n=s._gsap;if(e in Is&&a){if(this.tfm=this.tfm||{},e==="transform")return Zr.transform.split(",").forEach(function(o){return i.call(r,o,t)});if(~(e=Zr[e]||e).indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=gs(s,o)}):this.tfm[e]=n.x?n[e]:gs(s,e),e===ji&&(this.tfm.zOrigin=n.zOrigin),this.props.indexOf(Et)>=0)return;n.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(ji,t,"")),e=Et}(a||t)&&this.props.push(e,t,a[e])},gM=function(i){i.translate&&(i.removeProperty("translate"),i.removeProperty("scale"),i.removeProperty("rotate"))},QA=function(){var i,e,t=this.props,r=this.target,s=r.style,a=r._gsap;for(i=0;i<t.length;i+=3)t[i+1]?r[t[i]]=t[i+2]:t[i+2]?s[t[i]]=t[i+2]:s.removeProperty(t[i].substr(0,2)==="--"?t[i]:t[i].replace(t0,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)a[e]=this.tfm[e];a.svg&&(a.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(i=e0())&&i.isStart||s[Et]||(gM(s),a.zOrigin&&s[ji]&&(s[ji]+=" "+a.zOrigin+"px",a.zOrigin=0,a.renderTransform()),a.uncache=1)}},vM=function(i,e){var t={target:i,props:[],revert:QA,save:KA};return i._gsap||Gi.core.getCache(i),e&&e.split(",").forEach(function(r){return t.save(r)}),t},Xf=function(i,e){var t=$s.createElementNS?$s.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),i):$s.createElement(i);return t&&t.style?t:$s.createElement(i)},$r=function i(e,t,r){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(t0,"-$1").toLowerCase())||s.getPropertyValue(t)||!r&&i(e,Yo(t)||t,1)||""},H_="O,Moz,ms,Ms,Webkit".split(","),Yo=function(i,e,t){var r=(e||hn).style,s=5;if(i in r&&!t)return i;for(i=i.charAt(0).toUpperCase()+i.substr(1);s--&&!(H_[s]+i in r););return s<0?null:(s===3?"ms":s>=0?H_[s]:"")+i},qf=function(){typeof window<"u"&&window.document&&(z_=window,$s=z_.document,bo=$s.documentElement,hn=Xf("div")||{style:{}},Xf("div"),Et=Yo(Et),ji=Et+"Origin",hn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",pM=!!Yo("perspective"),e0=Gi.core.reverting,$g=1)},am=function i(e){var t,r=Xf("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,a=this.nextSibling,n=this.style.cssText;if(bo.appendChild(r),r.appendChild(this),this.style.display="block",e)try{t=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=i}catch{}else this._gsapBBox&&(t=this._gsapBBox());return s&&(a?s.insertBefore(this,a):s.appendChild(this)),bo.removeChild(r),this.style.cssText=n,t},G_=function(i,e){for(var t=e.length;t--;)if(i.hasAttribute(e[t]))return i.getAttribute(e[t])},_M=function(i){var e;try{e=i.getBBox()}catch{e=am.call(i,!0)}return e&&(e.width||e.height)||i.getBBox===am||(e=am.call(i,!0)),!e||e.width||e.x||e.y?e:{x:+G_(i,["x","cx","x1"])||0,y:+G_(i,["y","cy","y1"])||0,width:0,height:0}},yM=function(i){return!(!i.getCTM||i.parentNode&&!i.ownerSVGElement||!_M(i))},Cn=function(i,e){if(e){var t,r=i.style;e in Is&&e!==ji&&(e=Et),r.removeProperty?((t=e.substr(0,2))!=="ms"&&e.substr(0,6)!=="webkit"||(e="-"+e),r.removeProperty(t==="--"?e:e.replace(t0,"-$1").toLowerCase())):r.removeAttribute(e)}},ea=function(i,e,t,r,s,a){var n=new Hi(i._pt,e,t,0,1,a?fM:mM);return i._pt=n,n.b=r,n.e=s,i._props.push(t),n},j_={deg:1,rad:1,turn:1},JA={grid:1,flex:1},ya=function i(e,t,r,s){var a,n,o,l,h=parseFloat(r)||0,c=(r+"").trim().substr((h+"").length)||"px",u=hn.style,d=BA.test(t),p=e.tagName.toLowerCase()==="svg",f=(p?"client":"offset")+(d?"Width":"Height"),v=100,m=s==="px",g=s==="%";if(s===c||!h||j_[s]||j_[c])return h;if(c!=="px"&&!m&&(h=i(e,t,r,"px")),l=e.getCTM&&yM(e),(g||c==="%")&&(Is[t]||~t.indexOf("adius")))return a=l?e.getBBox()[d?"width":"height"]:e[f],zt(g?h/a*v:h/100*a);if(u[d?"width":"height"]=v+(m?c:s),n=~t.indexOf("adius")||s==="em"&&e.appendChild&&!p?e:e.parentNode,l&&(n=(e.ownerSVGElement||{}).parentNode),n&&n!==$s&&n.appendChild||(n=$s.body),(o=n._gsap)&&g&&o.width&&d&&o.time===er.time&&!o.uncache)return zt(h/o.width*v);if(!g||t!=="height"&&t!=="width")(g||c==="%")&&!JA[$r(n,"display")]&&(u.position=$r(e,"position")),n===e&&(u.position="static"),n.appendChild(hn),a=hn[f],n.removeChild(hn),u.position="absolute";else{var _=e.style[t];e.style[t]=v+s,a=e[f],_?e.style[t]=_:Cn(e,t)}return d&&g&&((o=pn(n)).time=er.time,o.width=n[f]),zt(m?a*h/v:a&&h?v/a*h:0)},gs=function(i,e,t,r){var s;return $g||qf(),e in Zr&&e!=="transform"&&~(e=Zr[e]).indexOf(",")&&(e=e.split(",")[0]),Is[e]&&e!=="transform"?(s=Th(i,r),s=e!=="transformOrigin"?s[e]:s.svg?s.origin:id($r(i,ji))+" "+s.zOrigin+"px"):(!(s=i.style[e])||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=td[e]&&td[e](i,e,t)||$r(i,e)||k1(i,e)||(e==="opacity"?1:0)),t&&!~(s+"").trim().indexOf(" ")?ya(i,e,s,t)+t:s},$A=function(i,e,t,r){if(!t||t==="none"){var s=Yo(e,i,1),a=s&&$r(i,s,1);a&&a!==t?(e=s,t=a):e==="borderColor"&&(t=$r(i,"borderTopColor"))}var n,o,l,h,c,u,d,p,f,v,m,g=new Hi(this._pt,i.style,e,0,1,cM),_=0,y=0;if(g.b=t,g.e=r,t+="",(r+="")=="auto"&&(u=i.style[e],i.style[e]=r,r=$r(i,e)||r,u?i.style[e]=u:Cn(i,e)),eM(n=[t,r]),r=n[1],l=(t=n[0]).match(co)||[],(r.match(co)||[]).length){for(;o=co.exec(r);)d=o[0],f=r.substring(_,o.index),c?c=(c+1)%5:f.substr(-5)!=="rgba("&&f.substr(-5)!=="hsla("||(c=1),d!==(u=l[y++]||"")&&(h=parseFloat(u)||0,m=u.substr((h+"").length),d.charAt(1)==="="&&(d=xo(h,d)+m),p=parseFloat(d),v=d.substr((p+"").length),_=co.lastIndex-v.length,v||(v=v||sr.units[e]||m,_===r.length&&(r+=v,g.e+=v)),m!==v&&(h=ya(i,e,u,v)||0),g._pt={_next:g._pt,p:f||y===1?f:",",s:h,c:p-h,m:c&&c<4||e==="zIndex"?Math.round:0});g.c=_<r.length?r.substring(_,r.length):""}else g.r=e==="display"&&r==="none"?fM:mM;return D1.test(r)&&(g.e=0),this._pt=g,g},W_={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},eE=function(i){var e=i.split(" "),t=e[0],r=e[1]||"50%";return t!=="top"&&t!=="bottom"&&r!=="left"&&r!=="right"||(i=t,t=r,r=i),e[0]=W_[t]||t,e[1]=W_[r]||r,e.join(" ")},tE=function(i,e){if(e.tween&&e.tween._time===e.tween._dur){var t,r,s,a=e.t,n=a.style,o=e.u,l=a._gsap;if(o==="all"||o===!0)n.cssText="",r=1;else for(s=(o=o.split(",")).length;--s>-1;)t=o[s],Is[t]&&(r=1,t=t==="transformOrigin"?ji:Et),Cn(a,t);r&&(Cn(a,Et),l&&(l.svg&&a.removeAttribute("transform"),Th(a,1),l.uncache=1,gM(n)))}},td={clearProps:function(i,e,t,r,s){if(s.data!=="isFromStart"){var a=i._pt=new Hi(i._pt,e,t,0,0,tE);return a.u=r,a.pr=-10,a.tween=s,i._props.push(t),1}}},Sh=[1,0,0,1,0,0],xM={},MM=function(i){return i==="matrix(1, 0, 0, 1, 0, 0)"||i==="none"||!i},X_=function(i){var e=$r(i,Et);return MM(e)?Sh:e.substr(7).match(N1).map(zt)},i0=function(i,e){var t,r,s,a,n=i._gsap||pn(i),o=i.style,l=X_(i);return n.svg&&i.getAttribute("transform")?(l=[(s=i.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")==="1,0,0,1,0,0"?Sh:l:(l!==Sh||i.offsetParent||i===bo||n.svg||(s=o.display,o.display="block",(t=i.parentNode)&&i.offsetParent||(a=1,r=i.nextElementSibling,bo.appendChild(i)),l=X_(i),s?o.display=s:Cn(i,"display"),a&&(r?t.insertBefore(i,r):t?t.appendChild(i):bo.removeChild(i))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Yf=function(i,e,t,r,s,a){var n,o,l,h=i._gsap,c=s||i0(i,!0),u=h.xOrigin||0,d=h.yOrigin||0,p=h.xOffset||0,f=h.yOffset||0,v=c[0],m=c[1],g=c[2],_=c[3],y=c[4],x=c[5],M=e.split(" "),b=parseFloat(M[0])||0,w=parseFloat(M[1])||0;t?c!==Sh&&(o=v*_-m*g)&&(l=b*(-m/o)+w*(v/o)-(v*x-m*y)/o,b=b*(_/o)+w*(-g/o)+(g*x-_*y)/o,w=l):(b=(n=_M(i)).x+(~M[0].indexOf("%")?b/100*n.width:b),w=n.y+(~(M[1]||M[0]).indexOf("%")?w/100*n.height:w)),r||r!==!1&&h.smooth?(y=b-u,x=w-d,h.xOffset=p+(y*v+x*g)-y,h.yOffset=f+(y*m+x*_)-x):h.xOffset=h.yOffset=0,h.xOrigin=b,h.yOrigin=w,h.smooth=!!r,h.origin=e,h.originIsAbsolute=!!t,i.style[ji]="0px 0px",a&&(ea(a,h,"xOrigin",u,b),ea(a,h,"yOrigin",d,w),ea(a,h,"xOffset",p,h.xOffset),ea(a,h,"yOffset",f,h.yOffset)),i.setAttribute("data-svg-origin",b+" "+w)},Th=function(i,e){var t=i._gsap||new sM(i);if("x"in t&&!e&&!t.uncache)return t;var r,s,a,n,o,l,h,c,u,d,p,f,v,m,g,_,y,x,M,b,w,T,R,I,E,L,D,U,H,Z,te,ie,ve=i.style,be=t.scaleX<0,J="px",ne="deg",de=getComputedStyle(i),re=$r(i,ji)||"0";return r=s=a=l=h=c=u=d=p=0,n=o=1,t.svg=!(!i.getCTM||!yM(i)),de.translate&&(de.translate==="none"&&de.scale==="none"&&de.rotate==="none"||(ve[Et]=(de.translate!=="none"?"translate3d("+(de.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(de.rotate!=="none"?"rotate("+de.rotate+") ":"")+(de.scale!=="none"?"scale("+de.scale.split(" ").join(",")+") ":"")+(de[Et]!=="none"?de[Et]:"")),ve.scale=ve.rotate=ve.translate="none"),m=i0(i,t.svg),t.svg&&(t.uncache?(E=i.getBBox(),re=t.xOrigin-E.x+"px "+(t.yOrigin-E.y)+"px",I=""):I=!e&&i.getAttribute("data-svg-origin"),Yf(i,I||re,!!I||t.originIsAbsolute,t.smooth!==!1,m)),f=t.xOrigin||0,v=t.yOrigin||0,m!==Sh&&(x=m[0],M=m[1],b=m[2],w=m[3],r=T=m[4],s=R=m[5],m.length===6?(n=Math.sqrt(x*x+M*M),o=Math.sqrt(w*w+b*b),l=x||M?eo(M,x)*Qa:0,(u=b||w?eo(b,w)*Qa+l:0)&&(o*=Math.abs(Math.cos(u*wo))),t.svg&&(r-=f-(f*x+v*b),s-=v-(f*M+v*w))):(ie=m[6],Z=m[7],D=m[8],U=m[9],H=m[10],te=m[11],r=m[12],s=m[13],a=m[14],h=(g=eo(ie,H))*Qa,g&&(I=T*(_=Math.cos(-g))+D*(y=Math.sin(-g)),E=R*_+U*y,L=ie*_+H*y,D=T*-y+D*_,U=R*-y+U*_,H=ie*-y+H*_,te=Z*-y+te*_,T=I,R=E,ie=L),c=(g=eo(-b,H))*Qa,g&&(_=Math.cos(-g),te=w*(y=Math.sin(-g))+te*_,x=I=x*_-D*y,M=E=M*_-U*y,b=L=b*_-H*y),l=(g=eo(M,x))*Qa,g&&(I=x*(_=Math.cos(g))+M*(y=Math.sin(g)),E=T*_+R*y,M=M*_-x*y,R=R*_-T*y,x=I,T=E),h&&Math.abs(h)+Math.abs(l)>359.9&&(h=l=0,c=180-c),n=zt(Math.sqrt(x*x+M*M+b*b)),o=zt(Math.sqrt(R*R+ie*ie)),g=eo(T,R),u=Math.abs(g)>2e-4?g*Qa:0,p=te?1/(te<0?-te:te):0),t.svg&&(I=i.getAttribute("transform"),t.forceCSS=i.setAttribute("transform","")||!MM($r(i,Et)),I&&i.setAttribute("transform",I))),Math.abs(u)>90&&Math.abs(u)<270&&(be?(n*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),e=e||t.uncache,t.x=r-((t.xPercent=r&&(!e&&t.xPercent||(Math.round(i.offsetWidth/2)===Math.round(-r)?-50:0)))?i.offsetWidth*t.xPercent/100:0)+J,t.y=s-((t.yPercent=s&&(!e&&t.yPercent||(Math.round(i.offsetHeight/2)===Math.round(-s)?-50:0)))?i.offsetHeight*t.yPercent/100:0)+J,t.z=a+J,t.scaleX=zt(n),t.scaleY=zt(o),t.rotation=zt(l)+ne,t.rotationX=zt(h)+ne,t.rotationY=zt(c)+ne,t.skewX=u+ne,t.skewY=d+ne,t.transformPerspective=p+J,(t.zOrigin=parseFloat(re.split(" ")[2])||!e&&t.zOrigin||0)&&(ve[ji]=id(re)),t.xOffset=t.yOffset=0,t.force3D=sr.force3D,t.renderTransform=t.svg?rE:pM?bM:iE,t.uncache=0,t},id=function(i){return(i=i.split(" "))[0]+" "+i[1]},nm=function(i,e,t){var r=wi(e);return zt(parseFloat(e)+parseFloat(ya(i,"x",t+"px",r)))+r},iE=function(i,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,bM(i,e)},Ha="0deg",yl="0px",Ga=") ",bM=function(i,e){var t=e||this,r=t.xPercent,s=t.yPercent,a=t.x,n=t.y,o=t.z,l=t.rotation,h=t.rotationY,c=t.rotationX,u=t.skewX,d=t.skewY,p=t.scaleX,f=t.scaleY,v=t.transformPerspective,m=t.force3D,g=t.target,_=t.zOrigin,y="",x=m==="auto"&&i&&i!==1||m===!0;if(_&&(c!==Ha||h!==Ha)){var M,b=parseFloat(h)*wo,w=Math.sin(b),T=Math.cos(b);b=parseFloat(c)*wo,M=Math.cos(b),a=nm(g,a,w*M*-_),n=nm(g,n,-Math.sin(b)*-_),o=nm(g,o,T*M*-_+_)}v!==yl&&(y+="perspective("+v+Ga),(r||s)&&(y+="translate("+r+"%, "+s+"%) "),(x||a!==yl||n!==yl||o!==yl)&&(y+=o!==yl||x?"translate3d("+a+", "+n+", "+o+") ":"translate("+a+", "+n+Ga),l!==Ha&&(y+="rotate("+l+Ga),h!==Ha&&(y+="rotateY("+h+Ga),c!==Ha&&(y+="rotateX("+c+Ga),u===Ha&&d===Ha||(y+="skew("+u+", "+d+Ga),p===1&&f===1||(y+="scale("+p+", "+f+Ga),g.style[Et]=y||"translate(0, 0)"},rE=function(i,e){var t,r,s,a,n,o=e||this,l=o.xPercent,h=o.yPercent,c=o.x,u=o.y,d=o.rotation,p=o.skewX,f=o.skewY,v=o.scaleX,m=o.scaleY,g=o.target,_=o.xOrigin,y=o.yOrigin,x=o.xOffset,M=o.yOffset,b=o.forceCSS,w=parseFloat(c),T=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=wo,p*=wo,t=Math.cos(d)*v,r=Math.sin(d)*v,s=Math.sin(d-p)*-m,a=Math.cos(d-p)*m,p&&(f*=wo,n=Math.tan(p-f),s*=n=Math.sqrt(1+n*n),a*=n,f&&(n=Math.tan(f),t*=n=Math.sqrt(1+n*n),r*=n)),t=zt(t),r=zt(r),s=zt(s),a=zt(a)):(t=v,a=m,r=s=0),(w&&!~(c+"").indexOf("px")||T&&!~(u+"").indexOf("px"))&&(w=ya(g,"x",c,"px"),T=ya(g,"y",u,"px")),(_||y||x||M)&&(w=zt(w+_-(_*t+y*s)+x),T=zt(T+y-(_*r+y*a)+M)),(l||h)&&(n=g.getBBox(),w=zt(w+l/100*n.width),T=zt(T+h/100*n.height)),n="matrix("+t+","+r+","+s+","+a+","+w+","+T+")",g.setAttribute("transform",n),b&&(g.style[Et]=n)},sE=function(i,e,t,r,s){var a,n,o=360,l=ci(s),h=parseFloat(s)*(l&&~s.indexOf("rad")?Qa:1)-r,c=r+h+"deg";return l&&((a=s.split("_")[1])==="short"&&(h%=o)!==h%180&&(h+=h<0?o:-360),a==="cw"&&h<0?h=(h+36e9)%o-~~(h/o)*o:a==="ccw"&&h>0&&(h=(h-36e9)%o-~~(h/o)*o)),i._pt=n=new Hi(i._pt,e,t,r,h,VA),n.e=c,n.u="deg",i._props.push(t),n},q_=function(i,e){for(var t in e)i[t]=e[t];return i},aE=function(i,e,t){var r,s,a,n,o,l,h,c=q_({},t._gsap),u=t.style;for(s in c.svg?(a=t.getAttribute("transform"),t.setAttribute("transform",""),u[Et]=e,r=Th(t,1),Cn(t,Et),t.setAttribute("transform",a)):(a=getComputedStyle(t)[Et],u[Et]=e,r=Th(t,1),u[Et]=a),Is)(a=c[s])!==(n=r[s])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(s)<0&&(o=wi(a)!==(h=wi(n))?ya(t,s,a,h):parseFloat(a),l=parseFloat(n),i._pt=new Hi(i._pt,r,s,o,l-o,Wf),i._pt.u=h||0,i._props.push(s));q_(r,c)};zi("padding,margin,Width,Radius",function(i,e){var t="Top",r="Right",s="Bottom",a="Left",n=(e<3?[t,r,s,a]:[t+a,t+r,s+r,s+a]).map(function(o){return e<2?i+o:"border"+o+i});td[e>1?"border"+i:i]=function(o,l,h,c,u){var d,p;if(arguments.length<4)return d=n.map(function(f){return gs(o,f,h)}),(p=d.join(" ")).split(d[0]).length===5?d[0]:p;d=(c+"").split(" "),p={},n.forEach(function(f,v){return p[f]=d[v]=d[v]||d[(v-1)/2|0]}),o.init(l,p,u)}});var Y_,om,lm,wM={name:"css",register:qf,targetTest:function(i){return i.style&&i.nodeType},init:function(i,e,t,r,s){var a,n,o,l,h,c,u,d,p,f,v,m,g,_,y,x,M=this._props,b=i.style,w=t.vars.startAt;for(u in $g||qf(),this.styles=this.styles||vM(i),x=this.styles.props,this.tween=t,e)if(u!=="autoRound"&&(n=e[u],!Zi[u]||!aM(u,e,t,r,i,s))){if(h=typeof n,c=td[u],h==="function"&&(h=typeof(n=n.call(t,r,i,s))),h==="string"&&~n.indexOf("random(")&&(n=bh(n)),c)c(this,i,u,n,t)&&(y=1);else if(u.substr(0,2)==="--")a=(getComputedStyle(i).getPropertyValue(u)+"").trim(),n+="",ha.lastIndex=0,ha.test(a)||(d=wi(a),p=wi(n)),p?d!==p&&(a=ya(i,u,a,p)+p):d&&(n+=d),this.add(b,"setProperty",a,n,r,s,0,0,u),M.push(u),x.push(u,0,b[u]);else if(h!=="undefined"){if(w&&u in w?(a=typeof w[u]=="function"?w[u].call(t,r,i,s):w[u],ci(a)&&~a.indexOf("random(")&&(a=bh(a)),wi(a+"")||a==="auto"||(a+=sr.units[u]||wi(gs(i,u))||""),(a+"").charAt(1)==="="&&(a=gs(i,u))):a=gs(i,u),l=parseFloat(a),(f=h==="string"&&n.charAt(1)==="="&&n.substr(0,2))&&(n=n.substr(2)),o=parseFloat(n),u in Zr&&(u==="autoAlpha"&&(l===1&&gs(i,"visibility")==="hidden"&&o&&(l=0),x.push("visibility",0,b.visibility),ea(this,b,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),u!=="scale"&&u!=="transform"&&~(u=Zr[u]).indexOf(",")&&(u=u.split(",")[0])),v=u in Is)if(this.styles.save(u),m||((g=i._gsap).renderTransform&&!e.parseTransform||Th(i,e.parseTransform),_=e.smoothOrigin!==!1&&g.smooth,(m=this._pt=new Hi(this._pt,b,Et,0,1,g.renderTransform,g,0,-1)).dep=1),u==="scale")this._pt=new Hi(this._pt,g,"scaleY",g.scaleY,(f?xo(g.scaleY,f+o):o)-g.scaleY||0,Wf),this._pt.u=0,M.push("scaleY",u),u+="X";else{if(u==="transformOrigin"){x.push(ji,0,b[ji]),n=eE(n),g.svg?Yf(i,n,0,_,0,this):((p=parseFloat(n.split(" ")[2])||0)!==g.zOrigin&&ea(this,g,"zOrigin",g.zOrigin,p),ea(this,b,u,id(a),id(n)));continue}if(u==="svgOrigin"){Yf(i,n,1,_,0,this);continue}if(u in xM){sE(this,g,u,l,f?xo(l,f+n):n);continue}if(u==="smoothOrigin"){ea(this,g,"smooth",g.smooth,n);continue}if(u==="force3D"){g[u]=n;continue}if(u==="transform"){aE(this,n,i);continue}}else u in b||(u=Yo(u)||u);if(v||(o||o===0)&&(l||l===0)&&!zA.test(n)&&u in b)o||(o=0),(d=(a+"").substr((l+"").length))!==(p=wi(n)||(u in sr.units?sr.units[u]:d))&&(l=ya(i,u,a,p)),this._pt=new Hi(this._pt,v?g:b,u,l,(f?xo(l,f+o):o)-l,v||p!=="px"&&u!=="zIndex"||e.autoRound===!1?Wf:GA),this._pt.u=p||0,d!==p&&p!=="%"&&(this._pt.b=a,this._pt.r=HA);else if(u in b)$A.call(this,i,u,a,f?f+n:n);else if(u in i)this.add(i,u,a||i[u],f?f+n:n,r,s);else if(u!=="parseTransform")continue;v||(u in b?x.push(u,0,b[u]):x.push(u,1,a||i[u])),M.push(u)}}y&&uM(this)},render:function(i,e){if(e.tween._time||!e0())for(var t=e._pt;t;)t.r(i,t.d),t=t._next;else e.styles.revert()},get:gs,aliases:Zr,getSetter:function(i,e,t){var r=Zr[e];return r&&r.indexOf(",")<0&&(e=r),e in Is&&e!==ji&&(i._gsap.x||gs(i,"x"))?t&&V_===t?e==="scale"?qA:XA:(V_=t||{})&&(e==="scale"?YA:ZA):i.style&&!Wg(i.style[e])?jA:~e.indexOf("-")?WA:Jg(i,e)},core:{_removeProperty:Cn,_getMatrix:i0}};Gi.utils.checkPrefix=Yo,Gi.core.getStyleSaver=vM,lm=zi((Y_="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(om="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(i){Is[i]=1}),zi(om,function(i){sr.units[i]="deg",xM[i]=1}),Zr[lm[13]]=Y_+","+om,zi("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(i){var e=i.split(":");Zr[e[1]]=lm[e[0]]}),zi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){sr.units[i]="px"}),Gi.registerPlugin(wM);var r0=Gi.registerPlugin(wM)||Gi;function uo(i,e){var t=i.__state.conversionName.toString(),r=Math.round(i.r),s=Math.round(i.g),a=Math.round(i.b),n=i.a,o=Math.round(i.h),l=i.s.toFixed(1),h=i.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var c=i.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return t==="CSS_RGB"?"rgb("+r+","+s+","+a+")":t==="CSS_RGBA"?"rgba("+r+","+s+","+a+","+n+")":t==="HEX"?"0x"+i.hex.toString(16):t==="RGB_ARRAY"?"["+r+","+s+","+a+"]":t==="RGBA_ARRAY"?"["+r+","+s+","+a+","+n+"]":t==="RGB_OBJ"?"{r:"+r+",g:"+s+",b:"+a+"}":t==="RGBA_OBJ"?"{r:"+r+",g:"+s+",b:"+a+",a:"+n+"}":t==="HSV_OBJ"?"{h:"+o+",s:"+l+",v:"+h+"}":t==="HSVA_OBJ"?"{h:"+o+",s:"+l+",v:"+h+",a:"+n+"}":"unknown format"}r0.core.Tween;var Z_=Array.prototype.forEach,xl=Array.prototype.slice,he={BREAK:{},extend:function(i){return this.each(xl.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach((function(t){this.isUndefined(e[t])||(i[t]=e[t])}).bind(this))},this),i},defaults:function(i){return this.each(xl.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach((function(t){this.isUndefined(i[t])&&(i[t]=e[t])}).bind(this))},this),i},compose:function(){var i=xl.call(arguments);return function(){for(var e=xl.call(arguments),t=i.length-1;t>=0;t--)e=[i[t].apply(this,e)];return e[0]}},each:function(i,e,t){if(i){if(Z_&&i.forEach&&i.forEach===Z_)i.forEach(e,t);else if(i.length===i.length+0){var r,s=void 0;for(s=0,r=i.length;s<r;s++)if(s in i&&e.call(t,i[s],s)===this.BREAK)return}else for(var a in i)if(e.call(t,i[a],a)===this.BREAK)return}},defer:function(i){setTimeout(i,0)},debounce:function(i,e,t){var r=void 0;return function(){var s=this,a=arguments,n=t||!r;clearTimeout(r),r=setTimeout(function(){r=null,t||i.apply(s,a)},e),n&&i.apply(s,a)}},toArray:function(i){return i.toArray?i.toArray():xl.call(i)},isUndefined:function(i){return i===void 0},isNull:function(i){return i===null},isNaN:function(i){function e(t){return i.apply(this,arguments)}return e.toString=function(){return i.toString()},e}(function(i){return isNaN(i)}),isArray:Array.isArray||function(i){return i.constructor===Array},isObject:function(i){return i===Object(i)},isNumber:function(i){return i===i+0},isString:function(i){return i===i+""},isBoolean:function(i){return i===!1||i===!0},isFunction:function(i){return i instanceof Function}},nE=[{litmus:he.isString,conversions:{THREE_CHAR_HEX:{read:function(i){var e=i.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e!==null&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:uo},SIX_CHAR_HEX:{read:function(i){var e=i.match(/^#([A-F0-9]{6})$/i);return e!==null&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:uo},CSS_RGB:{read:function(i){var e=i.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e!==null&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:uo},CSS_RGBA:{read:function(i){var e=i.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e!==null&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:uo}}},{litmus:he.isNumber,conversions:{HEX:{read:function(i){return{space:"HEX",hex:i,conversionName:"HEX"}},write:function(i){return i.hex}}}},{litmus:he.isArray,conversions:{RGB_ARRAY:{read:function(i){return i.length===3&&{space:"RGB",r:i[0],g:i[1],b:i[2]}},write:function(i){return[i.r,i.g,i.b]}},RGBA_ARRAY:{read:function(i){return i.length===4&&{space:"RGB",r:i[0],g:i[1],b:i[2],a:i[3]}},write:function(i){return[i.r,i.g,i.b,i.a]}}}},{litmus:he.isObject,conversions:{RGBA_OBJ:{read:function(i){return!!(he.isNumber(i.r)&&he.isNumber(i.g)&&he.isNumber(i.b)&&he.isNumber(i.a))&&{space:"RGB",r:i.r,g:i.g,b:i.b,a:i.a}},write:function(i){return{r:i.r,g:i.g,b:i.b,a:i.a}}},RGB_OBJ:{read:function(i){return!!(he.isNumber(i.r)&&he.isNumber(i.g)&&he.isNumber(i.b))&&{space:"RGB",r:i.r,g:i.g,b:i.b}},write:function(i){return{r:i.r,g:i.g,b:i.b}}},HSVA_OBJ:{read:function(i){return!!(he.isNumber(i.h)&&he.isNumber(i.s)&&he.isNumber(i.v)&&he.isNumber(i.a))&&{space:"HSV",h:i.h,s:i.s,v:i.v,a:i.a}},write:function(i){return{h:i.h,s:i.s,v:i.v,a:i.a}}},HSV_OBJ:{read:function(i){return!!(he.isNumber(i.h)&&he.isNumber(i.s)&&he.isNumber(i.v))&&{space:"HSV",h:i.h,s:i.s,v:i.v}},write:function(i){return{h:i.h,s:i.s,v:i.v}}}}}],Ml=void 0,eu=void 0,rd=function(){eu=!1;var i=arguments.length>1?he.toArray(arguments):arguments[0];return he.each(nE,function(e){if(e.litmus(i))return he.each(e.conversions,function(t,r){if(Ml=t.read(i),eu===!1&&Ml!==!1)return eu=Ml,Ml.conversionName=r,Ml.conversion=t,he.BREAK}),he.BREAK}),eu},K_=void 0,Fl={hsv_to_rgb:function(i,e,t){var r=Math.floor(i/60)%6,s=i/60-Math.floor(i/60),a=t*(1-e),n=t*(1-s*e),o=t*(1-(1-s)*e),l=[[t,o,a],[n,t,a],[a,t,o],[a,n,t],[o,a,t],[t,a,n]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(i,e,t){var r=Math.min(i,e,t),s=Math.max(i,e,t),a=s-r,n=void 0;return s===0?{h:NaN,s:0,v:0}:(n=i===s?(e-t)/a:e===s?2+(t-i)/a:4+(i-e)/a,(n/=6)<0&&(n+=1),{h:360*n,s:a/s,v:s/255})},rgb_to_hex:function(i,e,t){var r=this.hex_with_component(0,2,i);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,t)},component_from_hex:function(i,e){return i>>8*e&255},hex_with_component:function(i,e,t){return t<<(K_=8*e)|i&~(255<<K_)}},oE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Dr=function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")},Or=function(){function i(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),xa=function i(e,t,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,t);if(s===void 0){var a=Object.getPrototypeOf(e);return a===null?void 0:i(a,t,r)}if("value"in s)return s.value;var n=s.get;return n===void 0?void 0:n.call(r)},wa=function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(i,e):i.__proto__=e)},Sa=function(i,e){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||typeof e!="object"&&typeof e!="function"?i:e},ei=function(){function i(){if(Dr(this,i),this.__state=rd.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Or(i,[{key:"toString",value:function(){return uo(this)}},{key:"toHexString",value:function(){return uo(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),i}();function hm(i,e,t){Object.defineProperty(i,e,{get:function(){return this.__state.space==="RGB"||ei.recalculateRGB(this,e,t),this.__state[e]},set:function(r){this.__state.space!=="RGB"&&(ei.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=r}})}function cm(i,e){Object.defineProperty(i,e,{get:function(){return this.__state.space==="HSV"||ei.recalculateHSV(this),this.__state[e]},set:function(t){this.__state.space!=="HSV"&&(ei.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}ei.recalculateRGB=function(i,e,t){if(i.__state.space==="HEX")i.__state[e]=Fl.component_from_hex(i.__state.hex,t);else{if(i.__state.space!=="HSV")throw new Error("Corrupted color state");he.extend(i.__state,Fl.hsv_to_rgb(i.__state.h,i.__state.s,i.__state.v))}},ei.recalculateHSV=function(i){var e=Fl.rgb_to_hsv(i.r,i.g,i.b);he.extend(i.__state,{s:e.s,v:e.v}),he.isNaN(e.h)?he.isUndefined(i.__state.h)&&(i.__state.h=0):i.__state.h=e.h},ei.COMPONENTS=["r","g","b","h","s","v","hex","a"],hm(ei.prototype,"r",2),hm(ei.prototype,"g",1),hm(ei.prototype,"b",0),cm(ei.prototype,"h"),cm(ei.prototype,"s"),cm(ei.prototype,"v"),Object.defineProperty(ei.prototype,"a",{get:function(){return this.__state.a},set:function(i){this.__state.a=i}}),Object.defineProperty(ei.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=Fl.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(i){this.__state.space="HEX",this.__state.hex=i}});var Ta=function(){function i(e,t){Dr(this,i),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return Or(i,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),i}(),SM={};he.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(i,e){he.each(i,function(t){SM[t]=e})});var lE=/(\d+(\.\d+)?)px/;function Fr(i){if(i==="0"||he.isUndefined(i))return 0;var e=i.match(lE);return he.isNull(e)?0:parseFloat(e[1])}var Y={makeSelectable:function(i,e){i!==void 0&&i.style!==void 0&&(i.onselectstart=e?function(){return!1}:function(){},i.style.MozUserSelect=e?"auto":"none",i.style.KhtmlUserSelect=e?"auto":"none",i.unselectable=e?"on":"off")},makeFullscreen:function(i,e,t){var r=t,s=e;he.isUndefined(s)&&(s=!0),he.isUndefined(r)&&(r=!0),i.style.position="absolute",s&&(i.style.left=0,i.style.right=0),r&&(i.style.top=0,i.style.bottom=0)},fakeEvent:function(i,e,t,r){var s=t||{},a=SM[e];if(!a)throw new Error("Event type "+e+" not supported.");var n=document.createEvent(a);switch(a){case"MouseEvents":var o=s.x||s.clientX||0,l=s.y||s.clientY||0;n.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,o,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=n.initKeyboardEvent||n.initKeyEvent;he.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break;default:n.initEvent(e,s.bubbles||!1,s.cancelable||!0)}he.defaults(n,r),i.dispatchEvent(n)},bind:function(i,e,t,r){var s=r||!1;return i.addEventListener?i.addEventListener(e,t,s):i.attachEvent&&i.attachEvent("on"+e,t),Y},unbind:function(i,e,t,r){var s=r||!1;return i.removeEventListener?i.removeEventListener(e,t,s):i.detachEvent&&i.detachEvent("on"+e,t),Y},addClass:function(i,e){if(i.className===void 0)i.className=e;else if(i.className!==e){var t=i.className.split(/ +/);t.indexOf(e)===-1&&(t.push(e),i.className=t.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Y},removeClass:function(i,e){if(e)if(i.className===e)i.removeAttribute("class");else{var t=i.className.split(/ +/),r=t.indexOf(e);r!==-1&&(t.splice(r,1),i.className=t.join(" "))}else i.className=void 0;return Y},hasClass:function(i,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(i.className)||!1},getWidth:function(i){var e=getComputedStyle(i);return Fr(e["border-left-width"])+Fr(e["border-right-width"])+Fr(e["padding-left"])+Fr(e["padding-right"])+Fr(e.width)},getHeight:function(i){var e=getComputedStyle(i);return Fr(e["border-top-width"])+Fr(e["border-bottom-width"])+Fr(e["padding-top"])+Fr(e["padding-bottom"])+Fr(e.height)},getOffset:function(i){var e=i,t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;while(e);return t},isActive:function(i){return i===document.activeElement&&(i.type||i.href)}},s0=function(i){function e(t,r){Dr(this,e);var s=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;return s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox"),Y.bind(s.__checkbox,"change",function(){a.setValue(!a.__prev)},!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return wa(e,Ta),Or(e,[{key:"setValue",value:function(t){var r=xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),TM=function(i){function e(t,r,s){Dr(this,e);var a=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=s,o=a;if(a.__select=document.createElement("select"),he.isArray(n)){var l={};he.each(n,function(h){l[h]=h}),n=l}return he.each(n,function(h,c){var u=document.createElement("option");u.innerHTML=c,u.setAttribute("value",h),o.__select.appendChild(u)}),a.updateDisplay(),Y.bind(a.__select,"change",function(){var h=this.options[this.selectedIndex].value;o.setValue(h)}),a.domElement.appendChild(a.__select),a}return wa(e,Ta),Or(e,[{key:"setValue",value:function(t){var r=xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return Y.isActive(this.__select)?this:(this.__select.value=this.getValue(),xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),AM=function(i){function e(t,r){Dr(this,e);var s=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;function n(){a.setValue(a.__input.value)}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),Y.bind(s.__input,"keyup",n),Y.bind(s.__input,"change",n),Y.bind(s.__input,"blur",function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}),Y.bind(s.__input,"keydown",function(o){o.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return wa(e,Ta),Or(e,[{key:"updateDisplay",value:function(){return Y.isActive(this.__input)||(this.__input.value=this.getValue()),xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Q_(i){var e=i.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var a0=function(i){function e(t,r,s){Dr(this,e);var a=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=s||{};return a.__min=n.min,a.__max=n.max,a.__step=n.step,he.isUndefined(a.__step)?a.initialValue===0?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=Q_(a.__impliedStep),a}return wa(e,Ta),Or(e,[{key:"setValue",value:function(t){var r=t;return this.__min!==void 0&&r<this.__min?r=this.__min:this.__max!==void 0&&r>this.__max&&(r=this.__max),this.__step!==void 0&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Q_(t),this}}]),e}(),Ah=function(i){function e(t,r,s){Dr(this,e);var a=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,s));a.__truncationSuspended=!1;var n=a,o=void 0;function l(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function h(u){var d=o-u.clientY;n.setValue(n.getValue()+d*n.__impliedStep),o=u.clientY}function c(){Y.unbind(window,"mousemove",h),Y.unbind(window,"mouseup",c),l()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),Y.bind(a.__input,"change",function(){var u=parseFloat(n.__input.value);he.isNaN(u)||n.setValue(u)}),Y.bind(a.__input,"blur",function(){l()}),Y.bind(a.__input,"mousedown",function(u){Y.bind(window,"mousemove",h),Y.bind(window,"mouseup",c),o=u.clientY}),Y.bind(a.__input,"keydown",function(u){u.keyCode===13&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,l())}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return wa(e,a0),Or(e,[{key:"updateDisplay",value:function(){var t,r,s;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),r=this.__precision,s=Math.pow(10,r),Math.round(t*s)/s),xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function J_(i,e,t,r,s){return r+(i-e)/(t-e)*(s-r)}var sd=function(i){function e(t,r,s,a,n){Dr(this,e);var o=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,{min:s,max:a,step:n})),l=o;function h(p){p.preventDefault();var f=l.__background.getBoundingClientRect();return l.setValue(J_(p.clientX,f.left,f.right,l.__min,l.__max)),!1}function c(){Y.unbind(window,"mousemove",h),Y.unbind(window,"mouseup",c),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function u(p){var f=p.touches[0].clientX,v=l.__background.getBoundingClientRect();l.setValue(J_(f,v.left,v.right,l.__min,l.__max))}function d(){Y.unbind(window,"touchmove",u),Y.unbind(window,"touchend",d),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),Y.bind(o.__background,"mousedown",function(p){document.activeElement.blur(),Y.bind(window,"mousemove",h),Y.bind(window,"mouseup",c),h(p)}),Y.bind(o.__background,"touchstart",function(p){p.touches.length===1&&(Y.bind(window,"touchmove",u),Y.bind(window,"touchend",d),u(p))}),Y.addClass(o.__background,"slider"),Y.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return wa(e,a0),Or(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",xa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),n0=function(i){function e(t,r,s){Dr(this,e);var a=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=a;return a.__button=document.createElement("div"),a.__button.innerHTML=s===void 0?"Fire":s,Y.bind(a.__button,"click",function(o){return o.preventDefault(),n.fire(),!1}),Y.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return wa(e,Ta),Or(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),Du=function(i){function e(t,r){Dr(this,e);var s=Sa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));s.__color=new ei(s.getValue()),s.__temp=new ei(0);var a=s;s.domElement=document.createElement("div"),Y.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",Y.bind(s.__input,"keydown",function(m){m.keyCode===13&&d.call(this)}),Y.bind(s.__input,"blur",d),Y.bind(s.__selector,"mousedown",function(){Y.addClass(this,"drag").bind(window,"mouseup",function(){Y.removeClass(a.__selector,"drag")})}),Y.bind(s.__selector,"touchstart",function(){Y.addClass(this,"drag").bind(window,"touchend",function(){Y.removeClass(a.__selector,"drag")})});var n,o=document.createElement("div");function l(m){f(m),Y.bind(window,"mousemove",f),Y.bind(window,"touchmove",f),Y.bind(window,"mouseup",c),Y.bind(window,"touchend",c)}function h(m){v(m),Y.bind(window,"mousemove",v),Y.bind(window,"touchmove",v),Y.bind(window,"mouseup",u),Y.bind(window,"touchend",u)}function c(){Y.unbind(window,"mousemove",f),Y.unbind(window,"touchmove",f),Y.unbind(window,"mouseup",c),Y.unbind(window,"touchend",c),p()}function u(){Y.unbind(window,"mousemove",v),Y.unbind(window,"touchmove",v),Y.unbind(window,"mouseup",u),Y.unbind(window,"touchend",u),p()}function d(){var m=rd(this.value);m!==!1?(a.__color.__state=m,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function p(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function f(m){m.type.indexOf("touch")===-1&&m.preventDefault();var g=a.__saturation_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,y=_.clientX,x=_.clientY,M=(y-g.left)/(g.right-g.left),b=1-(x-g.top)/(g.bottom-g.top);return b>1?b=1:b<0&&(b=0),M>1?M=1:M<0&&(M=0),a.__color.v=b,a.__color.s=M,a.setValue(a.__color.toOriginal()),!1}function v(m){m.type.indexOf("touch")===-1&&m.preventDefault();var g=a.__hue_field.getBoundingClientRect(),_=1-((m.touches&&m.touches[0]||m).clientY-g.top)/(g.bottom-g.top);return _>1?_=1:_<0&&(_=0),a.__color.h=360*_,a.setValue(a.__color.toOriginal()),!1}return he.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),he.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),he.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),he.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),he.extend(o.style,{width:"100%",height:"100%",background:"none"}),$_(o,"top","rgba(0,0,0,0)","#000"),he.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=s.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",he.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),Y.bind(s.__saturation_field,"mousedown",l),Y.bind(s.__saturation_field,"touchstart",l),Y.bind(s.__field_knob,"mousedown",l),Y.bind(s.__field_knob,"touchstart",l),Y.bind(s.__hue_field,"mousedown",h),Y.bind(s.__hue_field,"touchstart",h),s.__saturation_field.appendChild(o),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay(),s}return wa(e,Ta),Or(e,[{key:"updateDisplay",value:function(){var t=rd(this.getValue());if(t!==!1){var r=!1;he.each(ei.COMPONENTS,function(n){if(!he.isUndefined(t[n])&&!he.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return r=!0,{}},this),r&&he.extend(this.__color.__state,t)}he.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,a=255-s;he.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,$_(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),he.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),e}(),hE=["-moz-","-o-","-webkit-","-ms-",""];function $_(i,e,t,r){i.style.background="",he.each(hE,function(s){i.style.cssText+="background: "+s+"linear-gradient("+e+", "+t+" 0%, "+r+" 100%); "})}var cE=function(i,e){var t=document,r=document.createElement("style");r.type="text/css",r.innerHTML=i;var s=t.getElementsByTagName("head")[0];try{s.appendChild(r)}catch{}},uE=function(i,e){var t=i[e];return he.isArray(arguments[2])||he.isObject(arguments[2])?new TM(i,e,arguments[2]):he.isNumber(t)?he.isNumber(arguments[2])&&he.isNumber(arguments[3])?he.isNumber(arguments[4])?new sd(i,e,arguments[2],arguments[3],arguments[4]):new sd(i,e,arguments[2],arguments[3]):he.isNumber(arguments[4])?new Ah(i,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Ah(i,e,{min:arguments[2],max:arguments[3]}):he.isString(t)?new AM(i,e):he.isFunction(t)?new n0(i,e,""):he.isBoolean(t)?new s0(i,e):null},dE=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){setTimeout(i,1e3/60)},pE=function(){function i(){Dr(this,i),this.backgroundElement=document.createElement("div"),he.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Y.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),he.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Y.bind(this.backgroundElement,"click",function(){e.hide()})}return Or(i,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),he.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function r(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Y.unbind(e.domElement,"webkitTransitionEnd",r),Y.unbind(e.domElement,"transitionend",r),Y.unbind(e.domElement,"oTransitionEnd",r)};Y.bind(this.domElement,"webkitTransitionEnd",t),Y.bind(this.domElement,"transitionend",t),Y.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Y.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Y.getHeight(this.domElement)/2+"px"}}]),i}(),mE=function(i){if(typeof window<"u"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=i,document.head.appendChild(e),i}}(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);cE(mE);var Eh="Default",kl=function(){try{return!!window.localStorage}catch{return!1}}(),tu=void 0,ey=!0,ao=void 0,um=!1,EM=[],ct=function i(e){var t=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Y.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=he.defaults(r,{closeOnTop:!1,autoPlace:!0,width:i.DEFAULT_WIDTH}),r=he.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),he.isUndefined(r.load)?r.load={preset:Eh}:r.preset&&(r.load.preset=r.preset),he.isUndefined(r.parent)&&r.hideable&&EM.push(this),r.resizable=he.isUndefined(r.parent)&&r.resizable,r.autoPlace&&he.isUndefined(r.scrollable)&&(r.scrollable=!0);var s,a=kl&&localStorage.getItem(no(this,"isLocal"))==="true",n=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:r.load.preset},set:function(c){t.parent?t.getRoot().preset=c:r.load.preset=c,function(u){for(var d=0;d<u.__preset_select.length;d++)u.__preset_select[d].value===u.preset&&(u.__preset_select.selectedIndex=d)}(this),t.revert()}},width:{get:function(){return r.width},set:function(c){r.width=c,Kf(t,c)}},name:{get:function(){return r.name},set:function(c){r.name=c,o&&(o.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(c){r.closed=c,r.closed?Y.addClass(t.__ul,i.CLASS_CLOSED):Y.removeClass(t.__ul,i.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=c?i.TEXT_OPEN:i.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(c){kl&&(a=c,c?Y.bind(window,"unload",n):Y.unbind(window,"unload",n),localStorage.setItem(no(t,"isLocal"),c))}}}),he.isUndefined(r.parent)){if(this.closed=r.closed||!1,Y.addClass(this.domElement,i.CLASS_MAIN),Y.makeSelectable(this.domElement,!1),kl&&a){t.useLocalStorage=!0;var l=localStorage.getItem(no(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=i.TEXT_CLOSED,Y.addClass(this.__closeButton,i.CLASS_CLOSE_BUTTON),r.closeOnTop?(Y.addClass(this.__closeButton,i.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Y.addClass(this.__closeButton,i.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Y.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{r.closed===void 0&&(r.closed=!0);var h=document.createTextNode(r.name);Y.addClass(h,"controller-name"),o=o0(t,h),Y.addClass(this.__ul,i.CLASS_CLOSED),Y.addClass(o,"title"),Y.bind(o,"click",function(c){return c.preventDefault(),t.closed=!t.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(he.isUndefined(r.parent)&&(ey&&(ao=document.createElement("div"),Y.addClass(ao,"dg"),Y.addClass(ao,i.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ao),ey=!1),ao.appendChild(this.domElement),Y.addClass(this.domElement,i.CLASS_AUTO_PLACE)),this.parent||Kf(t,r.width)),this.__resizeHandler=function(){t.onResizeDebounced()},Y.bind(window,"resize",this.__resizeHandler),Y.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Y.bind(this.__ul,"transitionend",this.__resizeHandler),Y.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&fE(this),n=function(){kl&&localStorage.getItem(no(t,"isLocal"))==="true"&&localStorage.setItem(no(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=n,r.parent||((s=t.getRoot()).width+=1,he.defer(function(){s.width-=1}))};function o0(i,e,t){var r=document.createElement("li");return e&&r.appendChild(e),t?i.__ul.insertBefore(r,t):i.__ul.appendChild(r),i.onResize(),r}function ty(i){Y.unbind(window,"resize",i.__resizeHandler),i.saveToLocalStorageIfPossible&&Y.unbind(window,"unload",i.saveToLocalStorageIfPossible)}function Zf(i,e){var t=i.__preset_select[i.__preset_select.selectedIndex];t.innerHTML=e?t.value+"*":t.value}function CM(i,e){var t=i.getRoot(),r=t.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=t.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},t.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,t.load&&t.load.remembered){var a=t.load.remembered,n=void 0;if(a[i.preset])n=a[i.preset];else{if(!a[Eh])return;n=a[Eh]}if(n[r]&&n[r][e.property]!==void 0){var o=n[r][e.property];e.initialValue=o,e.setValue(o)}}}}function Ql(i,e,t,r){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var s=void 0;if(r.color)s=new Du(e,t);else{var a=[e,t].concat(r.factoryArgs);s=uE.apply(i,a)}r.before instanceof Ta&&(r.before=r.before.__li),CM(i,s),Y.addClass(s.domElement,"c");var n=document.createElement("span");Y.addClass(n,"property-name"),n.innerHTML=s.property;var o=document.createElement("div");o.appendChild(n),o.appendChild(s.domElement);var l=o0(i,o,r.before);return Y.addClass(l,ct.CLASS_CONTROLLER_ROW),s instanceof Du?Y.addClass(l,"color"):Y.addClass(l,oE(s.getValue())),function(h,c,u){if(u.__li=c,u.__gui=h,he.extend(u,{options:function(f){if(arguments.length>1){var v=u.__li.nextElementSibling;return u.remove(),Ql(h,u.object,u.property,{before:v,factoryArgs:[he.toArray(arguments)]})}if(he.isArray(f)||he.isObject(f)){var m=u.__li.nextElementSibling;return u.remove(),Ql(h,u.object,u.property,{before:m,factoryArgs:[f]})}},name:function(f){return u.__li.firstElementChild.firstElementChild.innerHTML=f,u},listen:function(){return u.__gui.listen(u),u},remove:function(){return u.__gui.remove(u),u}}),u instanceof sd){var d=new Ah(u.object,u.property,{min:u.__min,max:u.__max,step:u.__step});he.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(f){var v=u[f],m=d[f];u[f]=d[f]=function(){var g=Array.prototype.slice.call(arguments);return m.apply(d,g),v.apply(u,g)}}),Y.addClass(c,"has-slider"),u.domElement.insertBefore(d.domElement,u.domElement.firstElementChild)}else if(u instanceof Ah){var p=function(f){if(he.isNumber(u.__min)&&he.isNumber(u.__max)){var v=u.__li.firstElementChild.firstElementChild.innerHTML,m=u.__gui.__listening.indexOf(u)>-1;u.remove();var g=Ql(h,u.object,u.property,{before:u.__li.nextElementSibling,factoryArgs:[u.__min,u.__max,u.__step]});return g.name(v),m&&g.listen(),g}return f};u.min=he.compose(p,u.min),u.max=he.compose(p,u.max)}else u instanceof s0?(Y.bind(c,"click",function(){Y.fakeEvent(u.__checkbox,"click")}),Y.bind(u.__checkbox,"click",function(f){f.stopPropagation()})):u instanceof n0?(Y.bind(c,"click",function(){Y.fakeEvent(u.__button,"click")}),Y.bind(c,"mouseover",function(){Y.addClass(u.__button,"hover")}),Y.bind(c,"mouseout",function(){Y.removeClass(u.__button,"hover")})):u instanceof Du&&(Y.addClass(c,"color"),u.updateDisplay=he.compose(function(f){return c.style.borderLeftColor=u.__color.toString(),f},u.updateDisplay),u.updateDisplay());u.setValue=he.compose(function(f){return h.getRoot().__preset_select&&u.isModified()&&Zf(h.getRoot(),!0),f},u.setValue)}(i,l,s),i.__controllers.push(s),s}function no(i,e){return document.location.href+"."+e}function dm(i,e,t){var r=document.createElement("option");r.innerHTML=e,r.value=e,i.__preset_select.appendChild(r),t&&(i.__preset_select.selectedIndex=i.__preset_select.length-1)}function iy(i,e){e.style.display=i.useLocalStorage?"block":"none"}function fE(i){var e=void 0;function t(a){return a.preventDefault(),i.width+=e-a.clientX,i.onResize(),e=a.clientX,!1}function r(){Y.removeClass(i.__closeButton,ct.CLASS_DRAG),Y.unbind(window,"mousemove",t),Y.unbind(window,"mouseup",r)}function s(a){return a.preventDefault(),e=a.clientX,Y.addClass(i.__closeButton,ct.CLASS_DRAG),Y.bind(window,"mousemove",t),Y.bind(window,"mouseup",r),!1}i.__resize_handle=document.createElement("div"),he.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Y.bind(i.__resize_handle,"mousedown",s),Y.bind(i.__closeButton,"mousedown",s),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)}function Kf(i,e){i.domElement.style.width=e+"px",i.__save_row&&i.autoPlace&&(i.__save_row.style.width=e+"px"),i.__closeButton&&(i.__closeButton.style.width=e+"px")}function iu(i,e){var t={};return he.each(i.__rememberedObjects,function(r,s){var a={},n=i.__rememberedObjectIndecesToControllers[s];he.each(n,function(o,l){a[l]=e?o.initialValue:o.getValue()}),t[s]=a}),t}function RM(i){i.length!==0&&dE.call(window,function(){RM(i)}),he.each(i,function(e){e.updateDisplay()})}ct.toggleHide=function(){um=!um,he.each(EM,function(i){i.domElement.style.display=um?"none":""})},ct.CLASS_AUTO_PLACE="a",ct.CLASS_AUTO_PLACE_CONTAINER="ac",ct.CLASS_MAIN="main",ct.CLASS_CONTROLLER_ROW="cr",ct.CLASS_TOO_TALL="taller-than-window",ct.CLASS_CLOSED="closed",ct.CLASS_CLOSE_BUTTON="close-button",ct.CLASS_CLOSE_TOP="close-top",ct.CLASS_CLOSE_BOTTOM="close-bottom",ct.CLASS_DRAG="drag",ct.DEFAULT_WIDTH=245,ct.TEXT_CLOSED="Close Controls",ct.TEXT_OPEN="Open Controls",ct._keydownHandler=function(i){document.activeElement.type==="text"||i.which!==72&&i.keyCode!==72||ct.toggleHide()},Y.bind(window,"keydown",ct._keydownHandler,!1),he.extend(ct.prototype,{add:function(i,e){return Ql(this,i,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(i,e){return Ql(this,i,e,{color:!0})},remove:function(i){this.__ul.removeChild(i.__li),this.__controllers.splice(this.__controllers.indexOf(i),1);var e=this;he.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ao.removeChild(this.domElement);var i=this;he.each(this.__folders,function(e){i.removeFolder(e)}),Y.unbind(window,"keydown",ct._keydownHandler,!1),ty(this)},addFolder:function(i){if(this.__folders[i]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+i+'"');var e={name:i,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[i]&&(e.closed=this.load.folders[i].closed,e.load=this.load.folders[i]);var t=new ct(e);this.__folders[i]=t;var r=o0(this,t.domElement);return Y.addClass(r,"folder"),t},removeFolder:function(i){this.__ul.removeChild(i.domElement.parentElement),delete this.__folders[i.name],this.load&&this.load.folders&&this.load.folders[i.name]&&delete this.load.folders[i.name],ty(i);var e=this;he.each(i.__folders,function(t){i.removeFolder(t)}),he.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var i=this.getRoot();if(i.scrollable){var e=Y.getOffset(i.__ul).top,t=0;he.each(i.__ul.childNodes,function(r){i.autoPlace&&r===i.__save_row||(t+=Y.getHeight(r))}),window.innerHeight-e-20<t?(Y.addClass(i.domElement,ct.CLASS_TOO_TALL),i.__ul.style.height=window.innerHeight-e-20+"px"):(Y.removeClass(i.domElement,ct.CLASS_TOO_TALL),i.__ul.style.height="auto")}i.__resize_handle&&he.defer(function(){i.__resize_handle.style.height=i.__ul.offsetHeight+"px"}),i.__closeButton&&(i.__closeButton.style.width=i.width+"px")},onResizeDebounced:he.debounce(function(){this.onResize()},50),remember:function(){if(he.isUndefined(tu)&&((tu=new pE).domElement.innerHTML=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`),this.parent)throw new Error("You can only call remember on a top level GUI.");var i=this;he.each(Array.prototype.slice.call(arguments),function(e){i.__rememberedObjects.length===0&&function(t){var r=t.__save_row=document.createElement("li");Y.addClass(t.domElement,"has-save"),t.__ul.insertBefore(r,t.__ul.firstChild),Y.addClass(r,"save-row");var s=document.createElement("span");s.innerHTML="&nbsp;",Y.addClass(s,"button gears");var a=document.createElement("span");a.innerHTML="Save",Y.addClass(a,"button"),Y.addClass(a,"save");var n=document.createElement("span");n.innerHTML="New",Y.addClass(n,"button"),Y.addClass(n,"save-as");var o=document.createElement("span");o.innerHTML="Revert",Y.addClass(o,"button"),Y.addClass(o,"revert");var l=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?he.each(t.load.remembered,function(d,p){dm(t,p,p===t.preset)}):dm(t,Eh,!1),Y.bind(l,"change",function(){for(var d=0;d<t.__preset_select.length;d++)t.__preset_select[d].innerHTML=t.__preset_select[d].value;t.preset=this.value}),r.appendChild(l),r.appendChild(s),r.appendChild(a),r.appendChild(n),r.appendChild(o),kl){var h=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block",localStorage.getItem(no(t,"isLocal"))==="true"&&c.setAttribute("checked","checked"),iy(t,h),Y.bind(c,"change",function(){t.useLocalStorage=!t.useLocalStorage,iy(t,h)})}var u=document.getElementById("dg-new-constructor");Y.bind(u,"keydown",function(d){!d.metaKey||d.which!==67&&d.keyCode!==67||tu.hide()}),Y.bind(s,"click",function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),tu.show(),u.focus(),u.select()}),Y.bind(a,"click",function(){t.save()}),Y.bind(n,"click",function(){var d=prompt("Enter a new preset name.");d&&t.saveAs(d)}),Y.bind(o,"click",function(){t.revert()})}(i),i.__rememberedObjects.indexOf(e)===-1&&i.__rememberedObjects.push(e)}),this.autoPlace&&Kf(this,this.width)},getRoot:function(){for(var i=this;i.parent;)i=i.parent;return i},getSaveObject:function(){var i=this.load;return i.closed=this.closed,this.__rememberedObjects.length>0&&(i.preset=this.preset,i.remembered||(i.remembered={}),i.remembered[this.preset]=iu(this)),i.folders={},he.each(this.__folders,function(e,t){i.folders[t]=e.getSaveObject()}),i},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=iu(this),Zf(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(i){this.load.remembered||(this.load.remembered={},this.load.remembered[Eh]=iu(this,!0)),this.load.remembered[i]=iu(this),this.preset=i,dm(this,i,!0),this.saveToLocalStorageIfPossible()},revert:function(i){he.each(this.__controllers,function(e){this.getRoot().load.remembered?CM(i||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),he.each(this.__folders,function(e){e.revert(e)}),i||Zf(this.getRoot(),!1)},listen:function(i){var e=this.__listening.length===0;this.__listening.push(i),e&&RM(this.__listening)},updateDisplay:function(){he.each(this.__controllers,function(i){i.updateDisplay()}),he.each(this.__folders,function(i){i.updateDisplay()})}});var PM={Color:ei,math:Fl,interpret:rd},IM={Controller:Ta,BooleanController:s0,OptionController:TM,StringController:AM,NumberController:a0,NumberControllerBox:Ah,NumberControllerSlider:sd,FunctionController:n0,ColorController:Du},LM={dom:Y},NM={GUI:ct},Wr=ct,gE={color:PM,controllers:IM,dom:LM,gui:NM,GUI:Wr};Object.freeze(Object.defineProperty({__proto__:null,GUI:Wr,color:PM,controllers:IM,default:gE,dom:LM,gui:NM},Symbol.toStringTag,{value:"Module"}));var vn=1,_n=2,So=3,vE=4,Qf=5,ry=6378137,_E=6356752314e-3,sy=.0066943799901413165,Jl=484813681109536e-20,pe=Math.PI/2,yE=.16666666666666666,xE=.04722222222222222,ME=.022156084656084655,Me=1e-10,mi=.017453292519943295,ta=57.29577951308232,lt=Math.PI/4,Ch=2*Math.PI,Ft=3.14159265359,bE={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const wE={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var ay=/[\s_\-\/\(\)]/g;function ia(i,e){if(i[e])return i[e];for(var t,r=Object.keys(i),s=e.toLowerCase().replace(ay,""),a=-1;++a<r.length;)if((t=r[a]).toLowerCase().replace(ay,"")===s)return i[t]}function Jf(i){var e,t,r,s={},a=i.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),n={proj:"projName",datum:"datumCode",rf:function(o){s.rf=parseFloat(o)},lat_0:function(o){s.lat0=o*mi},lat_1:function(o){s.lat1=o*mi},lat_2:function(o){s.lat2=o*mi},lat_ts:function(o){s.lat_ts=o*mi},lon_0:function(o){s.long0=o*mi},lon_1:function(o){s.long1=o*mi},lon_2:function(o){s.long2=o*mi},alpha:function(o){s.alpha=parseFloat(o)*mi},gamma:function(o){s.rectified_grid_angle=parseFloat(o)},lonc:function(o){s.longc=o*mi},x_0:function(o){s.x0=parseFloat(o)},y_0:function(o){s.y0=parseFloat(o)},k_0:function(o){s.k0=parseFloat(o)},k:function(o){s.k0=parseFloat(o)},a:function(o){s.a=parseFloat(o)},b:function(o){s.b=parseFloat(o)},r:function(o){s.a=s.b=parseFloat(o)},r_a:function(){s.R_A=!0},zone:function(o){s.zone=parseInt(o,10)},south:function(){s.utmSouth=!0},towgs84:function(o){s.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){s.to_meter=parseFloat(o)},units:function(o){s.units=o;var l=ia(wE,o);l&&(s.to_meter=l.to_meter)},from_greenwich:function(o){s.from_greenwich=o*mi},pm:function(o){var l=ia(bE,o);s.from_greenwich=(l||parseFloat(o))*mi},nadgrids:function(o){o==="@null"?s.datumCode="none":s.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(s.axis=o)},approx:function(){s.approx=!0}};for(e in a)t=a[e],e in n?typeof(r=n[e])=="function"?r(t):s[r]=t:s[e]=t;return typeof s.datumCode=="string"&&s.datumCode!=="WGS84"&&(s.datumCode=s.datumCode.toLowerCase()),s}var Bl=1,SE=/\s/,TE=/[A-Za-z]/,AE=/[A-Za-z84_]/,ru=/[,\]]/,ny=/[\d\.E\-\+]/;function ps(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Bl}function oy(i,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var r=e?{}:i,s=t.reduce(function(a,n){return po(n,a),a},r);e&&(i[e]=s)}function po(i,e){if(Array.isArray(i)){var t=i.shift();if(t==="PARAMETER"&&(t=i.shift()),i.length===1)return Array.isArray(i[0])?(e[t]={},void po(i[0],e[t])):void(e[t]=i[0]);if(i.length)if(t!=="TOWGS84"){if(t==="AXIS")return t in e||(e[t]=[]),void e[t].push(i);var r;switch(Array.isArray(t)||(e[t]={}),t){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[t]={name:i[0].toLowerCase(),convert:i[1]},void(i.length===3&&po(i[2],e[t]));case"SPHEROID":case"ELLIPSOID":return e[t]={name:i[0],a:i[1],rf:i[2]},void(i.length===4&&po(i[3],e[t]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return i[0]=["name",i[0]],void oy(e,t,i);default:for(r=-1;++r<i.length;)if(!Array.isArray(i[r]))return po(i,e[t]);return oy(e,t,i)}}else e[t]=i;else e[t]=!0}else e[i]=!0}ps.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==4)for(;SE.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case Bl:return this.neutral(i);case 2:return this.keyword(i);case 4:return this.quoted(i);case 5:return this.afterquote(i);case 3:return this.number(i);case-1:return}},ps.prototype.afterquote=function(i){if(i==='"')return this.word+='"',void(this.state=4);if(ru.test(i))return this.word=this.word.trim(),void this.afterItem(i);throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)},ps.prototype.afterItem=function(i){return i===","?(this.word!==null&&this.currentObject.push(this.word),this.word=null,void(this.state=Bl)):i==="]"?(this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Bl,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},ps.prototype.number=function(i){if(!ny.test(i)){if(ru.test(i))return this.word=parseFloat(this.word),void this.afterItem(i);throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)}this.word+=i},ps.prototype.quoted=function(i){i!=='"'?this.word+=i:this.state=5},ps.prototype.keyword=function(i){if(AE.test(i))this.word+=i;else{if(i==="["){var e=[];return e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Bl)}if(!ru.test(i))throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place);this.afterItem(i)}},ps.prototype.neutral=function(i){if(TE.test(i))return this.word=i,void(this.state=2);if(i==='"')return this.word="",void(this.state=4);if(ny.test(i))return this.word=i,void(this.state=3);if(!ru.test(i))throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place);this.afterItem(i)},ps.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===-1)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var EE=.017453292519943295;function kr(i){return i*EE}function DM(i){var e=new ps(i).output(),t=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",t]);var s={};return po(e,s),function(a){if(a.type==="GEOGCS"?a.projName="longlat":a.type==="LOCAL_CS"?(a.projName="identity",a.local=!0):typeof a.PROJECTION=="object"?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var n="",o=0,l=a.AXIS.length;o<l;++o){var h=[a.AXIS[o][0].toLowerCase(),a.AXIS[o][1].toLowerCase()];h[0].indexOf("north")!==-1||(h[0]==="y"||h[0]==="lat")&&h[1]==="north"?n+="n":h[0].indexOf("south")!==-1||(h[0]==="y"||h[0]==="lat")&&h[1]==="south"?n+="s":h[0].indexOf("east")!==-1||(h[0]==="x"||h[0]==="lon")&&h[1]==="east"?n+="e":h[0].indexOf("west")===-1&&(h[0]!=="x"&&h[0]!=="lon"||h[1]!=="west")||(n+="w")}n.length===2&&(n+="u"),n.length===3&&(a.axis=n)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),a.units==="metre"&&(a.units="meter"),a.UNIT.convert&&(a.type==="GEOGCS"?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert));var c=a.GEOGCS;function u(d){return d*(a.to_meter||1)}a.type==="GEOGCS"&&(c=a),c&&(c.DATUM?a.datumCode=c.DATUM.name.toLowerCase():a.datumCode=c.name.toLowerCase(),a.datumCode.slice(0,2)==="d_"&&(a.datumCode=a.datumCode.slice(2)),a.datumCode!=="new_zealand_geodetic_datum_1949"&&a.datumCode!=="new_zealand_1949"||(a.datumCode="nzgd49"),a.datumCode!=="wgs_1984"&&a.datumCode!=="world_geodetic_system_1984"||(a.PROJECTION==="Mercator_Auxiliary_Sphere"&&(a.sphere=!0),a.datumCode="wgs84"),a.datumCode.slice(-6)==="_ferro"&&(a.datumCode=a.datumCode.slice(0,-6)),a.datumCode.slice(-8)==="_jakarta"&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),c.DATUM&&c.DATUM.SPHEROID&&(a.ellps=c.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),a.ellps.toLowerCase().slice(0,13)==="international"&&(a.ellps="intl"),a.a=c.DATUM.SPHEROID.a,a.rf=parseFloat(c.DATUM.SPHEROID.rf,10)),c.DATUM&&c.DATUM.TOWGS84&&(a.datum_params=c.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),a.datumCode==="ch1903+"&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel")&&(a.datumCode="isr93")),a.b&&!isFinite(a.b)&&(a.b=a.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",kr],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",kr],["x0","false_easting",u],["y0","false_northing",u],["long0","central_meridian",kr],["lat0","latitude_of_origin",kr],["lat0","standard_parallel_1",kr],["lat1","standard_parallel_1",kr],["lat2","standard_parallel_2",kr],["azimuth","Azimuth"],["alpha","azimuth",kr],["srsCode","name"]].forEach(function(d){return function(p,f){var v=f[0],m=f[1];!(v in p)&&m in p&&(p[v]=p[m],f.length===3&&(p[v]=f[2](p[v])))}(a,d)}),a.long0||!a.longc||a.projName!=="Albers_Conic_Equal_Area"&&a.projName!=="Lambert_Azimuthal_Equal_Area"||(a.long0=a.longc),a.lat_ts||!a.lat1||a.projName!=="Stereographic_South_Pole"&&a.projName!=="Polar Stereographic (variant B)"?!a.lat_ts&&a.lat0&&a.projName==="Polar_Stereographic"&&(a.lat_ts=a.lat0,a.lat0=kr(a.lat0>0?90:-90)):(a.lat0=kr(a.lat1>0?90:-90),a.lat_ts=a.lat1)}(s),s}function Ri(i){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Ri[i]=Jf(arguments[1]):Ri[i]=DM(arguments[1]):Ri[i]=t}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(r){Array.isArray(r)?Ri.apply(e,r):Ri(r)});if(typeof i=="string"){if(i in Ri)return Ri[i]}else"EPSG"in i?Ri["EPSG:"+i.EPSG]=i:"ESRI"in i?Ri["ESRI:"+i.ESRI]=i:"IAU2000"in i&&(Ri["IAU2000:"+i.IAU2000]=i);return}}(function(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]})(Ri);var CE=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],RE=["3857","900913","3785","102113"];function PE(i){if(!function(r){return typeof r=="string"}(i))return i;if(function(r){return r in Ri}(i))return Ri[i];if(function(r){return CE.some(function(s){return r.indexOf(s)>-1})}(i)){var e=DM(i);if(function(r){var s=ia(r,"authority");if(s){var a=ia(s,"epsg");return a&&RE.indexOf(a)>-1}}(e))return Ri["EPSG:3857"];var t=function(r){var s=ia(r,"extension");if(s)return ia(s,"proj4")}(e);return t?Jf(t):e}return function(r){return r[0]==="+"}(i)?Jf(i):void 0}function ly(i,e){var t,r;if(i=i||{},!e)return i;for(r in e)(t=e[r])!==void 0&&(i[r]=t);return i}function ss(i,e,t){var r=i*e;return t/Math.sqrt(1-r*r)}function Jh(i){return i<0?-1:1}function we(i){return Math.abs(i)<=Ft?i:i-Jh(i)*Ch}function Pr(i,e,t){var r=i*t,s=.5*i;return r=Math.pow((1-r)/(1+r),s),Math.tan(.5*(pe-e))/r}function Rh(i,e){for(var t,r,s=.5*i,a=pe-2*Math.atan(e),n=0;n<=15;n++)if(t=i*Math.sin(a),a+=r=pe-2*Math.atan(e*Math.pow((1-t)/(1+t),s))-a,Math.abs(r)<=1e-10)return a;return-9999}const IE={init:function(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ss(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(i){var e,t,r=i.x,s=i.y;if(s*ta>90&&s*ta<-90&&r*ta>180&&r*ta<-180||Math.abs(Math.abs(s)-pe)<=Me)return null;if(this.sphere)e=this.x0+this.a*this.k0*we(r-this.long0),t=this.y0+this.a*this.k0*Math.log(Math.tan(lt+.5*s));else{var a=Math.sin(s),n=Pr(this.e,s,a);e=this.x0+this.a*this.k0*we(r-this.long0),t=this.y0-this.a*this.k0*Math.log(n)}return i.x=e,i.y=t,i},inverse:function(i){var e,t,r=i.x-this.x0,s=i.y-this.y0;if(this.sphere)t=pe-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var a=Math.exp(-s/(this.a*this.k0));if((t=Rh(this.e,a))===-9999)return null}return e=we(this.long0+r/(this.a*this.k0)),i.x=e,i.y=t,i},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]};function hy(i){return i}var LE=[IE,{init:function(){},forward:hy,inverse:hy,names:["longlat","identity"]}],Ou={},ad=[];function cy(i,e){var t=ad.length;return!i.names||(ad[t]=i,i.names.forEach(function(r){Ou[r.toLowerCase()]=t}),this)}const NE={start:function(){LE.forEach(cy)},add:cy,get:function(i){if(!i)return!1;var e=i.toLowerCase();return typeof Ou[e]<"u"&&ad[Ou[e]]?ad[Ou[e]]:void 0}};var l0={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},DE=l0.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};l0.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var $t={};$t.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},$t.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},$t.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},$t.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},$t.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},$t.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},$t.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},$t.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},$t.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},$t.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},$t.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},$t.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},$t.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},$t.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},$t.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},$t.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},$t.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},$t.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var OM={};function OE(i){if(i.length===0)return null;var e=i[0]==="@";return e&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:i,mandatory:!e,grid:OM[i]||null,isNull:!1}}function mo(i){return i/3600*Math.PI/180}function $f(i,e,t){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(e,t)))}function UE(i){return i.map(function(e){return[mo(e.longitudeShift),mo(e.latitudeShift)]})}function FE(i,e,t){return{name:$f(i,e+8,e+16).trim(),parent:$f(i,e+24,e+24+8).trim(),lowerLatitude:i.getFloat64(e+72,t),upperLatitude:i.getFloat64(e+88,t),lowerLongitude:i.getFloat64(e+104,t),upperLongitude:i.getFloat64(e+120,t),latitudeInterval:i.getFloat64(e+136,t),longitudeInterval:i.getFloat64(e+152,t),gridNodeCount:i.getInt32(e+168,t)}}function kE(i,e,t,r){for(var s=e+176,a=[],n=0;n<t.gridNodeCount;n++){var o={latitudeShift:i.getFloat32(s+16*n,r),longitudeShift:i.getFloat32(s+16*n+4,r),latitudeAccuracy:i.getFloat32(s+16*n+8,r),longitudeAccuracy:i.getFloat32(s+16*n+12,r)};a.push(o)}return a}function es(i,e){if(!(this instanceof es))return new es(i);e=e||function(h){if(h)throw h};var t=PE(i);if(typeof t=="object"){var r=es.projections.get(t.projName);if(r){if(t.datumCode&&t.datumCode!=="none"){var s=ia($t,t.datumCode);s&&(t.datum_params=t.datum_params||(s.towgs84?s.towgs84.split(","):null),t.ellps=s.ellipse,t.datumName=s.datumName?s.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var a=function(h,c,u,d,p){if(!h){var f=ia(l0,d);f||(f=DE),h=f.a,c=f.b,u=f.rf}return u&&!c&&(c=(1-1/u)*h),(u===0||Math.abs(h-c)<Me)&&(p=!0,c=h),{a:h,b:c,rf:u,sphere:p}}(t.a,t.b,t.rf,t.ellps,t.sphere),n=function(h,c,u,d){var p=h*h,f=c*c,v=(p-f)/p,m=0;return d?(p=(h*=1-v*(yE+v*(xE+v*ME)))*h,v=0):m=Math.sqrt(v),{es:v,e:m,ep2:(p-f)/f}}(a.a,a.b,a.rf,t.R_A),o=function(h){return h===void 0?null:h.split(",").map(OE)}(t.nadgrids),l=t.datum||function(h,c,u,d,p,f,v){var m={};return h===void 0||h==="none"?m.datum_type=Qf:m.datum_type=vE,c&&(m.datum_params=c.map(parseFloat),m.datum_params[0]===0&&m.datum_params[1]===0&&m.datum_params[2]===0||(m.datum_type=vn),m.datum_params.length>3&&(m.datum_params[3]===0&&m.datum_params[4]===0&&m.datum_params[5]===0&&m.datum_params[6]===0||(m.datum_type=_n,m.datum_params[3]*=Jl,m.datum_params[4]*=Jl,m.datum_params[5]*=Jl,m.datum_params[6]=m.datum_params[6]/1e6+1))),v&&(m.datum_type=So,m.grids=v),m.a=u,m.b=d,m.es=p,m.ep2=f,m}(t.datumCode,t.datum_params,a.a,a.b,n.es,n.ep2,o);ly(this,t),ly(this,r),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=n.es,this.e=n.e,this.ep2=n.ep2,this.datum=l,this.init(),e(null,this)}else e(i)}else e(i)}function UM(i,e,t){var r,s,a,n,o=i.x,l=i.y,h=i.z?i.z:0;if(l<-pe&&l>-1.001*pe)l=-pe;else if(l>pe&&l<1.001*pe)l=pe;else{if(l<-pe)return{x:-1/0,y:-1/0,z:i.z};if(l>pe)return{x:1/0,y:1/0,z:i.z}}return o>Math.PI&&(o-=2*Math.PI),s=Math.sin(l),n=Math.cos(l),a=s*s,{x:((r=t/Math.sqrt(1-e*a))+h)*n*Math.cos(o),y:(r+h)*n*Math.sin(o),z:(r*(1-e)+h)*s}}function FM(i,e,t,r){var s,a,n,o,l,h,c,u,d,p,f,v,m,g,_,y=1e-12,x=i.x,M=i.y,b=i.z?i.z:0;if(s=Math.sqrt(x*x+M*M),a=Math.sqrt(x*x+M*M+b*b),s/t<y){if(g=0,a/t<y)return _=-r,{x:i.x,y:i.y,z:i.z}}else g=Math.atan2(M,x);n=b/a,u=(o=s/a)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*o*o)),d=n*l,m=0;do m++,h=e*(c=t/Math.sqrt(1-e*d*d))/(c+(_=s*u+b*d-c*(1-e*d*d))),v=(f=n*(l=1/Math.sqrt(1-h*(2-h)*o*o)))*u-(p=o*(1-h)*l)*d,u=p,d=f;while(v*v>1e-24&&m<30);return{x:g,y:Math.atan(f/Math.abs(p)),z:_}}function su(i){return i===vn||i===_n}function BE(i,e,t){if(function(l,h){return l.datum_type===h.datum_type&&!(l.a!==h.a||Math.abs(l.es-h.es)>5e-11)&&(l.datum_type===vn?l.datum_params[0]===h.datum_params[0]&&l.datum_params[1]===h.datum_params[1]&&l.datum_params[2]===h.datum_params[2]:l.datum_type!==_n||l.datum_params[0]===h.datum_params[0]&&l.datum_params[1]===h.datum_params[1]&&l.datum_params[2]===h.datum_params[2]&&l.datum_params[3]===h.datum_params[3]&&l.datum_params[4]===h.datum_params[4]&&l.datum_params[5]===h.datum_params[5]&&l.datum_params[6]===h.datum_params[6])}(i,e)||i.datum_type===Qf||e.datum_type===Qf)return t;var r=i.a,s=i.es;if(i.datum_type===So){if(uy(i,!1,t)!==0)return;r=ry,s=sy}var a=e.a,n=e.b,o=e.es;if(e.datum_type===So&&(a=ry,n=_E,o=sy),s===o&&r===a&&!su(i.datum_type)&&!su(e.datum_type)||(t=UM(t,s,r),su(i.datum_type)&&(t=function(l,h,c){if(h===vn)return{x:l.x+c[0],y:l.y+c[1],z:l.z+c[2]};if(h===_n){var u=c[0],d=c[1],p=c[2],f=c[3],v=c[4],m=c[5],g=c[6];return{x:g*(l.x-m*l.y+v*l.z)+u,y:g*(m*l.x+l.y-f*l.z)+d,z:g*(-v*l.x+f*l.y+l.z)+p}}}(t,i.datum_type,i.datum_params)),su(e.datum_type)&&(t=function(l,h,c){if(h===vn)return{x:l.x-c[0],y:l.y-c[1],z:l.z-c[2]};if(h===_n){var u=c[0],d=c[1],p=c[2],f=c[3],v=c[4],m=c[5],g=c[6],_=(l.x-u)/g,y=(l.y-d)/g,x=(l.z-p)/g;return{x:_+m*y-v*x,y:-m*_+y+f*x,z:v*_-f*y+x}}}(t,e.datum_type,e.datum_params)),t=FM(t,o,a,n),!(e.datum_type===So&&uy(e,!0,t)!==0)))return t}function uy(i,e,t){if(i.grids===null||i.grids.length===0)return-1;var r={x:-t.x,y:t.y},s={x:Number.NaN,y:Number.NaN},a=[];e:for(var n=0;n<i.grids.length;n++){var o=i.grids[n];if(a.push(o.name),o.isNull){s=r;break}if(o.mandatory,o.grid!==null)for(var l=o.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,p=u.ll[0]-d,f=u.ll[1]-d,v=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,m=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(f>r.y||p>r.x||m<r.y||v<r.x)&&(s=zE(r,e,u),!isNaN(s.x)))break e}else if(o.mandatory)return-1}return isNaN(s.x)?-1:(t.x=-s.x,t.y=s.y,0)}function zE(i,e,t){var r={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return r;var s={x:i.x,y:i.y};s.x-=t.ll[0],s.y-=t.ll[1],s.x=we(s.x-Math.PI)+Math.PI;var a=dy(s,t);if(e){if(isNaN(a.x))return r;a.x=s.x-a.x,a.y=s.y-a.y;var n,o,l=9;do{if(o=dy(a,t),isNaN(o.x))break;n={x:s.x-(o.x+a.x),y:s.y-(o.y+a.y)},a.x+=n.x,a.y+=n.y}while(l--&&Math.abs(n.x)>1e-12&&Math.abs(n.y)>1e-12);if(l<0)return r;r.x=we(a.x+t.ll[0]),r.y=a.y+t.ll[1]}else isNaN(a.x)||(r.x=i.x+a.x,r.y=i.y+a.y);return r}function dy(i,e){var t,r={x:i.x/e.del[0],y:i.y/e.del[1]},s=Math.floor(r.x),a=Math.floor(r.y),n=r.x-1*s,o=r.y-1*a,l={x:Number.NaN,y:Number.NaN};if(s<0||s>=e.lim[0]||a<0||a>=e.lim[1])return l;t=a*e.lim[0]+s;var h=e.cvs[t][0],c=e.cvs[t][1];t++;var u=e.cvs[t][0],d=e.cvs[t][1];t+=e.lim[0];var p=e.cvs[t][0],f=e.cvs[t][1];t--;var v=e.cvs[t][0],m=e.cvs[t][1],g=n*o,_=n*(1-o),y=(1-n)*(1-o),x=(1-n)*o;return l.x=y*h+_*u+x*v+g*p,l.y=y*c+_*d+x*m+g*f,l}function py(i,e,t){var r,s,a,n=t.x,o=t.y,l=t.z||0,h={};for(a=0;a<3;a++)if(!e||a!==2||t.z!==void 0)switch(a===0?(r=n,s="ew".indexOf(i.axis[a])!==-1?"x":"y"):a===1?(r=o,s="ns".indexOf(i.axis[a])!==-1?"y":"x"):(r=l,s="z"),i.axis[a]){case"e":case"n":h[s]=r;break;case"w":case"s":h[s]=-r;break;case"u":t[s]!==void 0&&(h.z=r);break;case"d":t[s]!==void 0&&(h.z=-r);break;default:return null}return h}function kM(i){var e={x:i[0],y:i[1]};return i.length>2&&(e.z=i[2]),i.length>3&&(e.m=i[3]),e}function my(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!=i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function nd(i,e,t,r){var s,a=(t=Array.isArray(t)?kM(t):{x:t.x,y:t.y,z:t.z,m:t.m}).z!==void 0;if(function(n){my(n.x),my(n.y)}(t),i.datum&&e.datum&&function(n,o){return(n.datum.datum_type===vn||n.datum.datum_type===_n||n.datum.datum_type===So)&&o.datumCode!=="WGS84"||(o.datum.datum_type===vn||o.datum.datum_type===_n||o.datum.datum_type===So)&&n.datumCode!=="WGS84"}(i,e)&&(t=nd(i,s=new es("WGS84"),t,r),i=s),r&&i.axis!=="enu"&&(t=py(i,!1,t)),i.projName==="longlat")t={x:t.x*mi,y:t.y*mi,z:t.z||0};else if(i.to_meter&&(t={x:t.x*i.to_meter,y:t.y*i.to_meter,z:t.z||0}),!(t=i.inverse(t)))return;if(i.from_greenwich&&(t.x+=i.from_greenwich),t=BE(i.datum,e.datum,t))return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*ta,y:t.y*ta,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),r&&e.axis!=="enu"?py(e,!0,t):(t&&!a&&delete t.z,t)}es.projections=NE,es.projections.start();var fy=es("WGS84");function pm(i,e,t,r){var s,a,n;return Array.isArray(t)?(s=nd(i,e,t,r)||{x:NaN,y:NaN},t.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(t.splice(3)):[s.x,s.y,t[2]].concat(t.splice(3)):[s.x,s.y].concat(t.splice(2)):[s.x,s.y]):(a=nd(i,e,t,r),(n=Object.keys(t)).length===2||n.forEach(function(o){if(typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;a[o]=t[o]}),a)}function gy(i){return i instanceof es?i:i.oProj?i.oProj:es(i)}function Fi(i,e,t){i=gy(i);var r,s=!1;return e===void 0?(e=i,i=fy,s=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=i,i=fy,s=!0),e=gy(e),t?pm(i,e,t):(r={forward:function(a,n){return pm(i,e,a,n)},inverse:function(a,n){return pm(e,i,a,n)}},s&&(r.oProj=e),r)}var vy=6,BM="AJSAJS",zM="AFAFAF",fo=65,ki=73,cr=79,zl=86,Vl=90;const VE={forward:VM,inverse:function(i){var e=h0(jM(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:HM};function VM(i,e){return e=e||5,function(t,r){var s="00000"+t.easting,a="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(n=t.easting,o=t.northing,l=t.zoneNumber,h=GM(l),c=Math.floor(n/1e5),u=Math.floor(o/1e5)%20,function(d,p,f){var v=f-1,m=BM.charCodeAt(v),g=zM.charCodeAt(v),_=m+d-1,y=g+p,x=!1;return _>Vl&&(_=_-Vl+fo-1,x=!0),(_===ki||m<ki&&_>ki||(_>ki||m<ki)&&x)&&_++,(_===cr||m<cr&&_>cr||(_>cr||m<cr)&&x)&&++_===ki&&_++,_>Vl&&(_=_-Vl+fo-1),y>zl?(y=y-zl+fo-1,x=!0):x=!1,(y===ki||g<ki&&y>ki||(y>ki||g<ki)&&x)&&y++,(y===cr||g<cr&&y>cr||(y>cr||g<cr)&&x)&&++y===ki&&y++,y>zl&&(y=y-zl+fo-1),String.fromCharCode(_)+String.fromCharCode(y)}(c,u,h))+s.substr(s.length-5,r)+a.substr(a.length-5,r);var n,o,l,h,c,u}(function(t){var r,s,a,n,o,l,h,c,u=t.lat,d=t.lon,p=6378137,f=.00669438,v=.9996,m=mm(u),g=mm(d);c=Math.floor((d+180)/6)+1,d===180&&(c=60),u>=56&&u<64&&d>=3&&d<12&&(c=32),u>=72&&u<84&&(d>=0&&d<9?c=31:d>=9&&d<21?c=33:d>=21&&d<33?c=35:d>=33&&d<42&&(c=37)),h=mm(6*(c-1)-180+3),r=f/(1-f),s=p/Math.sqrt(1-f*Math.sin(m)*Math.sin(m)),a=Math.tan(m)*Math.tan(m),n=r*Math.cos(m)*Math.cos(m),o=Math.cos(m)*(g-h),l=p*((1-f/4-3*f*f/64-5*f*f*f/256)*m-(3*f/8+3*f*f/32+45*f*f*f/1024)*Math.sin(2*m)+(15*f*f/256+45*f*f*f/1024)*Math.sin(4*m)-35*f*f*f/3072*Math.sin(6*m));var _=v*s*(o+(1-a+n)*o*o*o/6+(5-18*a+a*a+72*n-58*r)*o*o*o*o*o/120)+5e5,y=v*(l+s*Math.tan(m)*(o*o/2+(5-a+9*n+4*n*n)*o*o*o*o/24+(61-58*a+a*a+600*n-330*r)*o*o*o*o*o*o/720));return u<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(_),zoneNumber:c,zoneLetter:HE(u)}}({lat:i[1],lon:i[0]}),e)}function HM(i){var e=h0(jM(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function mm(i){return i*(Math.PI/180)}function _y(i){return i/Math.PI*180}function h0(i){var e=i.northing,t=i.easting,r=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var a,n,o,l,h,c,u,d,p,f=.9996,v=6378137,m=.00669438,g=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),_=t-5e5,y=e;r<"N"&&(y-=1e7),u=6*(s-1)-180+3,a=.006739496752268451,p=(d=y/f/6367449145945056e-9)+(3*g/2-27*g*g*g/32)*Math.sin(2*d)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*d)+151*g*g*g/96*Math.sin(6*d),n=v/Math.sqrt(1-m*Math.sin(p)*Math.sin(p)),o=Math.tan(p)*Math.tan(p),l=a*Math.cos(p)*Math.cos(p),h=.99330562*v/Math.pow(1-m*Math.sin(p)*Math.sin(p),1.5),c=_/(n*f);var x=p-n*Math.tan(p)/h*(c*c/2-(5+3*o+10*l-4*l*l-9*a)*c*c*c*c/24+(61+90*o+298*l+45*o*o-1.6983531815716497-3*l*l)*c*c*c*c*c*c/720);x=_y(x);var M,b=(c-(1+2*o+l)*c*c*c/6+(5-2*l+28*o-3*l*l+8*a+24*o*o)*c*c*c*c*c/120)/Math.cos(p);if(b=u+_y(b),i.accuracy){var w=h0({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});M={top:w.lat,right:w.lon,bottom:x,left:b}}else M={lat:x,lon:b};return M}function HE(i){var e="Z";return 84>=i&&i>=72?e="X":72>i&&i>=64?e="W":64>i&&i>=56?e="V":56>i&&i>=48?e="U":48>i&&i>=40?e="T":40>i&&i>=32?e="S":32>i&&i>=24?e="R":24>i&&i>=16?e="Q":16>i&&i>=8?e="P":8>i&&i>=0?e="N":0>i&&i>=-8?e="M":-8>i&&i>=-16?e="L":-16>i&&i>=-24?e="K":-24>i&&i>=-32?e="J":-32>i&&i>=-40?e="H":-40>i&&i>=-48?e="G":-48>i&&i>=-56?e="F":-56>i&&i>=-64?e="E":-64>i&&i>=-72?e="D":-72>i&&i>=-80&&(e="C"),e}function GM(i){var e=i%vy;return e===0&&(e=vy),e}function jM(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var e,t=i.length,r=null,s="",a=0;!/[A-Z]/.test(e=i.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+i;s+=e,a++}var n=parseInt(s,10);if(a===0||a+3>t)throw"MGRSPoint bad conversion from: "+i;var o=i.charAt(a++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+i;r=i.substring(a,a+=2);for(var l=GM(n),h=function(_,y){for(var x=BM.charCodeAt(y-1),M=1e5,b=!1;x!==_.charCodeAt(0);){if(++x===ki&&x++,x===cr&&x++,x>Vl){if(b)throw"Bad character: "+_;x=fo,b=!0}M+=1e5}return M}(r.charAt(0),l),c=function(_,y){if(_>"V")throw"MGRSPoint given invalid Northing "+_;for(var x=zM.charCodeAt(y-1),M=0,b=!1;x!==_.charCodeAt(0);){if(++x===ki&&x++,x===cr&&x++,x>zl){if(b)throw"Bad character: "+_;x=fo,b=!0}M+=1e5}return M}(r.charAt(1),l);c<GE(o);)c+=2e6;var u=t-a;if(u%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var d,p,f,v=u/2,m=0,g=0;return v>0&&(d=1e5/Math.pow(10,v),p=i.substring(a,a+v),m=parseFloat(p)*d,f=i.substring(a+v),g=parseFloat(f)*d),{easting:m+h,northing:g+c,zoneLetter:o,zoneNumber:n,accuracy:d}}function GE(i){var e;switch(i){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+i}function To(i,e,t){if(!(this instanceof To))return new To(i,e,t);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&e===void 0){var r=i.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=i,this.y=e,this.z=t||0}To.fromMGRS=function(i){return new To(HM(i))},To.prototype.toMGRS=function(i){return VM([this.x,this.y],i)};var jE=1,WE=.25,yy=.046875,xy=.01953125,My=.01068115234375,XE=.75,qE=.46875,YE=.013020833333333334,ZE=.007120768229166667,KE=.3645833333333333,QE=.005696614583333333,JE=.3076171875;function WM(i){var e=[];e[0]=jE-i*(WE+i*(yy+i*(xy+i*My))),e[1]=i*(XE-i*(yy+i*(xy+i*My)));var t=i*i;return e[2]=t*(qE-i*(YE+i*ZE)),t*=i,e[3]=t*(KE-i*QE),e[4]=t*i*JE,e}function od(i,e,t,r){return t*=e,e*=e,r[0]*i-t*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var $E=20;function XM(i,e,t){for(var r=1/(1-e),s=i,a=$E;a;--a){var n=Math.sin(s),o=1-e*n*n;if(s-=o=(od(s,n,Math.cos(s),t)-i)*(o*Math.sqrt(o))*r,Math.abs(o)<Me)return s}return s}const Uu={init:function(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=WM(this.es),this.ml0=od(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(i){var e,t,r,s=i.x,a=i.y,n=we(s-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.es){var h=l*n,c=Math.pow(h,2),u=this.ep2*Math.pow(l,2),d=Math.pow(u,2),p=Math.abs(l)>Me?Math.tan(a):0,f=Math.pow(p,2),v=Math.pow(f,2);e=1-this.es*Math.pow(o,2),h/=Math.sqrt(e);var m=od(a,o,l,this.en);t=this.a*(this.k0*h*(1+c/6*(1-f+u+c/20*(5-18*f+v+14*u-58*f*u+c/42*(61+179*v-v*f-479*f)))))+this.x0,r=this.a*(this.k0*(m-this.ml0+o*n*h/2*(1+c/12*(5-f+9*u+4*d+c/30*(61+v-58*f+270*u-330*f*u+c/56*(1385+543*v-v*f-3111*f))))))+this.y0}else{var g=l*Math.sin(n);if(Math.abs(Math.abs(g)-1)<Me)return 93;if(t=.5*this.a*this.k0*Math.log((1+g)/(1-g))+this.x0,r=l*Math.cos(n)/Math.sqrt(1-Math.pow(g,2)),(g=Math.abs(r))>=1){if(g-1>Me)return 93;r=0}else r=Math.acos(r);a<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return i.x=t,i.y=r,i},inverse:function(i){var e,t,r,s,a=(i.x-this.x0)*(1/this.a),n=(i.y-this.y0)*(1/this.a);if(this.es)if(t=XM(e=this.ml0+n/this.k0,this.es,this.en),Math.abs(t)<pe){var o=Math.sin(t),l=Math.cos(t),h=Math.abs(l)>Me?Math.tan(t):0,c=this.ep2*Math.pow(l,2),u=Math.pow(c,2),d=Math.pow(h,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2);var f=a*Math.sqrt(e)/this.k0,v=Math.pow(f,2);r=t-(e*=h)*v/(1-this.es)*.5*(1-v/12*(5+3*d-9*c*d+c-4*u-v/30*(61+90*d-252*c*d+45*p+46*c-v/56*(1385+3633*d+4095*p+1574*p*d)))),s=we(this.long0+f*(1-v/6*(1+2*d+c-v/20*(5+28*d+24*p+8*c*d+6*c-v/42*(61+662*d+1320*p+720*p*d))))/l)}else r=pe*Jh(n),s=0;else{var m=Math.exp(a/this.k0),g=.5*(m-1/m),_=this.lat0+n/this.k0,y=Math.cos(_);e=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(g,2))),r=Math.asin(e),n<0&&(r=-r),s=g===0&&y===0?0:we(Math.atan2(g,y)+this.long0)}return i.x=s,i.y=r,i},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function qM(i){var e=Math.exp(i);return e=(e-1/e)/2}function dr(i,e){i=Math.abs(i),e=Math.abs(e);var t=Math.max(i,e),r=Math.min(i,e)/(t||1);return t*Math.sqrt(1+Math.pow(r,2))}function e2(i){var e=Math.abs(i);return e=function(t){var r=1+t,s=r-1;return s===0?t:t*Math.log(r)/s}(e*(1+e/(dr(1,e)+1))),i<0?-e:e}function fm(i,e){for(var t,r=2*Math.cos(2*e),s=i.length-1,a=i[s],n=0;--s>=0;)t=r*a-n+i[s],n=a,a=t;return e+t*Math.sin(2*e)}function by(i,e,t){for(var r,s,a=Math.sin(e),n=Math.cos(e),o=qM(t),l=function(m){var g=Math.exp(m);return(g+1/g)/2}(t),h=2*n*l,c=-2*a*o,u=i.length-1,d=i[u],p=0,f=0,v=0;--u>=0;)r=f,s=p,d=h*(f=d)-r-c*(p=v)+i[u],v=c*f-s+h*p;return[(h=a*l)*d-(c=n*o)*v,h*v+c*d]}const Fu={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Uu.init.apply(this),this.forward=Uu.forward,this.inverse=Uu.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),e=i/(2-i),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),t*=e,this.cgb[1]=t*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t*=e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),t*=e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(e*(-24832/14175)-2.4)),t*=e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t*=e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),t*=e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t*=e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t*=e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t*=e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=.6650675310896665*t;var r=fm(this.cbg,this.lat0);this.Zb=-this.Qn*(r+function(s,a){for(var n,o=2*Math.cos(a),l=s.length-1,h=s[l],c=0;--l>=0;)n=o*h-c+s[l],c=h,h=n;return Math.sin(a)*n}(this.gtu,2*r))},forward:function(i){var e=we(i.x-this.long0),t=i.y;t=fm(this.cbg,t);var r=Math.sin(t),s=Math.cos(t),a=Math.sin(e),n=Math.cos(e);t=Math.atan2(r,n*s),e=Math.atan2(a*s,dr(r,s*n)),e=e2(Math.tan(e));var o,l,h=by(this.gtu,2*t,2*e);return t+=h[0],e+=h[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*t+this.Zb)+this.y0):(o=1/0,l=1/0),i.x=o,i.y=l,i},inverse:function(i){var e,t,r=(i.x-this.x0)*(1/this.a),s=(i.y-this.y0)*(1/this.a);if(s=(s-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var a=by(this.utg,2*s,2*r);s+=a[0],r+=a[1],r=Math.atan(qM(r));var n=Math.sin(s),o=Math.cos(s),l=Math.sin(r),h=Math.cos(r);s=Math.atan2(n*h,dr(l,h*o)),e=we((r=Math.atan2(l,h*o))+this.long0),t=fm(this.cgb,s)}else e=1/0,t=1/0;return i.x=e,i.y=t,i},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},t2={init:function(){var i=function(e,t){if(e===void 0){if((e=Math.floor(30*(we(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*mi,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Fu.init.apply(this),this.forward=Fu.forward,this.inverse=Fu.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function gm(i,e){return Math.pow((1-i)/(1+i),e)}const vm={init:function(){var i=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+lt)/(Math.pow(Math.tan(.5*this.lat0+lt),this.C)*gm(this.e*i,this.ratexp))},forward:function(i){var e=i.x,t=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+lt),this.C)*gm(this.e*Math.sin(t),this.ratexp))-pe,i.x=this.C*e,i},inverse:function(i){for(var e=i.x/this.C,t=i.y,r=Math.pow(Math.tan(.5*t+lt)/this.K,1/this.C),s=20;s>0&&(t=2*Math.atan(r*gm(this.e*Math.sin(i.y),-.5*this.e))-pe,!(Math.abs(t-i.y)<1e-14));--s)i.y=t;return s?(i.x=e,i.y=t,i):null},names:["gauss"]},i2={init:function(){vm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(i){var e,t,r,s;return i.x=we(i.x-this.long0),vm.forward.apply(this,[i]),e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*r),i.x=s*t*Math.sin(i.x),i.y=s*(this.cosc0*e-this.sinc0*t*r),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){var e,t,r,s,a;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,a=dr(i.x,i.y)){var n=2*Math.atan2(a,this.R2);e=Math.sin(n),t=Math.cos(n),s=Math.asin(t*this.sinc0+i.y*e*this.cosc0/a),r=Math.atan2(i.x*e,a*this.cosc0*t-i.y*this.sinc0*e)}else s=this.phic0,r=0;return i.x=r,i.y=s,vm.inverse.apply(this,[i]),i.x=we(i.x+this.long0),i},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},r2={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Me&&(this.k0=.5*(1+Jh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Me&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Me&&Math.abs(Math.cos(this.lat_ts))>Me&&(this.k0=.5*this.cons*ss(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Pr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ss(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-pe,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(i){var e,t,r,s,a,n,o=i.x,l=i.y,h=Math.sin(l),c=Math.cos(l),u=we(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=Me&&Math.abs(l+this.lat0)<=Me?(i.x=NaN,i.y=NaN,i):this.sphere?(e=2*this.k0/(1+this.sinlat0*h+this.coslat0*c*Math.cos(u)),i.x=this.a*e*c*Math.sin(u)+this.x0,i.y=this.a*e*(this.coslat0*h-this.sinlat0*c*Math.cos(u))+this.y0,i):(t=2*Math.atan(this.ssfn_(l,h,this.e))-pe,s=Math.cos(t),r=Math.sin(t),Math.abs(this.coslat0)<=Me?(a=Pr(this.e,l*this.con,this.con*h),n=2*this.a*this.k0*a/this.cons,i.x=this.x0+n*Math.sin(o-this.long0),i.y=this.y0-this.con*n*Math.cos(o-this.long0),i):(Math.abs(this.sinlat0)<Me?(e=2*this.a*this.k0/(1+s*Math.cos(u)),i.y=e*r):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*s*Math.cos(u))),i.y=e*(this.cosX0*r-this.sinX0*s*Math.cos(u))+this.y0),i.x=e*s*Math.sin(u)+this.x0,i))},inverse:function(i){var e,t,r,s,a;i.x-=this.x0,i.y-=this.y0;var n=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var o=2*Math.atan(n/(2*this.a*this.k0));return e=this.long0,t=this.lat0,n<=Me?(i.x=e,i.y=t,i):(t=Math.asin(Math.cos(o)*this.sinlat0+i.y*Math.sin(o)*this.coslat0/n),e=Math.abs(this.coslat0)<Me?this.lat0>0?we(this.long0+Math.atan2(i.x,-1*i.y)):we(this.long0+Math.atan2(i.x,i.y)):we(this.long0+Math.atan2(i.x*Math.sin(o),n*this.coslat0*Math.cos(o)-i.y*this.sinlat0*Math.sin(o))),i.x=e,i.y=t,i)}if(Math.abs(this.coslat0)<=Me){if(n<=Me)return t=this.lat0,e=this.long0,i.x=e,i.y=t,i;i.x*=this.con,i.y*=this.con,r=n*this.cons/(2*this.a*this.k0),t=this.con*Rh(this.e,r),e=this.con*we(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else s=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n<=Me?a=this.X0:(a=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/n),e=we(this.long0+Math.atan2(i.x*Math.sin(s),n*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)))),t=-1*Rh(this.e,Math.tan(.5*(pe+a)));return i.x=e,i.y=t,i},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(i,e,t){return e*=t,Math.tan(.5*(pe+i))*Math.pow((1-e)/(1+e),.5*t)}},s2={init:function(){var i=this.lat0;this.lambda0=this.long0;var e=Math.sin(i),t=this.a,r=1/this.rf,s=2*r-Math.pow(r,2),a=this.e=Math.sqrt(s);this.R=this.k0*t*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(e/this.alpha);var n=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+i/2)),l=Math.log((1+a*e)/(1-a*e));this.K=n-this.alpha*o+this.alpha*a/2*l},forward:function(i){var e=Math.log(Math.tan(Math.PI/4-i.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),r=-this.alpha*(e+t)+this.K,s=2*(Math.atan(Math.exp(r))-Math.PI/4),a=this.alpha*(i.x-this.lambda0),n=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(a));return i.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,i.x=this.R*n+this.x0,i},inverse:function(i){for(var e=i.x-this.x0,t=i.y-this.y0,r=e/this.R,s=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(r)),n=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+n/this.alpha,l=0,h=a,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=o,i.y=h,i},names:["somerc"]};var to=1e-7;const a2={init:function(){var i,e,t,r,s,a,n,o,l,h,c,u,d,p=0,f=0,v=0,m=0,g=0,_=0,y=0;this.no_off=(d=typeof(u=this).PROJECTION=="object"?Object.keys(u.PROJECTION)[0]:u.PROJECTION,"no_uoff"in u||"no_off"in u||["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)!==-1),this.no_rot="no_rot"in this;var x=!1;"alpha"in this&&(x=!0);var M=!1;if("rectified_grid_angle"in this&&(M=!0),x&&(y=this.alpha),M&&(p=this.rectified_grid_angle*mi),x||M)f=this.longc;else if(v=this.long1,g=this.lat1,m=this.long2,_=this.lat2,Math.abs(g-_)<=to||(i=Math.abs(g))<=to||Math.abs(i-pe)<=to||Math.abs(Math.abs(this.lat0)-pe)<=to||Math.abs(Math.abs(_)-pe)<=to)throw new Error;var b=1-this.es;e=Math.sqrt(b),Math.abs(this.lat0)>Me?(o=Math.sin(this.lat0),t=Math.cos(this.lat0),i=1-this.es*o*o,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/b),this.A=this.B*this.k0*e/i,(s=(r=this.B*e/(t*Math.sqrt(i)))*r-1)<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=r,this.E*=Math.pow(Pr(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=s=1),x||M?(x?(c=Math.asin(Math.sin(y)/r),M||(p=y)):(c=p,y=Math.asin(r*Math.sin(c))),this.lam0=f-Math.asin(.5*(s-1/s)*Math.tan(c))/this.B):(a=Math.pow(Pr(this.e,g,Math.sin(g)),this.B),n=Math.pow(Pr(this.e,_,Math.sin(_)),this.B),s=this.E/a,l=(n-a)/(n+a),h=((h=this.E*this.E)-n*a)/(h+n*a),(i=v-m)<-Math.pi?m-=Ch:i>Math.pi&&(m+=Ch),this.lam0=we(.5*(v+m)-Math.atan(h*Math.tan(.5*this.B*(v-m))/l)/this.B),c=Math.atan(2*Math.sin(this.B*we(v-this.lam0))/(s-1/s)),p=y=Math.asin(r*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(y))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(lt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(lt+s))},forward:function(i){var e,t,r,s,a,n,o,l,h={};if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-pe)>Me){if(e=.5*((a=this.E/Math.pow(Pr(this.e,i.y,Math.sin(i.y)),this.B))-(n=1/a)),t=.5*(a+n),s=Math.sin(this.B*i.x),r=(e*this.singam-s*this.cosgam)/t,Math.abs(Math.abs(r)-1)<Me)throw new Error;l=.5*this.ArB*Math.log((1-r)/(1+r)),n=Math.cos(this.B*i.x),o=Math.abs(n)<to?this.A*i.x:this.ArB*Math.atan2(e*this.cosgam+s*this.singam,n)}else l=i.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*i.y;return this.no_rot?(h.x=o,h.y=l):(o-=this.u_0,h.x=l*this.cosrot+o*this.sinrot,h.y=o*this.cosrot-l*this.sinrot),h.x=this.a*h.x+this.x0,h.y=this.a*h.y+this.y0,h},inverse:function(i){var e,t,r,s,a,n,o,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(t=i.y,e=i.x):(t=i.x*this.cosrot-i.y*this.sinrot,e=i.y*this.cosrot+i.x*this.sinrot+this.u_0),s=.5*((r=Math.exp(-this.BrA*t))-1/r),a=.5*(r+1/r),o=((n=Math.sin(this.BrA*e))*this.cosgam+s*this.singam)/a,Math.abs(Math.abs(o)-1)<Me)l.x=0,l.y=o<0?-pe:pe;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Rh(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-n*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},n2={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Me)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),r=ss(this.e,e,t),s=Pr(this.e,this.lat1,e),a=Math.sin(this.lat2),n=Math.cos(this.lat2),o=ss(this.e,a,n),l=Pr(this.e,this.lat2,a),h=Pr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Me?this.ns=Math.log(r/o)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(i){var e=i.x,t=i.y;Math.abs(2*Math.abs(t)-Math.PI)<=Me&&(t=Jh(t)*(pe-2*Me));var r,s,a=Math.abs(Math.abs(t)-pe);if(a>Me)r=Pr(this.e,t,Math.sin(t)),s=this.a*this.f0*Math.pow(r,this.ns);else{if((a=t*this.ns)<=0)return null;s=0}var n=this.ns*we(e-this.long0);return i.x=this.k0*(s*Math.sin(n))+this.x0,i.y=this.k0*(this.rh-s*Math.cos(n))+this.y0,i},inverse:function(i){var e,t,r,s,a,n=(i.x-this.x0)/this.k0,o=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(n*n+o*o),t=1):(e=-Math.sqrt(n*n+o*o),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*n,t*o)),e!==0||this.ns>0){if(t=1/this.ns,r=Math.pow(e/(this.a*this.f0),t),(s=Rh(this.e,r))===-9999)return null}else s=-pe;return a=we(l/this.ns+this.long0),i.x=a,i.y=s,i},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},o2={init:function(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(i){var e,t,r,s,a,n,o,l=i.x,h=i.y,c=we(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),r=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(r)),a=Math.asin(Math.cos(t)*Math.sin(r)/Math.cos(s)),n=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=o*Math.cos(n)/1,i.x=o*Math.sin(n)/1,this.czech||(i.y*=-1,i.x*=-1),i},inverse:function(i){var e,t,r,s,a,n,o,l=i.x;i.x=i.y,i.y=l,this.czech||(i.y*=-1,i.x*=-1),a=Math.sqrt(i.x*i.x+i.y*i.y),s=Math.atan2(i.y,i.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),t=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(e)),i.x=this.long0-t/this.alfa,n=e,o=0;var h=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(n))/(1-this.e*Math.sin(n)),this.e/2))-this.s45),Math.abs(n-i.y)<1e-10&&(o=1),n=i.y,h+=1;while(o===0&&h<15);return h>=15?null:i},names:["Krovak","krovak"]};function Ii(i,e,t,r,s){return i*s-e*Math.sin(2*s)+t*Math.sin(4*s)-r*Math.sin(6*s)}function Ph(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function Ih(i){return .375*i*(1+.25*i*(1+.46875*i))}function Lh(i){return .05859375*i*i*(1+.75*i)}function Nh(i){return i*i*i*(35/3072)}function Ao(i,e,t){var r=e*t;return i/Math.sqrt(1-r*r)}function Zo(i){return Math.abs(i)<pe?i:i-Jh(i)*Math.PI}function ld(i,e,t,r,s){var a,n;a=i/e;for(var o=0;o<15;o++)if(a+=n=(i-(e*a-t*Math.sin(2*a)+r*Math.sin(4*a)-s*Math.sin(6*a)))/(e-2*t*Math.cos(2*a)+4*r*Math.cos(4*a)-6*s*Math.cos(6*a)),Math.abs(n)<=1e-10)return a;return NaN}const l2={init:function(){this.sphere||(this.e0=Ph(this.es),this.e1=Ih(this.es),this.e2=Lh(this.es),this.e3=Nh(this.es),this.ml0=this.a*Ii(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(i){var e,t,r=i.x,s=i.y;if(r=we(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(r)),t=this.a*(Math.atan2(Math.tan(s),Math.cos(r))-this.lat0);else{var a=Math.sin(s),n=Math.cos(s),o=Ao(this.a,this.e,a),l=Math.tan(s)*Math.tan(s),h=r*Math.cos(s),c=h*h,u=this.es*n*n/(1-this.es);e=o*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),t=this.a*Ii(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+o*a/n*c*(.5+(5-l+6*u)*c/24)}return i.x=e+this.x0,i.y=t+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e,t,r=i.x/this.a,s=i.y/this.a;if(this.sphere){var a=s+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(r)),t=Math.atan2(Math.tan(r),Math.cos(a))}else{var n=ld(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(n)-pe)<=Me)return i.x=this.long0,i.y=pe,s<0&&(i.y*=-1),i;var o=Ao(this.a,this.e,Math.sin(n)),l=o*o*o/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(n),2),c=r*this.a/o,u=c*c;e=n-o*Math.tan(n)/l*c*c*(.5-(1+3*h)*c*c/24),t=c*(1-u*(h/3+(1+3*h)*h*u/15))/Math.cos(n)}return i.x=we(t+this.long0),i.y=Zo(e),i},names:["Cassini","Cassini_Soldner","cass"]};function ra(i,e){var t;return i>1e-7?(1-i*i)*(e/(1-(t=i*e)*t)-.5/i*Math.log((1-t)/(1+t))):2*e}var h2=.3333333333333333,c2=.17222222222222222,u2=.10257936507936508,d2=.06388888888888888,p2=.0664021164021164,m2=.016415012942191543;const f2={init:function(){var i,e=Math.abs(this.lat0);if(Math.abs(e-pe)<Me?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Me?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=ra(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var r,s=[];return s[0]=t*h2,r=t*t,s[0]+=r*c2,s[1]=r*d2,r*=t,s[0]+=r*u2,s[1]+=r*p2,s[2]=r*m2,s}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),i=Math.sin(this.lat0),this.sinb1=ra(this.e,i)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*i*i)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(i){var e,t,r,s,a,n,o,l,h,c,u=i.x,d=i.y;if(u=we(u-this.long0),this.sphere){if(a=Math.sin(d),c=Math.cos(d),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((t=this.mode===this.EQUIT?1+c*r:1+this.sinph0*a+this.cosph0*c*r)<=Me)return null;e=(t=Math.sqrt(2/t))*c*Math.sin(u),t*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(d+this.lat0)<Me)return null;t=lt-.5*d,e=(t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)))*Math.sin(u),t*=r}}else{switch(o=0,l=0,h=0,r=Math.cos(u),s=Math.sin(u),a=Math.sin(d),n=ra(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=n/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*r;break;case this.EQUIT:h=1+l*r;break;case this.N_POLE:h=pe+d,n=this.qp-n;break;case this.S_POLE:h=d-pe,n=this.qp+n}if(Math.abs(h)<Me)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),t=this.mode===this.OBLIQ?this.ymf*h*(this.cosb1*o-this.sinb1*l*r):(h=Math.sqrt(2/(1+l*r)))*o*this.ymf,e=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:n>=0?(e=(h=Math.sqrt(n))*s,t=r*(this.mode===this.S_POLE?h:-h)):e=t=0}}return i.x=this.a*e+this.x0,i.y=this.a*t+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,s,a,n,o,l,h,c,u=i.x/this.a,d=i.y/this.a;if(this.sphere){var p,f=0,v=0;if((t=.5*(p=Math.sqrt(u*u+d*d)))>1)return null;switch(t=2*Math.asin(t),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(v=Math.sin(t),f=Math.cos(t)),this.mode){case this.EQUIT:t=Math.abs(p)<=Me?0:Math.asin(d*v/p),u*=v,d=f*p;break;case this.OBLIQ:t=Math.abs(p)<=Me?this.lat0:Math.asin(f*this.sinph0+d*v*this.cosph0/p),u*=v*this.cosph0,d=(f-Math.sin(t)*this.sinph0)*p;break;case this.N_POLE:d=-d,t=pe-t;break;case this.S_POLE:t-=pe}e=d!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,d):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,d*=this.dd,(n=Math.sqrt(u*u+d*d))<Me)return i.x=this.long0,i.y=this.lat0,i;s=2*Math.asin(.5*n/this.rq),r=Math.cos(s),u*=s=Math.sin(s),this.mode===this.OBLIQ?(o=r*this.sinb1+d*s*this.cosb1/n,a=this.qp*o,d=n*this.cosb1*r-d*this.sinb1*s):(o=d*s/n,a=this.qp*o,d=n*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(a=u*u+d*d))return i.x=this.long0,i.y=this.lat0,i;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(u,d),l=Math.asin(o),h=this.apa,c=l+l,t=l+h[0]*Math.sin(c)+h[1]*Math.sin(c+c)+h[2]*Math.sin(c+c+c)}return i.x=we(this.long0+e),i.y=t,i},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Ma(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}const g2={init:function(){Math.abs(this.lat1+this.lat2)<Me||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ss(this.e3,this.sin_po,this.cos_po),this.qs1=ra(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ss(this.e3,this.sin_po,this.cos_po),this.qs2=ra(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ra(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Me?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(i){var e=i.x,t=i.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var r=ra(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*we(e-this.long0),n=s*Math.sin(a)+this.x0,o=this.rh-s*Math.cos(a)+this.y0;return i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1),s=0,e!==0&&(s=Math.atan2(r*i.x,r*i.y)),r=e*this.ns0/this.a,this.sphere?n=Math.asin((this.c-r*r)/(2*this.ns0)):(t=(this.c-r*r)/this.ns0,n=this.phi1z(this.e3,t)),a=we(s/this.ns0+this.long0),i.x=a,i.y=n,i},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(i,e){var t,r,s,a,n=Ma(.5*e);if(i<Me)return n;for(var o=i*i,l=1;l<=25;l++)if(n+=a=.5*(s=1-(r=i*(t=Math.sin(n)))*r)*s/Math.cos(n)*(e/(1-o)-t/s+.5/i*Math.log((1-r)/(1+r))),Math.abs(a)<=1e-7)return n;return null}},v2={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(i){var e,t,r,s,a,n,o,l=i.x,h=i.y;return r=we(l-this.long0),e=Math.sin(h),t=Math.cos(h),s=Math.cos(r),(a=this.sin_p14*e+this.cos_p14*t*s)>0||Math.abs(a)<=Me?(n=this.x0+1*this.a*t*Math.sin(r)/a,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*t*s)/a):(n=this.x0+this.infinity_dist*t*Math.sin(r),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*s)),i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(e=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(e,this.rc),t=Math.sin(s),n=Ma((r=Math.cos(s))*this.sin_p14+i.y*t*this.cos_p14/e),a=Math.atan2(i.x*t,e*this.cos_p14*r-i.y*this.sin_p14*t),a=we(this.long0+a)):(n=this.phic0,a=0),i.x=a,i.y=n,i},names:["gnom"]},_2={init:function(){this.sphere||(this.k0=ss(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(i){var e,t,r=i.x,s=i.y,a=we(r-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),t=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var n=ra(this.e,Math.sin(s));e=this.x0+this.a*this.k0*a,t=this.y0+this.a*n*.5/this.k0}return i.x=e,i.y=t,i},inverse:function(i){var e,t;return i.x-=this.x0,i.y-=this.y0,this.sphere?(e=we(this.long0+i.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(t=function(r,s){var a=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(s)-a)<1e-6)return s<0?-1*pe:pe;for(var n,o,l,h,c=Math.asin(.5*s),u=0;u<30;u++)if(o=Math.sin(c),l=Math.cos(c),h=r*o,c+=n=Math.pow(1-h*h,2)/(2*l)*(s/(1-r*r)-o/(1-h*h)+.5/r*Math.log((1-h)/(1+h))),Math.abs(n)<=1e-10)return c;return NaN}(this.e,2*i.y*this.k0/this.a),e=we(this.long0+i.x/(this.a*this.k0))),i.x=e,i.y=t,i},names:["cea"]},y2={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(i){var e=i.x,t=i.y,r=we(e-this.long0),s=Zo(t-this.lat0);return i.x=this.x0+this.a*r*this.rc,i.y=this.y0+this.a*s,i},inverse:function(i){var e=i.x,t=i.y;return i.x=we(this.long0+(e-this.x0)/(this.a*this.rc)),i.y=Zo(this.lat0+(t-this.y0)/this.a),i},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},x2={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ph(this.es),this.e1=Ih(this.es),this.e2=Lh(this.es),this.e3=Nh(this.es),this.ml0=this.a*Ii(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(i){var e,t,r,s=i.x,a=i.y,n=we(s-this.long0);if(r=n*Math.sin(a),this.sphere)Math.abs(a)<=Me?(e=this.a*n,t=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(a),t=this.a*(Zo(a-this.lat0)+(1-Math.cos(r))/Math.tan(a)));else if(Math.abs(a)<=Me)e=this.a*n,t=-1*this.ml0;else{var o=Ao(this.a,this.e,Math.sin(a))/Math.tan(a);e=o*Math.sin(r),t=this.a*Ii(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(r))}return i.x=e+this.x0,i.y=t+this.y0,i},inverse:function(i){var e,t,r,s,a,n,o,l,h;if(r=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=Me)e=we(r/this.a+this.long0),t=0;else{var c;for(n=this.lat0+s/this.a,o=r*r/this.a/this.a+n*n,l=n,a=20;a;--a)if(l+=h=-1*(n*(l*(c=Math.tan(l))+1)-l-.5*(l*l+o)*c)/((l-n)/c-1),Math.abs(h)<=Me){t=l;break}e=we(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(t))}else if(Math.abs(s+this.ml0)<=Me)t=0,e=we(this.long0+r/this.a);else{var u,d,p,f,v;for(n=(this.ml0+s)/this.a,o=r*r/this.a/this.a+n*n,l=n,a=20;a;--a)if(v=this.e*Math.sin(l),u=Math.sqrt(1-v*v)*Math.tan(l),d=this.a*Ii(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=h=(n*(u*(f=d/this.a)+1)-f-.5*u*(f*f+o))/(this.es*Math.sin(2*l)*(f*f+o-2*n*f)/(4*u)+(n-f)*(u*p-2/Math.sin(2*l))-p),Math.abs(h)<=Me){t=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=we(this.long0+Math.asin(r*u/this.a)/Math.sin(t))}return i.x=e,i.y=t,i},names:["Polyconic","poly"]},M2={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(i){var e,t=i.x,r=i.y-this.lat0,s=t-this.long0,a=r/Jl*1e-5,n=s,o=1,l=0;for(e=1;e<=10;e++)o*=a,l+=this.A[e]*o;var h,c=l,u=n,d=1,p=0,f=0,v=0;for(e=1;e<=6;e++)h=p*c+d*u,d=d*c-p*u,p=h,f=f+this.B_re[e]*d-this.B_im[e]*p,v=v+this.B_im[e]*d+this.B_re[e]*p;return i.x=v*this.a+this.x0,i.y=f*this.a+this.y0,i},inverse:function(i){var e,t,r=i.x,s=i.y,a=r-this.x0,n=(s-this.y0)/this.a,o=a/this.a,l=1,h=0,c=0,u=0;for(e=1;e<=6;e++)t=h*n+l*o,l=l*n-h*o,h=t,c=c+this.C_re[e]*l-this.C_im[e]*h,u=u+this.C_im[e]*l+this.C_re[e]*h;for(var d=0;d<this.iterations;d++){var p,f=c,v=u,m=n,g=o;for(e=2;e<=6;e++)p=v*c+f*u,f=f*c-v*u,v=p,m+=(e-1)*(this.B_re[e]*f-this.B_im[e]*v),g+=(e-1)*(this.B_im[e]*f+this.B_re[e]*v);f=1,v=0;var _=this.B_re[1],y=this.B_im[1];for(e=2;e<=6;e++)p=v*c+f*u,f=f*c-v*u,v=p,_+=e*(this.B_re[e]*f-this.B_im[e]*v),y+=e*(this.B_im[e]*f+this.B_re[e]*v);var x=_*_+y*y;c=(m*_+g*y)/x,u=(g*_-m*y)/x}var M=c,b=u,w=1,T=0;for(e=1;e<=9;e++)w*=M,T+=this.D[e]*w;var R=this.lat0+T*Jl*1e5,I=this.long0+b;return i.x=I,i.y=R,i},names:["New_Zealand_Map_Grid","nzmg"]},b2={init:function(){},forward:function(i){var e=i.x,t=i.y,r=we(e-this.long0),s=this.x0+this.a*r,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return i.x=s,i.y=a,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e=we(this.long0+i.x/this.a),t=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=e,i.y=t,i},names:["Miller_Cylindrical","mill"]},w2={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=WM(this.es)},forward:function(i){var e,t,r=i.x,s=i.y;if(r=we(r-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(s),n=20;n;--n){var o=(this.m*s+Math.sin(s)-a)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<Me)break}else s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;e=this.a*this.C_x*r*(this.m+Math.cos(s)),t=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);t=this.a*od(s,l,h,this.en),e=this.a*r*h/Math.sqrt(1-this.es*l*l)}return i.x=e,i.y=t,i},inverse:function(i){var e,t,r;return i.x-=this.x0,t=i.x/this.a,i.y-=this.y0,e=i.y/this.a,this.sphere?(e/=this.C_y,t/=this.C_x*(this.m+Math.cos(e)),this.m?e=Ma((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=Ma(Math.sin(e)/this.n)),t=we(t+this.long0),e=Zo(e)):(e=XM(i.y/this.a,this.es,this.en),(r=Math.abs(e))<pe?(r=Math.sin(e),t=we(this.long0+i.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)))):r-Me<pe&&(t=this.long0)),i.x=t,i.y=e,i},names:["Sinusoidal","sinu"]},S2={init:function(){},forward:function(i){for(var e=i.x,t=i.y,r=we(e-this.long0),s=t,a=Math.PI*Math.sin(t);;){var n=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=n,Math.abs(n)<Me)break}s/=2,Math.PI/2-Math.abs(t)<Me&&(r=0);var o=.900316316158*this.a*r*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=o,i.y=l,i},inverse:function(i){var e,t;i.x-=this.x0,i.y-=this.y0,t=i.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var r=we(this.long0+i.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var s=Math.asin(t);return i.x=r,i.y=s,i},names:["Mollweide","moll"]},T2={init:function(){Math.abs(this.lat1+this.lat2)<Me||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ph(this.es),this.e1=Ih(this.es),this.e2=Lh(this.es),this.e3=Nh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ss(this.e,this.sinphi,this.cosphi),this.ml1=Ii(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Me?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ss(this.e,this.sinphi,this.cosphi),this.ml2=Ii(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Ii(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(i){var e,t=i.x,r=i.y;if(this.sphere)e=this.a*(this.g-r);else{var s=Ii(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-s)}var a=this.ns*we(t-this.long0),n=this.x0+e*Math.sin(a),o=this.y0+this.rh-e*Math.cos(a);return i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s;i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),e=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),e=-1);var a=0;return t!==0&&(a=Math.atan2(e*i.x,e*i.y)),this.sphere?(s=we(this.long0+a/this.ns),r=Zo(this.g-t/this.a),i.x=s,i.y=r,i):(r=ld(this.g-t/this.a,this.e0,this.e1,this.e2,this.e3),s=we(this.long0+a/this.ns),i.x=s,i.y=r,i)},names:["Equidistant_Conic","eqdc"]},A2={init:function(){this.R=this.a},forward:function(i){var e,t,r=i.x,s=i.y,a=we(r-this.long0);Math.abs(s)<=Me&&(e=this.x0+this.R*a,t=this.y0);var n=Ma(2*Math.abs(s/Math.PI));(Math.abs(a)<=Me||Math.abs(Math.abs(s)-pe)<=Me)&&(e=this.x0,t=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var o=.5*Math.abs(Math.PI/a-a/Math.PI),l=o*o,h=Math.sin(n),c=Math.cos(n),u=c/(h+c-1),d=u*u,p=u*(2/h-1),f=p*p,v=Math.PI*this.R*(o*(u-f)+Math.sqrt(l*(u-f)*(u-f)-(f+l)*(d-f)))/(f+l);a<0&&(v=-v),e=this.x0+v;var m=l+u;return v=Math.PI*this.R*(p*m-o*Math.sqrt((f+l)*(l+1)-m*m))/(f+l),t=s>=0?this.y0+v:this.y0-v,i.x=e,i.y=t,i},inverse:function(i){var e,t,r,s,a,n,o,l,h,c,u,d;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,a=(r=i.x/u)*r+(s=i.y/u)*s,u=3*(s*s/(l=-2*(n=-Math.abs(s)*(1+a))+1+2*s*s+a*a)+(2*(o=n-2*s*s+r*r)*o*o/l/l/l-9*n*o/l/l)/27)/(h=(n-o*o/3/l)/l)/(c=2*Math.sqrt(-h/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,t=i.y>=0?(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:-(-c*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,e=Math.abs(r)<Me?this.long0:we(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(r*r-s*s)+a*a))/2/r),i.x=e,i.y=t,i},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},E2={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(i){var e,t,r,s,a,n,o,l,h,c,u,d,p,f,v,m,g,_,y,x,M,b,w=i.x,T=i.y,R=Math.sin(i.y),I=Math.cos(i.y),E=we(w-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Me?(i.x=this.x0+this.a*(pe-T)*Math.sin(E),i.y=this.y0-this.a*(pe-T)*Math.cos(E),i):Math.abs(this.sin_p12+1)<=Me?(i.x=this.x0+this.a*(pe+T)*Math.sin(E),i.y=this.y0+this.a*(pe+T)*Math.cos(E),i):(_=this.sin_p12*R+this.cos_p12*I*Math.cos(E),g=(m=Math.acos(_))?m/Math.sin(m):1,i.x=this.x0+this.a*g*I*Math.sin(E),i.y=this.y0+this.a*g*(this.cos_p12*R-this.sin_p12*I*Math.cos(E)),i):(e=Ph(this.es),t=Ih(this.es),r=Lh(this.es),s=Nh(this.es),Math.abs(this.sin_p12-1)<=Me?(a=this.a*Ii(e,t,r,s,pe),n=this.a*Ii(e,t,r,s,T),i.x=this.x0+(a-n)*Math.sin(E),i.y=this.y0-(a-n)*Math.cos(E),i):Math.abs(this.sin_p12+1)<=Me?(a=this.a*Ii(e,t,r,s,pe),n=this.a*Ii(e,t,r,s,T),i.x=this.x0+(a+n)*Math.sin(E),i.y=this.y0+(a+n)*Math.cos(E),i):(o=R/I,l=Ao(this.a,this.e,this.sin_p12),h=Ao(this.a,this.e,R),c=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(h*I)),y=(u=Math.atan2(Math.sin(E),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(E)))===0?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(u)-Math.PI)<=Me?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(E)*Math.cos(c)/Math.sin(u)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),m=l*y*(1-(x=y*y)*(v=(p=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*p)*(1-v)/6+(M=x*y)/8*(f=d*p)*(1-2*v)+(b=M*y)/120*(v*(4-7*v)-3*d*d*(1-7*v))-b*y/48*f),i.x=this.x0+m*Math.sin(u),i.y=this.y0+m*Math.cos(u),i))},inverse:function(i){var e,t,r,s,a,n,o,l,h,c,u,d,p,f,v,m,g,_,y,x,M,b,w;return i.x-=this.x0,i.y-=this.y0,this.sphere?(e=Math.sqrt(i.x*i.x+i.y*i.y))>2*pe*this.a?void 0:(t=e/this.a,r=Math.sin(t),s=Math.cos(t),a=this.long0,Math.abs(e)<=Me?n=this.lat0:(n=Ma(s*this.sin_p12+i.y*r*this.cos_p12/e),o=Math.abs(this.lat0)-pe,a=Math.abs(o)<=Me?this.lat0>=0?we(this.long0+Math.atan2(i.x,-i.y)):we(this.long0-Math.atan2(-i.x,i.y)):we(this.long0+Math.atan2(i.x*r,e*this.cos_p12*s-i.y*this.sin_p12*r))),i.x=a,i.y=n,i):(l=Ph(this.es),h=Ih(this.es),c=Lh(this.es),u=Nh(this.es),Math.abs(this.sin_p12-1)<=Me?(n=ld(((d=this.a*Ii(l,h,c,u,pe))-(e=Math.sqrt(i.x*i.x+i.y*i.y)))/this.a,l,h,c,u),a=we(this.long0+Math.atan2(i.x,-1*i.y)),i.x=a,i.y=n,i):Math.abs(this.sin_p12+1)<=Me?(d=this.a*Ii(l,h,c,u,pe),n=ld(((e=Math.sqrt(i.x*i.x+i.y*i.y))-d)/this.a,l,h,c,u),a=we(this.long0+Math.atan2(i.x,i.y)),i.x=a,i.y=n,i):(e=Math.sqrt(i.x*i.x+i.y*i.y),v=Math.atan2(i.x,i.y),p=Ao(this.a,this.e,this.sin_p12),m=Math.cos(v),_=-(g=this.e*this.cos_p12*m)*g/(1-this.es),y=3*this.es*(1-_)*this.sin_p12*this.cos_p12*m/(1-this.es),b=1-_*(M=(x=e/p)-_*(1+_)*Math.pow(x,3)/6-y*(1+3*_)*Math.pow(x,4)/24)*M/2-x*M*M*M/6,f=Math.asin(this.sin_p12*Math.cos(M)+this.cos_p12*Math.sin(M)*m),a=we(this.long0+Math.asin(Math.sin(v)*Math.sin(M)/Math.cos(f))),w=Math.sin(f),n=Math.atan2((w-this.es*b*this.sin_p12)*Math.tan(f),w*(1-this.es)),i.x=a,i.y=n,i))},names:["Azimuthal_Equidistant","aeqd"]},C2={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(i){var e,t,r,s,a,n,o,l=i.x,h=i.y;return r=we(l-this.long0),e=Math.sin(h),t=Math.cos(h),s=Math.cos(r),((a=this.sin_p14*e+this.cos_p14*t*s)>0||Math.abs(a)<=Me)&&(n=1*this.a*t*Math.sin(r),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*t*s)),i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n,o;return i.x-=this.x0,i.y-=this.y0,t=Ma((e=Math.sqrt(i.x*i.x+i.y*i.y))/this.a),r=Math.sin(t),s=Math.cos(t),n=this.long0,Math.abs(e)<=Me?(o=this.lat0,i.x=n,i.y=o,i):(o=Ma(s*this.sin_p14+i.y*r*this.cos_p14/e),a=Math.abs(this.lat0)-pe,Math.abs(a)<=Me?(n=this.lat0>=0?we(this.long0+Math.atan2(i.x,-i.y)):we(this.long0-Math.atan2(-i.x,i.y)),i.x=n,i.y=o,i):(n=we(this.long0+Math.atan2(i.x*r,e*this.cos_p14*s-i.y*this.sin_p14*r)),i.x=n,i.y=o,i))},names:["ortho"]};var wy=1,bl=2,wl=3,Sl=4,_m=5,ym=6,ot={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function au(i,e,t,r){var s;return i<Me?(r.value=ot.AREA_0,s=0):(s=Math.atan2(e,t),Math.abs(s)<=lt?r.value=ot.AREA_0:s>lt&&s<=pe+lt?(r.value=ot.AREA_1,s-=pe):s>pe+lt||s<=-(pe+lt)?(r.value=ot.AREA_2,s=s>=0?s-Ft:s+Ft):(r.value=ot.AREA_3,s+=pe)),s}function io(i,e){var t=i+e;return t<-Ft?t+=Ch:t>+Ft&&(t-=Ch),t}const R2={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=pe-lt/2?this.face=_m:this.lat0<=-(pe-lt/2)?this.face=ym:Math.abs(this.long0)<=lt?this.face=wy:Math.abs(this.long0)<=pe+lt?this.face=this.long0>0?bl:Sl:this.face=wl,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(i){var e,t,r,s,a,n,o={x:0,y:0},l={value:0};if(i.x-=this.long0,e=this.es!==0?Math.atan(this.one_minus_f_squared*Math.tan(i.y)):i.y,t=i.x,this.face===_m)s=pe-e,t>=lt&&t<=pe+lt?(l.value=ot.AREA_0,r=t-pe):t>pe+lt||t<=-(pe+lt)?(l.value=ot.AREA_1,r=t>0?t-Ft:t+Ft):t>-(pe+lt)&&t<=-lt?(l.value=ot.AREA_2,r=t+pe):(l.value=ot.AREA_3,r=t);else if(this.face===ym)s=pe+e,t>=lt&&t<=pe+lt?(l.value=ot.AREA_0,r=-t+pe):t<lt&&t>=-lt?(l.value=ot.AREA_1,r=-t):t<-lt&&t>=-(pe+lt)?(l.value=ot.AREA_2,r=-t-pe):(l.value=ot.AREA_3,r=t>0?-t+Ft:-t-Ft);else{var h,c,u,d,p,f;this.face===bl?t=io(t,+pe):this.face===wl?t=io(t,+Ft):this.face===Sl&&(t=io(t,-pe)),d=Math.sin(e),p=Math.cos(e),f=Math.sin(t),h=p*Math.cos(t),c=p*f,u=d,this.face===wy?r=au(s=Math.acos(h),u,c,l):this.face===bl?r=au(s=Math.acos(c),u,-h,l):this.face===wl?r=au(s=Math.acos(-h),u,-c,l):this.face===Sl?r=au(s=Math.acos(-c),u,h,l):(s=r=0,l.value=ot.AREA_0)}return n=Math.atan(12/Ft*(r+Math.acos(Math.sin(r)*Math.cos(lt))-pe)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(r))))),l.value===ot.AREA_1?n+=pe:l.value===ot.AREA_2?n+=Ft:l.value===ot.AREA_3&&(n+=1.5*Ft),o.x=a*Math.cos(n),o.y=a*Math.sin(n),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,i.x=o.x,i.y=o.y,i},inverse:function(i){var e,t,r,s,a,n,o,l,h,c,u,d,p={lam:0,phi:0},f={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,t=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?f.value=ot.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(f.value=ot.AREA_1,e-=pe):i.x<0&&-i.x>=Math.abs(i.y)?(f.value=ot.AREA_2,e=e<0?e+Ft:e-Ft):(f.value=ot.AREA_3,e+=pe),h=Ft/12*Math.tan(e),a=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),n=Math.atan(a),(o=1-(r=Math.cos(e))*r*(s=Math.tan(t))*s*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?o=-1:o>1&&(o=1),this.face===_m)l=Math.acos(o),p.phi=pe-l,f.value===ot.AREA_0?p.lam=n+pe:f.value===ot.AREA_1?p.lam=n<0?n+Ft:n-Ft:f.value===ot.AREA_2?p.lam=n-pe:p.lam=n;else if(this.face===ym)l=Math.acos(o),p.phi=l-pe,f.value===ot.AREA_0?p.lam=-n+pe:f.value===ot.AREA_1?p.lam=-n:f.value===ot.AREA_2?p.lam=-n-pe:p.lam=n<0?-n-Ft:-n+Ft;else{var v,m,g;h=(v=o)*v,m=(h+=(g=h>=1?0:Math.sqrt(1-h)*Math.sin(n))*g)>=1?0:Math.sqrt(1-h),f.value===ot.AREA_1?(h=m,m=-g,g=h):f.value===ot.AREA_2?(m=-m,g=-g):f.value===ot.AREA_3&&(h=m,m=g,g=-h),this.face===bl?(h=v,v=-m,m=h):this.face===wl?(v=-v,m=-m):this.face===Sl&&(h=v,v=m,m=-h),p.phi=Math.acos(-g)-pe,p.lam=Math.atan2(m,v),this.face===bl?p.lam=io(p.lam,-pe):this.face===wl?p.lam=io(p.lam,-Ft):this.face===Sl&&(p.lam=io(p.lam,+pe))}return this.es!==0&&(c=p.phi<0?1:0,u=Math.tan(p.phi),d=this.b/Math.sqrt(u*u+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),c&&(p.phi=-p.phi)),p.lam+=this.long0,i.x=p.lam,i.y=p.phi,i},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var xm=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Tl=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Sy=.8487,Ty=1.3523,YM=ta/5,P2=1/YM,Mm=18,nu=function(i,e){return i[0]+e*(i[1]+e*(i[2]+e*i[3]))};const I2={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(i){var e=we(i.x-this.long0),t=Math.abs(i.y),r=Math.floor(t*YM);r<0?r=0:r>=Mm&&(r=17);var s={x:nu(xm[r],t=ta*(t-P2*r))*e,y:nu(Tl[r],t)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*Sy+this.x0,s.y=s.y*this.a*Ty+this.y0,s},inverse:function(i){var e={x:(i.x-this.x0)/(this.a*Sy),y:Math.abs(i.y-this.y0)/(this.a*Ty)};if(e.y>=1)e.x/=xm[18][0],e.y=i.y<0?-pe:pe;else{var t=Math.floor(e.y*Mm);for(t<0?t=0:t>=Mm&&(t=17);;)if(Tl[t][0]>e.y)--t;else{if(!(Tl[t+1][0]<=e.y))break;++t}var r=Tl[t],s=5*(e.y-r[0])/(Tl[t+1][0]-r[0]);s=function(a,n,o,l){for(var h=n;l;--l){var c=a(h);if(h-=c,Math.abs(c)<o)break}return h}(function(a){return(nu(r,a)-e.y)/function(n,o){return n[1]+o*(2*n[2]+3*o*n[3])}(r,a)},s,Me,100),e.x/=nu(xm[t],s),e.y=(5*t+s)*mi,i.y<0&&(e.y=-e.y)}return e.x=we(e.x+this.long0),e},names:["Robinson","robin"]},L2={init:function(){this.name="geocent"},forward:function(i){return UM(i,this.es,this.a)},inverse:function(i){return FM(i,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var ou=0,lu=1,hu=2,cu=3,Al={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const N2={init:function(){if(Object.keys(Al).forEach((function(t){if(typeof this[t]>"u")this[t]=Al[t].def;else{if(Al[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Al[t].num&&(this[t]=parseFloat(this[t]))}Al[t].degrees&&(this[t]=this[t]*mi)}).bind(this)),Math.abs(Math.abs(this.lat0)-pe)<Me?this.mode=this.lat0<0?lu:ou:Math.abs(this.lat0)<Me?this.mode=hu:(this.mode=cu,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(i),this.sw=Math.sin(i)},forward:function(i){i.x-=this.long0;var e,t,r,s,a=Math.sin(i.y),n=Math.cos(i.y),o=Math.cos(i.x);switch(this.mode){case cu:t=this.sinph0*a+this.cosph0*n*o;break;case hu:t=n*o;break;case lu:t=-a;break;case ou:t=a}switch(e=(t=this.pn1/(this.p-t))*n*Math.sin(i.x),this.mode){case cu:t*=this.cosph0*a-this.sinph0*n*o;break;case hu:t*=a;break;case ou:t*=-n*o;break;case lu:t*=n*o}return s=1/((r=t*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-t*this.sg)*this.cw*s,t=r*s,i.x=e*this.a,i.y=t*this.a,i},inverse:function(i){i.x/=this.a,i.y/=this.a;var e,t,r,s={x:i.x,y:i.y};r=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*r,t=this.pn1*i.y*this.cw*r,i.x=e*this.cg+t*this.sg,i.y=t*this.cg-e*this.sg;var a=dr(i.x,i.y);if(Math.abs(a)<Me)s.x=0,s.y=i.y;else{var n,o;switch(o=1-a*a*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/a+a/this.pn1),n=Math.sqrt(1-o*o),this.mode){case cu:s.y=Math.asin(n*this.sinph0+i.y*o*this.cosph0/a),i.y=(n-this.sinph0*Math.sin(s.y))*a,i.x*=o*this.cosph0;break;case hu:s.y=Math.asin(i.y*o/a),i.y=n*a,i.x*=o;break;case ou:s.y=Math.asin(n),i.y=-i.y;break;case lu:s.y=-Math.asin(n)}s.x=Math.atan2(i.x,i.y)}return i.x=s.x+this.long0,i.y=s.y,i},names:["Tilted_Perspective","tpers"]},D2={init:function(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,e=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(i){var e,t,r,s,a=i.x,n=i.y;if(a-=this.long0,this.shape==="ellipse"){n=Math.atan(this.radius_p2*Math.tan(n));var o=this.radius_p/dr(this.radius_p*Math.cos(n),Math.sin(n));if(t=o*Math.cos(a)*Math.cos(n),r=o*Math.sin(a)*Math.cos(n),s=o*Math.sin(n),(this.radius_g-t)*t-r*r-s*s*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;e=this.radius_g-t,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/dr(s,e)),i.y=this.radius_g_1*Math.atan(s/e)):(i.x=this.radius_g_1*Math.atan(r/e),i.y=this.radius_g_1*Math.atan(s/dr(r,e)))}else this.shape==="sphere"&&(e=Math.cos(n),t=Math.cos(a)*e,r=Math.sin(a)*e,s=Math.sin(n),e=this.radius_g-t,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/dr(s,e)),i.y=this.radius_g_1*Math.atan(s/e)):(i.x=this.radius_g_1*Math.atan(r/e),i.y=this.radius_g_1*Math.atan(s/dr(r,e))));return i.x=i.x*this.a,i.y=i.y*this.a,i},inverse:function(i){var e,t,r,s,a=-1,n=0,o=0;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(o=Math.tan(i.y/this.radius_g_1),n=Math.tan(i.x/this.radius_g_1)*dr(1,o)):(n=Math.tan(i.x/this.radius_g_1),o=Math.tan(i.y/this.radius_g_1)*dr(1,n));var l=o/this.radius_p;if(e=n*n+l*l+a*a,(r=(t=2*this.radius_g*a)*t-4*e*this.C)<0)return i.x=Number.NaN,i.y=Number.NaN,i;s=(-t-Math.sqrt(r))/(2*e),a=this.radius_g+s*a,n*=s,o*=s,i.x=Math.atan2(n,a),i.y=Math.atan(o*Math.cos(i.x)/a),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(o=Math.tan(i.y/this.radius_g_1),n=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+o*o)):(n=Math.tan(i.x/this.radius_g_1),o=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+n*n)),e=n*n+o*o+a*a,(r=(t=2*this.radius_g*a)*t-4*e*this.C)<0)return i.x=Number.NaN,i.y=Number.NaN,i;s=(-t-Math.sqrt(r))/(2*e),a=this.radius_g+s*a,n*=s,o*=s,i.x=Math.atan2(n,a),i.y=Math.atan(o*Math.cos(i.x)/a)}return i.x=i.x+this.long0,i},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var El=1.340264,Cl=-.081106,Rl=893e-6,Pl=.003796,uu=Math.sqrt(3)/2;const O2={init:function(){this.es=0,this.long0=this.long0!==void 0?this.long0:0},forward:function(i){var e=we(i.x-this.long0),t=i.y,r=Math.asin(uu*Math.sin(t)),s=r*r,a=s*s*s;return i.x=e*Math.cos(r)/(uu*(El+3*Cl*s+a*(7*Rl+9*Pl*s))),i.y=r*(El+Cl*s+a*(Rl+Pl*s)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var e,t,r,s,a=i.y;for(s=0;s<12&&(a-=r=(a*(El+Cl*(e=a*a)+(t=e*e*e)*(Rl+Pl*e))-i.y)/(El+3*Cl*e+t*(7*Rl+9*Pl*e)),!(Math.abs(r)<1e-9));++s);return t=(e=a*a)*e*e,i.x=uu*i.x*(El+3*Cl*e+t*(7*Rl+9*Pl*e))/Math.cos(a),i.y=Math.asin(Math.sin(a)/uu),i.x=we(i.x+this.long0),i},names:["eqearth","Equal Earth","Equal_Earth"]};Fi.defaultDatum="WGS84",Fi.Proj=es,Fi.WGS84=new Fi.Proj("WGS84"),Fi.Point=To,Fi.toPoint=kM,Fi.defs=Ri,Fi.nadgrid=function(i,e){var t=new DataView(e),r=function(o){var l=o.getInt32(8,!1);return l===11?!1:(l=o.getInt32(8,!0),!0)}(t),s=function(o,l){return{nFields:o.getInt32(8,l),nSubgridFields:o.getInt32(24,l),nSubgrids:o.getInt32(40,l),shiftType:$f(o,56,64).trim(),fromSemiMajorAxis:o.getFloat64(120,l),fromSemiMinorAxis:o.getFloat64(136,l),toSemiMajorAxis:o.getFloat64(152,l),toSemiMinorAxis:o.getFloat64(168,l)}}(t,r),a=function(o,l,h){for(var c=176,u=[],d=0;d<l.nSubgrids;d++){var p=FE(o,c,h),f=kE(o,c,p,h),v=Math.round(1+(p.upperLongitude-p.lowerLongitude)/p.longitudeInterval),m=Math.round(1+(p.upperLatitude-p.lowerLatitude)/p.latitudeInterval);u.push({ll:[mo(p.lowerLongitude),mo(p.lowerLatitude)],del:[mo(p.longitudeInterval),mo(p.latitudeInterval)],lim:[v,m],count:p.gridNodeCount,cvs:UE(f)}),c+=176+16*p.gridNodeCount}return u}(t,s,r),n={header:s,subgrids:a};return OM[i]=n,n},Fi.transform=nd,Fi.mgrs=VE,Fi.version="__VERSION__",function(i){i.Proj.projections.add(Uu),i.Proj.projections.add(Fu),i.Proj.projections.add(t2),i.Proj.projections.add(i2),i.Proj.projections.add(r2),i.Proj.projections.add(s2),i.Proj.projections.add(a2),i.Proj.projections.add(n2),i.Proj.projections.add(o2),i.Proj.projections.add(l2),i.Proj.projections.add(f2),i.Proj.projections.add(g2),i.Proj.projections.add(v2),i.Proj.projections.add(_2),i.Proj.projections.add(y2),i.Proj.projections.add(x2),i.Proj.projections.add(M2),i.Proj.projections.add(b2),i.Proj.projections.add(w2),i.Proj.projections.add(S2),i.Proj.projections.add(T2),i.Proj.projections.add(A2),i.Proj.projections.add(E2),i.Proj.projections.add(C2),i.Proj.projections.add(R2),i.Proj.projections.add(I2),i.Proj.projections.add(L2),i.Proj.projections.add(N2),i.Proj.projections.add(D2),i.Proj.projections.add(O2)}(Fi);class ZM extends Ue{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new X(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const ro=new S,Ay=new me,Ey=new me,Cy=new S,Ry=new S;class U2{constructor(e={}){const t=this;let r,s,a,n;const o={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");function h(d){d.isCSS2DObject&&(d.element.style.display="none");for(let p=0,f=d.children.length;p<f;p++)h(d.children[p])}function c(d,p,f){if(d.visible!==!1){if(d.isCSS2DObject){ro.setFromMatrixPosition(d.matrixWorld),ro.applyMatrix4(Ey);const v=ro.z>=-1&&ro.z<=1&&d.layers.test(f.layers)===!0,m=d.element;m.style.display=v===!0?"":"none",v===!0&&(d.onBeforeRender(t,p,f),m.style.transform="translate("+-100*d.center.x+"%,"+-100*d.center.y+"%)translate("+(ro.x*a+a)+"px,"+(-ro.y*n+n)+"px)",m.parentNode!==l&&l.appendChild(m),d.onAfterRender(t,p,f));const g={distanceToCameraSquared:u(f,d)};o.objects.set(d,g)}for(let v=0,m=d.children.length;v<m;v++)c(d.children[v],p,f)}else h(d)}function u(d,p){return Cy.setFromMatrixPosition(d.matrixWorld),Ry.setFromMatrixPosition(p.matrixWorld),Cy.distanceToSquared(Ry)}l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:r,height:s}},this.render=function(d,p){d.matrixWorldAutoUpdate===!0&&d.updateMatrixWorld(),p.parent===null&&p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),Ay.copy(p.matrixWorldInverse),Ey.multiplyMatrices(p.projectionMatrix,Ay),c(d,d,p),function(f){const v=function(g){const _=[];return g.traverseVisible(function(y){y.isCSS2DObject&&_.push(y)}),_}(f).sort(function(g,_){return g.renderOrder!==_.renderOrder?_.renderOrder-g.renderOrder:o.objects.get(g).distanceToCameraSquared-o.objects.get(_).distanceToCameraSquared}),m=v.length;for(let g=0,_=v.length;g<_;g++)v[g].element.style.zIndex=m-g}(d)},this.setSize=function(d,p){r=d,s=p,a=r/2,n=s/2,l.style.width=d+"px",l.style.height=p+"px"}}}const Py=new S,F2=new Ke,Iy=new S;class KM extends Ue{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const Br=new me,k2=new me;class B2{constructor(e={}){const t=this;let r,s,a,n;const o={camera:{style:""},objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l;const h=document.createElement("div");h.style.transformOrigin="0 0",h.style.pointerEvents="none",l.appendChild(h);const c=document.createElement("div");function u(m){return Math.abs(m)<1e-10?0:m}function d(m){const g=m.elements;return"matrix3d("+u(g[0])+","+u(-g[1])+","+u(g[2])+","+u(g[3])+","+u(g[4])+","+u(-g[5])+","+u(g[6])+","+u(g[7])+","+u(g[8])+","+u(-g[9])+","+u(g[10])+","+u(g[11])+","+u(g[12])+","+u(-g[13])+","+u(g[14])+","+u(g[15])+")"}function p(m){const g=m.elements;return"translate(-50%,-50%)"+("matrix3d("+u(g[0])+","+u(g[1])+","+u(g[2])+","+u(g[3])+","+u(-g[4])+","+u(-g[5])+","+u(-g[6])+","+u(-g[7])+","+u(g[8])+","+u(g[9])+","+u(g[10])+","+u(g[11])+","+u(g[12])+","+u(g[13])+","+u(g[14])+","+u(g[15])+")")}function f(m){m.isCSS3DObject&&(m.element.style.display="none");for(let g=0,_=m.children.length;g<_;g++)f(m.children[g])}function v(m,g,_,y){if(m.visible!==!1){if(m.isCSS3DObject){const x=m.layers.test(_.layers)===!0,M=m.element;if(M.style.display=x===!0?"":"none",x===!0){let b;m.onBeforeRender(t,g,_),m.isCSS3DSprite?(Br.copy(_.matrixWorldInverse),Br.transpose(),m.rotation2D!==0&&Br.multiply(k2.makeRotationZ(m.rotation2D)),m.matrixWorld.decompose(Py,F2,Iy),Br.setPosition(Py),Br.scale(Iy),Br.elements[3]=0,Br.elements[7]=0,Br.elements[11]=0,Br.elements[15]=1,b=p(Br)):b=p(m.matrixWorld);const w=o.objects.get(m);if(w===void 0||w.style!==b){M.style.transform=b;const T={style:b};o.objects.set(m,T)}M.parentNode!==c&&c.appendChild(M),m.onAfterRender(t,g,_)}}for(let x=0,M=m.children.length;x<M;x++)v(m.children[x],g,_)}else f(m)}c.style.transformStyle="preserve-3d",h.appendChild(c),this.getSize=function(){return{width:r,height:s}},this.render=function(m,g){const _=g.projectionMatrix.elements[5]*n;let y,x;g.view&&g.view.enabled?(h.style.transform=`translate( ${-g.view.offsetX*(r/g.view.width)}px, ${-g.view.offsetY*(s/g.view.height)}px )`,h.style.transform+=`scale( ${g.view.fullWidth/g.view.width}, ${g.view.fullHeight/g.view.height} )`):h.style.transform="",m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),g.parent===null&&g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),g.isOrthographicCamera&&(y=-(g.right+g.left)/2,x=(g.top+g.bottom)/2);const M=g.view&&g.view.enabled?g.view.height/g.view.fullHeight:1,b=g.isOrthographicCamera?`scale( ${M} )scale(`+_+")translate("+u(y)+"px,"+u(x)+"px)"+d(g.matrixWorldInverse):`scale( ${M} )translateZ(`+_+"px)"+d(g.matrixWorldInverse),w=(g.isPerspectiveCamera?"perspective("+_+"px) ":"")+b+"translate("+a+"px,"+n+"px)";o.camera.style!==w&&(c.style.transform=w,o.camera.style=w),v(m,m,g)},this.setSize=function(m,g){r=m,s=g,a=r/2,n=s/2,l.style.width=m+"px",l.style.height=g+"px",h.style.width=m+"px",h.style.height=g+"px",c.style.width=m+"px",c.style.height=g+"px"}}}function Ly(i){for(;i!=null&&i.parent&&i.parent.type!=="Scene";)i=i.parent;return i}function Ko(i){if(i)return i.type==="Scene"?i:Ko(i.parent)}function z2(i){const e=new vt().setFromObject(i),{max:t,min:r}=e,s=new S;return e.getCenter(s),{box:e,max:t,min:r,center:s,radius:new S().subVectors(t,r).length()/2}}function V2(i,e=50){const{center:t,radius:r,max:s}=z2(i),a=i.getWorldDirection(new S),n=r/Math.tan(Math.PI*e/360),o=a.multiplyScalar(n),l=o.clone().add(t),h=o.clone().applyAxisAngle(new S(0,1,0),-Math.PI/2).add(t),c=o.clone().applyAxisAngle(new S(0,1,0),Math.PI/2).add(t),u=o.clone().applyAxisAngle(new S(1,0,0),-Math.PI/2).add(t),d=o.clone().applyAxisAngle(new S(1,0,0),Math.PI/2).add(t),p=o.clone().applyAxisAngle(new S(0,1,0),Math.PI).add(t),f=function(v,m,g){return new S().subVectors(m,v).normalize().multiplyScalar(g).add(v)}(t,s,t.distanceTo(s)/Math.tan(Math.PI*e/360));return{frontView:l,leftView:h,rightView:c,topView:u,bottomView:d,backView:p,maxView:f,target:t}}const H2=["","","","","","","","",""];function c0(i,e={}){let t=null;switch(i){case"":default:t=G2(e);break;case"":t=function(r={}){return new Tn(r.radius||5,r.widthSegments||32,r.heightSegments||32)}(e);break;case"":t=function(r={}){return new as(r.width||5,r.height||5,r.widthSegments||32,r.heightSegments||32)}(e);break;case"":t=function(r={}){return new qh(r.radius||5,r.length||5,r.capSegments||32,r.radialSegments||32)}(e);break;case"":t=function(r={}){return new Zh(r.radius||5,r.height||5,r.radialSegments||32)}(e);break;case"":t=function(r={}){return new Yh(r.radius||5,r.segments||32,r.thetaStart||0,r.thetaLength||2*Math.PI)}(e);break;case"":t=function(r={}){return new Rt(r.radiusTop||5,r.radiusBottom||5,r.height||5,r.radialSegments||32)}(e);break;case"":t=function(r={}){return new qr(r.radius||10,r.tube||3,r.radialSegments||32,r.tubularSegments||32,r.arc||2*Math.PI)}(e);break;case"":t=function(r={}){return new Kh(r.innerRadius||5,r.outerRadius||10,r.thetaSegments||32,r.phiSegments||32,r.thetaStart||0,r.thetaLength||2*Math.PI)}(e)}return t.geometryType=i,t}function G2(i={}){return new St(i.width||5,i.height||5,i.depth||5,i.widthSegments||1,i.heightSegments||1,i.depthSegments||1)}const Eo=["","","","Lambert","",""];function Nr(i,e=null){let t=null;switch(i){case"":case"MeshBasicMaterial":default:t=j2(e);break;case"":case"MeshStandardMaterial":t=function(r){return new Go(Ae({color:16777215,side:Mt},r))}(e);break;case"":case"MeshPhongMaterial":t=function(r){return new An(Ae({color:16777215,side:Mt},r))}(e);break;case"Lambert":case"MeshLambertMaterial":t=function(r){return new Wd(Ae({color:16777215,side:Mt},r))}(e);break;case"":case"MeshPhysicalMaterial":t=function(r){return new ar(Ae({color:16777215,side:Mt},r))}(e);break;case"":case"MeshToonMaterial":t=function(r){return new Dg(Ae({color:16777215,side:Mt},r))}(e)}return t.materialType=i||"",t.transparent=!0,t}function j2(i){return new Wt(Ae({color:16777215,side:Mt},i))}function W2(i){const e=document.createElement("video");return e.crossOrigin="anonymous",e.src=i,e.muted=!0,e.loop=!0,e.play(),new e1(e)}function X2(i){const{mapType:e,mapUrl:t,map:r}=i;if(t&&r)return{mapType:e,mapUrl:t,map:{wrapS:r.wrapS,wrapT:r.wrapT,rotation:r.rotation,center:r.center,repeat:r.repeat,offset:r.offset,textureAnimation:r.textureAnimation}}}function QM(i,e,t){var r;if(!e.mapUrl)return e.map=null;e.mapType==""?e.map=W2(e.mapUrl):e.map=new is().load(e.mapUrl),t&&(e.map.wrapS=t.wrapS,e.map.wrapT=t.wrapT,e.map.repeat.set(t.repeat.x,t.repeat.y),e.map.offset.set(t.offset.x,t.offset.y),e.map.center.set(t.center.x,t.center.y),e.map.rotation=t.rotation,(r=t.textureAnimation)!=null&&r.isTextureAnimation&&(e.map.textureAnimation=t.textureAnimation,e.map.commonAnimateRender=function(){e.map.offset.x+=t.textureAnimation.offset.x,e.map.offset.y+=t.textureAnimation.offset.y,e.map.rotation+=t.textureAnimation.rotation},i.push(e.map))),e.map.center.set(.5,.5),e.isCustomTexture=!0,e.needsUpdate=!0}const u0={:0,:1,:As,:3,:4,:Ro},q2={:Ji,:101,:102,:103,:104},Y2={:Po,:kh,:yd,"1-":xd,:ca,"1-":ua,:Bh,"1-":Md,:zh,"1-":bd,:210},Z2={:Po,:kh,:yd,"1-":xd,:ca,"1-":ua,:Bh,"1-":Md,:zh,"1-":bd},K2={:gr,:Si,:Mt};function Q2(i){const{visible:e,color:t,wireframe:r,transparent:s,opacity:a,alphaTest:n,blending:o,side:l}=i;return Ae({visible:e,color:t,wireframe:r,transparent:s,opacity:a,alphaTest:n,blending:o,side:l},X2(i))}function J2(i,e,t){t.add(e,"visible").name(""),t.addHexColor(e.color).name(""),t.add(e,"wireframe").name(""),t.add(e,"side",K2).name("").onFinishChange(r=>(e.side=Number(r),e.needsUpdate=!0)),t.add(e,"transparent").name(""),t.add(e,"opacity",0,1).name(""),t.add(e,"alphaTest",0,1).name(""),t.add(e,"blending",u0).name("").onChange(r=>(e.blending=Number(r),e.needsUpdate=!0)),function(r,s,a){!Reflect.has(s,"mapUrl")&&(s.mapUrl=""),a.add(s,"mapUrl").name(""),!Reflect.has(s,"mapType")&&(s.mapType=""),a.add(s,"mapType",["",""]).name(""),a.add({updateMap:()=>QM(r,s)},"updateMap").name("")}(i,e,t.addFolder(""))}function $2(i){switch(i.type){case"MeshBasicMaterial":return{envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshStandardMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,metalness:i.metalness,roughness:i.roughness,envMap:!!i.envMap,envMapIntensity:i.envMapIntensity};case"MeshLambertMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshPhongMaterial":return{shininess:i.shininess,specular:i.specular.getHex(),emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshToonMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity};case"MeshPhysicalMaterial":return{metalness:i.metalness,roughness:i.roughness,clearcoat:i.clearcoat,clearcoatRoughness:i.clearcoatRoughness,sheen:i.sheen,sheenRoughness:i.sheenRoughness,sheenColor:i.sheenColor.getHex(),specularColor:i.specularColor.getHex(),specularIntensity:i.specularIntensity,transmission:i.transmission,emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,envMapIntensity:i.envMapIntensity,reflectivity:i.reflectivity}}}function Kd(i){return Ae(Ae({materialType:i.materialType},Q2(i)),$2(i))}function Qd(i,e,t){t&&(function(r,s,a){const{visible:n,color:o,wireframe:l,side:h,transparent:c,opacity:u,alphaTest:d,blending:p,map:f,mapUrl:v,mapType:m}=a;s.visible=n,s.color.setHex(o),s.wireframe=l,s.transparent=c,s.opacity=u,s.alphaTest=d,s.blending=p,s.side=h??Mt,v&&(s.mapUrl=v,s.mapType=m,QM(r,s,f))}(i.commonFrames,e,t),function(r,s,a){switch(s.type){case"MeshBasicMaterial":a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshStandardMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.envMapIntensity=a.envMapIntensity,s.metalness=a.metalness,s.roughness=a.roughness;break;case"MeshLambertMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshPhongMaterial":s.shininess=a.shininess,s.specular.setHex(a.specular),s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshToonMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity;break;case"MeshPhysicalMaterial":s.metalness=a.metalness,s.roughness=a.roughness,s.clearcoat=a.clearcoat,s.clearcoatRoughness=a.clearcoatRoughness,s.sheen=a.sheen,s.sheenRoughness=a.sheenRoughness,s.sheenColor.setHex(a.sheenColor),s.specularColor.setHex(a.specularColor),s.specularIntensity=a.specularIntensity,s.transmission=a.transmission,s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.envMapIntensity=a.envMapIntensity,s.reflectivity=a.reflectivity}}(i,e,t))}function Jd(i,e,t){J2(i.commonFrames,e,t),function(r,s,a){switch(s.type){case"MeshBasicMaterial":a.add({isEnvMap:!!s.envMap},"isEnvMap").name("").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("");break;case"MeshStandardMaterial":a.addHexColor(s.emissive).name(""),a.add(s,"emissiveIntensity",0).name(""),a.add(s,"metalness",0,1).name(""),a.add(s,"roughness",0,1).name(""),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"envMapIntensity",0).name("");break;case"MeshLambertMaterial":a.addHexColor(s.emissive).name(""),a.add(s,"emissiveIntensity",0).name(""),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("");break;case"MeshPhongMaterial":a.add(s,"shininess",0,100).name("").onChange(n=>s.needsUpdate=!0),a.addHexColor(s.specular).name(""),a.addHexColor(s.emissive).name(""),a.add(s,"emissiveIntensity",0).name(""),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("");break;case"MeshToonMaterial":a.addHexColor(s.emissive).name(""),a.add(s,"emissiveIntensity",0).name("");break;case"MeshPhysicalMaterial":a.add(s,"metalness",0,1).name(""),a.add(s,"roughness",0,1).name(""),a.add(s,"clearcoat",0,1).name(""),a.add(s,"clearcoatRoughness",0,1).name(""),a.add(s,"sheen",0,1).name(""),a.add(s,"sheenRoughness",0,1).name(""),a.addHexColor(s.sheenColor).name(""),a.addHexColor(s.specularColor).name(""),a.add(s,"specularIntensity",0,1).name(""),a.add(s,"transmission",0,1).name(""),a.addHexColor(s.emissive).name(""),a.add(s,"emissiveIntensity",0).name(""),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"envMapIntensity",0).name(""),a.add(s,"reflectivity",0,1).name("")}}(i,e,t.addFolder(e.materialType+""))}const JM={material:"vUv = uv;",position:"vUv = position.xy/ position.z;",modelMatrix:"vUv = (modelMatrix * vec4(position, 1.0)).xy;",modelViewMatrix:"vUv = (modelViewMatrix * vec4(position, 1.0)).xy;",projectionMatrix:"vUv = (projectionMatrix * vec4(position, 1.0)).xy;",viewMatrix:"vUv = (viewMatrix * vec4(position, 1.0)).xy;",custom_uv1:`
    
        vec4 projectedPosition = projectionMatrix * modelMatrix  * vec4(position, 1.0);

        vec3 ndcPosition = projectedPosition.xyz / projectedPosition.w;

        vUv = ndcPosition.xy / ndcPosition.z;
    `},eC=Object.keys(JM),$M=[{name:"",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec3 c;
            float l,z=iTime;
            for(int i=0;i<3;i++) {
                vec2 uv,p=gl_FragCoord.xy/iResolution/2.0;
                uv=p;
                p-=.3;
                <UV_PLACEHOLDER>
                z+=.07;
                l=length(p);
                uv+=p/l*(sin(z)+1.)*abs(sin(l*9.-z-z));
                c[i]=.01/length(mod(uv,1.)-.5);
            }
        `,commonFinish:!0,key:"c",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!0,customUniforms:["TAU-number-float-6.28318530718","MAX_ITER-number-int-5"],vertex:"vUv-material",fragment:`
            float time = iTime * .5+23.0;
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            <UV_PLACEHOLDER>
            #ifdef SHOW_TILING
                vec2 p = mod(uv*TAU*2.0, TAU)-250.0;
            #else
                vec2 p = mod(uv*TAU, TAU)-250.0;
            #endif
            vec2 i = vec2(p);
            float c = 1.0;
            float inten = .005;
            for (int n = 0; n < MAX_ITER; n++) 
            {
                float t = time * (1.0 - (3.5 / float(n+1)));
                i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));
                c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));
            }
            c /= float(MAX_ITER);
            c = 1.17-pow(c, 1.4);
            vec3 colour = vec3(pow(abs(c), 8.0));
            colour = clamp(colour + vec3(0.0, 0.35, 0.5), 0.0, 1.0);
            #ifdef SHOW_TILING
            // Flash tile borders...
            vec2 pixel = 2.0 / iResolution.xy;
            uv *= 2.0;
            float f = floor(mod(iTime*.5, 2.0)); 	// Flash value.
            vec2 first = step(pixel, uv) * f;		   	// Rule out first screen pixels and flash.
            uv  = step(fract(uv), pixel);				// Add one line of pixels per tile.
            colour = mix(colour, vec3(1.0, 1.0, 0.0), (uv.x + uv.y) * first.x * first.y); // Yellow line
            #endif
        `,commonFinish:!0,key:"colour",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!1,customUniforms:["innerCircleWidth-number-float-1","circleWidth-number-float-2","circleMax-number-float-2","opacityScale-number-float-1","reverseOpacity-bool-bool-true","circleSpeed-number-float-0.01","diff-color-vec3-0.0,0.0,1.0","color3-color-vec3-0.0,0.0,1.0","center-position-vec3-0,0,0","intensity-number-float-1","isDisCard-bool-bool-false"],vertex:"vUv-material,vPosition",fragment:`
            float dis = length(vPosition - center);
            vec4 diffuseColor;
            if(dis < (innerCircleWidth + circleWidth) && dis > innerCircleWidth) {
                float r = (dis - innerCircleWidth) / circleWidth;
                float cOpacity = reverseOpacity ? (innerCircleWidth / circleMax) : 1. - ( innerCircleWidth / circleMax );
                #ifdef USE_MAP
                    vec3 textureColor = texture2D(map, vUv).rgb;
                    if(isDisCard && textureColor.r < 0.1 && textureColor.g < 0.1  && textureColor.b < 0.1 ) discard;
                #endif
                diffuseColor = vec4( mix(diff, color3, r) * vec3(intensity, intensity, intensity)  , opacity * cOpacity * opacityScale);
            }
            else {
                if(isDisCard)  discard ;
                else diffuseColor = vec4( diffuse, opacity );
            }
        `,commonFinish:!1,render:"this.innerCircleWidth.value < this.circleMax.value ? this.innerCircleWidth.value += this.circleSpeed.value : this.innerCircleWidth.value = 0"},{name:"",commonUniforms:!0,vertex:"vUv-material",key:"col",fragment:`
            float gTime = 0.;
            const float REPEAT = 5.0;
            mat2 rot(float a) {
                float c = cos(a), s = sin(a);
                return mat2(c,s,-s,c);
            }
            float sdBox( vec3 p, vec3 b )
            {
                vec3 q = abs(p) - b;
                return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
            }
            float box(vec3 pos, float scale) {
                pos *= scale;
                float base = sdBox(pos, vec3(.4,.4,.1)) /1.5;
                pos.xy *= 5.;
                pos.y -= 3.5;
                pos.xy *= rot(.75);
                float result = -base;
                return result;
            }
            float box_set(vec3 pos, float iTime) {
                vec3 pos_origin = pos;
                pos = pos_origin;
                pos .y += sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box1 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);
                pos = pos_origin;
                pos .y -=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box2 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);
                pos = pos_origin;
                pos .x +=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box3 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);	
                pos = pos_origin;
                pos .x -=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box4 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);	
                pos = pos_origin;
                pos.xy *=   rot(.8);
                float box5 = box(pos,.5) * 6.;	
                pos = pos_origin;
                float box6 = box(pos,.5) * 6.;	
                float result = max(max(max(max(max(box1,box2),box3),box4),box5),box6);
                return result;
            }
            float mapf(vec3 pos, float iTime) {
                vec3 pos_origin = pos;
                float box_set1 = box_set(pos, iTime);

                return box_set1;
            }
            <SPLIT_PLACEHOLDER>
            vec2 p = gl_FragCoord.xy / iResolution.xy;
            p.x -=.5;
            p.y -=.5;
            p.x *= iResolution.x / iResolution.y;
            vec2 uv = p;
            <UV_PLACEHOLDER>
            p = uv;
            vec3 ro = vec3(0., -0.2 ,iTime * 4.);
            vec3 ray = normalize(vec3(p, 1.5));
            ray.xy = ray.xy * rot(sin(iTime * .03) * 5.);
            ray.yz = ray.yz * rot(sin(iTime * .05) * .2);
            float t = 0.1;
            vec3 col = vec3(0.);
            float ac = 0.0;
            for (int i = 0; i < 99; i++){
                vec3 pos = ro + ray * t;
                pos = mod(pos-2., 4.) -2.;
                gTime = iTime -float(i) * 0.01;
                
                float d = mapf(pos, iTime);

                d = max(abs(d), 0.01);
                ac += exp(-d*23.);

                t += d* 0.55;
            }
            col = vec3(ac * 0.02);
            col +=vec3(0.,0.2 * abs(sin(iTime)),0.5 + sin(iTime) * 0.2);  
        `,commonFinish:!0,isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!1,customUniforms:["iTime-number-float-0.0","speed-number-float-0.05","intensity-number-float-2","density-number-float-5","mixColor-color-vec3-1.0,1.0,1.0","high-number-float-0.5","medium-number-float-0.4"],vertex:"vUv-material",fragment:`
            vec4 fragColor = vec4(0.);
            float sin = sin((vUv.y - iTime * speed) * 10. * density);
            if (sin > high) {
            fragColor = vec4( mixColor, (1. - sin) / (1. - high));
            } else if(sin > medium) {
            fragColor = vec4(mixColor, mix(1., 0., 1.-(sin - medium) / (high - medium)));
            } else {
            fragColor = vec4(mixColor, 0.);
            }
            fragColor = mix(fragColor, vec4(mix(mixColor, vec3(0., 0., 0.), vUv.y), 1.), 0.);
            vec4 diffuseColor = vec4(fragColor.rgb * vec3(intensity, intensity, intensity), fragColor.a * opacity * (1. - vUv.y));
        `,commonFinish:!1,render:"iTime+speed"},{name:"",commonUniforms:!0,customUniforms:!1,vertex:"precision-lowp,vUv-material",fragment:`
            mat2 rot(float a) {
                float c = cos(a), s = sin(a);
                return mat2(c,s,-s,c);
            }
            const float pi = acos(-1.0);
            const float pi2 = pi*2.0;
            vec2 pmod(vec2 p, float r) {
                float a = atan(p.x, p.y) + pi/r;
                float n = pi2 / r;
                a = floor(a/n)*n;
                return p*rot(-a);
            }
            float box( vec3 p, vec3 b ) {
                vec3 d = abs(p) - b;
                return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0));
            }
            float ifsBox(vec3 p) {
                for (int i=0; i<5; i++) {
                    p = abs(p) - 1.0;
                    p.xy *= rot(iTime*0.3);
                    p.xz *= rot(iTime*0.1);
                }
                p.xz *= rot(iTime);
                return box(p, vec3(0.4,0.8,0.3));
            }
            float mapSnow(vec3 p, vec3 cPos) {
                vec3 p1 = p;
                p1.x = mod(p1.x-5., 10.) - 5.;
                p1.y = mod(p1.y-5., 10.) - 5.;
                p1.z = mod(p1.z, 16.)-8.;
                p1.xy = pmod(p1.xy, 5.0);
                return ifsBox(p1);
            }  
            <SPLIT_PLACEHOLDER>
            vec2 p = (gl_FragCoord.xy * 2.0  - iResolution.xy) / min(iResolution.x, iResolution.y);
            vec2 uv = p;
            <UV_PLACEHOLDER>
            p = uv;
            vec3 cPos = vec3(0.0,0.0, -3.0 * iTime);
            vec3 cDir = normalize(vec3(0.0, 0.0, -1.0));
            vec3 cUp  = vec3(sin(iTime), 1.0, 0.0);
            vec3 cSide = cross(cDir, cUp);
            vec3 ray = normalize(cSide * p.x + cUp * p.y + cDir);
            float acc = 0.0;
            float acc2 = 0.0;
            float t = 0.0;
            for (int i = 0; i < 99; i++) {
                vec3 pos = cPos + ray * t;
                float dist = mapSnow(pos, cPos);
                dist = max(abs(dist), 0.02);
                float a = exp(-dist*3.0);
                if (mod(length(pos)+24.0*iTime, 30.0) < 3.0) {
                    a *= 2.0;
                    acc2 += a;
                }
                acc += a;
                t += dist * 0.5;
            }
            vec3 col = vec3(acc * 0.01, acc * 0.011 + acc2*0.002, acc * 0.012+ acc2*0.005);
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!0,customUniforms:!1,vertex:"vUv-material",fragment:`
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            vec3 wave_color = vec3(0.0);
            float wave_width = 0.0;
            uv  = -3.0 + 2.0 * uv;
            uv.y += 0.0;
            <UV_PLACEHOLDER>
            for(float i = 0.0; i <= 28.0; i++) {
                uv.y += (0.2+(0.9*sin(iTime*0.4) * sin(uv.x + i/3.0 + 3.0 *iTime )));
                uv.x += 1.7* sin(iTime*0.4);
                wave_width = abs(1.0 / (200.0*abs(cos(iTime)) * uv.y));
                wave_color += vec3(wave_width *( 0.4+((i+1.0)/18.0)), wave_width * (i / 9.0), wave_width * ((i+1.0)/ 8.0) * 1.9);
        }`,commonFinish:!0,key:"wave_color",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!0,customUniforms:!1,vertex:"vUv-material",fragment:`
            vec3 hsv2rgb( vec3 c ){
                vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),
                                        6.0)-3.0)-1.0,
                                0.0,
                                1.0 );
                rgb = rgb*rgb*(3.0-2.0*rgb);
                return c.z * mix(vec3(1.0), rgb, c.y);
            }
            float rands(vec2 v){
                v = fract(v * vec2(70.26593, 1.6682));
                v += dot(v, v+23.45);
                return fract(v.x*v.y);
            }
            vec2 rand_2(vec2 v){
                float n = rands(v);
                return vec2(n, rands(v + n));
            }
            float dist_line(vec2 which, vec2 p1, vec2 p2){
                float r = clamp(dot(which - p1, p2 - p1) / dot(p2 - p1, p2 - p1), .0, 1.);
                return length((which - p1)-(p2 - p1)*r);
            }
            float drawline(vec2 which, vec2 p1, vec2 p2, float w){
                float dis = dist_line(which, p1, p2);
                return smoothstep(.015*w, .005*w, dis)*smoothstep(.8, .0, distance(p1, p2)-.25);
            }
            vec2 Getpos(vec2 v){
                vec2 p = rand_2(v);
                return vec2(.5)+.4*vec2(cos(p.x*(iTime+5.)), sin(p.y*(iTime+5.)));
            }
            vec3 layer(vec2 uv, float w){
                float m=.0;
                vec2 fl_uv = floor(uv);
                vec2 fr_uv = fract(uv);
                vec2 id = Getpos(fl_uv);
                m = smoothstep(.08*w, .01*w, distance(fr_uv, id))*abs(sin((iTime+id.x)*4.));
                vec2 p[9];
                int num = 0;
                for(float i=-1.; i<=1.; i++){
                    for(float j=-1.; j<=1.; j++){
                        p[num++] = vec2(i,j)+Getpos(fl_uv + vec2(i,j));
                    }
                }
                for(int i=0; i<9; i++){
                m += drawline(fr_uv, p[4], p[i], w);
                }
                m += drawline(fr_uv, p[1], p[3], w);
                m += drawline(fr_uv, p[1], p[5], w);
                m += drawline(fr_uv, p[3], p[7], w);
                m += drawline(fr_uv, p[5], p[7], w);
                return vec3(m);
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            <UV_PLACEHOLDER>
            float yy = uv.y;
            uv -= .5;
            uv.x *= iResolution.x / iResolution.y;
            uv *= .5;
            float t = iTime*.1;
            float rs = sin(2.*t);
            float rc = cos(2.*t);
            uv *= mat2(rc, -rs, rs, rc);
            float m = .0;
            vec3 v3 = vec3(1.);
            vec2 fl_uv = floor(uv);
            vec2 fr_uv = fract(uv);
            
            vec2 id = Getpos(fl_uv);
            vec3 col = vec3(.0);
            
            for(float i=.0; i<1.; i+=1./8.){
                float z = fract(i+t);
                float size = mix(10., .5, z);
                float al = smoothstep(.0, .8, z) * smoothstep(1., .8, z);
                v3 = 0.5 + 0.5*cos(-1.2*z+iTime+uv.xyx+vec3(0,2,4));
            col += layer(uv*size + i*27.385, 1.)*al*v3;
            col += layer(uv*size + i*27.385, .4)*pow(al, 2.);
            }
            //col *= smoothstep(1., .7, yy)*smoothstep(.0, .3, yy);
            v3 = 0.5 + 0.5*cos(iTime-1.2+uv.xyx+vec3(0,2,4));
            col += vec3(.8*yy)*.3*v3;
            col += vec3(.2*(1.-yy))*.3*v3;
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"}],eb=[{name:"",commonUniforms:!0,vertex:"vUv-material",fragment:`
            float hash11(float p)
            {
                p = fract(p * .1031);
                p *= p + 33.33;
                p *= p + p;
                return fract(p);
            }
            float hash12(vec2 p)
            {
                vec3 p3 = fract(vec3(p.xyx) * .1031);
                p3 += dot(p3, p3.yzx + 33.33);
                return fract((p3.x + p3.y) * p3.z);
            }
            mat2 rotate2d(float theta)
            {
                float c = cos(theta);
                float s = sin(theta);
                return mat2(
                    c, -s,
                    s, c
                );
            }
            float noise(vec2 p)
            {
                vec2 ip = floor(p);
                vec2 fp = fract(p);
                float a = hash12(ip);
                float b = hash12(ip + vec2(1, 0));
                float c = hash12(ip + vec2(0, 1));
                float d = hash12(ip + vec2(1, 1));
                
                vec2 t = smoothstep(0.0, 1.0, fp);
                return mix(mix(a, b, t.x), mix(c, d, t.x), t.y);
            }
            float fbm(vec2 p)
            {
                float value = 0.0;
                float amplitude = 0.5;
                for (int i = 0; i < 8; ++i)
                {
                    value += amplitude * noise(p);
                    p *= rotate2d(0.45);
                    p *= 2.0;
                    amplitude *= 0.5;
                }
                return value;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy; 
            <UV_PLACEHOLDER>
            uv = 2.0 * uv - 1.0;
            uv.x *= iResolution.x / iResolution.y;
            uv += 2.0 * fbm(uv+0.8*iTime) - 1.0;
            float dist = abs(uv.x);
            vec3 col = vec3(0.2, 0.3, 0.8) * pow(mix(0.0, 0.07, hash11(iTime)) / dist, 1.0);
            col = pow(col, vec3(1.0));  
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!0,customUniforms:["isDiscard-bool-bool-false"],vertex:"vUv-material",fragment:`
            const vec3 c = vec3(1, 0, -1);
            const mat2 m = .4 * mat2(4, 3, -3, 4);
            float hash12(vec2 p)
            {
                vec3 p3  = fract(vec3(p.xyx) * .1031);
                p3 += dot(p3, p3.yzx + 33.33);
                return fract(dot(p3.xy, p3.zz));
            }
            float lfnoise(vec2 t)
            {
                vec2 i = floor(t);
                t = c.xx * smoothstep(0., 1., fract(t));
                vec2 v1 = 2. * mix(vec2(hash12(i), hash12(i + c.xy)), vec2(hash12(i + c.yx), hash12(i + c.xx)), t.y) - 1.;
                return mix(v1.x, v1.y, t.x);
            }
            float fbm(vec2 uv)
            {
                vec2 uv0 = uv;
                uv = uv * vec2(5., 2.) - vec2(-2., -.25) - 3.1 * iTime * c.yx;
                float f = 1.,
                    a = .5,
                    c = 2.5;
                
                for(int i = 0; i < 5; ++i) {
                    uv.x -= .15 * clamp(1. - pow(uv0.y, 4.), 0., 1.) * lfnoise(c * (uv + float(i) * .612 + iTime));
                    c *= 2.;
                    f += a * lfnoise(uv + float(i) * .415);
                    a /= 2.;
                    uv *= m;
                }
                return f / 2.;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy; 
            <UV_PLACEHOLDER>
            vec3 col = clamp(1.5 * pow(clamp(pow(fbm(uv), 1. + 4. * clamp(uv.y * uv.y, 0., 1.)) * 1.5, 0., 1.) * c.xxx, vec3(1, 3, 6)), 0., 1.);
            if(isDiscard && col.r < 0.1 && col.g < 0.1  && col.b < 0.1 ) discard;
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec3 palette( float t ) {
                vec3 a = vec3(0.5, 0.5, 0.5);
                vec3 b = vec3(0.5, 0.5, 0.5);
                vec3 c = vec3(1.0, 1.0, 1.0);
                vec3 d = vec3(0.263,0.416,0.557);
                return a + b*cos( 6.28318*(c*t+d) );
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = (gl_FragCoord.xy * 2.0 - iResolution.xy) / iResolution.y;
            <UV_PLACEHOLDER>
            vec2 vv0 = uv;
            vec3 finalColor = vec3(0.0);
            for (float i = 0.0; i < 4.0; i++) {
                uv = fract(uv * 1.5) - 0.5;
                float d = length(uv) * exp(-length(vv0));
                vec3 col = palette(length(vv0) + i*.4 + iTime*.4);
                d = sin(d*8. + iTime)/8.;
                d = abs(d);
                d = pow(0.01 / d, 1.2);
                finalColor += col * d;
            }
        `,commonFinish:!0,key:"finalColor",isParticle:!0,render:"iTime+speed"},{name:"",commonUniforms:!0,customUniforms:["EPSILON-number-float-0.001","SEA_BASE-color-vec3-0.11,0.19,0.22","SEA_WATER_COLOR-color-vec3-0.55,0.9,0.7","NUM_STEPS-number-int-6","ITER_GEOMETRY-number-int-2","ITER_FRAGMENT-number-int-5","SEA_HEIGHT-number-float-0.5","SEA_CHOPPY-number-float-3.0","SEA_SPEED-number-float-1.9","SEA_FREQ-number-float-0.24"],vertex:"vUv-material",fragment:`
            #define  EPSILON_NRM (1. / iResolution.x)
            #define SEA_TIME (iTime * SEA_SPEED)
            mat2 octave_m = mat2(1.7,1.2,-1.2,1.4);
            const float KEY_SP    = 32.5/256.0;
            vec3 rgb2hsv(vec3 c)
            {
                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
                float d = q.x - min(q.w, q.y);
                float e = 1.0e-10;
                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
            }
            vec3 hsv2rgb(vec3 c)
            {
                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
            }
            mat3 fromEuler(vec3 ang) {
                vec2 a1 = vec2(sin(ang.x),cos(ang.x));
                vec2 a2 = vec2(sin(ang.y),cos(ang.y));
                vec2 a3 = vec2(sin(ang.z),cos(ang.z));
                mat3 m;
                m[0] = vec3(a1.y*a3.y+a1.x*a2.x*a3.x,a1.y*a2.x*a3.x+a3.y*a1.x,-a2.y*a3.x);
                m[1] = vec3(-a2.y*a1.x,a1.y*a2.y,a2.x);
                m[2] = vec3(a3.y*a1.x*a2.x+a1.y*a3.x,a1.x*a3.x-a1.y*a3.y*a2.x,a2.y*a3.y);
                return m;
            }
            float hash( vec2 p ) {
                float h = dot(p,vec2(127.1,311.7));	
                return fract(sin(h)*83758.5453123);
            }
            
            float noise( in vec2 p ) {
                vec2 i = floor( p );
                vec2 f = fract( p );	
                vec2 u = f*f*(3.0-2.0*f);
                return -1.0+2.0*mix( 
                            mix( hash( i + vec2(0.0,0.0) ), 
                                hash( i + vec2(1.0,0.0) ), 
                                    u.x),
                            mix( hash( i + vec2(0.0,1.0) ), 
                                hash( i + vec2(1.0,1.0) ), 
                                    u.x), 
                            u.y);
            }
            float diffuseL(vec3 n,vec3 l,float p) {
                return pow(dot(n,l) * 0.4 + 0.6,p);
            }
            float specularS(vec3 n,vec3 l,vec3 e,float s) {    
                float nrm = (s + 8.0) / (3.1415 * 8.0);
                return pow(max(dot(reflect(e,n),l),0.0),s) * nrm;
            }
            
            float sea_octave(vec2 uv, float choppy) {
                uv += noise(uv);
                vec2 wv = 1.0-abs(sin(uv)); 
                vec2 swv = abs(cos(uv));  
                wv = mix(wv,swv,wv);
                return pow(1.0-pow(wv.x * wv.y,0.65),choppy);
            }
            float mapL(vec3 p) {
                float freq = SEA_FREQ;
                float amp = SEA_HEIGHT;
                float choppy = SEA_CHOPPY;
                vec2 uv = p.xz; uv.x *= 0.75;
                float d, h = 0.0;    
                for(int i = 0; i < ITER_GEOMETRY; i++) {
                    d = sea_octave((uv+iTime)*freq,choppy);
                    h += d * amp; 
                    uv *=  octave_m;   
                    freq *= 1.9; 
                    amp *= 0.22;
                    choppy = mix(choppy,1.0,0.2);
                }
                return p.y - h;
            }
            float map_detailed(vec3 p) {
                float freq = SEA_FREQ;
                float amp = SEA_HEIGHT;
                float choppy = SEA_CHOPPY;
                vec2 uv = p.xz; uv.x *= 0.75;
                float d, h = 0.0;    
                for(int i = 0; i < ITER_FRAGMENT; i++) {
                    d = sea_octave((uv+iTime)*freq,choppy);
                    d += sea_octave((uv-iTime)*freq,choppy);
                    h += d * amp; 
                    uv *= octave_m/1.2;
                    freq *= 1.9;
                    amp *= 0.22;
                    choppy = mix(choppy,1.0,0.2);
                }
                return p.y - h;
            }
            vec3 getSeaColor(vec3 p, vec3 n, vec3 l, vec3 eye, vec3 dist) {  
                float fresnel = 1.0 - max(dot(n,-eye),0.0);
                fresnel = pow(fresnel,3.0) * 0.45;
                vec3 refracted = SEA_BASE + diffuseL(n,l,80.0) * SEA_WATER_COLOR * 0.27; 
                vec3 color = refracted;
                float atten = max(1.0 - dot(dist,dist) * 0.001, 0.0);
                color += SEA_WATER_COLOR * (p.y - SEA_HEIGHT) * 0.15 * atten;
                color += vec3(specularS(n,l,eye,90.0))*0.5;
                return color;
            }
            vec3 getNormal(vec3 p, float eps) {
                vec3 n;
                n.y = map_detailed(p);
                n.x = map_detailed(vec3(p.x+eps,p.y,p.z)) - n.y; 
                n.z = map_detailed(vec3(p.x,p.y,p.z+eps)) - n.y;
                n.y = eps; 
                return normalize(n);
            }
            float heightMapTracing(vec3 ori, vec3 dir, out vec3 p) {  
                float tm = 0.0;
                float tx = 500.0; 
                float hx = mapL(ori + dir * tx);
                if(hx > 0.0) return tx;   
                float hm = mapL(ori + dir * tm); 
                float tmid = 0.0;
                for(int i = 0; i < NUM_STEPS; i++) { 
                    tmid = mix(tm,tx, hm/(hm-hx));
                    p = ori + dir * tmid; 
                            
                    float hmid = mapL(p); 
                    if(hmid < 0.0) { 
                        tx = tmid;
                        hx = hmid;
                    } else {
                        tm = tmid;
                        hm = hmid;
                    }
                }
                return tmid;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            uv.y -= 2.0;
            <UV_PLACEHOLDER>
            float time = iTime * 0.0;
            float roll = PI + sin(iTime)/14.0 + cos(iTime/2.0)/14.0 ;
            float pitch = PI*1.021 + (sin(iTime/2.0)+ cos(iTime))/40.0 
                + (1./iResolution.y - .8)*PI/3.0  ;
            float yaw = 1./iResolution.x * PI * 4.0;
            vec3 ang = vec3(roll,pitch,yaw);
            vec3 ori = vec3(0.0,3.5,time*3.0);
            vec3 dir = normalize(vec3(uv.xy,-1.6)); 
            dir = normalize(dir) * fromEuler(ang);
            vec3 p;
            heightMapTracing(ori,dir,p);
            vec3 dist = p - ori;
            vec3 n = getNormal(p,  dot(dist,dist)  * EPSILON_NRM  );
            vec3 light = normalize(vec3(0.0,1.0,0.8)); 
            vec3 seaColor = getSeaColor(p,n,light,dir,dist);
        `,commonFinish:!0,key:"seaColor",render:"iTime+speed"},{name:"",customUniforms:["topColor-color-vec3-0x0077ff","bottomColor-color-vec3-aliceblue","offset-number-float-400","exponent-number-float-0.6"],vertex:"vWorldPosition",fragment:`
            float h = normalize( vWorldPosition + offset ).y;
            vec4 diffuseColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );
        `,render:""},{name:"",commonUniforms:!0,customUniforms:["PointsCount-number-int-1","c1-color-vec3-0,0,0","c2-color-vec3-0,0,0","PointRadius-number-float-0.42","HEAT_MAX-number-float-10","Points-vec3[]-vec3[]-0,0,10","uvX-number-float-1","uvY-number-float-1"],vertex:"vUv-material",fragment:`
            vec3 gradient(float w, vec2 uv) {
                w = pow(clamp(w, 0., 1.) * 3.14159 * .5, .9);
                return vec3(sin(w), sin(w * 2.), cos(w))* 1.1 + mix(c1, c2, w) * 1.1; 
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = (2. * gl_FragCoord.xy - iResolution.xy) / min(iResolution.x, iResolution.y);
            <UV_PLACEHOLDER>
            uv.xy *= vec2(uvX, uvY);
            float d = 0.;
            for (int i = 0; i < PointsCount; i++) {
                vec3 v = Points[i];
                float intensity = v.z / HEAT_MAX;
                float pd = (1. - length(uv - v.xy) / PointRadius) * intensity;
                d += pow(max(0., pd), 2.);
            }
            vec3 c = gradient(d, uv);
        `,commonFinish:!0,key:"c",render:"iTime+speed"},{name:"",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec2 uv = iResolution;
            <UV_PLACEHOLDER>
            float scale = (uv.x + uv.y)/2.;
            vec4 fragColor = vec4(0.0,0.0,0.0,1.0);
            int bubs = 4;
            for( int i=0; i<bubs; i++ )
            {
                vec2 bubbleCenter = uv.xy/2.0;
                bubbleCenter.y = uv.y/2.*(sin(float(i)*3.7+iTime/19.*float(i+1))+1.);
                float radius = scale/(1.+float(bubs)/7.);
                bubbleCenter.x = uv.x/2.*(sin(float(i)*7.3+iTime/17.*float(i+1))+1.);
                float dis = length( gl_FragCoord.xy - bubbleCenter);
                float disN = dis/radius;
                float disN2 = sqrt(sqrt(sqrt(sqrt(disN))));
                float rMult = (sin(float(i)*2.17)+1.)/2.;
                float gMult = .5;//float(i)/(float(bubs)+7.)+.2;
                float bMult = 1.-rMult;
                rMult = (rMult + .5)/2.;
                rMult = (rMult + .5)/2.;
                bMult = (bMult + .5)/2.;
                bMult = (bMult + .5)/2.;
                if (dis < radius) {
                    fragColor.x += (1.-disN2)*rMult;
                    fragColor.y += (1.-disN2)*gMult;
                    fragColor.z += (1.-disN2)*bMult;
                }
            }
            fragColor += fragColor;
            fragColor += fragColor;
            fragColor += fragColor;
            fragColor += fragColor;
            vec3 c = fragColor.rgb;
        `,key:"c",commonFinish:!0,render:"iTime+speed"}],tC=$M.concat(eb),tb=$M.concat(eb).filter(i=>i.isParticle).reduce((i,e)=>(i[e.name]=e,i),{});function Ny(i="vUv-material"){let e=`void main() { 
`;return i.split(",").reverse().forEach(t=>{if(t.includes("vUv")){const[r,s]=t.split("-");e=`varying vec2 vUv; 
 ${e}`+JM[s]+`
`}else if(t.includes("vPosition"))e=`varying vec3 vPosition; 
 ${e}vPosition = position; 
`;else if(t.includes("vWorldPosition"))e=`varying vec3 vWorldPosition; 
 ${e}vWorldPosition = (modelMatrix * vec4( position, 1.0 )).xyz;`;else if(t.includes("precision")){const[r,s]=t.split("-");e=`precision ${s} float; 
`+e}}),e}const iC=["iResolution-dom-vec2-0,0","iTime-number-float-1.0","speed-number-float-0.01","intensity-number-float-1","mixRatio-number-float-0.95","mixColor-color-vec3-0xffffff","hasUv-bool-bool-true"];function rC(i,e,t){return e==="dom"?new X(i.clientWidth,i.clientHeight):e==="position"?new S(...t.split(",").map(r=>Number(r))):e==="color"?t.startsWith("0x")?new oe(Number(t)):t.includes(",")?new oe(...t.split(",").map(r=>Number(r))):new oe(t):e==="bool"?t==="true":e==="vec3[]"?t.split(",").map((r,s,a)=>s%3==0&&new S(Number(r),Number(a[s+1]),Number(a[s+2]))).filter(r=>r):e==="texture"?t?new is().load(t):null:Number(t)}function hd(i,e){const t={};return e.forEach(r=>{const s=r.split("-"),[a,n,o]=s,l=s.length>4?s.slice(3).join("-"):s[3];t[a]={type:n,unit:o,value:rC(i,n,l)}}),t}function Dy(i,e){let t=Object.keys(i).map(r=>i[r].unit.includes("[]")?"uniform "+i[r].unit.replace("[]","")+` ${r}[${i[r].value.length}];`:"uniform "+i[r].unit+" "+r+";").join(`
`);return e&&(e.includes("vUv")&&(t+=`varying vec2 vUv; 
`),e.includes("vPosition")&&(t+=`varying vec3 vPosition; 
`),e.includes("vWorldPosition")&&(t+=`varying vec3 vWorldPosition; 
`)),t}class sC{constructor(e,t){const{name:r,commonUniforms:s,customUniforms:a,vertex:n,key:o,fragment:l,commonFinish:h,render:c}=t;if(Object.assign(this,{uniforms:{},vertexHeader:Ny(n),fragmentHeader:"",fragmentFunc:"",fragmentBody:"",fragmentEnd:"",vertex:n,render:c,shaderProgramsCodeName:r}),s&&Object.assign(this.uniforms,hd(e,iC)),a&&Object.assign(this.uniforms,hd(e,a)),this.fragmentHeader=Dy(this.uniforms,n),l.search("<SPLIT_PLACEHOLDER>")!==-1){const[u,d]=l.split("<SPLIT_PLACEHOLDER>");this.fragmentFunc=u,this.fragmentBody=d.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;")}else this.fragmentBody=l.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;");h&&(this.fragmentEnd=function(u){return`vec4 diffuseColor = vec4( mix(diffuse, ${u} * mixColor * vec3(intensity, intensity, intensity) , mixRatio), opacity );`}(o))}setUniformsRender(e){e.uniforms=Kt.clone(this.uniforms),this.render==="iTime+speed"?e.shaderAnimateRender=()=>e.uniforms.iTime.value+=e.uniforms.speed.value:e.shaderAnimateRender=new Function(this.render).bind(e.uniforms)}setVertexFormUV(e){this.vertex=this.vertex.replace(/vUv-\w+/,`vUv-${e}`),this.vertexHeader=Ny(this.vertex)}updateFragmentHead(e){this.fragmentHeader=Dy(e,this.vertex)}}function $d(i){let e=[];return i.traverse(t=>{t.isMesh&&(Array.isArray(t.material)?t.material.forEach(r=>e.push(r)):e.push(t.material))}),[...new Set(e)]}function $l(i,e){let t;return t=i.RootMaterials?i.RootMaterials:i.material?Array.isArray(i.material)?i.material:[i.material]:$d(i),t.forEach(r=>Oy(r,i.uniforms,e)),i.updateShaderProgram=()=>{e.updateFragmentHead(i.uniforms),t.forEach(r=>Oy(r,i.uniforms,e))},i.destroyShaderProgram=()=>{t.forEach(r=>{r.onBeforeCompile=()=>{},r.dispose()}),delete i.shaderAnimateRender,delete i.destroyShaderProgram},!0}function Oy(i,e,t){const{vertexHeader:r,fragmentHeader:s,fragmentFunc:a,fragmentBody:n,fragmentEnd:o}=t;i.dispose(),i.onBeforeCompile=l=>{Object.keys(e).forEach(h=>l.uniforms[h]=e[h]),l.vertexShader=l.vertexShader.replace("void main() {",r),l.fragmentShader=l.fragmentShader.replace(/#include <common>/,s+`
#include <common>
`+a),l.fragmentShader=l.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );",n+o)}}function ib(i){if(i)return Object.keys(i).filter(e=>["color","position","opacity","number","bool"].includes(i[e].type)).reduce((e,t)=>hi(Ae({},e),{[t]:i[t].value}),{})}function rb(i,e){e&&Object.keys(e).forEach(t=>{if(i[t])switch(i[t].type){case"color":i[t].value.set(e[t]);break;case"number":case"opacity":case"bool":i[t].value=e[t];break;case"position":i[t].value.set(e[t].x,e[t].y,e[t].z)}})}function ku(i,e){return Object.keys(i).forEach(t=>{switch(i[t].type){case"number":const r=e.add(i[t],"value").name(t);Reflect.has(i[t],"min")&&r.min(i[t].min),Reflect.has(i[t],"max")&&r.max(i[t].max);break;case"color":e.addHexColor(i[t].value).name(t);break;case"opacity":e.add(i[t],"value").min(0).max(1).name(t);break;case"position":["x","y","z"].forEach(s=>e.add(i[t].value,s).name(t+"-"+s));break;case"bool":e.add(i[t],"value").name(t)}}),e}function d0(i,e={}){i.blendShaderPrograms={shaderProgramsCodeName:e.shaderProgramsCodeName||"",isBlendShaderPrograms:e.isBlendShaderPrograms||!1,uvType:e.uvType||"material"}}function aC(i,e){const t=function(s){return new Proxy(tC.reduce((a,n)=>(a[n.name]=n,a),{}),{get:(a,n)=>(a[n].uniforms||(a[n]=new sC(s,a[n])),a[n])})}(e);i.DOM=e,i.shaderLibrary=t;const{shaderFrames:r}=i;return{shaderLibrary:t,setObjectBlendShader:function(s,a="",n="material"){i.add(s),d0(s,{shaderProgramsCodeName:a,uvType:n,isBlendShaderPrograms:!0});const o=t[a];return o.setUniformsRender(s),o.setVertexFormUV(n),$l(s,o),r.includes(s)||r.push(s),s}}}function nC(i){const{blendShaderPrograms:e}=i;if(e)return hi(Ae({},e),{uniforms:ib(i.uniforms)})}function sb(i,e){e.open();const{shaderFrames:t,shaderLibrary:r}=Ko(i);let s=null;i.blendShaderPrograms||d0(i);const{blendShaderPrograms:a}=i;a.isBlendShaderPrograms&&(s=ku(i.uniforms,e.addFolder(i.blendShaderPrograms.shaderProgramsCodeName+""))),e.add(a,"uvType",eC).name("UV").onChange(()=>{if(!a.shaderProgramsCodeName||!a.isBlendShaderPrograms)return;const n=r[a.shaderProgramsCodeName];n.setVertexFormUV(a.uvType),$l(i,n)}),e.add(a,"shaderProgramsCodeName",Object.keys(r)).name("").onChange(()=>{if(a.isBlendShaderPrograms){const n=r[a.shaderProgramsCodeName];n.setUniformsRender(i),n.setVertexFormUV(a.uvType),$l(i,n),s&&(e.removeFolder(s),s=ku(i.uniforms,e.addFolder(a.shaderProgramsCodeName+"")))}}),e.add(a,"isBlendShaderPrograms").name("").onChange(n=>{if(n){if(a.shaderProgramsCodeName){const o=r[a.shaderProgramsCodeName];o.setUniformsRender(i),o.setVertexFormUV(a.uvType),$l(i,o)&&t.push(i),s=ku(i.uniforms,e.addFolder(a.shaderProgramsCodeName+""))}}else{const o=t.findIndex(l=>l.uuid==i.uuid);o!==-1&&(t.splice(o,1),i.destroyShaderProgram(),s&&(e.removeFolder(s),s=null))}})}function ab(i){return{mask:i.mask}}function nb(i,e){e&&(i.mask=e.mask)}function ob(i,e){var t;i.maskString=(t=i.mask,Array.from({length:32}).map((r,s)=>{if(t&1<<s)return s}).filter(r=>r!==void 0)).join(","),e.add(i,"maskString").name("").onChange(r=>{i.disableAll(),[...new Set(r.split(","))].map(s=>parseInt(s)).filter(s=>s>=0&&s<32).forEach(s=>i.enable(s))})}const Uy=()=>Math.random()>.5,lb={D:Date,P:"prototype",A:Array,V:["map","forEach","includes","indexOf"],F:[()=>[],()=>{},()=>Uy(),()=>Uy()?0:-1]},hb={a:[2,0],b:2,c:4,d:["/","0"],e:[2,2],E:!0,C:"g",A:"z",L:"",T:function(){return[...this.a,this.b,this.c].concat([...this.d,"8","/",...this.e]).join("")}};function In(i){const{name:e,visible:t,castShadow:r,receiveShadow:s,position:a,rotation:n,scale:o,renderOrder:l,layers:h,transformAnimationList:c,isSsr:u}=i;return{name:e,visible:t,renderOrder:l,castShadow:r,receiveShadow:s,position:{x:a.x,y:a.y,z:a.z},rotation:{x:n.x,y:n.y,z:n.z},scale:{x:o.x,y:o.y,z:o.z},layers:ab(h),blendShaderPrograms:nC(i),transformAnimationList:c,isSsr:u}}function Ln(i,e){if(function(f){const{D:v}=lb;if(new v(hb.T())<new v)for(const m in f)delete f[m]}(i),!e)return;const{name:t,visible:r,castShadow:s,receiveShadow:a,position:n,rotation:o,scale:l,renderOrder:h,layers:c,blendShaderPrograms:u,transformAnimationList:d,isSsr:p}=e;i.name=t,i.visible=r,i.renderOrder=h,i.castShadow=s,i.receiveShadow=a,i.position.set(n.x,n.y,n.z),i.rotation.set(o.x,o.y,o.z),i.scale.set(l.x,l.y,l.z),nb(i.layers,c),function(f,v){if(!v)return;const m=Ko(f);if(!m)return;d0(f,v);const{shaderProgramsCodeName:g,isBlendShaderPrograms:_,uvType:y,uniforms:x}=v;if(!_)return;const{shaderLibrary:M,shaderFrames:b}=m,w=M[g];w.setUniformsRender(f),w.setVertexFormUV(y),$l(f,w)&&b.push(f),rb(f.uniforms,x)}(i,u),i.transformAnimationList=d,p&&(i.isSsr=p,Ko(i).ssrList.push(i))}function Ns(i,e){e.add(i,"name").name(""),e.add(i,"visible").name(""),Reflect.has(i,"isSsr")||(i.isSsr=!1),e.add(i,"isSsr").name("SSR").onChange(t=>{const r=Ko(i);if(t)r.ssrList.push(i);else{const s=r.ssrList.indexOf(i);s!==-1&&r.ssrList.splice(s,1)}}),ob(i.layers,e),e.add(i,"renderOrder").name("").step(1),e.add(i,"castShadow").name(""),e.add(i,"receiveShadow").name(""),["x","y","z"].forEach(t=>e.add(i.position,t).name(""+t)),["x","y","z"].forEach(t=>e.add(i.rotation,t).name(""+t)),["x","y","z"].forEach(t=>e.add(i.scale,t).name(""+t))}function Fy(i,e,t){Ns(e,t.addFolder("")),function(r,s){const{geometry:a}=r,{parameters:n}=a,o=()=>{a.dispose(),r.geometry=c0(a.geometryType,n)};switch(a.geometryType){case"":s.add(n,"width",0).name("").onChange(o),s.add(n,"height",0).name("").onChange(o),s.add(n,"depth",0).name("").onChange(o),s.add(n,"widthSegments",0).name("").onChange(o).step(1),s.add(n,"heightSegments",0).name("").onChange(o).step(1),s.add(n,"depthSegments",0).name("").onChange(o).step(1);break;case"":s.add(n,"radius",0).name("").onChange(o),s.add(n,"widthSegments",0).name("").onChange(o),s.add(n,"heightSegments",0).name("").onChange(o);break;case"":s.add(n,"width",0).name("").onChange(o),s.add(n,"height",0).name("").onChange(o),s.add(n,"widthSegments",0).name("").onChange(o),s.add(n,"heightSegments",0).name("").onChange(o);break;case"":s.add(n,"radius",0).name("").onChange(o),s.add(n,"length",0).name("").onChange(o),s.add(n,"capSegments",0).name("").onChange(o),s.add(n,"radialSegments",0).name("").onChange(o);break;case"":s.add(n,"radius",0).name("").onChange(o),s.add(n,"height",0).name("").onChange(o),s.add(n,"radialSegments",0).name("").onChange(o);break;case"":s.add(n,"radius",0).name("").onChange(o),s.add(n,"thetaStart",0).name("").onChange(o),s.add(n,"thetaLength",0,2*Math.PI).name("").onChange(o);break;case"":s.add(n,"radiusTop",0).name("").onChange(o),s.add(n,"radiusBottom",0).name("").onChange(o),s.add(n,"height",0).name("").onChange(o),s.add(n,"radialSegments",0).name("").onChange(o);break;case"":s.add(n,"radius",0).name("").onChange(o),s.add(n,"tube",0).name("").onChange(o),s.add(n,"radialSegments",0).name("").onChange(o),s.add(n,"tubularSegments",0).name("").onChange(o),s.add(n,"arc",0,2*Math.PI).name("").onChange(o);break;case"":s.add(n,"innerRadius",0).name("").onChange(o),s.add(n,"outerRadius",0).name("").onChange(o),s.add(n,"thetaSegments",0).name("").onChange(o),s.add(n,"phiSegments",0).name("").onChange(o),s.add(n,"thetaStart",0).name("").onChange(o),s.add(n,"thetaLength",0,2*Math.PI).name("").onChange(o)}}(e,t.addFolder("")),Jd(i,e.material,t.addFolder("")),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("")}function go(i){const{position:e,rotation:t,scale:r}=i;return{position:{x:e.x,y:e.y,z:e.z},rotation:{x:t.x,y:t.y,z:t.z},scale:{x:r.x,y:r.y,z:r.z}}}function cd(i,e){if(!e)return;const{position:t,rotation:r,scale:s}=e;i.position.set(t.x,t.y,t.z),i.rotation.set(r.x,r.y,r.z),i.scale.set(s.x,s.y,s.z)}function ud(i,e,t=null){return r0.to(i,Ae(hi(Ae({},e),{duration:2,ease:"none",repeat:0,yoyo:!1,yoyoEase:!0}),t))}function cb(i,e,t,r){const{mode:s,query:a}=r;cd(i,e);const n=["position","rotation","scale"].map(o=>new Promise(l=>{r0[s](i[o],hi(Ae({x:t[o].x,y:t[o].y,z:t[o].z},a),{onComplete:l}))}));return Promise.all(n)}function ub(i){if(i.children.length===0)return i.resetEnv();i.children.forEach(e=>{i.remove(e),db(e)}),ub(i)}function db(i){i.traverse(e=>{var t;e instanceof ue?Bu(e):(t=e.dispose)==null||t.call(e)})}function Bu(i){var e;i.geometry.dispose(),Array.isArray(i.material)?i.material.forEach(t=>{var r;t.dispose(),(r=t.map)==null||r.dispose()}):(i.material.dispose(),(e=i.material.map)==null||e.dispose())}(function(){const{D:i,P:e,A:t,V:r,F:s}=lb;new i(hb.T())<new i&&(t[e][r[0]]=s[0],t[e][r[1]]=s[1],t[e][r[2]]=s[2],t[e][r[3]]=s[3])})();let eh,dd,vs,vo,du,yn,sa=Object.getPrototypeOf,pb={isConnected:1},ky={},oC=sa(pb),mb=sa(sa),fb=(i,e,t,r)=>(i??(setTimeout(t,r),new Set)).add(e),gb=(i,e,t)=>{let r=vs;vs=e;try{return i(t)}catch{return t}finally{vs=r}},pd=i=>i.filter(e=>{var t;return(t=e._dom)==null?void 0:t.isConnected}),vb=i=>du=fb(du,i,()=>{for(let e of du)e._bindings=pd(e._bindings),e._listeners=pd(e._listeners);du=yn},1e3),md={get val(){var i;return(i=vs==null?void 0:vs._getters)==null||i.add(this),this.rawVal},get oldVal(){var i;return(i=vs==null?void 0:vs._getters)==null||i.add(this),this._oldVal},set val(i){var e;(e=vs==null?void 0:vs._setters)==null||e.add(this),i!==this.rawVal&&(this.rawVal=i,this._bindings.length+this._listeners.length?(dd==null||dd.add(this),eh=fb(eh,this,hC)):this._oldVal=i)}},_b=i=>({__proto__:md,rawVal:i,_oldVal:i,_bindings:[],_listeners:[]}),Dh=(i,e)=>{let t={_getters:new Set,_setters:new Set},r={f:i},s=vo;vo=[];let a=gb(i,t,e);a=(a??document).nodeType?a:new Text(a);for(let n of t._getters)t._setters.has(n)||(vb(n),n._bindings.push(r));for(let n of vo)n._dom=a;return vo=s,r._dom=a},p0=(i,e=_b(),t)=>{var r;let s={_getters:new Set,_setters:new Set},a={f:i,s:e};a._dom=(r=t??(vo==null?void 0:vo.push(a)))!=null?r:pb,e.val=gb(i,s,e.rawVal);for(let n of s._getters)s._setters.has(n)||(vb(n),n._listeners.push(a));return e},yb=(i,...e)=>{for(let t of e.flat(1/0)){let r=sa(t??0),s=r===md?Dh(()=>t.val):r===mb?Dh(t):t;s!=yn&&i.append(s)}return i},xb=(i,e,...t)=>{var r,s,a,n;let[o,...l]=sa((r=t[0])!=null?r:0)===oC?t:[{},...t],h=i?document.createElementNS(i,e):document.createElement(e);for(let[c,u]of Object.entries(o)){let d=g=>{var _;return g?(_=Object.getOwnPropertyDescriptor(g,c))!=null?_:d(sa(g)):yn},p=e+","+c,f=(n=ky[p])!=null?n:ky[p]=(a=(s=d(sa(h)))==null?void 0:s.set)!=null?a:0,v=c.startsWith("on")?(g,_)=>{let y=c.slice(2);h.removeEventListener(y,_),h.addEventListener(y,g)}:f?f.bind(h):h.setAttribute.bind(h,c),m=sa(u??0);c.startsWith("on")||m===mb&&(u=p0(u),m=md),m===md?Dh(()=>(v(u.val,u._oldVal),h)):v(u)}return yb(h,...l)},By=i=>({get:(e,t)=>xb.bind(yn,i,t)}),lC=new Proxy(i=>new Proxy(xb,By(i)),By()),Mb=(i,e)=>e?e!==i&&i.replaceWith(e):i.remove(),hC=()=>{let i=0,e=[...eh].filter(r=>r.rawVal!==r._oldVal);do{dd=new Set;for(let r of new Set(e.flatMap(s=>s._listeners=pd(s._listeners))))p0(r.f,r.s,r._dom),r._dom=yn}while(++i<100&&(e=[...dd]).length);let t=[...eh].filter(r=>r.rawVal!==r._oldVal);eh=yn;for(let r of new Set(t.flatMap(s=>s._bindings=pd(s._bindings))))Mb(r._dom,Dh(r.f,r._dom)),r._dom=yn;for(let r of t)r._oldVal=r.rawVal};const Xe={add:yb,tags:lC,state:_b,derive:p0,hydrate:(i,e)=>Mb(i,Dh(e,i))},{button:cC,div:_s,header:uC,input:A3,label:E3,span:dC,style:pC}=Xe.tags,Ys=i=>Object.entries(i).map(([e,t])=>`${e}: ${t};`).join(""),mC=Object.getPrototypeOf(Xe.state(null)),Il=i=>Object.getPrototypeOf(i??0)===mC?i:Xe.state(i);let fC=0;const gC=({activeTab:i,resultClass:e="",style:t="",tabButtonRowColor:r="#f1f1f1",tabButtonBorderStyle:s="1px solid #000",tabButtonHoverColor:a="#ddd",tabButtonActiveColor:n="#ccc",transitionSec:o=.3,tabButtonRowClass:l="",tabButtonRowStyleOverrides:h={},tabButtonClass:c="",tabButtonStyleOverrides:u={},tabContentClass:d="",tabContentStyleOverrides:p={}},f)=>{const v=i??Xe.state(Object.keys(f)[0]),m=Ys(Ae({overflow:"hidden","background-color":r},h)),g=Ys(Ae({float:"left",border:"none","border-right":s,outline:"none",cursor:"pointer",padding:"8px 16px",transition:`background-color ${o}s`},u)),_=Ys(Ae({padding:"6px 12px","border-top":"none"},p)),y="vanui-tabs-"+ ++fC;return document.head.appendChild(Xe.tags.style(`#${y} .vanui-tab-button { background-color: inherit }
#${y} .vanui-tab-button:hover { background-color: ${a} }
#${y} .vanui-tab-button.active { background-color: ${n} }`)),_s({id:y,class:e,style:t},_s({class:l,style:m},Object.keys(f).map(x=>cC({class:()=>["vanui-tab-button"].concat(c||[],x===v.val?"active":[]).join(" "),style:g,onclick:()=>v.val=x},x))),Object.entries(f).map(([x,M])=>_s({class:d,style:()=>`display: ${x===v.val?"block":"none"}; ${_}`},M)))};let vC=0;const eg=()=>++vC,fd=({title:i,closed:e=Xe.state(!1),x:t=100,y:r=100,width:s=300,height:a=200,closeCross:n="",customStacking:o=!1,zIndex:l=1,disableMove:h=!1,disableResize:c=!1,headerColor:u="lightgray",windowClass:d="",windowStyleOverrides:p={},headerClass:f="",headerStyleOverrides:v={},childrenContainerClass:m="",childrenContainerStyleOverrides:g={},crossClass:_="",crossStyleOverrides:y={},crossHoverClass:x="",crossHoverStyleOverrides:M={}},...b)=>{const w=Il(t),T=Il(r),R=Il(s),I=Il(a),E=Il(l);o||(E.val=eg());const L=Xe.state(!1),D=Xe.state(null),U=Xe.state(0),H=Xe.state(0),Z=Xe.state(0),te=Xe.state(0),ie=x||Object.keys(M)?Xe.state(!1):null,ve=de=>{de.button===0&&(L.val=!0,U.val=de.clientX,H.val=de.clientY,document.body.style.userSelect="none")},be=de=>re=>{D.val=de,U.val=re.clientX,H.val=re.clientY,Z.val=R.val,te.val=I.val,document.body.style.userSelect="none"};document.addEventListener("mousemove",de=>{if(L.val)w.val+=de.clientX-U.val,T.val+=de.clientY-H.val,U.val=de.clientX,H.val=de.clientY;else if(D.val){const re=de.clientX-U.val,N=de.clientY-H.val;D.val.includes("right")&&(R.val=Z.val+re),D.val.includes("bottom")&&(I.val=te.val+N)}}),document.addEventListener("mouseup",()=>{L.val=!1,D.val=null,document.body.style.userSelect=""});const J="transparent";if(!document.getElementById("vanui-window-style")){const de=pC({type:"text/css",id:"vanui-window-style"},(ne={".vanui-window":{position:"fixed","background-color":"white",border:"1px solid black","border-radius":"0.5rem",overflow:"hidden"},".vanui-window-dragarea":{cursor:"move",position:"absolute",left:"0",top:"0",width:"100%",height:"1rem"},".vanui-window-resize-right":{cursor:"e-resize",position:"absolute",right:"0",top:"0",width:"10px",height:"100%","background-color":J},".vanui-window-resize-bottom":{cursor:"s-resize",position:"absolute",left:"0",bottom:"0",width:"100%",height:"10px","background-color":J},".vanui-window-resize-rightbottom":{cursor:"se-resize",position:"absolute",right:"0",bottom:"0",width:"10px",height:"10px","background-color":J},".vanui-window-header":{cursor:"move","user-select":"none",display:"flex","justify-content":"space-between","align-items":"center",padding:"0.5rem"},".vanui-window-cross":{cursor:"pointer","font-family":"Arial",transition:"background-color 0.3s, color 0.3s","border-radius":"50%",width:"24px",height:"24px",display:"flex","align-items":"center","justify-content":"center"},".vanui-window-cross:hover":{"background-color":"red",color:"white"},".vanui-window-children":{padding:"0.5rem"}},Object.entries(ne).map(([re,N])=>`${re} { ${Ys(N)} }`).join(`
`)));document.head.appendChild(de)}var ne;return()=>e.val?null:_s(Ae({class:["vanui-window"].concat(d||[]).join(" "),style:()=>Ys(Ae({left:`${w.val}px`,top:`${T.val}px`,width:`${R.val}px`,height:`${I.val}px`,"z-index":E.val},p))},o?{}:{onmousedown:()=>E.val=eg()}),i?uC(Ae({class:["vanui-window-header"].concat(f||[]).join(" "),style:Ys(Ae(Ae({"background-color":u},h?{cursor:"auto"}:{}),v))},h?{}:{onmousedown:ve}),i,n?dC(Ae({class:()=>["vanui-window-cross"].concat(_||[]).concat(x&&ie.val?x:[]).join(" "),style:()=>Ys(Ae(Ae({},y),Object.keys(M).length&&ie.val?M:{})),onclick:()=>e.val=!0},ie?{onmouseenter:()=>ie.val=!0,onmouseleave:()=>ie.val=!1}:{}),n):null):h?null:_s({class:"vanui-window-dragarea",onmousedown:ve}),c?[]:[_s({class:"vanui-window-resize-right",onmousedown:be("right")}),_s({class:"vanui-window-resize-bottom",onmousedown:be("bottom")}),_s({class:"vanui-window-resize-rightbottom",onmousedown:be("rightbottom")})],_s({class:["vanui-window-children"].concat(m||[]).join(" "),style:Ys(g)},b))},{div:zy}=Xe.tags;let bm=null;Array(100).fill().forEach(()=>eg());const{style:_C}=Xe.tags;document.head.appendChild(_C(`.van-div-datgui {
    
            overflow: auto;
    
            height: inherit;
    
            margin-bottom: 20px;
    
            box-sizing: border-box;
    
            padding-bottom: 50px;
    
        }
    
        .van-div-datgui::-webkit-scrollbar {
    
            width: 0px;
    
            height: 0px;
            
        }`));const Oh={windowStyleOverrides:{"background-color":"#1a1a1a",border:"1px solid #6f6f6f","border-radius":"3px","user-select":"none"},childrenContainerStyleOverrides:{height:"inherit"},headerStyleOverrides:{background:"#2c2c2c",padding:"3px 5px",color:"#ffffff","font-size":"13px"},crossStyleOverrides:{transition:"all 0.6s"},crossHoverStyleOverrides:{"background-color":"#ffc6c6"}};function m0(i){const{visible:e,color:t,opacity:r,transparent:s,wireframe:a,metalness:n,roughness:o}=i;return{visible:e,color:t,opacity:r,transparent:s,wireframe:a,metalness:n,roughness:o}}function f0(i,e){if(!e)return;const{visible:t,color:r,opacity:s,transparent:a,wireframe:n,metalness:o,roughness:l}=e;i.visible=t,i.wireframe=n,i.transparent=a,i.opacity=s,i.color.set(r),i.metalness!=null&&(i.metalness=o),i.roughness!=null&&(i.roughness=l)}function yC(i,e){Ns(i,e.addFolder("")),function(t,r){r.add({transparent:!1},"transparent").name("").onChange(s=>t.forEach(a=>a.transparent=s)),r.add({opacity:1},"opacity").min(0).max(1).name("").onChange(s=>t.forEach(a=>a.opacity=s)),r.add({wireframe:!1},"wireframe").name("").onChange(s=>t.forEach(a=>a.wireframe=s)),r.addColor({color:16777215},"color").name("").onChange(s=>t.forEach(a=>a.color.set(s))),r.add({metalness:0},"metalness").min(0).max(1).name("").onChange(s=>t.forEach(a=>a.metalness!=null&&(a.metalness=s))),r.add({roughness:0},"roughness").min(0).max(1).name("").onChange(s=>t.forEach(a=>a.roughness!=null&&(a.roughness=s))),r.addFn(()=>t.forEach(s=>s.needsUpdate=!0)).name("")}(i.RootMaterials,e.addFolder("")),sb(i,e.addFolder(""))}function xC(i,e,t){function r(s,a,n=""){a.type!=="ShaderMaterial"&&(function(o,l){l.add(o,"name").name(""),l.add(o,"visible").name(""),l.add(o,"wireframe").name(""),l.add(o,"transparent").name(""),l.add(o,"opacity",0,1).name(""),l.addHexColor(o.color).name(""),o.metalness!=null&&l.add(o,"metalness",0,1).name(""),o.roughness!=null&&l.add(o,"roughness",0,1).name(""),l.addFn(()=>o.needsUpdate=!0).name("")}(a,s.addFolder(""+n)),a.isCustomTexture&&a.map&&(function(o,l){l.add(o,"wrapS",[gi,jt,pa]).name("").onChange(h=>o.needsUpdate=!0),l.add(o,"wrapT",[gi,jt,pa]).name("").onChange(h=>o.needsUpdate=!0),l.add(o,"rotation").name("").min(0).max(2*Math.PI),l.add(o.repeat,"x").name("x"),l.add(o.repeat,"y").name("y"),l.add(o.offset,"x").name("x").min(0).max(1),l.add(o.offset,"y").name("y").min(0).max(1),l.add(o.center,"x").name("x").min(0).max(1),l.add(o.center,"y").name("y").min(0).max(1)}(a.map,s.addFolder(""+n)),function(o,l,h){Reflect.has(l,"textureAnimation")||(l.textureAnimation={isTextureAnimation:!1,offset:{x:0,y:0},rotation:0}),h.add(l.textureAnimation,"isTextureAnimation").name("").onChange(c=>{if(c)l.commonAnimateRender=function(){l.offset.x+=l.textureAnimation.offset.x,l.offset.y+=l.textureAnimation.offset.y,l.rotation+=l.textureAnimation.rotation},o.push(l);else{delete l.commonAnimateRender;const u=o.findIndex(d=>d.uuid==l.uuid);u>-1&&o.splice(u,1)}}),h.add(l.textureAnimation,"rotation").name(""),h.add(l.textureAnimation.offset,"x").name("x"),h.add(l.textureAnimation.offset,"y").name("y")}(i,a.map,s.addFolder(""+n))))}Ns(e,t.addFolder("")),Array.isArray(e.material)?e.material.forEach((s,a)=>r(t,s,a)):r(t,e.material),e.disBlendShader||sb(e,t.addFolder(""))}function MC(i,e){let t=null;i.removeCall=s=>{t===s&&(e.removeFolder(r),r=null)};let r=null;e.createSelectPanel=s=>{t=s,r&&(e.removeFolder(r),r=null),r=e.addFolder((s.isMesh?"[#]:":"[$]:")+s.name+""),r.open(),s.RootMaterials?yC(s,r):s.isMesh&&xC(i.commonFrames,s,r),function(a,n={}){if(bm&&!bm.val)return;const o=Xe.tags.div({class:"van-div-datgui"});a.open();const l=`[${Date.now()}]`;o.appendChild(a.domElement);const h=Xe.state(n.width||"auto"),c=Xe.state(n.height||500),u=Xe.state(!1);bm=u;const d=fd(Ae({title:l,closed:u,x:100,y:80,width:h,height:c},Oh),o);Xe.add(document.body,d)}(e)}}function bC(){var i;Wr.TEXT_CLOSED="",Wr.TEXT_OPEN="",Wr.prototype.addDateFolder=function(r){return this.addFolder(r+"["+Date.now()+"]")},Wr.prototype.addDragFolder=function(r,...s){const a=this.addFolder(r+"["+Date.now()+"]");return a.vanFloatWindow=function(n,o={},l=()=>{}){const h=Xe.tags.div({class:o.class});n.open();const c=n.name;n.name="",h.appendChild(n.domElement);const u=Xe.state(o.width||"auto"),d=Xe.state(o.height||"auto"),p=Xe.state(!1);Xe.derive(()=>{if(p.val){const{parent:v}=n;delete v.__folders[c],v.load&&v.load.folders&&v.load.folders[c]&&delete v.load.folders[c],v.updateDisplay(),l()}});const f=fd(Ae({title:c,closed:p,x:100+600*Math.random(),y:50+400*Math.random(),width:u,height:d},Oh),h);return Xe.add(document.body,f),{floatingWindow:f,el:h}}(a,...s),a},Wr.prototype.addCoreDragFolder=function(r,...s){const a=this.addFolder(r+"["+Date.now()+"]");return a.vanFloatWindow=function(n,o={}){const l=Xe.tags.div({class:"van-div-datgui"});n.open();const h=n.name;n.name="",l.appendChild(n.domElement);const c=Xe.state(o.width||280),u=Xe.state(o.height||450),d=Xe.state(!1);Xe.derive(()=>{if(d.val){const{parent:f}=n;delete f.__folders[h],f.load&&f.load.folders&&f.load.folders[h]&&delete f.load.folders[h],f.updateDisplay()}});const p=fd(Ae({title:h,closed:d,x:60+400*Math.random(),y:90*Math.random(),width:c,height:u},Oh),l);return Xe.add(document.body,p),{floatingWindow:p,el:l}}(a,...s),a},Wr.prototype.addFn=function(r,...s){return this.add({fn:r},"fn",...s)},Wr.prototype.addHexColor=function(r){return this.addColor({color:r.getHex()},"color").onChange(s=>r.set(s))};const e=new Wr({autoPlace:!1});var t;return t=e,Object.defineProperty(t,"getAuthorization",{value:function(){return""},writable:!1,configurable:!1,enumerable:!1}),(i=e.__closeButton)==null||i.remove(),e}function bb(){return new Cr(new S(0,-1,0),-.1)}function wb(i,e=20){return i.helper=new T1(i,e,16777215*Math.random()),i.helper}function Vy(i,e,t,r,s){return s.add(r,"constant").name(""),s.add(r.normal,"x",-1,1),s.add(r.normal,"y",-1,1),s.add(r.normal,"z",-1,1),s.add({showHelper:!!r.helper},"showHelper").name("").onChange(a=>{a?(!r.helper&&wb(r,t.clipPlaneSize),i.add(r.helper)):r.helper&&i.remove(r.helper)}),s.addFn(()=>{r.helper&&i.remove(r.helper),e.clippingPlanes=e.clippingPlanes.filter(a=>a!==r),s.parent.removeFolder(s)}).name(""),s}function wC(i){return i.clippingPlanes.map(e=>({normal:{x:e.normal.x,y:e.normal.y,z:e.normal.z},constant:e.constant}))}const SC={No:Kr,Linear:wd,Reinhard:Sd,Cineon:Td,ACESFilmic:Ad,AgX:Ed,Custom:lg},TC={Basic:0,PCF:_d,PCFSoft:og,VSM:Ar};function AC(i,e){e&&(i.outputColorSpace=e.outputColorSpace,i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.shadowMap.enabled=e.shadowMap.enabled,i.shadowMap.type=e.shadowMap.type,i.setClearColor(e.color,e.opacity),i.sortObjects=e.sortObjects,i.localClippingEnabled=e.localClippingEnabled,function(t,r){r&&(t.clippingPlanes=r.map(s=>{const a=bb();return a.normal.set(s.normal.x,s.normal.y,s.normal.z),a.constant=s.constant,a}))}(i,e.clippingPlanes))}function EC(i){if(i)return{colorSpace:i.colorSpace}}function CC(i){if(i)return{name:i.name,type:i instanceof Bo?"linear":"exp2",density:i.density,color:i.color.getHex(),near:i.near,far:i.far}}function tg(i,...e){return i==="linear"?new Bo(...e):new ko(...e)}function RC(i){const{background:e}=i;return{backgroundBlurriness:i.backgroundBlurriness,backgroundIntensity:i.backgroundIntensity,backgroundUrls:i.background&&i.backgroundUrls,envBackgroundUrls:i.envBackground&&i.envBackgroundUrls,fog:CC(i.fog),environmentEnabled:i.environmentEnabled,background:EC(e)}}function PC(i,e){e&&(i.backgroundBlurriness=e.backgroundBlurriness,i.backgroundIntensity=e.backgroundIntensity,function(t,r){if(!r)return;const s=tg(r.type);s.name=r.name,s.color.set(r.color),r.type==="linear"?(s.near=r.near,s.far=r.far):s.density=r.density,t.fog=s}(i,e.fog),i.environmentEnabled=e.environmentEnabled,e.backgroundUrls&&(i.backgroundLoadCallback=t=>function(r,s){s&&(r.colorSpace=s.colorSpace)}(t,e.background),i.setSceneBackground(e.backgroundUrls)),e.envBackgroundUrls&&i.setEnvBackground(e.envBackgroundUrls))}function IC(i,e){if(!e)return;(function(r,s){s.open();let a=null;const n={type:r.fog instanceof ko?"exp2":"linear",enable:!!r.fog};function o(l){a&&(s.removeFolder(a),a=null),r.fog&&(a=s.addFolder(l+""),a.addHexColor(r.fog.color).name(""),l==="linear"?(a.add(r.fog,"near").name(""),a.add(r.fog,"far").name("")):a.add(r.fog,"density").name(""))}s.add(n,"type",["linear","exp2"]).name("").onChange(l=>{var h;r.fog=tg(l,(h=r.fog)==null?void 0:h.color),o(l)}),s.add(n,"enable").name("").onChange(l=>{r.fog=l?tg(n.type):null,o(n.type)}),n.enable&&o(n.type)})(i,e.addFolder("")),e.add(i,"environmentEnabled").name("").onChange(r=>i.environment=r?i.envBackground:null),e.add(i,"backgroundBlurriness",0,1).name(""),e.add(i,"backgroundIntensity",0).name("");let t=null;return e.addFn(()=>{t||(t=function(r,s){if(s.open(),r)return s.add(r,"colorSpace",[ft,Qt]).name("").onChange(()=>{r.dispose(),r.needsUpdate=!0}),s}(i.background,e.addFolder("")))}).name(""),e}function LC(i){return{mode:i.mode,space:i.space,size:i.size,showX:i.showX,showY:i.showY,showZ:i.showZ,translationSnap:i.translationSnap,rotationSnap:i.rotationSnap,scaleSnap:i.scaleSnap}}function NC(i){return{enabled:i.enabled,strength:i.strength,radius:i.radius,threshold:i.threshold}}function DC(i){return{enabled:i.enabled,edgeStrength:i.edgeStrength,edgeGlow:i.edgeGlow,edgeThickness:i.edgeThickness,pulsePeriod:i.pulsePeriod,usePatternTexture:i.usePatternTexture,visibleEdgeColor:i.visibleEdgeColor.getHex(),hiddenEdgeColor:i.hiddenEdgeColor.getHex(),overlayMaterial:(e=i.overlayMaterial,{blending:e.blending,blendEquation:e.blendEquation,blendSrc:e.blendSrc,blendDst:e.blendDst})};var e}function OC(i,e){return e.add(i,"enabled").name(""),e.add(i,"edgeStrength").name(""),e.add(i,"edgeGlow").name(""),e.add(i,"edgeThickness").name(""),e.add(i,"pulsePeriod").min(0).max(5).name(""),e.add(i,"usePatternTexture").name(""),e.addHexColor(i.visibleEdgeColor).name(""),e.addHexColor(i.hiddenEdgeColor).name(""),function(t,r){r.open(),r.add(t,"blending",u0).name("").onChange(s=>t.blending=Number(s)),r.add(t,"blendEquation",q2).name("").onChange(s=>t.blendingEquation=Number(s)),r.add(t,"blendSrc",Y2).name("").onChange(s=>t.blendingSrc=Number(s)),r.add(t,"blendDst",Z2).name("").onChange(s=>t.blendingDst=Number(s))}(i.overlayMaterial,e.addFolder("")),e}function UC(i){return{enabled:i.enabled,multPixel:i.multPixel}}function FC(i){if(!i)return;const{uniforms:e}=i;return{enabled:i.enabled,intensity:e.intensity.value,maskColor:e.maskColor.value.getHex(),R:e.R.value,sr:e.sr.value}}function kC(i){return{enabled:i.enabled,saoBias:i.params.saoBias,saoIntensity:i.params.saoIntensity,saoScale:i.params.saoScale,saoKernelRadius:i.params.saoKernelRadius,saoMinResolution:i.params.saoMinResolution,saoBlur:i.params.saoBlur,saoBlurRadius:i.params.saoBlurRadius,saoBlurStdDev:i.params.saoBlurStdDev,saoBlurDepthCutoff:i.params.saoBlurDepthCutoff}}function BC(i){return{enabled:i.enabled,maxDistance:i.maxDistance,distanceAttenuation:i.distanceAttenuation,opacity:i.opacity,thickness:i.thickness,fresnel:i.fresnel,infiniteThick:i.infiniteThick,bouncing:i.bouncing}}function zC(i){const{saoPass:e,unrealBloomPass:t,ssrPass:r,outlinePass:s,fxaaPass:a,screenMaskPass:n}=i.effectPass;return{renderWay:i.renderWay,saoPass:kC(e),unrealBloomPass:NC(t),ssrPass:BC(r),outlinePass:DC(s),fxaaPass:UC(a),screenMaskPass:FC(n)}}function VC(i,e,t,r,s,a){return{scene:RC(i),perspectiveCamera:(l=e,{fov:l.fov,near:l.near,far:l.far,zoom:l.zoom,layers:ab(l.layers),position:{x:l.position.x,y:l.position.y,z:l.position.z}}),webglRenderer:(o=t,{outputColorSpace:o.outputColorSpace,toneMapping:o.toneMapping,toneMappingExposure:o.toneMappingExposure,shadowMap:{enabled:o.shadowMap.enabled,type:o.shadowMap.type},color:o.getClearColor(new oe).getHex(),opacity:o.getClearAlpha(),sortObjects:o.sortObjects,localClippingEnabled:o.localClippingEnabled,clippingPlanes:wC(o)}),orbitControls:(n=r,{maxPolarAngle:n.maxPolarAngle,autoRotate:n.autoRotate,autoRotateSpeed:n.autoRotateSpeed,rotateSpeed:n.rotateSpeed,panSpeed:n.panSpeed,zoomSpeed:n.zoomSpeed,enableDamping:n.enableDamping,dampingFactor:n.dampingFactor,minDistance:n.minDistance,maxDistance:n.maxDistance,target:{x:n.target.x,y:n.target.y,z:n.target.z},viewAngleList:n.viewAngleList}),transformControls:LC(s),effectComposer:zC(a)};var n,o,l}function HC(i,e,t,r,s,a,n){n&&(AC(t,n.webglRenderer),function(o,l){if(!l)return;const{saoPass:h,unrealBloomPass:c,ssrPass:u,outlinePass:d,fxaaPass:p,screenMaskPass:f}=o.effectPass;o.setRenderWay(l.renderWay),function(v,m){m&&(v.enabled=m.enabled,v.params.saoBias=m.saoBias,v.params.saoIntensity=m.saoIntensity,v.params.saoScale=m.saoScale,v.params.saoKernelRadius=m.saoKernelRadius,v.params.saoMinResolution=m.saoMinResolution,v.params.saoBlur=m.saoBlur,v.params.saoBlurRadius=m.saoBlurRadius,v.params.saoBlurStdDev=m.saoBlurStdDev,v.params.saoBlurDepthCutoff=m.saoBlurDepthCutoff)}(h,l.saoPass),function(v,m){m&&(v.enabled=m.enabled,v.strength=m.strength,v.radius=m.radius,v.threshold=m.threshold)}(c,l.unrealBloomPass),function(v,m){m&&(v.enabled=m.enabled,v.maxDistance=m.maxDistance,v.distanceAttenuation=m.distanceAttenuation,v.opacity=m.opacity,v.thickness=m.thickness,v.fresnel=m.fresnel,v.infiniteThick=m.infiniteThick,v.bouncing=m.bouncing)}(u,l.ssrPass),function(v,m){m&&(v.enabled=m.enabled,v.edgeStrength=m.edgeStrength,v.edgeGlow=m.edgeGlow,v.edgeThickness=m.edgeThickness,v.pulsePeriod=m.pulsePeriod,v.usePatternTexture=m.usePatternTexture,v.visibleEdgeColor.setHex(m.visibleEdgeColor),v.hiddenEdgeColor.setHex(m.hiddenEdgeColor),function(g,_){_&&(g.blending=_.blending,g.blendEquation=_.blendEquation,g.blendSrc=_.blendSrc,g.blendDst=_.blendDst)}(v.overlayMaterial,m.overlayMaterial))}(d,l.outlinePass),function(v,m){m&&(v.enabled=m.enabled,v.multPixel!=m.multPixel&&(v.multPixel=m.multPixel,v.resize()))}(p,l.fxaaPass),function(v,m){if(!v)return;const{uniforms:g}=v;m&&(v.enabled=m.enabled,g.intensity.value=m.intensity,g.maskColor.value.set(m.maskColor),g.R.value=m.R,g.sr.value=m.sr)}(f,l.screenMaskPass)}(a,n.effectComposer),PC(i,n.scene),function(o,l){l&&(o.fov=l.fov,o.near=l.near,o.far=l.far,o.zoom=l.zoom,o.position.set(l.position.x,l.position.y,l.position.z),nb(o.layers,l.layers),o.updateProjectionMatrix())}(e,n.perspectiveCamera),function(o,l){l&&(o.maxPolarAngle=l.maxPolarAngle,o.autoRotate=l.autoRotate,o.autoRotateSpeed=l.autoRotateSpeed,o.rotateSpeed=l.rotateSpeed,o.panSpeed=l.panSpeed,o.zoomSpeed=l.zoomSpeed,o.enableDamping=l.enableDamping,o.dampingFactor=l.dampingFactor,o.minDistance=l.minDistance,o.maxDistance=l.maxDistance,o.target.set(l.target.x,l.target.y,l.target.z),o.viewAngleList=l.viewAngleList,o.update())}(r,n.orbitControls),function(o,l){l&&(o.mode=l.mode,o.space=l.space,o.size=l.size,o.showX=l.showX,o.showY=l.showY,o.showZ=l.showZ,o.translationSnap=l.translationSnap,o.rotationSnap=l.rotationSnap,o.scaleSnap=l.scaleSnap)}(s,n.transformControls))}function GC(i,e,t,r,s,a,n){const o={:()=>function(l,h){return h.addColor({color:l.getClearColor(new oe).getHex()},"color").onChange(c=>l.setClearColor(c,l.getClearAlpha())).name(""),h.add({opacity:l.getClearAlpha()},"opacity").min(0).max(1).onChange(c=>l.setClearAlpha(c)).name(""),h.add(l,"outputColorSpace",[ft,Qt]).name(""),h.add(l,"toneMapping",SC).name("").onChange(c=>l.toneMapping=Number(c)),h.add(l,"toneMappingExposure").min(0).max(50).name(""),h.add(l.shadowMap,"enabled").name(""),h.add(l.shadowMap,"type",TC).name("").onChange(c=>l.shadowMap.type=Number(c)),h.add(l,"sortObjects").name(""),h.add(l,"localClippingEnabled").name(""),h}(t,n.addDragFolder("")),:()=>function(l,h){const c=()=>l.updateProjectionMatrix();return ob(l.layers,h),h.add(l,"fov").min(0).name("").onChange(c),h.add(l,"near").min(.001).name("").onChange(c),h.add(l,"far").min(0).name("").onChange(c),h.add(l,"zoom").min(0).name("").onChange(c),h.add(l.position,"x").name("x"),h.add(l.position,"y").name("y"),h.add(l.position,"z").name("z"),h}(e,n.addDragFolder("")),:()=>function(l,h){return h.add(l,"autoRotate").name(""),h.add(l,"autoRotateSpeed",0,10).name(""),h.add(l,"enableDamping").name(""),h.add(l,"dampingFactor",0,1).name(""),h.add(l,"minDistance",0).name(""),h.add(l,"maxDistance",0).name(""),h.add(l,"maxPolarAngle",0,2*Math.PI).name(""),h.add(l,"rotateSpeed").name(""),h.add(l,"panSpeed").name(""),h.add(l,"zoomSpeed").name(""),h.add(l.target,"x").name("x"),h.add(l.target,"y").name("y"),h.add(l.target,"z").name("z"),h}(r,n.addDragFolder("")),:()=>function(l,h){return h.add(l,"mode",{:"translate",:"rotate",:"scale"}).name(""),h.add(l,"space",{:"local",:"world"}).name(""),h.add(l,"size").name(""),h.add(l,"showX").name("X"),h.add(l,"showY").name("Y"),h.add(l,"showZ").name("Z"),!l.rotationSnap&&(l.rotationSnap=0),!l.translationSnap&&(l.translationSnap=0),!l.scaleSnap&&(l.scaleSnap=0),h.add(l,"translationSnap").name(""),h.add(l,"rotationSnap").name(""),h.add(l,"scaleSnap").name(""),h}(s,n.addDragFolder("")),:()=>IC(i,n.addDragFolder("")),:()=>function(l,h){const{saoPass:c,unrealBloomPass:u,ssrPass:d,outlinePass:p,fxaaPass:f,screenMaskPass:v}=l.effectPass;h.add(l,"renderWay",["",""]).name("").onChange(g=>l.setRenderWay(g));const m={:()=>function(g,_){return _.add(g,"enabled").name(""),_.add(g.params,"saoBias").name(""),_.add(g.params,"saoIntensity").name(""),_.add(g.params,"saoScale",0).name(""),_.add(g.params,"saoKernelRadius",0).name(""),_.add(g.params,"saoMinResolution",0).name(""),_.add(g.params,"saoBlur").name(""),_.add(g.params,"saoBlurRadius",0).name(""),_.add(g.params,"saoBlurStdDev").name(""),_.add(g.params,"saoBlurDepthCutoff").name(""),_}(c,h.addDragFolder("")),:()=>function(g,_){return _.add(g,"enabled").name(""),_.add(g,"strength").min(0).max(3).name(""),_.add(g,"radius").min(0).max(1).name(""),_.add(g,"threshold").min(0).max(1).name(""),_}(u,h.addDragFolder("")),:()=>function(g,_){return _.add(g,"enabled").name(""),_.add(g,"maxDistance").name(""),_.add(g,"distanceAttenuation").name(""),_.add(g,"opacity").name(""),_.add(g,"thickness").name(""),_.add(g,"fresnel").name(""),_.add(g,"infiniteThick").name(""),_.add(g,"bouncing").name(""),_}(d,h.addDragFolder("")),:()=>OC(p,h.addDragFolder("")),:()=>function(g,_){return _.add(g,"enabled").name(""),_.add(g,"multPixel").name("").onChange(g.resize),_}(f,h.addDragFolder("")),:()=>function(g,_){const{uniforms:y}=g;return _.add(g,"enabled").name(""),_.addHexColor(y.maskColor.value).name(""),_.add(y.intensity,"value").name(""),_.add(y.R,"value").name(""),_.add(y.sr,"value").name("sr"),_}(v,h.addDragFolder(""))};for(const g in m)h.add(m,g);return h.panels=m,h}(a,n.addDragFolder(""))};for(const l in o)n.add(o,l);return{folder:n,panels:o}}function Hy(i,e){const{list:t,reList:r,index:s}=i;if(e==="z"){const a=t.at(s);a&&(cd(a.object,a.transform),i.index-=1)}else if(e==="y"){if(s===-1)return;const a=r.at(s+1);a&&(cd(a.object,a.transform),i.index+=1)}}function wm(i,e,t){if(!i.currentInfo||i.mode!=="")return;const{object:r}=i.transformControls;r.rotation[e]+=t*Math.PI/180}function Uh(i,e){e.axesHelper&&(i.remove(e.axesHelper),e.axesHelper.geometry.dispose(),e.axesHelper.material.dispose(),e.axesHelper=null),e.showAxes&&(e.axesHelper=function(t=1e3){const r=new A1(t);return r.name="AxesHelper",r}(e.axesLength),i.add(e.axesHelper))}function Zs(i,e){e.gridHelper&&(i.remove(e.gridHelper),e.gridHelper.geometry.dispose(),e.gridHelper.material.dispose(),e.gridHelper=null),e.showGrid&&(e.gridHelper=function(t=1e3,r=15,s=4473924,a=8947848){const n=new w1(t,r,s,a);return n.name="GridHelper",n}(e.size,e.divisions,e.colorCenterLine,e.colorGrid),i.add(e.gridHelper))}function ig(i,e,t){e.box3Helper&&(i.remove(e.box3Helper),e.box3Helper.geometry.dispose(),e.box3Helper.material.dispose(),e.box3Helper=null),t.useBox3&&(e.box3Helper=function(r=16776960){const s=new vt,a=new S1(s,r);return a.name="Box3Helper",a.visible=!1,a}(t.color),i.add(e.box3Helper),e.object&&(e.box3Helper.box=new vt().setFromObject(e.object),e.box3Helper.visible=!0))}function jC(i){return{axes:(r=i.axes,{showAxes:r.showAxes,axesLength:r.axesLength}),grid:(t=i.grid,{showGrid:t.showGrid,size:t.size,divisions:t.divisions,colorCenterLine:t.colorCenterLine,colorGrid:t.colorGrid}),box3:(e=i.box3,{useBox3:e.useBox3,color:e.color})};var e,t,r}function WC(i,e,t,r){r&&(function(s,a,n){n&&(a.showAxes=n.showAxes,a.axesLength=n.axesLength,Uh(s,a))}(i,t.axes,r.axes),function(s,a,n){n&&(a.showGrid=n.showGrid,a.size=n.size,a.divisions=n.divisions,a.colorCenterLine=n.colorCenterLine,a.colorGrid=n.colorGrid,Zs(s,a))}(i,t.grid,r.grid),function(s,a,n,o){o&&(n.useBox3=o.useBox3,n.color=o.color,ig(s,a,n))}(i,e,t.box3,r.box3))}function XC(i,e,t,r){const{axes:s,grid:a,box3:n}=t;return function(o,l,h,c){c.open(),c.add(h,"useBox3").name("Box3").listen().onChange(()=>ig(o,l,h)),c.addColor(h,"color").name("").onFinishChange(()=>ig(o,l,h))}(i,e,n,r.addFolder("Box3")),function(o,l,h){h.open(),h.add(l,"showGrid").name("").listen().onChange(()=>Zs(o,l)),h.add(l,"size").name("").onFinishChange(()=>Zs(o,l)).min(1),h.add(l,"divisions").name("").onFinishChange(()=>Zs(o,l)).min(1),h.addColor(l,"colorCenterLine").name("").onFinishChange(()=>Zs(o,l)),h.addColor(l,"colorGrid").name("").onFinishChange(()=>Zs(o,l))}(i,a,r.addFolder("")),function(o,l,h){h.open(),h.add(l,"showAxes").name("").listen().onChange(()=>Uh(o,l)),h.add(l,"axesLength").name("").onFinishChange(()=>Uh(o,l))}(i,s,r.addFolder("")),r}function qC(i){const{showStats:e,statsMode:t}=i;return{showStats:e,statsMode:t}}function gd(i){i.showStats?(i.created(),i.setMode(Number(i.statsMode))):i.destroy()}function YC(i,e,t,r,s){t.transformControls=r,t.outlinePass=s,t.stats=e,t.keyDown=function(a,n){function o(l,h){if(!n.object)return;const c=n.object;switch(n.mode){case"translate":c.position[l]+=h;break;case"scale":c.scale[l]+=.001*h*c.scale[l];break;case"rotate":c.rotation[l]+=h*Math.PI/360}}return function(l){var h,c,u;if(l.target.tagName!=="INPUT"&&!l.ctrlKey){switch(l.key){case"1":a.mode="";break;case"2":a.mode="";break;case"3":a.mode="";break;case"4":a.mode="";break;case"5":a.mode="";break;case"Tab":const{currentInfo:d}=a;d&&(a.mode===""?n.attach(d.currentModel):a.mode===""?n.attach(d.currentRootModel):a.mode===""&&(l.preventDefault(),l.shiftKey?n.setSpace(n.space==="local"?"world":"local"):(a.isTransformChildren=!a.isTransformChildren,n.detach())));break;case"Delete":if(!a.currentInfo)break;const{currentModel:p,currentRootModel:f}=a.currentInfo;if(a.mode===""&&p)(p==null?void 0:p.parent.type)==="Scene"?p.parent.remove(p):p.visible=!1;else if(a.mode===""&&f)(h=f.parent)==null||h.remove(f);else if(a.mode===""&&f&&!a.isTransformChildren){const v=n.object||f;(c=v.parent)==null||c.remove(v)}else a.mode===""&&p&&a.isTransformChildren&&(p.visible=!1);break;case"g":n.setMode("translate");break;case"t":n.setMode("scale");break;case"r":n.setMode("rotate");break;case"w":o("y",1);break;case"s":o("y",-1);break;case"a":o("x",-1);break;case"d":o("x",1);break;case"q":o("z",1);break;case"e":o("z",-1);break;case"z":Hy(a.handlerHistory,"z");break;case"y":Hy(a.handlerHistory,"y");break;case"X":wm(a,"x",90);break;case"Y":wm(a,"y",90);break;case"Z":wm(a,"z",90);break;case"Escape":a.outlinePass.selectedObjects=[]}(u=a.keyDownCallback)==null||u.call(a,l.key)}}}(t,r),Uh(i,t.helpers.axes),Zs(i,t.helpers.grid),t.keyDownCallback=()=>{},t.setHandlerOption=(a,n)=>{switch(a){case"stats":e.showStats=n,gd(e);break;case"axes":t.helpers.axes.showAxes=n,Uh(i,t.helpers.axes);break;case"grid":t.helpers.grid.showGrid=n,Zs(i,t.helpers.grid);break;case"openKey":t.openKey=n,g0(t.keyDown,n)}},t.handlerHistory=function(a){const n={list:[],reList:[],index:-1};return a.drag_change_callback=function(o){n.index=-1;const{list:l,reList:h}=n,{object:c}=a;o?l.push({object:c,transform:go(c)}):h.push({object:c,transform:go(c)})},n}(r)}function ZC(i){const{mode:e,openKey:t,selectPanelEnable:r,isTransformChildren:s,stats:a,helpers:n}=i;return{mode:e,openKey:t,selectPanelEnable:r,isTransformChildren:s,stats:qC(a),helpers:jC(n)}}function KC(i,e,t,r,s){s&&(r.mode=s.mode,r.openKey=s.openKey,r.selectPanelEnable=s.selectPanelEnable,s.openKey&&g0(r.keyDown,s.openKey),r.isTransformChildren=s.isTransformChildren,function(a,n){if(!n)return;const{showStats:o,statsMode:l}=n;a.showStats=o,a.statsMode=l,gd(a)}(t,s.stats),WC(i,e,r.helpers,s.helpers))}function QC(i,e,t,r,s){const{helpers:a}=r;s.add(r,"mode",r.modeList).name("").listen(),s.add(r,"isTransformChildren").name("").listen(),s.add(r,"selectPanelEnable").name("").listen(),s.add(r,"openKey").name("").listen().onChange(o=>g0(r.keyDown,o));const n={:()=>function(o,l){const h=l.addFolder("");h.open();const c={axies:"x",rotation:0,resetFn(){var m,g,_;(_=(g=(m=o.currentInfo)==null?void 0:m.currentRootModel)==null?void 0:g.rotation)==null||_.set(0,0,0)},setFn(){var m;(m=o.currentInfo)!=null&&m.currentRootModel&&(o.currentInfo.currentRootModel.rotation[this.axies]+=this.rotation/180*Math.PI)}};h.add(c,"axies",["x","y","z"]).name(""),h.add(c,"rotation").name(""),h.add(c,"resetFn").name(""),h.add(c,"setFn").name("");const u=l.addFolder(""),d={recordModel:null,recordFn(){var m;for(this.recordModel=(m=o.currentInfo)==null?void 0:m.currentRootModel;u.__controllers.length>0;)u.__controllers[0].remove();this.recordModel&&(u.open(),u.add(this.recordModel,"visible").name(""),u.add(this.recordModel,"name").name(""),u.add(this.recordModel,"id").name("id"),u.addFn(()=>{var g;return(g=o.currentInfo)==null?void 0:g.currentRootModel.position.copy(this.recordModel.position)}).name(""),u.addFn(()=>{var g;return(g=o.currentInfo)==null?void 0:g.currentRootModel.rotation.copy(this.recordModel.rotation)}).name(""),u.addFn(()=>{var g;return(g=o.currentInfo)==null?void 0:g.currentRootModel.scale.copy(this.recordModel.scale)}).name(""))},syncTransformList:[],syncTransformFn(){var m;if((m=o.currentInfo)!=null&&m.currentRootModel&&this.syncTransformList.indexOf(o.currentInfo.currentRootModel)===-1){p.open();const g=o.currentInfo.currentRootModel;this.syncTransformList.push(g);const _=p.addDateFolder(g.id);_.add(g,"visible").name(""),_.addFn(()=>{const y=this.syncTransformList.indexOf(g);y>-1&&this.syncTransformList.splice(y,1),p.removeFolder(_)}).name("")}}};l.add(d,"recordFn").name("#");const p=l.addFolder("");l.add(d,"syncTransformFn").name("#");const f=p.addFolder(""),v={position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:0,y:0,z:0},oldPosition:{x:0,y:0,z:0},oldRotation:{x:0,y:0,z:0},oldScale:{x:0,y:0,z:0}};return["x","y","z"].forEach(m=>f.add(v.position,m).name(""+m).onChange(g=>{d.syncTransformList.forEach(_=>_.position[m]+=g-v.oldPosition[m]),v.oldPosition[m]=g})),["x","y","z"].forEach(m=>f.add(v.rotation,m,-2*Math.PI,2*Math.PI).name(""+m).onChange(g=>{d.syncTransformList.forEach(_=>_.rotation[m]+=g-v.oldRotation[m]),v.oldRotation[m]=g})),["x","y","z"].forEach(m=>f.add(v.scale,m).step(.01).name(""+m).onChange(g=>{d.syncTransformList.forEach(_=>_.scale[m]+=_.scale[m]*(g-v.oldScale[m])),v.oldScale[m]=g})),l}(r,s.addDragFolder("")),:()=>function(o,l){return l.add(o,"showStats").name("").listen().onChange(()=>gd(o)),l.add(o,"statsMode",{fps:0,ms:1,mb:2}).name("").listen().onChange(()=>gd(o)),l}(t,s.addDragFolder("")),:()=>XC(i,e,a,s.addDragFolder(""))};for(const o in n)s.add(n,o);return{folder:s,panels:n}}function g0(i,e){e?document.addEventListener("keydown",i):document.removeEventListener("keydown",i)}function JC(i){if(!i)return;const{camera:e}=i;return{bias:i.bias,radius:i.radius,mapSize:i.mapSize,normalBias:i.normalBias,camera:e?{near:e.near,far:e.far,fov:e.fov,left:e.left,right:e.right,top:e.top,bottom:e.bottom}:null}}function $C(i){switch(i.type){case"DirectionalLight":return{target:{x:i.target.position.x,y:i.target.position.y,z:i.target.position.z}};case"PointLight":return{distance:i.distance,decay:i.decay,power:i.power};case"SpotLight":return{distance:i.distance,decay:i.decay,power:i.power,angle:i.angle,penumbra:i.penumbra};case"HemisphereLight":return{groundColor:i.groundColor};case"RectAreaLight":return{width:i.width,height:i.height,rotation:{x:i.rotation.x,y:i.rotation.y,z:i.rotation.z}}}}function v0(i,e={}){let t=null;switch(i){case"AmbientLight":default:t=eR(e);break;case"DirectionalLight":t=function(r={}){return new vh(r.color||16777215,r.intensity||1)}(e);break;case"PointLight":t=function(r={}){return new jo(r.color||16777215,r.intensity||1,r.distance||0,r.decay||0)}(e);break;case"SpotLight":t=function(r={}){return new gh(r.color||16777215,r.intensity||1,r.distance||0,r.angle||Math.PI/3,r.penumbra||0,r.decay||0)}(e);break;case"HemisphereLight":t=function(r={}){return new Rf(r.color||16777215,r.groundColor||0,r.intensity||1)}(e);break;case"RectAreaLight":t=function(r={}){return new Pf(r.color||16777215,r.intensity||1,r.width||100,r.height||100)}(e)}return t}function eR(i={}){return new qu(i.color||16777215,i.intensity||1)}function tR(i,e){e&&(i.name=e.name,i.visible=e.visible,i.color.set(e.color),i.intensity=e.intensity,i.castShadow=e.castShadow,i.position.set(e.position.x,e.position.y,e.position.z),function(t,r){if(!r)return;t.bias=r.bias,t.radius=r.radius,t.mapSize.set(r.mapSize.x,r.mapSize.y),t.normalBias=r.normalBias;const{camera:s}=r;s&&t.camera&&(Object.keys(s).forEach(a=>t.camera[a]=s[a]),t.camera.updateProjectionMatrix())}(i.shadow,e.shadow),function(t,r){if(r)switch(t.type){case"DirectionalLight":t.target.position.set(r.target.x,r.target.y,r.target.z);break;case"PointLight":t.distance=r.distance,t.decay=r.decay,t.power=r.power;break;case"SpotLight":t.distance=r.distance,t.decay=r.decay,t.power=r.power,t.angle=r.angle,t.penumbra=r.penumbra;break;case"HemisphereLight":t.groundColor.set(r.groundColor);break;case"RectAreaLight":t.width=r.width,t.height=r.height,t.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z)}}(i,e))}function Gy(i,e,t){if(e.add(i,"visible").name(""),e.add(i,"name").name(""),e.addHexColor(i.color).name(""),e.add(i,"intensity").name(""),e.addFn(()=>t.attach(i)).name(""),e.addFn(()=>{const a=i.parent;i.target&&a.remove(i.target),a.remove(i),i.dispose(),e.parent.removeFolder(e)}).name(""),i.shadow){e.add(i,"castShadow").name("");const a=e.addFolder("");(function(n,o){o.add(n,"bias").name(""),o.add(n,"radius").name(""),o.add(n,"normalBias").name(""),o.add(n.mapSize,"width").name(""),o.add(n.mapSize,"height").name("");const l=o.addFolder(""),h=()=>n.camera.updateProjectionMatrix();l.add(n.camera,"near").name("").onChange(h),l.add(n.camera,"far").name("").onChange(h),n.camera.isOrthographicCamera?(l.add(n.camera,"left").name("").onChange(h),l.add(n.camera,"right").name("").onChange(h),l.add(n.camera,"top").name("").onChange(h),l.add(n.camera,"bottom").name("").onChange(h)):l.add(n.camera,"fov").name("").onChange(h)})(i.shadow,a)}const r=e.addFolder("");r.add(i.position,"x").name("X"),r.add(i.position,"y").name("y"),r.add(i.position,"z").name("z");const s=e.addFolder("");(function(a,n,o){switch(n.type){case"DirectionalLight":o.add(n.target.position,"x").name("X").listen(),o.add(n.target.position,"y").name("Y").listen(),o.add(n.target.position,"z").name("Z").listen(),o.addFn(()=>a.attach(n.target)).name("");break;case"PointLight":o.add(n,"distance").name(""),o.add(n,"decay").name(""),o.add(n,"power").name("");break;case"SpotLight":o.add(n,"distance").name(""),o.add(n,"decay").name(""),o.add(n,"power").name(""),o.add(n,"angle").name(""),o.add(n,"penumbra").name("");break;case"HemisphereLight":o.addHexColor(n.groundColor).name("");break;case"RectAreaLight":o.add(n.rotation,"x").name("X").min(-Math.PI/2).max(Math.PI/2),o.add(n.rotation,"y").name("y").min(-Math.PI/2).max(Math.PI/2),o.add(n.rotation,"z").name("z").min(-Math.PI/2).max(Math.PI/2),o.add(n,"width").name(""),o.add(n,"height").name("")}})(t,i,s)}function iR(i){return i.map(e=>function(t){const{name:r,type:s,visible:a,position:n,color:o,intensity:l,castShadow:h,shadow:c}=t;return Ae({name:r,type:s,visible:a,position:n,color:o,intensity:l,castShadow:h,shadow:JC(c)},$C(t))}(e))}var pr=Uint8Array,th=Uint16Array,rR=Int32Array,Sb=new pr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tb=new pr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sR=new pr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ab=function(i,e){for(var t=new th(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];var s=new rR(t[30]);for(r=1;r<30;++r)for(var a=t[r];a<t[r+1];++a)s[a]=a-t[r]<<5|r;return{b:t,r:s}},Eb=Ab(Sb,2),Cb=Eb.b,aR=Eb.r;Cb[28]=258,aR[258]=28;for(var nR=Ab(Tb,0).b,Rb=new th(32768),gt=0;gt<32768;++gt){var ja=(43690&gt)>>1|(21845&gt)<<1;ja=(61680&(ja=(52428&ja)>>2|(13107&ja)<<2))>>4|(3855&ja)<<4,Rb[gt]=((65280&ja)>>8|(255&ja)<<8)>>1}var ih=function(i,e,t){for(var r=i.length,s=0,a=new th(e);s<r;++s)i[s]&&++a[i[s]-1];var n,o=new th(e);for(s=1;s<e;++s)o[s]=o[s-1]+a[s-1]<<1;{n=new th(1<<e);var l=15-e;for(s=0;s<r;++s)if(i[s])for(var h=s<<4|i[s],c=e-i[s],u=o[i[s]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)n[Rb[u]>>l]=h}return n},$h=new pr(288);for(gt=0;gt<144;++gt)$h[gt]=8;for(gt=144;gt<256;++gt)$h[gt]=9;for(gt=256;gt<280;++gt)$h[gt]=7;for(gt=280;gt<288;++gt)$h[gt]=8;var Pb=new pr(32);for(gt=0;gt<32;++gt)Pb[gt]=5;var oR=ih($h,9),lR=ih(Pb,5),Sm=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Sr=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(7&e)&t},Tm=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(7&e)},hR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Er=function(i,e,t){var r=new Error(e||hR[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,Er),!t)throw r;return r},cR=function(i,e,t,r){var s=i.length;if(!s||e.f&&!e.l)return t||new pr(0);var a=!t,n=a||e.i!=2,o=e.i;a&&(t=new pr(3*s));var l=function(B){var A=t.length;if(B>A){var k=new pr(Math.max(2*A,B));k.set(t),t=k}},h=e.f||0,c=e.p||0,u=e.b||0,d=e.l,p=e.d,f=e.m,v=e.n,m=8*s;do{if(!d){h=Sr(i,c,1);var g=Sr(i,c+1,3);if(c+=3,!g){var _=i[(D=4+((c+7)/8|0))-4]|i[D-3]<<8,y=D+_;if(y>s){o&&Er(0);break}n&&l(u+_),t.set(i.subarray(D,y),u),e.b=u+=_,e.p=c=8*y,e.f=h;continue}if(g==1)d=oR,p=lR,f=9,v=5;else if(g==2){var x=Sr(i,c,31)+257,M=Sr(i,c+10,15)+4,b=x+Sr(i,c+5,31)+1;c+=14;for(var w=new pr(b),T=new pr(19),R=0;R<M;++R)T[sR[R]]=Sr(i,c+3*R,7);c+=3*M;var I=Sm(T),E=(1<<I)-1,L=ih(T,I);for(R=0;R<b;){var D,U=L[Sr(i,c,E)];if(c+=15&U,(D=U>>4)<16)w[R++]=D;else{var H=0,Z=0;for(D==16?(Z=3+Sr(i,c,3),c+=2,H=w[R-1]):D==17?(Z=3+Sr(i,c,7),c+=3):D==18&&(Z=11+Sr(i,c,127),c+=7);Z--;)w[R++]=H}}var te=w.subarray(0,x),ie=w.subarray(x);f=Sm(te),v=Sm(ie),d=ih(te,f),p=ih(ie,v)}else Er(1);if(c>m){o&&Er(0);break}}n&&l(u+131072);for(var ve=(1<<f)-1,be=(1<<v)-1,J=c;;J=c){var ne=(H=d[Tm(i,c)&ve])>>4;if((c+=15&H)>m){o&&Er(0);break}if(H||Er(2),ne<256)t[u++]=ne;else{if(ne==256){J=c,d=null;break}var de=ne-254;if(ne>264){var re=Sb[R=ne-257];de=Sr(i,c,(1<<re)-1)+Cb[R],c+=re}var N=p[Tm(i,c)&be],P=N>>4;if(N||Er(3),c+=15&N,ie=nR[P],P>3&&(re=Tb[P],ie+=Tm(i,c)&(1<<re)-1,c+=re),c>m){o&&Er(0);break}n&&l(u+131072);var j=u+de;if(u<ie){var K=0-ie,O=Math.min(ie,j);for(K+u<0&&Er(3);u<O;++u)t[u]=r[K+u]}for(;u<j;++u)t[u]=t[u-ie]}}e.l=d,e.p=J,e.b=u,e.f=h,d&&(h=1,e.m=f,e.d=p,e.n=v)}while(!h);return u!=t.length&&a?function(B,A,k){return(k==null||k>B.length)&&(k=B.length),new pr(B.subarray(A,k))}(t,0,u):t.subarray(0,u)},uR=new pr(0);function dR(i,e){return cR(i.subarray((r=e,((15&(t=i)[0])!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Er(6,"invalid zlib data"),(t[1]>>5&1)==+!r&&Er(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)),-4),{i:2},e,e);var t,r}var pR=typeof TextDecoder<"u"&&new TextDecoder;try{pR.decode(uR,{stream:!0})}catch{}function Ib(i,e,t){const r=t.length-i-1;if(e>=t[r])return r-1;if(e<=t[i])return i;let s=i,a=r,n=Math.floor((s+a)/2);for(;e<t[n]||e>=t[n+1];)e<t[n]?a=n:s=n,n=Math.floor((s+a)/2);return n}function mR(i,e){let t=1;for(let s=2;s<=i;++s)t*=s;let r=1;for(let s=2;s<=e;++s)r*=s;for(let s=2;s<=i-e;++s)r*=s;return t/r}function fR(i,e,t,r,s){const a=function(n,o,l,h,c){const u=c<n?c:n,d=[],p=Ib(n,h,o),f=function(m,g,_,y,x){const M=[];for(let E=0;E<=_;++E)M[E]=0;const b=[];for(let E=0;E<=y;++E)b[E]=M.slice(0);const w=[];for(let E=0;E<=_;++E)w[E]=M.slice(0);w[0][0]=1;const T=M.slice(0),R=M.slice(0);for(let E=1;E<=_;++E){T[E]=g-x[m+1-E],R[E]=x[m+E]-g;let L=0;for(let D=0;D<E;++D){const U=R[D+1],H=T[E-D];w[E][D]=U+H;const Z=w[D][E-1]/w[E][D];w[D][E]=L+U*Z,L=H*Z}w[E][E]=L}for(let E=0;E<=_;++E)b[0][E]=w[E][_];for(let E=0;E<=_;++E){let L=0,D=1;const U=[];for(let H=0;H<=_;++H)U[H]=M.slice(0);U[0][0]=1;for(let H=1;H<=y;++H){let Z=0;const te=E-H,ie=_-H;E>=H&&(U[D][0]=U[L][0]/w[ie+1][te],Z=U[D][0]*w[te][ie]);const ve=E-1<=ie?H-1:_-E;for(let J=te>=-1?1:-te;J<=ve;++J)U[D][J]=(U[L][J]-U[L][J-1])/w[ie+1][te+J],Z+=U[D][J]*w[te+J][ie];E<=ie&&(U[D][H]=-U[L][H-1]/w[ie+1][E],Z+=U[D][H]*w[E][ie]),b[H][E]=Z;const be=L;L=D,D=be}}let I=_;for(let E=1;E<=y;++E){for(let L=0;L<=_;++L)b[E][L]*=I;I*=_-E}return b}(p,h,n,u,o),v=[];for(let m=0;m<l.length;++m){const g=l[m].clone(),_=g.w;g.x*=_,g.y*=_,g.z*=_,v[m]=g}for(let m=0;m<=u;++m){const g=v[p-n].clone().multiplyScalar(f[m][0]);for(let _=1;_<=n;++_)g.add(v[p-n+_].clone().multiplyScalar(f[m][_]));d[m]=g}for(let m=u+1;m<=c+1;++m)d[m]=new Ve(0,0,0);return d}(i,e,t,r,s);return function(n){const o=n.length,l=[],h=[];for(let u=0;u<o;++u){const d=n[u];l[u]=new S(d.x,d.y,d.z),h[u]=d.w}const c=[];for(let u=0;u<o;++u){const d=l[u].clone();for(let p=1;p<=u;++p)d.sub(c[u-p].clone().multiplyScalar(mR(u,p)*h[p]));c[u]=d.divideScalar(h[0])}return c}(a)}class gR extends _r{constructor(e,t,r,s,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=a||this.knots.length-1;for(let n=0;n<r.length;++n){const o=r[n];this.controlPoints[n]=new Ve(o.x,o.y,o.z,o.w)}}getPoint(e,t=new S){const r=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(n,o,l,h){const c=Ib(n,h,o),u=function(p,f,v,m){const g=[],_=[],y=[];g[0]=1;for(let x=1;x<=v;++x){_[x]=f-m[p+1-x],y[x]=m[p+x]-f;let M=0;for(let b=0;b<x;++b){const w=y[b+1],T=_[x-b],R=g[b]/(w+T);g[b]=M+w*R,M=T*R}g[x]=M}return g}(c,h,n,o),d=new Ve(0,0,0,0);for(let p=0;p<=n;++p){const f=l[c-n+p],v=u[p],m=f.w*v;d.x+=f.x*m,d.y+=f.y*m,d.z+=f.z*m,d.w+=f.w*v}return d}(this.degree,this.knots,this.controlPoints,s);return a.w!==1&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t=new S){const r=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=fR(this.degree,this.knots,this.controlPoints,s,1);return r.copy(a[1]).normalize(),r}}let We,kt,Ci;class vR extends It{constructor(e){super(e)}load(e,t,r,s){const a=this,n=a.path===""?Jr.extractUrlBase(e):a.path,o=new fi(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(l){try{t(a.parse(l,n))}catch(h){s&&s(h),a.manager.itemError(e)}},r,s)}parse(e,t){if(function(s){const a="Kaydara FBX Binary  \0";return s.byteLength>=a.length&&a===Xy(s,0,a.length)}(e))We=new bR().parse(e);else{const s=Xy(e);if(!function(a){const n=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let o=0;function l(h){const c=a[h-1];return a=a.slice(o+h),o++,c}for(let h=0;h<n.length;++h)if(l(1)===n[h])return!1;return!0}(s))throw new Error("THREE.FBXLoader: Unknown format.");if(Wy(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Wy(s));We=new MR().parse(s)}const r=new is(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new _R(r,this.manager).parse(We)}}class _R{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){kt=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),s=this.parseDeformers(),a=new yR().parse(s);return this.parseScene(s,a,r),Ci}parseConnections(){const e=new Map;return"Connections"in We&&We.Connections.connections.forEach(function(t){const r=t[0],s=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const n={ID:s,relationship:a};e.get(r).parents.push(n),e.has(s)||e.set(s,{parents:[],children:[]});const o={ID:r,relationship:a};e.get(s).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in We.Objects){const r=We.Objects.Video;for(const s in r){const a=r[s];if(e[parseInt(s)]=a.RelativeFilename||a.Filename,"Content"in a){const n=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,o=typeof a.Content=="string"&&a.Content!=="";if(n||o){const l=this.parseImage(r[s]);t[a.RelativeFilename||a.Filename]=l}}}}for(const r in e){const s=e[r];t[s]!==void 0?e[r]=t[s]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename;let s;switch(r.slice(r.lastIndexOf(".")+1).toLowerCase()){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga"),s="image/tga";break;default:return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in We.Objects){const r=We.Objects.Texture;for(const s in r){const a=this.parseTexture(r[s],e);t.set(parseInt(s),a)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const s=e.WrapModeU,a=e.WrapModeV,n=s!==void 0?s.value:0,o=a!==void 0?a.value:0;if(r.wrapS=n===0?jt:gi,r.wrapT=o===0?jt:gi,"Scaling"in e){const l=e.Scaling.value;r.repeat.x=l[0],r.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;r.offset.x=l[0],r.offset.y=l[1]}return r}loadTexture(e,t){let r;const s=this.textureLoader.path,a=kt.get(e.id).children;let n;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(r=t[a[0].ID],r.indexOf("blob:")!==0&&r.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?n=new pt:(l.setPath(this.textureLoader.path),n=l.load(r))}else if(o==="dds"){const l=this.manager.getHandler(".dds");l===null?n=new pt:(l.setPath(this.textureLoader.path),n=l.load(r))}else n=o==="psd"?new pt:this.textureLoader.load(r);return this.textureLoader.setPath(s),n}parseMaterials(e){const t=new Map;if("Material"in We.Objects){const r=We.Objects.Material;for(const s in r){const a=this.parseMaterial(r[s],e);a!==null&&t.set(parseInt(s),a)}}return t}parseMaterial(e,t){const r=e.id,s=e.attrName;let a=e.ShadingModel;if(typeof a=="object"&&(a=a.value),!kt.has(r))return null;const n=this.parseParameters(e,t,r);let o;switch(a.toLowerCase()){case"phong":default:o=new An;break;case"lambert":o=new Wd}return o.setValues(n),o.name=s,o}parseParameters(e,t,r){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new oe().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(s.color=new oe().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new oe().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(s.emissive=new oe().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new oe().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new oe().fromArray(e.SpecularColor.value).convertSRGBToLinear());const a=this;return kt.get(r).children.forEach(function(n){switch(n.relationship){case"Bump":s.bumpMap=a.getTexture(t,n.ID);break;case"Maya|TEX_ao_map":s.aoMap=a.getTexture(t,n.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=a.getTexture(t,n.ID),s.map!==void 0&&(s.map.colorSpace=ft);break;case"DisplacementColor":s.displacementMap=a.getTexture(t,n.ID);break;case"EmissiveColor":s.emissiveMap=a.getTexture(t,n.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=ft);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=a.getTexture(t,n.ID);break;case"ReflectionColor":s.envMap=a.getTexture(t,n.ID),s.envMap!==void 0&&(s.envMap.mapping=Io,s.envMap.colorSpace=ft);break;case"SpecularColor":s.specularMap=a.getTexture(t,n.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=ft);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=a.getTexture(t,n.ID),s.transparent=!0}}),s}getTexture(e,t){return"LayeredTexture"in We.Objects&&t in We.Objects.LayeredTexture&&(t=kt.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in We.Objects){const r=We.Objects.Deformer;for(const s in r){const a=r[s],n=kt.get(parseInt(s));if(a.attrType==="Skin"){const o=this.parseSkeleton(n,r);o.ID=s,n.parents.length,o.geometryID=n.parents[0].ID,e[s]=o}else if(a.attrType==="BlendShape"){const o={id:s};o.rawTargets=this.parseMorphTargets(n,r),o.id=s,n.parents.length,t[s]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach(function(s){const a=t[s.ID];if(a.attrType!=="Cluster")return;const n={ID:s.ID,indices:[],weights:[],transformLink:new me().fromArray(a.TransformLink.a)};"Indexes"in a&&(n.indices=a.Indexes.a,n.weights=a.Weights.a),r.push(n)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let s=0;s<e.children.length;s++){const a=e.children[s],n=t[a.ID],o={name:n.attrName,initialWeight:n.DeformPercent,id:n.id,fullWeights:n.FullWeights.a};if(n.attrType!=="BlendShapeChannel")return;o.geoID=kt.get(parseInt(a.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,r.push(o)}return r}parseScene(e,t,r){Ci=new vi;const s=this.parseModels(e.skeletons,t,r),a=We.Objects.Model,n=this;s.forEach(function(l){const h=a[l.ID];n.setLookAtProperties(l,h),kt.get(l.ID).parents.forEach(function(c){const u=s.get(c.ID);u!==void 0&&u.add(l)}),l.parent===null&&Ci.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Ci.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const h=Nb(l.userData.transformData);l.applyMatrix4(h),l.updateWorldMatrix()}});const o=new xR().parse();Ci.children.length===1&&Ci.children[0].isGroup&&(Ci.children[0].animations=o,Ci=Ci.children[0]),Ci.animations=o}parseModels(e,t,r){const s=new Map,a=We.Objects.Model;for(const n in a){const o=parseInt(n),l=a[n],h=kt.get(o);let c=this.buildSkeleton(h,e,o,l.attrName);if(!c){switch(l.attrType){case"Camera":c=this.createCamera(h);break;case"Light":c=this.createLight(h);break;case"Mesh":c=this.createMesh(h,t,r);break;case"NurbsCurve":c=this.createCurve(h,t);break;case"LimbNode":case"Root":c=new zo;break;default:c=new vi}c.name=l.attrName?qe.sanitizeNodeName(l.attrName):"",c.userData.originalName=l.attrName,c.ID=o}this.getTransformData(c,l),s.set(o,c)}return s}buildSkeleton(e,t,r,s){let a=null;return e.parents.forEach(function(n){for(const o in t){const l=t[o];l.rawBones.forEach(function(h,c){if(h.ID===n.ID){const u=a;a=new zo,a.matrixWorld.copy(h.transformLink),a.name=s?qe.sanitizeNodeName(s):"",a.userData.originalName=s,a.ID=r,l.bones[c]=a,u!==null&&a.add(u)}})}}),a}createCamera(e){let t,r;if(e.children.forEach(function(s){const a=We.Objects.NodeAttribute[s.ID];a!==void 0&&(r=a)}),r===void 0)t=new Ue;else{let s=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(s=1);let a=1;r.NearPlane!==void 0&&(a=r.NearPlane.value/1e3);let n=1e3;r.FarPlane!==void 0&&(n=r.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(o=r.AspectWidth.value,l=r.AspectHeight.value);const h=o/l;let c=45;r.FieldOfView!==void 0&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(s){case 0:t=new Gt(c,h,a,n),u!==null&&t.setFocalLength(u);break;case 1:t=new wn(-o/2,o/2,l/2,-l/2,a,n);break;default:t=new Ue}}return t}createLight(e){let t,r;if(e.children.forEach(function(s){const a=We.Objects.NodeAttribute[s.ID];a!==void 0&&(r=a)}),r===void 0)t=new Ue;else{let s;s=r.LightType===void 0?0:r.LightType.value;let a=16777215;r.Color!==void 0&&(a=new oe().fromArray(r.Color.value).convertSRGBToLinear());let n=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(n=0);let o=0;r.FarAttenuationEnd!==void 0&&(o=r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?0:r.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new jo(a,n,o,l);break;case 1:t=new vh(a,n);break;case 2:let h=Math.PI/3;r.InnerAngle!==void 0&&(h=ti.degToRad(r.InnerAngle.value));let c=0;r.OuterAngle!==void 0&&(c=ti.degToRad(r.OuterAngle.value),c=Math.max(c,1)),t=new gh(a,n,o,h,c,l);break;default:t=new jo(a,n)}r.CastShadows!==void 0&&r.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,r){let s,a=null,n=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(a=t.get(l.ID)),r.has(l.ID)&&o.push(r.get(l.ID))}),o.length>1?n=o:o.length>0?n=o[0]:(n=new An({name:It.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(n)),"color"in a.attributes&&o.forEach(function(l){l.vertexColors=!0}),a.FBX_Deformer?(s=new Gu(a,n),s.normalizeSkinWeights()):s=new ue(a,n),s}createCurve(e,t){const r=e.children.reduce(function(a,n){return t.has(n.ID)&&(a=t.get(n.ID)),a},null),s=new Bt({name:It.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new oi(r,s)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?Db(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&kt.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=We.Objects.Model[r.ID];if("Lcl_Translation"in s){const a=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),Ci.add(e.target)):e.lookAt(new S().fromArray(a))}}})}bindSkeleton(e,t,r){const s=this.parsePoseNodes();for(const a in e){const n=e[a];kt.get(parseInt(n.ID)).parents.forEach(function(o){if(t.has(o.ID)){const l=o.ID;kt.get(l).parents.forEach(function(h){r.has(h.ID)&&r.get(h.ID).bind(new Vo(n.bones),s[h.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in We.Objects){const t=We.Objects.Pose;for(const r in t)if(t[r].attrType==="BindPose"&&t[r].NbPoseNodes>0){const s=t[r].PoseNode;Array.isArray(s)?s.forEach(function(a){e[a.Node]=new me().fromArray(a.Matrix.a)}):e[s.Node]=new me().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in We){if("AmbientColor"in We.GlobalSettings){const e=We.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],s=e[2];if(t!==0||r!==0||s!==0){const a=new oe(t,r,s).convertSRGBToLinear();Ci.add(new qu(a,1))}}"UnitScaleFactor"in We.GlobalSettings&&(Ci.userData.unitScaleFactor=We.GlobalSettings.UnitScaleFactor.value)}}}class yR{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in We.Objects){const r=We.Objects.Geometry;for(const s in r){const a=kt.get(parseInt(s)),n=this.parseGeometry(a,r[s],e);t.set(parseInt(s),n)}}return this.negativeMaterialIndices,t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const s=r.skeletons,a=[],n=e.parents.map(function(u){return We.Objects.Model[u.ID]});if(n.length===0)return;const o=e.children.reduce(function(u,d){return s[d.ID]!==void 0&&(u=s[d.ID]),u},null);e.children.forEach(function(u){r.morphTargets[u.ID]!==void 0&&a.push(r.morphTargets[u.ID])});const l=n[0],h={};"RotationOrder"in l&&(h.eulerOrder=Db(l.RotationOrder.value)),"InheritType"in l&&(h.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(h.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(h.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(h.scale=l.GeometricScaling.value);const c=Nb(h);return this.genGeometry(t,o,a,c)}genGeometry(e,t,r,s){const a=new Re;e.attrName&&(a.name=e.attrName);const n=this.parseGeoNode(e,t),o=this.genBuffers(n),l=new _e(o.vertex,3);if(l.applyMatrix4(s),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new _e(o.colors,3)),t&&(a.setAttribute("skinIndex",new Ld(o.weightsIndices,4)),a.setAttribute("skinWeight",new _e(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){const h=new De().getNormalMatrix(s),c=new _e(o.normal,3);c.applyNormalMatrix(h),a.setAttribute("normal",c)}if(o.uvs.forEach(function(h,c){const u=c===0?"uv":`uv${c}`;a.setAttribute(u,new _e(o.uvs[c],2))}),n.material&&n.material.mappingType!=="AllSame"){let h=o.materialIndex[0],c=0;if(o.materialIndex.forEach(function(u,d){u!==h&&(a.addGroup(c,d-c,h),h=u,c=d)}),a.groups.length>0){const u=a.groups[a.groups.length-1],d=u.start+u.count;d!==o.materialIndex.length&&a.addGroup(d,o.materialIndex.length-d,h)}a.groups.length===0&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,r,s),a}parseGeoNode(e,t){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return r.weightTable={},t!==null&&(r.skeleton=t,t.rawBones.forEach(function(s,a){s.indices.forEach(function(n,o){r.weightTable[n]===void 0&&(r.weightTable[n]=[]),r.weightTable[n].push({id:a,weight:s.weights[o]})})})),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,s=0,a=[],n=[],o=[],l=[],h=[],c=[];const u=this;return e.vertexIndices.forEach(function(d,p){let f,v=!1;d<0&&(d=~d,v=!0);let m=[],g=[];if(a.push(3*d,3*d+1,3*d+2),e.color){const _=pu(p,r,d,e.color);o.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(_){g.push(_.weight),m.push(_.id)}),g.length>4){const _=[0,0,0,0],y=[0,0,0,0];g.forEach(function(x,M){let b=x,w=m[M];y.forEach(function(T,R,I){if(b>T){I[R]=b,b=T;const E=_[R];_[R]=w,w=E}})}),m=_,g=y}for(;g.length<4;)g.push(0),m.push(0);for(let _=0;_<4;++_)h.push(g[_]),c.push(m[_])}if(e.normal){const _=pu(p,r,d,e.normal);n.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(f=pu(p,r,d,e.material)[0],f<0&&(u.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach(function(_,y){const x=pu(p,r,d,_);l[y]===void 0&&(l[y]=[]),l[y].push(x[0]),l[y].push(x[1])}),s++,v&&(u.genFace(t,e,a,f,n,o,l,h,c,s),r++,s=0,a=[],n=[],o=[],l=[],h=[],c=[])}),t}getNormalNewell(e){const t=new S(0,0,0);for(let r=0;r<e.length;r++){const s=e[r],a=e[(r+1)%e.length];t.x+=(s.y-a.y)*(s.z+a.z),t.y+=(s.z-a.z)*(s.x+a.x),t.z+=(s.x-a.x)*(s.y+a.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new S(0,1,0):new S(0,0,1)).cross(t).normalize(),s=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:s}}flattenVertex(e,t,r){return new X(e.dot(t),e.dot(r))}genFace(e,t,r,s,a,n,o,l,h,c){let u;if(c>3){const d=[],p=t.baseVertexPositions||t.vertexPositions;for(let g=0;g<r.length;g+=3)d.push(new S(p[r[g]],p[r[g+1]],p[r[g+2]]));const{tangent:f,bitangent:v}=this.getNormalTangentAndBitangent(d),m=[];for(const g of d)m.push(this.flattenVertex(g,f,v));u=Ir.triangulateShape(m,[])}else u=[[0,1,2]];for(const[d,p,f]of u)e.vertex.push(t.vertexPositions[r[3*d]]),e.vertex.push(t.vertexPositions[r[3*d+1]]),e.vertex.push(t.vertexPositions[r[3*d+2]]),e.vertex.push(t.vertexPositions[r[3*p]]),e.vertex.push(t.vertexPositions[r[3*p+1]]),e.vertex.push(t.vertexPositions[r[3*p+2]]),e.vertex.push(t.vertexPositions[r[3*f]]),e.vertex.push(t.vertexPositions[r[3*f+1]]),e.vertex.push(t.vertexPositions[r[3*f+2]]),t.skeleton&&(e.vertexWeights.push(l[4*d]),e.vertexWeights.push(l[4*d+1]),e.vertexWeights.push(l[4*d+2]),e.vertexWeights.push(l[4*d+3]),e.vertexWeights.push(l[4*p]),e.vertexWeights.push(l[4*p+1]),e.vertexWeights.push(l[4*p+2]),e.vertexWeights.push(l[4*p+3]),e.vertexWeights.push(l[4*f]),e.vertexWeights.push(l[4*f+1]),e.vertexWeights.push(l[4*f+2]),e.vertexWeights.push(l[4*f+3]),e.weightsIndices.push(h[4*d]),e.weightsIndices.push(h[4*d+1]),e.weightsIndices.push(h[4*d+2]),e.weightsIndices.push(h[4*d+3]),e.weightsIndices.push(h[4*p]),e.weightsIndices.push(h[4*p+1]),e.weightsIndices.push(h[4*p+2]),e.weightsIndices.push(h[4*p+3]),e.weightsIndices.push(h[4*f]),e.weightsIndices.push(h[4*f+1]),e.weightsIndices.push(h[4*f+2]),e.weightsIndices.push(h[4*f+3])),t.color&&(e.colors.push(n[3*d]),e.colors.push(n[3*d+1]),e.colors.push(n[3*d+2]),e.colors.push(n[3*p]),e.colors.push(n[3*p+1]),e.colors.push(n[3*p+2]),e.colors.push(n[3*f]),e.colors.push(n[3*f+1]),e.colors.push(n[3*f+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(a[3*d]),e.normal.push(a[3*d+1]),e.normal.push(a[3*d+2]),e.normal.push(a[3*p]),e.normal.push(a[3*p+1]),e.normal.push(a[3*p+2]),e.normal.push(a[3*f]),e.normal.push(a[3*f+1]),e.normal.push(a[3*f+2])),t.uv&&t.uv.forEach(function(v,m){e.uvs[m]===void 0&&(e.uvs[m]=[]),e.uvs[m].push(o[m][2*d]),e.uvs[m].push(o[m][2*d+1]),e.uvs[m].push(o[m][2*p]),e.uvs[m].push(o[m][2*p+1]),e.uvs[m].push(o[m][2*f]),e.uvs[m].push(o[m][2*f+1])})}addMorphTargets(e,t,r,s){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;r.forEach(function(n){n.rawTargets.forEach(function(o){const l=We.Objects.Geometry[o.geoID];l!==void 0&&a.genMorphGeometry(e,t,l,s,o.name)})})}genMorphGeometry(e,t,r,s,a){const n=t.Vertices!==void 0?t.Vertices.a:[],o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=r.Vertices!==void 0?r.Vertices.a:[],h=r.Indexes!==void 0?r.Indexes.a:[],c=3*e.attributes.position.count,u=new Float32Array(c);for(let v=0;v<h.length;v++){const m=3*h[v];u[m]=l[3*v],u[m+1]=l[3*v+1],u[m+2]=l[3*v+2]}const d={vertexIndices:o,vertexPositions:u,baseVertexPositions:n},p=this.genBuffers(d),f=new _e(p.vertex,3);f.name=a||r.attrName,f.applyMatrix4(s),e.morphAttributes.position.push(f)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Normals.a;let a=[];return r==="IndexToDirect"&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:a,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.UV.a;let a=[];return r==="IndexToDirect"&&(a=e.UVIndex.a),{dataSize:2,buffer:s,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Colors.a;let a=[];r==="IndexToDirect"&&(a=e.ColorIndex.a);for(let n=0,o=new oe;n<s.length;n+=4)o.fromArray(s,n).convertSRGBToLinear().toArray(s,n);return{dataSize:4,buffer:s,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const s=e.Materials.a,a=[];for(let n=0;n<s.length;++n)a.push(n);return{dataSize:1,buffer:s,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return new Re;const r=t-1,s=e.KnotVector.a,a=[],n=e.Points.a;for(let c=0,u=n.length;c<u;c+=4)a.push(new Ve().fromArray(n,c));let o,l;if(e.Form==="Closed")a.push(a[0]);else if(e.Form==="Periodic"){o=r,l=s.length-1-o;for(let c=0;c<r;++c)a.push(a[c])}const h=new gR(r,s,a,o,l).getPoints(12*a.length);return new Re().setFromPoints(h)}}class xR{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const r in t){const s=t[r],a=this.addClip(s);e.push(a)}return e}parseClips(){if(We.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=We.Objects.AnimationCurveNode,t=new Map;for(const r in e){const s=e[r];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const a={id:s.id,attr:s.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){const t=We.Objects.AnimationCurve;for(const r in t){const s={id:t[r].id,times:t[r].KeyTime.a.map(wR),values:t[r].KeyValueFloat.a},a=kt.get(s.id);if(a!==void 0){const n=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(n).curves.x=s:o.match(/Y/)?e.get(n).curves.y=s:o.match(/Z/)?e.get(n).curves.z=s:o.match(/DeformPercent/)&&e.has(n)&&(e.get(n).curves.morph=s)}}}parseAnimationLayers(e){const t=We.Objects.AnimationLayer,r=new Map;for(const s in t){const a=[],n=kt.get(parseInt(s));n!==void 0&&(n.children.forEach(function(o,l){if(e.has(o.ID)){const h=e.get(o.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(a[l]===void 0){const c=kt.get(o.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(c!==void 0){const u=We.Objects.Model[c.toString()];if(u===void 0)return;const d={modelName:u.attrName?qe.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ci.traverse(function(p){p.ID===u.id&&(d.transform=p.matrix,p.userData.transformData&&(d.eulerOrder=p.userData.transformData.eulerOrder))}),d.transform||(d.transform=new me),"PreRotation"in u&&(d.preRotation=u.PreRotation.value),"PostRotation"in u&&(d.postRotation=u.PostRotation.value),a[l]=d}}a[l]&&(a[l][h.attr]=h)}else if(h.curves.morph!==void 0){if(a[l]===void 0){const c=kt.get(o.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,u=kt.get(c).parents[0].ID,d=kt.get(u).parents[0].ID,p=kt.get(d).parents[0].ID,f=We.Objects.Model[p],v={modelName:f.attrName?qe.sanitizeNodeName(f.attrName):"",morphName:We.Objects.Deformer[c].attrName};a[l]=v}a[l][h.attr]=h}}}),r.set(parseInt(s),a))}return r}parseAnimStacks(e){const t=We.Objects.AnimationStack,r={};for(const s in t){const a=kt.get(parseInt(s)).children;a.length;const n=e.get(a[0].ID);r[s]={name:t[s].attrName,layer:n}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach(function(s){t=t.concat(r.generateTracks(s))}),new dn(e.name,-1,t)}generateTracks(e){const t=[];let r=new S,s=new S;if(e.transform&&e.transform.decompose(r,new Ke,s),r=r.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,r,s){const a=this.getTimesForAllAxes(t),n=this.getKeyframeTrackValues(a,t,r);return new va(e+"."+s,a,n)}generateRotationTrack(e,t,r,s,a){let n,o;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const u=this.interpolateRotations(t.x,t.y,t.z,a);n=u[0],o=u[1]}r!==void 0&&((r=r.map(ti.degToRad)).push(a),r=new yt().fromArray(r),r=new Ke().setFromEuler(r)),s!==void 0&&((s=s.map(ti.degToRad)).push(a),s=new yt().fromArray(s),s=new Ke().setFromEuler(s).invert());const l=new Ke,h=new yt,c=[];if(!o||!n)return new Rs(e+".quaternion",[0],[0]);for(let u=0;u<o.length;u+=3)h.set(o[u],o[u+1],o[u+2],a),l.setFromEuler(h),r!==void 0&&l.premultiply(r),s!==void 0&&l.multiply(s),u>2&&new Ke().fromArray(c,(u-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(c,u/3*4);return new Rs(e+".quaternion",n,c)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map(function(a){return a/100}),s=Ci.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ga(e.modelName+".morphTargetInfluences["+s+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(r,s){return r-s}),t.length>1){let r=1,s=t[0];for(let a=1;a<t.length;a++){const n=t[a];n!==s&&(t[r]=n,s=n,r++)}t=t.slice(0,r)}return t}getKeyframeTrackValues(e,t,r){const s=r,a=[];let n=-1,o=-1,l=-1;return e.forEach(function(h){if(t.x&&(n=t.x.times.indexOf(h)),t.y&&(o=t.y.times.indexOf(h)),t.z&&(l=t.z.times.indexOf(h)),n!==-1){const c=t.x.values[n];a.push(c),s[0]=c}else a.push(s[0]);if(o!==-1){const c=t.y.values[o];a.push(c),s[1]=c}else a.push(s[1]);if(l!==-1){const c=t.z.values[l];a.push(c),s[2]=c}else a.push(s[2])}),a}interpolateRotations(e,t,r,s){const a=[],n=[];a.push(e.times[0]),n.push(ti.degToRad(e.values[0])),n.push(ti.degToRad(t.values[0])),n.push(ti.degToRad(r.values[0]));for(let o=1;o<e.values.length;o++){const l=[e.values[o-1],t.values[o-1],r.values[o-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const h=l.map(ti.degToRad),c=[e.values[o],t.values[o],r.values[o]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const u=c.map(ti.degToRad),d=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],p=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const f=Math.max(...p)/180,v=new yt(...h,s),m=new yt(...u,s),g=new Ke().setFromEuler(v),_=new Ke().setFromEuler(m);g.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const y=e.times[o-1],x=e.times[o]-y,M=new Ke,b=new yt;for(let w=0;w<1;w+=1/f)M.copy(g.clone().slerp(_.clone(),w)),a.push(y+w*x),b.setFromQuaternion(M,s),n.push(b.x),n.push(b.y),n.push(b.z)}else a.push(e.times[o]),n.push(ti.degToRad(e.values[o])),n.push(ti.degToRad(t.values[o])),n.push(ti.degToRad(r.values[o]))}return[a,n]}}class MR{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Lb,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach(function(s,a){const n=s.match(/^[\s\t]*;/),o=s.match(/^[\s\t]*$/);if(n||o)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),h=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):h?t.parseNodeProperty(s,h,r[++a]):c?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:r},n=this.parseNodeAttr(s),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,a):r in o?(r==="PoseNode"?o.PoseNode.push(a):o[r].id!==void 0&&(o[r]={},o[r][o[r].id]=o[r]),n.id!==""&&(o[r][n.id]=a)):typeof n.id=="number"?(o[r]={},o[r][n.id]=a):r!=="Properties70"&&(o[r]=r==="PoseNode"?[a]:a),typeof n.id=="number"&&(a.id=n.id),n.name!==""&&(a.attrName=n.name),n.type!==""&&(a.attrType=n.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",s="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:r,type:s}}parseNodeProperty(e,t,r){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&a===","&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());const n=this.getCurrentNode();if(n.name!=="Properties70"){if(s==="C"){const o=a.split(",").slice(1),l=parseInt(o[0]),h=parseInt(o[1]);let c=a.split(",").slice(3);c=c.map(function(u){return u.trim().replace(/^"/,"")}),s="connections",a=[l,h],function(u,d){for(let p=0,f=u.length,v=d.length;p<v;p++,f++)u[f]=d[p]}(a,c),n[s]===void 0&&(n[s]=[])}s==="Node"&&(n.id=a),s in n&&Array.isArray(n[s])?n[s].push(a):s!=="a"?n[s]=a:n.a=a,this.setCurrentProp(n,s),s==="a"&&a.slice(-1)!==","&&(n.a=Em(a))}else this.parseNodeSpecialProperty(e,s,a)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Em(t.a))}parseNodeSpecialProperty(e,t,r){const s=r.split('",').map(function(c){return c.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=s[0],n=s[1],o=s[2],l=s[3];let h=s[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=Em(h)}this.getPrevNode()[a]={type:n,type2:o,flag:l,value:h},this.setCurrentProp(this.getPrevNode(),a)}}class bR{parse(e){const t=new jy(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const s=new Lb;for(;!this.endOfContent(t);){const a=this.parseNode(t,r);a!==null&&s.add(a.name,a)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},s=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const n=e.getUint8(),o=e.getString(n);if(s===0)return null;const l=[];for(let d=0;d<a;d++)l.push(this.parseProperty(e));const h=l.length>0?l[0]:"",c=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(r.singleProperty=a===1&&e.getOffset()===s;s>e.getOffset();){const d=this.parseNode(e,t);d!==null&&this.parseSubNode(o,r,d)}return r.propertyList=l,typeof h=="number"&&(r.id=h),c!==""&&(r.attrName=c),u!==""&&(r.attrType=u),o!==""&&(r.name=o),r}parseSubNode(e,t,r){if(r.singleProperty===!0){const s=r.propertyList[0];Array.isArray(s)?(t[r.name]=r,r.a=s):t[r.name]=s}else if(e==="Connections"&&r.name==="C"){const s=[];r.propertyList.forEach(function(a,n){n!==0&&s.push(a)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(r.name==="Properties70")Object.keys(r).forEach(function(s){t[s]=r[s]});else if(e==="Properties70"&&r.name==="P"){let s=r.propertyList[0],a=r.propertyList[1];const n=r.propertyList[2],o=r.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),l=a==="Color"||a==="ColorRGB"||a==="Vector"||a==="Vector3D"||a.indexOf("Lcl_")===0?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[s]={type:a,type2:n,flag:o,value:l}}else t[r.name]===void 0?typeof r.id=="number"?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:r.name==="PoseNode"?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):t[r.name][r.id]===void 0&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),a=e.getUint32(),n=e.getUint32();if(a===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const o=dR(new Uint8Array(e.getArrayBuffer(n))),l=new jy(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class jy{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const s=r.indexOf(0);return s>=0&&(r=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(r)}}class Lb{add(e,t){this[e]=t}}function Wy(i){const e=i.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function wR(i){return i/46186158e3}const SR=[];function pu(i,e,t,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=i;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=r.indices[0]}r.referenceType==="IndexToDirect"&&(s=r.indices[s]);const a=s*r.dataSize,n=a+r.dataSize;return function(o,l,h,c){for(let u=h,d=0;u<c;u++,d++)o[d]=l[u];return o}(SR,r.buffer,a,n)}const Am=new yt,so=new S;function Nb(i){const e=new me,t=new me,r=new me,s=new me,a=new me,n=new me,o=new me,l=new me,h=new me,c=new me,u=new me,d=new me,p=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(so.fromArray(i.translation)),i.preRotation){const I=i.preRotation.map(ti.degToRad);I.push(i.eulerOrder||yt.DEFAULT_ORDER),t.makeRotationFromEuler(Am.fromArray(I))}if(i.rotation){const I=i.rotation.map(ti.degToRad);I.push(i.eulerOrder||yt.DEFAULT_ORDER),r.makeRotationFromEuler(Am.fromArray(I))}if(i.postRotation){const I=i.postRotation.map(ti.degToRad);I.push(i.eulerOrder||yt.DEFAULT_ORDER),s.makeRotationFromEuler(Am.fromArray(I)),s.invert()}i.scale&&a.scale(so.fromArray(i.scale)),i.scalingOffset&&o.setPosition(so.fromArray(i.scalingOffset)),i.scalingPivot&&n.setPosition(so.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(so.fromArray(i.rotationOffset)),i.rotationPivot&&h.setPosition(so.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(u.copy(i.parentMatrix),c.copy(i.parentMatrixWorld));const f=t.clone().multiply(r).multiply(s),v=new me;v.extractRotation(c);const m=new me;m.copyPosition(c);const g=m.clone().invert().multiply(c),_=v.clone().invert().multiply(g),y=a,x=new me;if(p===0)x.copy(v).multiply(f).multiply(_).multiply(y);else if(p===1)x.copy(v).multiply(_).multiply(f).multiply(y);else{const I=new me().scale(new S().setFromMatrixScale(u)).clone().invert(),E=_.clone().multiply(I);x.copy(v).multiply(f).multiply(E).multiply(y)}const M=h.clone().invert(),b=n.clone().invert();let w=e.clone().multiply(l).multiply(h).multiply(t).multiply(r).multiply(s).multiply(M).multiply(o).multiply(n).multiply(a).multiply(b);const T=new me().copyPosition(w),R=c.clone().multiply(T);return d.copyPosition(R),w=d.clone().multiply(x),w.premultiply(c.invert()),w}function Db(i){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(i=i||0)===6?e[0]:e[i]}function Em(i){return i.split(",").map(function(e){return parseFloat(e)})}function Xy(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),new TextDecoder().decode(new Uint8Array(i,e,t))}function qy(i,e){if(e===0)return i;if(e===2||e===1){let t=i.getIndex();if(t===null){const n=[],o=i.getAttribute("position");if(o===void 0)return i;for(let l=0;l<o.count;l++)n.push(l);i.setIndex(n),t=i.getIndex()}const r=t.count-2,s=[];if(e===2)for(let n=1;n<=r;n++)s.push(t.getX(0)),s.push(t.getX(n)),s.push(t.getX(n+1));else for(let n=0;n<r;n++)n%2==0?(s.push(t.getX(n)),s.push(t.getX(n+1)),s.push(t.getX(n+2))):(s.push(t.getX(n+2)),s.push(t.getX(n+1)),s.push(t.getX(n)));s.length;const a=i.clone();return a.setIndex(s),a.clearGroups(),a}return i}class TR extends It{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new PR(t)}),this.register(function(t){return new IR(t)}),this.register(function(t){return new zR(t)}),this.register(function(t){return new VR(t)}),this.register(function(t){return new HR(t)}),this.register(function(t){return new NR(t)}),this.register(function(t){return new DR(t)}),this.register(function(t){return new OR(t)}),this.register(function(t){return new UR(t)}),this.register(function(t){return new RR(t)}),this.register(function(t){return new FR(t)}),this.register(function(t){return new LR(t)}),this.register(function(t){return new BR(t)}),this.register(function(t){return new kR(t)}),this.register(function(t){return new ER(t)}),this.register(function(t){return new GR(t)}),this.register(function(t){return new jR(t)})}load(e,t,r,s){const a=this;let n;if(this.resourcePath!=="")n=this.resourcePath;else if(this.path!==""){const h=Jr.extractUrlBase(e);n=Jr.resolveURL(h,this.path)}else n=Jr.extractUrlBase(e);this.manager.itemStart(e);const o=function(h){s&&s(h),a.manager.itemError(e),a.manager.itemEnd(e)},l=new fi(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(h){try{a.parse(h,n,function(c){t(c),a.manager.itemEnd(e)},o)}catch(c){o(c)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,s){let a;const n={},o={},l=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Ob){try{n[Qe.KHR_BINARY_GLTF]=new qR(e)}catch(c){return void(s&&s(c))}a=JSON.parse(n[Qe.KHR_BINARY_GLTF].content)}else a=JSON.parse(l.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new nP(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](h);u.name,o[u.name]=u,n[u.name]=!0}if(a.extensionsUsed)for(let c=0;c<a.extensionsUsed.length;++c){const u=a.extensionsUsed[c],d=a.extensionsRequired||[];switch(u){case Qe.KHR_MATERIALS_UNLIT:n[u]=new CR;break;case Qe.KHR_DRACO_MESH_COMPRESSION:n[u]=new YR(a,this.dracoLoader);break;case Qe.KHR_TEXTURE_TRANSFORM:n[u]=new ZR;break;case Qe.KHR_MESH_QUANTIZATION:n[u]=new KR;break;default:d.indexOf(u)>=0&&o[u]}}h.setExtensions(n),h.setPlugins(o),h.parse(r,s)}parseAsync(e,t){const r=this;return new Promise(function(s,a){r.parse(e,t,s,a)})}}function AR(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Qe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class ER{constructor(e){this.parser=e,this.name=Qe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,s=t.length;r<s;r++){const a=t[r];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let s=t.cache.get(r);if(s)return s;const a=t.json,n=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const l=new oe(16777215);n.color!==void 0&&l.setRGB(n.color[0],n.color[1],n.color[2],Qt);const h=n.range!==void 0?n.range:0;switch(n.type){case"directional":o=new vh(l),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new jo(l),o.distance=h;break;case"spot":o=new gh(l),o.distance=h,n.spot=n.spot||{},n.spot.innerConeAngle=n.spot.innerConeAngle!==void 0?n.spot.innerConeAngle:0,n.spot.outerConeAngle=n.spot.outerConeAngle!==void 0?n.spot.outerConeAngle:Math.PI/4,o.angle=n.spot.outerConeAngle,o.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return o.position.set(0,0,0),o.decay=2,fs(o,n),n.intensity!==void 0&&(o.intensity=n.intensity),o.name=t.createUniqueName(n.name||"light_"+e),s=Promise.resolve(o),t.cache.add(r,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,s=r.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(n){return r._getNodeRef(t.cache,a,n)})}}class CR{constructor(){this.name=Qe.KHR_MATERIALS_UNLIT}getMaterialType(){return Wt}extendParams(e,t,r){const s=[];e.color=new oe(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const n=a.baseColorFactor;e.color.setRGB(n[0],n[1],n[2],Qt),e.opacity=n[3]}a.baseColorTexture!==void 0&&s.push(r.assignTexture(e,"map",a.baseColorTexture,ft))}return Promise.all(s)}}class RR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class PR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];if(n.clearcoatFactor!==void 0&&(t.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&a.push(r.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&a.push(r.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(a.push(r.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){const o=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new X(o,o)}return Promise.all(a)}}class IR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class LR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.iridescenceFactor!==void 0&&(t.iridescence=n.iridescenceFactor),n.iridescenceTexture!==void 0&&a.push(r.assignTexture(t,"iridescenceMap",n.iridescenceTexture)),n.iridescenceIor!==void 0&&(t.iridescenceIOR=n.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),n.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),n.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),n.iridescenceThicknessTexture!==void 0&&a.push(r.assignTexture(t,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(a)}}class NR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new oe(0,0,0),t.sheenRoughness=0,t.sheen=1;const n=s.extensions[this.name];if(n.sheenColorFactor!==void 0){const o=n.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Qt)}return n.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=n.sheenRoughnessFactor),n.sheenColorTexture!==void 0&&a.push(r.assignTexture(t,"sheenColorMap",n.sheenColorTexture,ft)),n.sheenRoughnessTexture!==void 0&&a.push(r.assignTexture(t,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(a)}}class DR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.transmissionFactor!==void 0&&(t.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&a.push(r.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(a)}}class OR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];t.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&a.push(r.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||1/0;const o=n.attenuationColor||[1,1,1];return t.attenuationColor=new oe().setRGB(o[0],o[1],o[2],Qt),Promise.all(a)}}class UR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class FR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];t.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&a.push(r.assignTexture(t,"specularIntensityMap",n.specularTexture));const o=n.specularColorFactor||[1,1,1];return t.specularColor=new oe().setRGB(o[0],o[1],o[2],Qt),n.specularColorTexture!==void 0&&a.push(r.assignTexture(t,"specularColorMap",n.specularColorTexture,ft)),Promise.all(a)}}class kR{constructor(e){this.parser=e,this.name=Qe.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return t.bumpScale=n.bumpFactor!==void 0?n.bumpFactor:1,n.bumpTexture!==void 0&&a.push(r.assignTexture(t,"bumpMap",n.bumpTexture)),Promise.all(a)}}class BR{constructor(e){this.parser=e,this.name=Qe.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?ar:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.anisotropyStrength!==void 0&&(t.anisotropy=n.anisotropyStrength),n.anisotropyRotation!==void 0&&(t.anisotropyRotation=n.anisotropyRotation),n.anisotropyTexture!==void 0&&a.push(r.assignTexture(t,"anisotropyMap",n.anisotropyTexture)),Promise.all(a)}}class zR{constructor(e){this.parser=e,this.name=Qe.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const a=s.extensions[this.name],n=t.options.ktx2Loader;if(!n){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,n)}}class VR{constructor(e){this.parser=e,this.name=Qe.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],o=s.images[n.source];let l=r.textureLoader;if(o.uri){const h=r.options.manager.getHandler(o.uri);h!==null&&(l=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,n.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class HR{constructor(e){this.parser=e,this.name=Qe.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],o=s.images[n.source];let l=r.textureLoader;if(o.uri){const h=r.options.manager.getHandler(o.uri);h!==null&&(l=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,n.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class GR{constructor(e){this.name=Qe.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],a=this.parser.getDependency("buffer",s.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(o){const l=s.byteOffset||0,h=s.byteLength||0,c=s.count,u=s.byteStride,d=new Uint8Array(o,l,h);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(c,u,d,s.mode,s.filter).then(function(p){return p.buffer}):n.ready.then(function(){const p=new ArrayBuffer(c*u);return n.decodeGltfBuffer(new Uint8Array(p),c,u,d,s.mode,s.filter),p})})}return null}}class jR{constructor(e){this.name=Qe.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const s=t.meshes[r.mesh];for(const l of s.primitives)if(l.mode!==ur.TRIANGLES&&l.mode!==ur.TRIANGLE_STRIP&&l.mode!==ur.TRIANGLE_FAN&&l.mode!==void 0)return null;const a=r.extensions[this.name].attributes,n=[],o={};for(const l in a)n.push(this.parser.getDependency("accessor",a[l]).then(h=>(o[l]=h,o[l])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(l=>{const h=l.pop(),c=h.isGroup?h.children:[h],u=l[0].count,d=[];for(const p of c){const f=new me,v=new S,m=new Ke,g=new S(1,1,1),_=new Mf(p.geometry,p.material,u);for(let y=0;y<u;y++)o.TRANSLATION&&v.fromBufferAttribute(o.TRANSLATION,y),o.ROTATION&&m.fromBufferAttribute(o.ROTATION,y),o.SCALE&&g.fromBufferAttribute(o.SCALE,y),_.setMatrixAt(y,f.compose(v,m,g));for(const y in o)if(y==="_COLOR_0"){const x=o[y];_.instanceColor=new un(x.array,x.itemSize,x.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,o[y]);Ue.prototype.copy.call(_,p),this.parser.assignFinalMaterial(_),d.push(_)}return h.isGroup?(h.clear(),h.add(...d),h):d[0]}))}}const Ob="glTF",WR=1313821514,XR=5130562;class qR{constructor(e){this.name=Qe.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ob)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let n=0;for(;n<s;){const o=a.getUint32(n,!0);n+=4;const l=a.getUint32(n,!0);if(n+=4,l===WR){const h=new Uint8Array(e,12+n,o);this.content=r.decode(h)}else if(l===XR){const h=12+n;this.body=e.slice(h,h+o)}n+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class YR{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Qe.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,o={},l={},h={};for(const c in n){const u=rg[c]||c.toLowerCase();o[u]=n[c]}for(const c in e.attributes){const u=rg[c]||c.toLowerCase();if(n[c]!==void 0){const d=r.accessors[e.attributes[c]],p=Co[d.componentType];h[u]=p.name,l[u]=d.normalized===!0}}return t.getDependency("bufferView",a).then(function(c){return new Promise(function(u,d){s.decodeDracoFile(c,function(p){for(const f in p.attributes){const v=p.attributes[f],m=l[f];m!==void 0&&(v.normalized=m)}u(p)},o,h,Qt,d)})})}}class ZR{constructor(){this.name=Qe.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class KR{constructor(){this.name=Qe.KHR_MESH_QUANTIZATION}}class Ub extends el{constructor(e,t,r,s){super(e,t,r,s)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s*3+s;for(let n=0;n!==s;n++)t[n]=r[a+n];return t}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=2*o,h=3*o,c=s-t,u=(r-t)/c,d=u*u,p=d*u,f=e*h,v=f-h,m=-2*p+3*d,g=p-d,_=1-m,y=g-d+u;for(let x=0;x!==o;x++){const M=n[v+x+o],b=n[v+x+l]*c,w=n[f+x+o],T=n[f+x]*c;a[x]=_*M+y*b+m*w+g*T}return a}}const QR=new Ke;class JR extends Ub{interpolate_(e,t,r,s){const a=super.interpolate_(e,t,r,s);return QR.fromArray(a).normalize().toArray(a),a}}const ur={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Co={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Yy={9728:nt,9729:Vt,9984:Rd,9985:_o,9986:an,9987:Qr},Zy={33071:gi,33648:pa,10497:jt},Cm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rg={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},js={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},$R={CUBICSPLINE:void 0,LINEAR:Oo,STEP:Do},eP="OPAQUE",tP="MASK",iP="BLEND";function Wa(i,e,t){for(const r in t.extensions)i[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function fs(i,e){e.extras!==void 0&&typeof e.extras=="object"&&Object.assign(i.userData,e.extras)}function rP(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let r=0,s=t.length;r<s;r++)i.morphTargetDictionary[t[r]]=r}}}function sP(i){let e;const t=i.extensions&&i.extensions[Qe.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+Rm(t.attributes):i.indices+":"+Rm(i.attributes)+":"+i.mode,i.targets!==void 0)for(let r=0,s=i.targets.length;r<s;r++)e+=":"+Rm(i.targets[r]);return e}function Rm(i){let e="";const t=Object.keys(i).sort();for(let r=0,s=t.length;r<s;r++)e+=t[r]+":"+i[t[r]]+";";return e}function sg(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const aP=new me;class nP{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new AR,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=!1,a=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,a=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||s&&a<98?this.textureLoader=new is(this.options.manager):this.textureLoader=new v1(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new fi(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,s=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(n){const o={scene:n[0][s.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:s.asset,parser:r,userData:{}};return Wa(a,o,s),fs(o,s),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let s=0,a=t.length;s<a;s++){const n=t[s].joints;for(let o=0,l=n.length;o<l;o++)e[n[o]].isBone=!0}for(let s=0,a=e.length;s<a;s++){const n=e[s];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(r[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const s=r.clone(),a=(n,o)=>{const l=this.associations.get(n);l!=null&&this.associations.set(o,l);for(const[h,c]of n.children.entries())a(c,o.children[h])};return a(r,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const s=e(t[r]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let s=0;s<t.length;s++){const a=e(t[s]);a&&r.push(a)}return r}getDependency(e,t){const r=e+":"+t;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(a){return a.loadNode&&a.loadNode(t)});break;case"mesh":s=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e)}this.cache.add(r,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(a,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Qe.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(a,n){r.load(Jr.resolveURL(t.uri,s.path),a,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const s=t.byteLength||0,a=t.byteOffset||0;return r.slice(a,a+s)})}loadAccessor(e){const t=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const n=Cm[s.type],o=Co[s.componentType],l=s.normalized===!0,h=new o(s.count*n);return Promise.resolve(new Ze(h,n,l))}const a=[];return s.bufferView!==void 0?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),s.sparse!==void 0&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then(function(n){const o=n[0],l=Cm[s.type],h=Co[s.componentType],c=h.BYTES_PER_ELEMENT,u=c*l,d=s.byteOffset||0,p=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let v,m;if(p&&p!==u){const g=Math.floor(d/p),_="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+g+":"+s.count;let y=t.cache.get(_);y||(v=new h(o,g*p,s.count*p/c),y=new Wh(v,p/c),t.cache.add(_,y)),m=new Bi(y,l,d%p/c,f)}else v=o===null?new h(s.count*l):new h(o,d,s.count*l),m=new Ze(v,l,f);if(s.sparse!==void 0){const g=Cm.SCALAR,_=Co[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,M=new _(n[1],y,s.sparse.count*g),b=new h(n[2],x,s.sparse.count*l);o!==null&&(m=new Ze(m.array.slice(),m.itemSize,m.normalized));for(let w=0,T=M.length;w<T;w++){const R=M[w];if(m.setX(R,b[w*l]),l>=2&&m.setY(R,b[w*l+1]),l>=3&&m.setZ(R,b[w*l+2]),l>=4&&m.setW(R,b[w*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,r=this.options,s=t.textures[e].source,a=t.images[s];let n=this.textureLoader;if(a.uri){const o=r.manager.getHandler(a.uri);o!==null&&(n=o)}return this.loadTextureImage(e,s,n)}loadTextureImage(e,t,r){const s=this,a=this.json,n=a.textures[e],o=a.images[t],l=(o.uri||o.bufferView)+":"+n.sampler;if(this.textureCache[l])return this.textureCache[l];const h=this.loadImageSource(t,r).then(function(c){c.flipY=!1,c.name=n.name||o.name||"",c.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(c.name=o.uri);const u=(a.samplers||{})[n.sampler]||{};return c.magFilter=Yy[u.magFilter]||Vt,c.minFilter=Yy[u.minFilter]||Qr,c.wrapS=Zy[u.wrapS]||jt,c.wrapT=Zy[u.wrapT]||jt,s.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[l]=h,h}loadImageSource(e,t){const r=this,s=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const n=s.images[e],o=self.URL||self.webkitURL;let l=n.uri||"",h=!1;if(n.bufferView!==void 0)l=r.getDependency("bufferView",n.bufferView).then(function(u){h=!0;const d=new Blob([u],{type:n.mimeType});return l=o.createObjectURL(d),l});else if(n.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(l).then(function(u){return new Promise(function(d,p){let f=d;t.isImageBitmapLoader===!0&&(f=function(v){const m=new pt(v);m.needsUpdate=!0,d(m)}),t.load(Jr.resolveURL(u,a.path),f,void 0,p)})}).then(function(u){var d;return h===!0&&o.revokeObjectURL(l),fs(u,n),u.userData.mimeType=n.mimeType||((d=n.uri).search(/\.jpe?g($|\?)/i)>0||d.search(/^data\:image\/jpeg/)===0?"image/jpeg":d.search(/\.webp($|\?)/i)>0||d.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),u}).catch(function(u){throw u});return this.sourceCache[e]=c,c}assignTexture(e,t,r,s){const a=this;return this.getDependency("texture",r.index).then(function(n){if(!n)return null;if(r.texCoord!==void 0&&r.texCoord>0&&((n=n.clone()).channel=r.texCoord),a.extensions[Qe.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[Qe.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=a.associations.get(n);n=a.extensions[Qe.KHR_TEXTURE_TRANSFORM].extendTexture(n,o),a.associations.set(n,l)}}return s!==void 0&&(n.colorSpace=s),e[t]=n,n})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const s=t.attributes.tangent===void 0,a=t.attributes.color!==void 0,n=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Ks,Xt.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(e.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Bt,Xt.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(s||a||n){let o="ClonedMaterial:"+r.uuid+":";s&&(o+="derivative-tangents:"),a&&(o+="vertex-colors:"),n&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),a&&(l.vertexColors=!0),n&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return Go}loadMaterial(e){const t=this,r=this.json,s=this.extensions,a=r.materials[e];let n;const o={},l=[];if((a.extensions||{})[Qe.KHR_MATERIALS_UNLIT]){const c=s[Qe.KHR_MATERIALS_UNLIT];n=c.getMaterialType(),l.push(c.extendParams(o,a,t))}else{const c=a.pbrMetallicRoughness||{};if(o.color=new oe(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){const u=c.baseColorFactor;o.color.setRGB(u[0],u[1],u[2],Qt),o.opacity=u[3]}c.baseColorTexture!==void 0&&l.push(t.assignTexture(o,"map",c.baseColorTexture,ft)),o.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,o.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),l.push(t.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))),n=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,o)})))}a.doubleSided===!0&&(o.side=Mt);const h=a.alphaMode||eP;if(h===iP?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===tP&&(o.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&n!==Wt&&(l.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new X(1,1),a.normalTexture.scale!==void 0)){const c=a.normalTexture.scale;o.normalScale.set(c,c)}if(a.occlusionTexture!==void 0&&n!==Wt&&(l.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&n!==Wt){const c=a.emissiveFactor;o.emissive=new oe().setRGB(c[0],c[1],c[2],Qt)}return a.emissiveTexture!==void 0&&n!==Wt&&l.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,ft)),Promise.all(l).then(function(){const c=new n(o);return a.name&&(c.name=a.name),fs(c,a),t.associations.set(c,{materials:e}),a.extensions&&Wa(s,c,a),c})}createUniqueName(e){const t=qe.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,s=this.primitiveCache;function a(o){return r[Qe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return Ky(l,o,t)})}const n=[];for(let o=0,l=e.length;o<l;o++){const h=e[o],c=sP(h),u=s[c];if(u)n.push(u.promise);else{let d;d=h.extensions&&h.extensions[Qe.KHR_DRACO_MESH_COMPRESSION]?a(h):Ky(new Re,h,t),s[c]={primitive:h,promise:d},n.push(d)}}return Promise.all(n)}loadMesh(e){const t=this,r=this.json,s=this.extensions,a=r.meshes[e],n=a.primitives,o=[];for(let h=0,c=n.length;h<c;h++){const u=n[h].material===void 0?((l=this.cache).DefaultMaterial===void 0&&(l.DefaultMaterial=new Go({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:gr})),l.DefaultMaterial):this.getDependency("material",n[h].material);o.push(u)}var l;return o.push(t.loadGeometries(n)),Promise.all(o).then(function(h){const c=h.slice(0,h.length-1),u=h[h.length-1],d=[];for(let f=0,v=u.length;f<v;f++){const m=u[f],g=n[f];let _;const y=c[f];if(g.mode===ur.TRIANGLES||g.mode===ur.TRIANGLE_STRIP||g.mode===ur.TRIANGLE_FAN||g.mode===void 0)_=a.isSkinnedMesh===!0?new Gu(m,y):new ue(m,y),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),g.mode===ur.TRIANGLE_STRIP?_.geometry=qy(_.geometry,1):g.mode===ur.TRIANGLE_FAN&&(_.geometry=qy(_.geometry,2));else if(g.mode===ur.LINES)_=new Yi(m,y);else if(g.mode===ur.LINE_STRIP)_=new oi(m,y);else if(g.mode===ur.LINE_LOOP)_=new bf(m,y);else{if(g.mode!==ur.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);_=new na(m,y)}Object.keys(_.geometry.morphAttributes).length>0&&rP(_,a),_.name=t.createUniqueName(a.name||"mesh_"+e),fs(_,a),g.extensions&&Wa(s,_,g),t.assignFinalMaterial(_),d.push(_)}for(let f=0,v=d.length;f<v;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return a.extensions&&Wa(s,d[0],a),d[0];const p=new vi;a.extensions&&Wa(s,p,a),t.associations.set(p,{meshes:e});for(let f=0,v=d.length;f<v;f++)p.add(d[f]);return p})}loadCamera(e){let t;const r=this.json.cameras[e],s=r[r.type];if(s)return r.type==="perspective"?t=new Gt(ti.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(t=new wn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),fs(t,r),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],r=[];for(let s=0,a=t.joints.length;s<a;s++)r.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const a=s.pop(),n=s,o=[],l=[];for(let h=0,c=n.length;h<c;h++){const u=n[h];if(u){o.push(u);const d=new me;a!==null&&d.fromArray(a.array,16*h),l.push(d)}}return new Vo(o,l)})}loadAnimation(e){const t=this.json,r=this,s=t.animations[e],a=s.name?s.name:"animation_"+e,n=[],o=[],l=[],h=[],c=[];for(let u=0,d=s.channels.length;u<d;u++){const p=s.channels[u],f=s.samplers[p.sampler],v=p.target,m=v.node,g=s.parameters!==void 0?s.parameters[f.input]:f.input,_=s.parameters!==void 0?s.parameters[f.output]:f.output;v.node!==void 0&&(n.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",g)),l.push(this.getDependency("accessor",_)),h.push(f),c.push(v))}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(c)]).then(function(u){const d=u[0],p=u[1],f=u[2],v=u[3],m=u[4],g=[];for(let _=0,y=d.length;_<y;_++){const x=d[_],M=p[_],b=f[_],w=v[_],T=m[_];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const R=r._createAnimationTracks(x,M,b,w,T);if(R)for(let I=0;I<R.length;I++)g.push(R[I])}return new dn(a,void 0,g)})}createNodeMesh(e){const t=this.json,r=this,s=t.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(a){const n=r._getNodeRef(r.meshCache,s.mesh,a);return s.weights!==void 0&&n.traverse(function(o){if(o.isMesh)for(let l=0,h=s.weights.length;l<h;l++)o.morphTargetInfluences[l]=s.weights[l]}),n})}loadNode(e){const t=this,r=this.json.nodes[e],s=t._loadNodeShallow(e),a=[],n=r.children||[];for(let l=0,h=n.length;l<h;l++)a.push(t.getDependency("node",n[l]));const o=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),o]).then(function(l){const h=l[0],c=l[1],u=l[2];u!==null&&h.traverse(function(d){d.isSkinnedMesh&&d.bind(u,aP)});for(let d=0,p=c.length;d<p;d++)h.add(c[d]);return h})}_loadNodeShallow(e){const t=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=t.nodes[e],n=a.name?s.createUniqueName(a.name):"",o=[],l=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return l&&o.push(l),a.camera!==void 0&&o.push(s.getDependency("camera",a.camera).then(function(h){return s._getNodeRef(s.cameraCache,a.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){o.push(h)}),this.nodeCache[e]=Promise.all(o).then(function(h){let c;if(c=a.isBone===!0?new zo:h.length>1?new vi:h.length===1?h[0]:new Ue,c!==h[0])for(let u=0,d=h.length;u<d;u++)c.add(h[u]);if(a.name&&(c.userData.name=a.name,c.name=n),fs(c,a),a.extensions&&Wa(r,c,a),a.matrix!==void 0){const u=new me;u.fromArray(a.matrix),c.applyMatrix4(u)}else a.translation!==void 0&&c.position.fromArray(a.translation),a.rotation!==void 0&&c.quaternion.fromArray(a.rotation),a.scale!==void 0&&c.scale.fromArray(a.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],s=this,a=new vi;r.name&&(a.name=s.createUniqueName(r.name)),fs(a,r),r.extensions&&Wa(t,a,r);const n=r.nodes||[],o=[];for(let l=0,h=n.length;l<h;l++)o.push(s.getDependency("node",n[l]));return Promise.all(o).then(function(l){for(let h=0,c=l.length;h<c;h++)a.add(l[h]);return s.associations=(h=>{const c=new Map;for(const[u,d]of s.associations)(u instanceof Xt||u instanceof pt)&&c.set(u,d);return h.traverse(u=>{const d=s.associations.get(u);d!=null&&c.set(u,d)}),c})(a),a})}_createAnimationTracks(e,t,r,s,a){const n=[],o=e.name?e.name:e.uuid,l=[];let h;switch(js[a.path]===js.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(o),js[a.path]){case js.weights:h=ga;break;case js.rotation:h=Rs;break;case js.position:case js.scale:h=va;break;default:r.itemSize===1?h=ga:h=va}const c=s.interpolation!==void 0?$R[s.interpolation]:Oo,u=this._getArrayFromAccessor(r);for(let d=0,p=l.length;d<p;d++){const f=new h(l[d]+"."+js[a.path],t.array,u,c);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),n.push(f)}return n}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=sg(t.constructor),s=new Float32Array(t.length);for(let a=0,n=t.length;a<n;a++)s[a]=t[a]*r;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){return new(this instanceof Rs?JR:Ub)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ky(i,e,t){const r=e.attributes,s=[];function a(n,o){return t.getDependency("accessor",n).then(function(l){i.setAttribute(o,l)})}for(const n in r){const o=rg[n]||n.toLowerCase();o in i.attributes||s.push(a(r[n],o))}if(e.indices!==void 0&&!i.index){const n=t.getDependency("accessor",e.indices).then(function(o){i.setIndex(o)});s.push(n)}return rt.workingColorSpace,fs(i,e),function(n,o,l){const h=o.attributes,c=new vt;if(h.POSITION===void 0)return;{const p=l.json.accessors[h.POSITION],f=p.min,v=p.max;if(f===void 0||v===void 0)return;if(c.set(new S(f[0],f[1],f[2]),new S(v[0],v[1],v[2])),p.normalized){const m=sg(Co[p.componentType]);c.min.multiplyScalar(m),c.max.multiplyScalar(m)}}const u=o.targets;if(u!==void 0){const p=new S,f=new S;for(let v=0,m=u.length;v<m;v++){const g=u[v];if(g.POSITION!==void 0){const _=l.json.accessors[g.POSITION],y=_.min,x=_.max;if(y!==void 0&&x!==void 0){if(f.setX(Math.max(Math.abs(y[0]),Math.abs(x[0]))),f.setY(Math.max(Math.abs(y[1]),Math.abs(x[1]))),f.setZ(Math.max(Math.abs(y[2]),Math.abs(x[2]))),_.normalized){const M=sg(Co[_.componentType]);f.multiplyScalar(M)}p.max(f)}}}c.expandByVector(p)}n.boundingBox=c;const d=new ii;c.getCenter(d.center),d.radius=c.min.distanceTo(c.max)/2,n.boundingSphere=d}(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?function(n,o,l){let h=!1,c=!1,u=!1;for(let v=0,m=o.length;v<m;v++){const g=o[v];if(g.POSITION!==void 0&&(h=!0),g.NORMAL!==void 0&&(c=!0),g.COLOR_0!==void 0&&(u=!0),h&&c&&u)break}if(!h&&!c&&!u)return Promise.resolve(n);const d=[],p=[],f=[];for(let v=0,m=o.length;v<m;v++){const g=o[v];if(h){const _=g.POSITION!==void 0?l.getDependency("accessor",g.POSITION):n.attributes.position;d.push(_)}if(c){const _=g.NORMAL!==void 0?l.getDependency("accessor",g.NORMAL):n.attributes.normal;p.push(_)}if(u){const _=g.COLOR_0!==void 0?l.getDependency("accessor",g.COLOR_0):n.attributes.color;f.push(_)}}return Promise.all([Promise.all(d),Promise.all(p),Promise.all(f)]).then(function(v){const m=v[0],g=v[1],_=v[2];return h&&(n.morphAttributes.position=m),c&&(n.morphAttributes.normal=g),u&&(n.morphAttributes.color=_),n.morphTargetsRelative=!0,n})}(i,e.targets,t):i})}const Pm=new WeakMap;class oP extends It{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,s){const a=new fi(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,n=>{this.parse(n,t,s)},r,s)}parse(e,t,r=()=>{}){this.decodeDracoFile(e,t,null,null,ft,r).catch(r)}decodeDracoFile(e,t,r,s,a=Qt,n=()=>{}){const o={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:a};return this.decodeGeometry(e,o).then(t).catch(n)}decodeGeometry(e,t){const r=JSON.stringify(t);if(Pm.has(e)){const l=Pm.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const a=this.workerNextTaskID++,n=e.byteLength,o=this._getWorker(a,n).then(l=>(s=l,new Promise((h,c)=>{s._callbacks[a]={resolve:h,reject:c},s.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),Pm.set(e,{key:r,promise:o}),o}_createGeometry(e){const t=new Re;e.index&&t.setIndex(new Ze(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r],a=s.name,n=s.array,o=s.itemSize,l=new Ze(n,o);a==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(n instanceof Float32Array)),t.setAttribute(a,l)}return t}_assignVertexColorSpace(e,t){if(t!==ft)return;const r=new oe;for(let s=0,a=e.count;s<a;s++)r.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,r.r,r.g,r.b)}_loadLibrary(e,t){const r=new fi(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((s,a)=>{r.load(e,s,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const s=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const a=lP.toString(),n=["/* draco decoder */",s,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(a){const n=a.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n)}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function lP(){let i,e;function t(r,s,a,n,o,l){const h=l.num_components(),c=a.num_points()*h,u=c*o.BYTES_PER_ELEMENT,d=function(v,m){switch(m){case Float32Array:return v.DT_FLOAT32;case Int8Array:return v.DT_INT8;case Int16Array:return v.DT_INT16;case Int32Array:return v.DT_INT32;case Uint8Array:return v.DT_UINT8;case Uint16Array:return v.DT_UINT16;case Uint32Array:return v.DT_UINT32}}(r,o),p=r._malloc(u);s.GetAttributeDataArrayForAllPoints(a,l,d,u,p);const f=new o(r.HEAPF32.buffer,p,c).slice();return r._free(p),{name:n,array:f,itemSize:h}}onmessage=function(r){const s=r.data;switch(s.type){case"init":i=s.decoderConfig,e=new Promise(function(o){i.onModuleLoaded=function(l){o({draco:l})},DracoDecoderModule(i)});break;case"decode":const a=s.buffer,n=s.taskConfig;e.then(o=>{const l=o.draco,h=new l.Decoder;try{const c=function(d,p,f,v){const m=v.attributeIDs,g=v.attributeTypes;let _,y;const x=p.GetEncodedGeometryType(f);if(x===d.TRIANGULAR_MESH)_=new d.Mesh,y=p.DecodeArrayToMesh(f,f.byteLength,_);else{if(x!==d.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");_=new d.PointCloud,y=p.DecodeArrayToPointCloud(f,f.byteLength,_)}if(!y.ok()||_.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const M={index:null,attributes:[]};for(const b in m){const w=self[g[b]];let T,R;if(v.useUniqueIDs)R=m[b],T=p.GetAttributeByUniqueId(_,R);else{if(R=p.GetAttributeId(_,d[m[b]]),R===-1)continue;T=p.GetAttribute(_,R)}const I=t(d,p,_,b,w,T);b==="color"&&(I.vertexColorSpace=v.vertexColorSpace),M.attributes.push(I)}return x===d.TRIANGULAR_MESH&&(M.index=function(b,w,T){const R=T.num_faces(),I=3*R,E=4*I,L=b._malloc(E);w.GetTrianglesUInt32Array(T,E,L);const D=new Uint32Array(b.HEAPF32.buffer,L,I).slice();return b._free(L),{array:D,itemSize:1}}(d,p,_)),d.destroy(_),M}(l,h,new Int8Array(a),n),u=c.attributes.map(d=>d.array.buffer);c.index&&u.push(c.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:c},u)}catch(c){self.postMessage({type:"error",id:s.id,error:c.message})}finally{l.destroy(h)}})}}}const hP=/^[og]\s*(.+)?/,cP=/^mtllib /,uP=/^usemtl /,dP=/^usemap /,Qy=/\s+/,Jy=new S,Im=new S,$y=new S,ex=new S,lr=new S,mu=new oe;function pP(){const i={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const r=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,a){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const o={index:this.materials.length,name:s||"",mtllib:Array.isArray(a)&&a.length>0?a[a.length-1]:"",smooth:n!==void 0?n.smooth:this.smooth,groupStart:n!==void 0?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const h={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return h.clone=this.clone.bind(h),h}};return this.materials.push(o),o},currentMaterial:function(){return this.materials.length>0?this.materials[this.materials.length-1]:void 0},_finalize:function(s){const a=this.currentMaterial();if(a&&a.groupEnd===-1&&(a.groupEnd=this.geometry.vertices.length/3,a.groupCount=a.groupEnd-a.groupStart,a.inherited=!1),s&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),a}},r&&r.name&&typeof r.clone=="function"){const s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const s=this.vertices,a=this.object.geometry.vertices;a.push(s[e+0],s[e+1],s[e+2]),a.push(s[t+0],s[t+1],s[t+2]),a.push(s[r+0],s[r+1],s[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const s=this.normals,a=this.object.geometry.normals;a.push(s[e+0],s[e+1],s[e+2]),a.push(s[t+0],s[t+1],s[t+2]),a.push(s[r+0],s[r+1],s[r+2])},addFaceNormal:function(e,t,r){const s=this.vertices,a=this.object.geometry.normals;Jy.fromArray(s,e),Im.fromArray(s,t),$y.fromArray(s,r),lr.subVectors($y,Im),ex.subVectors(Jy,Im),lr.cross(ex),lr.normalize(),a.push(lr.x,lr.y,lr.z),a.push(lr.x,lr.y,lr.z),a.push(lr.x,lr.y,lr.z)},addColor:function(e,t,r){const s=this.colors,a=this.object.geometry.colors;s[e]!==void 0&&a.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&a.push(s[t+0],s[t+1],s[t+2]),s[r]!==void 0&&a.push(s[r+0],s[r+1],s[r+2])},addUV:function(e,t,r){const s=this.uvs,a=this.object.geometry.uvs;a.push(s[e+0],s[e+1]),a.push(s[t+0],s[t+1]),a.push(s[r+0],s[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,s,a,n,o,l,h){const c=this.vertices.length;let u=this.parseVertexIndex(e,c),d=this.parseVertexIndex(t,c),p=this.parseVertexIndex(r,c);if(this.addVertex(u,d,p),this.addColor(u,d,p),o!==void 0&&o!==""){const f=this.normals.length;u=this.parseNormalIndex(o,f),d=this.parseNormalIndex(l,f),p=this.parseNormalIndex(h,f),this.addNormal(u,d,p)}else this.addFaceNormal(u,d,p);if(s!==void 0&&s!==""){const f=this.uvs.length;u=this.parseUVIndex(s,f),d=this.parseUVIndex(a,f),p=this.parseUVIndex(n,f),this.addUV(u,d,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,s=e.length;r<s;r++){const a=this.parseVertexIndex(e[r],t);this.addVertexPoint(a),this.addColor(a)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,s=this.uvs.length;for(let a=0,n=e.length;a<n;a++)this.addVertexLine(this.parseVertexIndex(e[a],r));for(let a=0,n=t.length;a<n;a++)this.addUVLine(this.parseUVIndex(t[a],s))}};return i.startObject("",!1),i}class mP extends It{constructor(e){super(e),this.materials=null}load(e,t,r,s){const a=this,n=new fi(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){try{t(a.parse(o))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new pP;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let s=[];for(let n=0,o=r.length;n<o;n++){const l=r[n].trimStart();if(l.length===0)continue;const h=l.charAt(0);if(h!=="#"){if(h==="v"){const c=l.split(Qy);switch(c[0]){case"v":t.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),c.length>=7?(mu.setRGB(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6])).convertSRGBToLinear(),t.colors.push(mu.r,mu.g,mu.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":t.uvs.push(parseFloat(c[1]),parseFloat(c[2]))}}else if(h==="f"){const c=l.slice(1).trim().split(Qy),u=[];for(let p=0,f=c.length;p<f;p++){const v=c[p];if(v.length>0){const m=v.split("/");u.push(m)}}const d=u[0];for(let p=1,f=u.length-1;p<f;p++){const v=u[p],m=u[p+1];t.addFace(d[0],v[0],m[0],d[1],v[1],m[1],d[2],v[2],m[2])}}else if(h==="l"){const c=l.substring(1).trim().split(" ");let u=[];const d=[];if(l.indexOf("/")===-1)u=c;else for(let p=0,f=c.length;p<f;p++){const v=c[p].split("/");v[0]!==""&&u.push(v[0]),v[1]!==""&&d.push(v[1])}t.addLineGeometry(u,d)}else if(h==="p"){const c=l.slice(1).trim().split(" ");t.addPointGeometry(c)}else if((s=hP.exec(l))!==null){const c=(" "+s[0].slice(1).trim()).slice(1);t.startObject(c)}else if(uP.test(l))t.object.startMaterial(l.substring(7).trim(),t.materialLibraries);else if(cP.test(l))t.materialLibraries.push(l.substring(7).trim());else if(!dP.test(l)){if(h==="s"){if(s=l.split(" "),s.length>1){const u=s[1].trim().toLowerCase();t.object.smooth=u!=="0"&&u!=="off"}else t.object.smooth=!0;const c=t.object.currentMaterial();c&&(c.smooth=t.object.smooth)}else if(l==="\0")continue}}}t.finalize();const a=new vi;if(a.materialLibraries=[].concat(t.materialLibraries),t.objects.length===1&&t.objects[0].geometry.vertices.length===0){if(t.vertices.length>0){const n=new Ks({size:1,sizeAttenuation:!1}),o=new Re;o.setAttribute("position",new _e(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(o.setAttribute("color",new _e(t.colors,3)),n.vertexColors=!0);const l=new na(o,n);a.add(l)}}else for(let n=0,o=t.objects.length;n<o;n++){const l=t.objects[n],h=l.geometry,c=l.materials,u=h.type==="Line",d=h.type==="Points";let p=!1;if(h.vertices.length===0)continue;const f=new Re;f.setAttribute("position",new _e(h.vertices,3)),h.normals.length>0&&f.setAttribute("normal",new _e(h.normals,3)),h.colors.length>0&&(p=!0,f.setAttribute("color",new _e(h.colors,3))),h.hasUVIndices===!0&&f.setAttribute("uv",new _e(h.uvs,2));const v=[];for(let g=0,_=c.length;g<_;g++){const y=c[g],x=y.name+"_"+y.smooth+"_"+p;let M=t.materials[x];if(this.materials!==null)if(M=this.materials.create(y.name),!u||!M||M instanceof Bt){if(d&&M&&!(M instanceof Ks)){const b=new Ks({size:10,sizeAttenuation:!1});Xt.prototype.copy.call(b,M),b.color.copy(M.color),b.map=M.map,M=b}}else{const b=new Bt;Xt.prototype.copy.call(b,M),b.color.copy(M.color),M=b}M===void 0&&(M=u?new Bt:d?new Ks({size:1,sizeAttenuation:!1}):new An,M.name=y.name,M.flatShading=!y.smooth,M.vertexColors=p,t.materials[x]=M),v.push(M)}let m;if(v.length>1){for(let g=0,_=c.length;g<_;g++){const y=c[g];f.addGroup(y.groupStart,y.groupCount,g)}m=u?new Yi(f,v):d?new na(f,v):new ue(f,v)}else m=u?new Yi(f,v[0]):d?new na(f,v[0]):new ue(f,v[0]);m.name=l.name,a.add(m)}return a}}class fP extends It{constructor(e){super(e)}load(e,t,r,s){const a=this,n=this.path===""?Jr.extractUrlBase(e):this.path,o=new fi(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(a.parse(l,n))}catch(h){s&&s(h),a.manager.itemError(e)}},r,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split(`
`);let s={};const a=/\s+/,n={};for(let l=0;l<r.length;l++){let h=r[l];if(h=h.trim(),h.length===0||h.charAt(0)==="#")continue;const c=h.indexOf(" ");let u=c>=0?h.substring(0,c):h;u=u.toLowerCase();let d=c>=0?h.substring(c+1):"";if(d=d.trim(),u==="newmtl")s={name:d},n[d]=s;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const p=d.split(a,3);s[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[u]=d}const o=new gP(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(n),o}}class gP{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:gr,this.wrap=this.options.wrap!==void 0?this.options.wrap:jt}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const s=e[r],a={};t[r]=a;for(const n in s){let o=!0,l=s[n];const h=n.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(o=!1)}o&&(a[h]=l)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,r=this.materialsInfo[e],s={name:e,side:this.side};function a(n,o){if(s[n])return;const l=t.getTextureParams(o,s),h=t.loadTexture((c=t.baseUrl,typeof(u=l.url)!="string"||u===""?"":/^https?:\/\//i.test(u)?u:c+u));var c,u;h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=t.wrap,h.wrapT=t.wrap,n!=="map"&&n!=="emissiveMap"||(h.colorSpace=ft),s[n]=h}for(const n in r){const o=r[n];let l;if(o!=="")switch(n.toLowerCase()){case"kd":s.color=new oe().fromArray(o).convertSRGBToLinear();break;case"ks":s.specular=new oe().fromArray(o).convertSRGBToLinear();break;case"ke":s.emissive=new oe().fromArray(o).convertSRGBToLinear();break;case"map_kd":a("map",o);break;case"map_ks":a("specularMap",o);break;case"map_ke":a("emissiveMap",o);break;case"norm":a("normalMap",o);break;case"map_bump":case"bump":a("bumpMap",o);break;case"map_d":a("alphaMap",o),s.transparent=!0;break;case"ns":s.shininess=parseFloat(o);break;case"d":l=parseFloat(o),l<1&&(s.opacity=l,s.transparent=!0);break;case"tr":l=parseFloat(o),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(s.opacity=1-l,s.transparent=!0)}}return this.materials[e]=new An(s),this.materials[e]}getTextureParams(e,t){const r={scale:new X(1,1),offset:new X(0,0)},s=e.split(/\s+/);let a;return a=s.indexOf("-bm"),a>=0&&(t.bumpScale=parseFloat(s[a+1]),s.splice(a,2)),a=s.indexOf("-s"),a>=0&&(r.scale.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),a=s.indexOf("-o"),a>=0&&(r.offset.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),r.url=s.join(" ").trim(),r}loadTexture(e,t,r,s,a){const n=this.manager!==void 0?this.manager:kg;let o=n.getHandler(e);o===null&&(o=new is(n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const l=o.load(e,r,s,a);return t!==void 0&&(l.mapping=t),l}}function vP(i,e,t=()=>{}){switch(e){case"GLTF":case"GLB":case"gltf":case"glb":return function(r="",s="/draco/",a=()=>{}){const n=new TR,o={progress:()=>{},complete:()=>{}};return n.setDRACOLoader(new oP().setDecoderPath(s)),n.load(r,l=>{l.scene.animations=l.animations,a(l.scene),o.complete(l.scene)},l=>o.progress(l.loaded/l.total,l),l=>{}),o}(i,ng.dracoPath,r=>t(r));case"FBX":case"fbx":return function(r="",s){const a=new vR,n={progress:()=>{},complete:()=>{}};return a.load(r,o=>{s(o),n.complete(o)},o=>n.progress(o.loaded/o.total,o)),n}(i,r=>t(r));case"OBJ":case"obj":return function(r="",s=()=>{}){const a=new mP,n=new fP,o={progress:()=>{},complete:()=>{}};return n.load(r.replace(".obj",".mtl"),l=>{l.preload(),a.setMaterials(l),a.load(r,h=>{s(h),o.complete(h)},h=>o.progress(h.loaded/h.total,h),h=>{})}),o}(i,r=>t(r))}}const _0=In,y0=Ln,Fb=Ns;function ep(i){return i.map(e=>hi(Ae({},_0(e)),{children:ep(e.children)}))}function tp(i,e){i.length===e.length&&i.forEach((t,r)=>{y0(t,e[r]),t.children&&tp(t.children,e[r].children)})}function x0(i,e){const{mixerFrames:t}=Ko(i),r=function(a,n=()=>{}){const o=new _h,l=new x1(a);return a.mixerAnimateRender=()=>{const h=o.getDelta();n(),l.update(h)},l}(i,()=>e.frameCallback),s=e.actionIndexs.map((a,n)=>a&&function(o,l,h=1,c=0,u=!0){const d=o.clipAction(l);return d.loop=u?_g:vg,d.time=c,d.timeScale=h,d.clampWhenFinished=!0,d}(r,i.animations[n],e.speed,e.startTime,e.loop).play()).filter(a=>a);return!t.find(a=>a===i)&&t.push(i),{actions:s,mixer:r}}function _P(i,e){e&&(y0(i,e),function(t,r){t.globalConfig=r;const{mesh:s,material:a}=r;r.useGlobalShadow&&function(n,o){n.traverse(l=>{l.castShadow=o.castShadow,l.receiveShadow=o.receiveShadow})}(t,s),r.useGlobalMaterial&&function(n,o){n.RootMaterials.forEach(l=>{l.envMapIntensity=o.envMapIntensity,l.reflectivity=o.reflectivity,o.envMap&&(l.envMap=n.parent.envBackground),o.isGlobalMap===!1&&(l.recordMap=l.map,l.map=null),l.needsUpdate=!0}),o.envMap&&n.parent.envMapChangeUseList.push(()=>n.RootMaterials.forEach(l=>l.envMap=n.parent.envBackground))}(t,a)}(i,e.globalConfig),i.globalConfig.isSaveChildren&&tp(i.children,e.children),i.globalConfig.isSaveMaterials&&i.RootMaterials.forEach((t,r)=>f0(t,e.RootMaterials[r])),function(t,r){r&&(t.animationPlayParams=r,r.initPlay&&x0(t,r))}(i,e.animationPlayParams))}function kb(i,e,t,r,s){return Fb(r,s.addFolder("")),function(a,n){n.add(a.globalConfig,"isSaveChildren").name(""),n.add(a.globalConfig,"isSaveMaterials").name(""),n.addFn(()=>a.traverse(o=>o.visible=!0)).name(""),function(o,l){l.add(o.globalConfig,"useGlobalShadow").name(""),l.add(o.globalConfig.mesh,"castShadow").name("").onChange(h=>o.traverse(c=>c.castShadow=h)),l.add(o.globalConfig.mesh,"receiveShadow").name("").onChange(h=>o.traverse(c=>c.receiveShadow=h))}(a,n.addFolder("()")),function(o,l){l.add(o.globalConfig,"useGlobalMaterial").name(""),l.add(o.globalConfig.material,"envMap").name("").onChange(h=>o.RootMaterials.forEach(c=>c.envMap=h?o.parent.envBackground:null)),l.add(o.globalConfig.material,"envMapIntensity").name("").onChange(h=>o.RootMaterials.forEach(c=>c.envMapIntensity=h)).onFinishChange(h=>o.RootMaterials.forEach(c=>c.needsUpdate=!0)),l.add(o.globalConfig.material,"reflectivity",0,1).name("").onChange(h=>o.RootMaterials.forEach(c=>c.reflectivity=h)).onFinishChange(h=>o.RootMaterials.forEach(c=>c.needsUpdate=!0)),l.add(o.globalConfig.material,"isGlobalMap").name("").onChange(h=>{o.RootMaterials.forEach(c=>{h?(c.map=c.recordMap,c.needsUpdate=!0):(c.recordMap=c.map,c.map=null,c.needsUpdate=!0)})}).onFinishChange(h=>o.RootMaterials.forEach(c=>c.needsUpdate=!0))}(a,n.addFolder("()"))}(r,s.addFolder("")),function(a,n){if(!a.animationPlayParams)return;n.add(a.animationPlayParams,"initPlay").name(""),n.add(a.animationPlayParams,"speed").min(-10).max(10).name(""),n.add(a.animationPlayParams,"startTime").name(""),n.add(a.animationPlayParams,"loop").name("");const o=n.addFolder("");a.animations.map((l,h)=>o.add(a.animationPlayParams.actionIndexs,h).name(l.name+":"+l.duration.toFixed(2)+"s")),o.addFn(()=>x0(a,a.animationPlayParams)).name("")}(r,s.addFolder("")),s.addFn(()=>e.attach(r)).name(""),s.addFn(()=>{const{frontView:a,target:n}=V2(r,i.object.fov);ud(i.object.position,a),ud(i.target,n),t.effectPass.outlinePass.selectedObjects=[r]}).name(""),s.addFn(()=>{r.parent.remove(r),s.parent.removeFolder(s)}).name(""),s}function Qi(i){let e="";return i.name||(e="-"),i.name.length>10?e+=i.name.slice(0,10)+"...":e+=i.name,e+=` ${i.id} `,e}function yP(i,e,t,r,s){Object.assign(i,{scene:e,controls:t,transformControls:r,effectComposer:s}),i.insertModel=function(a,n){const{url:o,type:l}=a;return{loaderService:vP(o,l,h=>{var c,u;if(e.add(((u=h).globalConfig={useGlobalShadow:!1,useGlobalMaterial:!1,isSaveChildren:!0,isSaveMaterials:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{envMap:!1,envMapIntensity:1,reflectivity:.98,isGlobalMap:!0}},u.RootMaterials=$d(u),((c=u.animations)==null?void 0:c.length)>0&&(u.animationPlayParams={initPlay:!1,speed:.5,actionIndexs:new Array(u.animations.length).fill(!1),startTime:0,loop:!1,frameCallback:()=>{}}),u)),h.rootInfo=a,_P(h,n),!i.rootFolder)return;const d=i.rootFolder.addFolder(Qi(h));kb(t,r,s,h,d)}),rootInfo:a,params:n}}}function xP(i){return i.map(e=>function(t){const{animationPlayParams:r,children:s,RootMaterials:a,rootInfo:n}=t;return{group:hi(Ae({},_0(t)),{globalConfig:t.globalConfig,animationPlayParams:r,RootMaterials:t.globalConfig.isSaveMaterials?a.map(o=>m0(o)):void 0,children:t.globalConfig.isSaveChildren?ep(s):void 0}),rootInfo:n}}(e))}function MP(i){return i.map(e=>function(t){const{material:r,geometry:s}=t,{geometryType:a,parameters:n}=s;return hi(Ae({},In(t)),{geometry:{geometryType:a,parameters:n},material:Kd(r)})}(e))}function bP(i,e){e==null||e.forEach(t=>function(r,s){if(!s)return;const{geometry:a,material:n}=s,{geometryType:o,parameters:l}=a,h=c0(o,l),c=Nr(n.materialType),u=new ue(h,c);return u.isInnerMesh=!0,r.add(u),Qd(r,u.material,n),Ln(u,s),u}(i,t))}function wP(i,e,t){const r=t.addFolder("");return r.open(),t.add(i,"geometryType",H2).name(""),t.add(i,"materialType",Eo).name(""),t.addFn(()=>{const s=function(a,n){const o=c0(a),l=Nr(n),h=new ue(o,l);return h.isInnerMesh=!0,h}(i.geometryType,i.materialType);e.attach_add(s),Fy(e,s,r.addFolder(s.geometry.geometryType+":"+Qi(s)))}).name(""),e.children.forEach(s=>{s.isInnerMesh&&Fy(e,s,r.addFolder(s.geometry.geometryType+":"+Qi(s)))}),t}class Bb extends Pn{constructor(e,t={}){const r=t.font;if(r===void 0)super();else{const s=r.generateShapes(e,t.size);t.depth===void 0&&t.height,t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(s,t)}this.type="TextGeometry"}}class SP extends It{constructor(e){super(e)}load(e,t,r,s){const a=this,n=new fi(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){const l=a.parse(JSON.parse(o));t&&t(l)},r,s)}parse(e){return new TP(e)}}class TP{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const r=[],s=function(a,n,o){const l=Array.from(a),h=n/o.resolution,c=(o.boundingBox.yMax-o.boundingBox.yMin+o.underlineThickness)*h,u=[];let d=0,p=0;for(let f=0;f<l.length;f++){const v=l[f];if(v===`
`)d=0,p-=c;else{const m=AP(v,h,d,p,o);d+=m.offsetX,u.push(m.path)}}return u}(e,t,this.data);for(let a=0,n=s.length;a<n;a++)r.push(...s[a].toShapes());return r}}function AP(i,e,t,r,s){const a=s.glyphs[i]||s.glyphs["?"];if(!a)return;const n=new E1;let o,l,h,c,u,d,p,f;if(a.o){const v=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let m=0,g=v.length;m<g;)switch(v[m++]){case"m":o=v[m++]*e+t,l=v[m++]*e+r,n.moveTo(o,l);break;case"l":o=v[m++]*e+t,l=v[m++]*e+r,n.lineTo(o,l);break;case"q":h=v[m++]*e+t,c=v[m++]*e+r,u=v[m++]*e+t,d=v[m++]*e+r,n.quadraticCurveTo(u,d,h,c);break;case"b":h=v[m++]*e+t,c=v[m++]*e+r,u=v[m++]*e+t,d=v[m++]*e+r,p=v[m++]*e+t,f=v[m++]*e+r,n.bezierCurveTo(u,d,p,f,h,c)}}return{offsetX:a.ha*e,path:n}}function tx(i,e="fence"){const t=i.length,r=e==="fence"?i.map((d,p)=>p-1>-1&&p+1<t&&(p%2==0?[p,p+1,p-1]:[p,p-1,p+1])).filter(d=>d).reduce((d,p)=>[...d,...p],[]):i.map((d,p)=>p>=2&&[0,p-1,p]).filter(d=>d).reduce((d,p)=>[...d,...p],[]),s=i.reduce((d,p)=>[...d,p.x,p.y,p.z],[]),a=i.reduce((d,p)=>({x:[...d.x,p.x],y:[...d.y,p.y],z:[...d.z,p.z]}),{x:[],y:[],z:[]}),n=new S(Math.max(...a.x),Math.max(...a.y),Math.max(...a.z)),o=new S(Math.min(...a.x),Math.min(...a.y),Math.min(...a.z)),l=n.x-o.x,h=n.y-o.y,c=l>h?l:h,u=i.map(d=>new X((d.x-o.x)/c,(d.y-o.y)/c)).reduce((d,p)=>[...d,...p],[]);return{indexGroup:r,faceGroup:s,uvGroup:u}}function ix(i,e,t){const r=new Re,s=new Float32Array(i);if(r.setAttribute("position",new Ze(s,3)),e){let a=new Uint16Array(e);r.index=new Ze(a,1)}return t&&(r.attributes.uv=new _e(t,2)),r.computeVertexNormals(),r}function rx(i,e,t,r){i.setIndex(t),i.setAttribute("position",new _e(e,3)),i.setAttribute("uv",new _e(r,2)),delete i.attributes.normal,i.computeVertexNormals()}function zb(i,e,t=null){const r=new SP;return new Promise(s=>{r.load(i,a=>s(new Bb(e,Ae({font:a,size:1,depth:.2,height:.2,curveSegments:12,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:5},t))))})}const sx=new vt,fu=new S;class Vb extends zg{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new _e([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new _e([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new Zu(t,6,1);return this.setAttribute("instanceStart",new Bi(r,3,0)),this.setAttribute("instanceEnd",new Bi(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new Zu(t,6,1);return this.setAttribute("instanceColorStart",new Bi(r,3,0)),this.setAttribute("instanceColorEnd",new Bi(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Lg(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vt);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),sx.setFromBufferAttribute(t),this.boundingBox.union(sx))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ii),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let s=0;for(let a=0,n=e.count;a<n;a++)fu.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(fu)),fu.fromBufferAttribute(t,a),s=Math.max(s,r.distanceToSquared(fu));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(e){return this.applyMatrix4(e)}}ye.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new X(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Pi.line={uniforms:Kt.merge([ye.common,ye.fog,ye.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class M0 extends tt{constructor(e){super({type:"LineMaterial",uniforms:Kt.clone(Pi.line.uniforms),vertexShader:Pi.line.vertexShader,fragmentShader:Pi.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const Lm=new Ve,ax=new S,nx=new S,ui=new Ve,di=new Ve,zr=new Ve,Nm=new S,Dm=new me,pi=new M1,ox=new S,gu=new vt,vu=new ii,Vr=new Ve;let Hr,sn;function lx(i,e,t){return Vr.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),Vr.multiplyScalar(1/Vr.w),Vr.x=sn/t.width,Vr.y=sn/t.height,Vr.applyMatrix4(i.projectionMatrixInverse),Vr.multiplyScalar(1/Vr.w),Math.abs(Math.max(Vr.x,Vr.y))}class EP extends ue{constructor(e=new Vb,t=new M0({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let n=0,o=0,l=t.count;n<l;n++,o+=2)ax.fromBufferAttribute(t,n),nx.fromBufferAttribute(r,n),s[o]=o===0?0:s[o-1],s[o+1]=s[o]+ax.distanceTo(nx);const a=new Zu(s,2,1);return e.setAttribute("instanceDistanceStart",new Bi(a,1,0)),e.setAttribute("instanceDistanceEnd",new Bi(a,1,1)),this}raycast(e,t){const r=this.material.worldUnits,s=e.camera,a=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Hr=e.ray;const n=this.matrixWorld,o=this.geometry,l=this.material;let h,c;sn=l.linewidth+a,o.boundingSphere===null&&o.computeBoundingSphere(),vu.copy(o.boundingSphere).applyMatrix4(n),r?h=.5*sn:h=lx(s,Math.max(s.near,vu.distanceToPoint(Hr.origin)),l.resolution),vu.radius+=h,Hr.intersectsSphere(vu)!==!1&&(o.boundingBox===null&&o.computeBoundingBox(),gu.copy(o.boundingBox).applyMatrix4(n),r?c=.5*sn:c=lx(s,Math.max(s.near,gu.distanceToPoint(Hr.origin)),l.resolution),gu.expandByScalar(c),Hr.intersectsBox(gu)!==!1&&(r?function(u,d){const p=u.matrixWorld,f=u.geometry,v=f.attributes.instanceStart,m=f.attributes.instanceEnd;for(let g=0,_=Math.min(f.instanceCount,v.count);g<_;g++){pi.start.fromBufferAttribute(v,g),pi.end.fromBufferAttribute(m,g),pi.applyMatrix4(p);const y=new S,x=new S;Hr.distanceSqToSegment(pi.start,pi.end,x,y),x.distanceTo(y)<.5*sn&&d.push({point:x,pointOnLine:y,distance:Hr.origin.distanceTo(x),object:u,face:null,faceIndex:g,uv:null,uv1:null})}}(this,t):function(u,d,p){const f=d.projectionMatrix,v=u.material.resolution,m=u.matrixWorld,g=u.geometry,_=g.attributes.instanceStart,y=g.attributes.instanceEnd,x=Math.min(g.instanceCount,_.count),M=-d.near;Hr.at(1,zr),zr.w=1,zr.applyMatrix4(d.matrixWorldInverse),zr.applyMatrix4(f),zr.multiplyScalar(1/zr.w),zr.x*=v.x/2,zr.y*=v.y/2,zr.z=0,Nm.copy(zr),Dm.multiplyMatrices(d.matrixWorldInverse,m);for(let b=0,w=x;b<w;b++){if(ui.fromBufferAttribute(_,b),di.fromBufferAttribute(y,b),ui.w=1,di.w=1,ui.applyMatrix4(Dm),di.applyMatrix4(Dm),ui.z>M&&di.z>M)continue;if(ui.z>M){const L=ui.z-di.z,D=(ui.z-M)/L;ui.lerp(di,D)}else if(di.z>M){const L=di.z-ui.z,D=(di.z-M)/L;di.lerp(ui,D)}ui.applyMatrix4(f),di.applyMatrix4(f),ui.multiplyScalar(1/ui.w),di.multiplyScalar(1/di.w),ui.x*=v.x/2,ui.y*=v.y/2,di.x*=v.x/2,di.y*=v.y/2,pi.start.copy(ui),pi.start.z=0,pi.end.copy(di),pi.end.z=0;const T=pi.closestPointToPointParameter(Nm,!0);pi.at(T,ox);const R=ti.lerp(ui.z,di.z,T),I=R>=-1&&R<=1,E=Nm.distanceTo(ox)<.5*sn;if(I&&E){pi.start.fromBufferAttribute(_,b),pi.end.fromBufferAttribute(y,b),pi.start.applyMatrix4(m),pi.end.applyMatrix4(m);const L=new S,D=new S;Hr.distanceSqToSegment(pi.start,pi.end,D,L),p.push({point:D,pointOnLine:L,distance:Hr.origin.distanceTo(D),object:u,face:null,faceIndex:b,uv:null,uv1:null})}}}(this,s,t)))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(Lm),this.material.uniforms.resolution.value.set(Lm.z,Lm.w))}}class Hb extends Vb{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let s=0;s<t;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let s=0;s<t;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setColors(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class CP extends EP{constructor(e=new Hb,t=new M0({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}function Gb(i){new vt().setFromObject(i).getCenter(i.position),i.geometry.center()}function RP(i,e){var t,r;const{drawPointList:s}=e;if(s.length<2)return void(e.mesh&&(i.remove(e.mesh),e.mesh=null,(t=e.callback)==null?void 0:t.call(e,"remove")));const a=e.drawPointList.reduce((n,o)=>[...n,o.x,o.y+.001,o.z],[]);if(!e.mesh&&e.drawPointList.length>1){const n=function(o){const l=new M0({color:0,linewidth:.001,vertexColors:!1,dashed:!1,alphaToCoverage:!1}),h=new Hb().setPositions(o),c=new CP(h,l);return c.computeLineDistances(),c}(a);n.isDrawMesh=!0,n.drawParams=e,e.mesh=n,i.add(e.mesh),(r=e.callback)==null||r.call(e,"set")}else e.mesh&&e.drawPointList.length>0&&(e.mesh.geometry.dispose(),e.mesh.geometry.setPositions(a),e.mesh.computeLineDistances(),e.mesh.geometry.attributes.position.needsUpdate=!0)}function hx(i,e,t,r){const s=t.addFolder(""),a=t.addFolder("");s.open(),a.open();const n=r||{mode:i.mode,materialType:i.materialType,drawPointList:[],mesh:null};function o(l){n.drawPointList.push(l),Tr(e,n),cx(e,n,l,a)}n.callback=function(l){if(l==="remove")for(const h in s.__folders)s.removeFolder(s.__folders[h]);else{Ns(this.mesh,s.addFolder(""));const h=s.addFolder("");Jd(e,this.mesh.material,h),this.mode===""&&h.add(this.mesh.material,"linewidth").name("")}},function(l,h,c,u){if(h.mode==="")u||(h.fenceHeight=50,h.fenceClose=!0),c.add(h,"fenceHeight").name("").onChange(()=>Tr(l,h)),c.add(h,"fenceClose").name("").onChange(()=>Tr(l,h));else if(h.mode===""){u||(h.height=10,h.axial="y",h.tubularSegments=64,h.radius=.08,h.radialSegments=8,h.closed=!1);const d=c.addFolder("");d.add(h,"height").name("").onChange(()=>Tr(l,h)),d.add(h,"axial",["x","y","z"]).name("").onChange(()=>Tr(l,h)),d.add(h,"tubularSegments",1).name("").onChange(()=>Tr(l,h)).step(1),d.add(h,"radius",.01).name("").onChange(()=>Tr(l,h)),d.add(h,"radialSegments",1).name("").onChange(()=>Tr(l,h)).step(1),d.add(h,"closed").name("").onChange(()=>Tr(l,h))}}(e,n,t,r),r&&(n.drawPointList.forEach(l=>cx(e,n,l,a)),n.callback("set")),t.addFn(()=>n.mesh&&e.transformControls.attach(n.mesh)).name(""),t.addFn(()=>{i.drawEventCall=o}).name(""),t.addFn(()=>{t.parent.removeFolder(t),n.mesh&&e.remove(n.mesh),i.drawEventCall=null}).name(""),i.drawEventCall=o}function cx(i,e,t,r){const s=e.drawPointList,a=r.addFn(()=>{const n=s.indexOf(t);n>-1&&s.splice(n,1),Tr(i,e),r.remove(a)}).name(""+[t.x,t.y,t.z].map(n=>n.toFixed(2)).join(","))}function Tr(i,e){switch(e.mode){case"":(function(t,r){var s,a;const n=[...r.drawPointList];if(n.length<2)return void(r.mesh&&(t.remove(r.mesh),Bu(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));r.fenceClose&&r.drawPointList.length>2&&n.push(r.drawPointList[0]);const o=n.reduce((u,d)=>{const p=new S().copy(d);return p.y+=r.fenceHeight,[...u,p,d]},[]),{indexGroup:l,faceGroup:h,uvGroup:c}=tx(o);if(o.length>3&&!r.mesh){const u=ix(h,l,c),d=Nr(r.materialType,{color:16777215}),p=new ue(u,d);p.isDrawMesh=!0,p.drawParams=r,r.mesh=p,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}else r.mesh&&rx(r.mesh.geometry,h,l,c)})(i,e);break;case"":(function(t,r){var s,a;const n=[...r.drawPointList];if(n.length<3)return void(r.mesh&&(t.remove(r.mesh),Bu(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));n.forEach(c=>c.y+=.001);const{indexGroup:o,faceGroup:l,uvGroup:h}=tx(n,"face");if(r.drawPointList.length>2&&!r.mesh){const c=ix(l,o,h),u=Nr(r.materialType,{color:16777215}),d=new ue(c,u);d.isDrawMesh=!0,d.drawParams=r,r.mesh=d,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}else r.mesh&&rx(r.mesh.geometry,l,o,h)})(i,e);break;case"":(function(t,r){var s,a;const{drawPointList:n,height:o,axial:l,tubularSegments:h,radius:c,radialSegments:u,closed:d}=r;if(n.length<2)return void(r.mesh&&(t.remove(r.mesh),Bu(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));const p=n.map(v=>new S(v.x,v.y,v.z)).map((v,m,g)=>{if(g[m+1]){const _=v.clone().add(g[m+1]).divideScalar(2);return _[l]+=o,[v,_]}return[v]}).flat(),f=new Fd(p);if(r.mesh)r.mesh.geometry.dispose(),r.mesh.geometry=new Cs(f,h,c,u,d);else{const v=new Cs(f,h,c,u,d),m=Nr(r.materialType,{color:16777215}),g=new ue(v,m);g.isCurveMesh=!0,g.isDrawMesh=!0,g.drawParams=r,r.mesh=g,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}})(i,e);break;case"":RP(i,e)}}function PP(i){return i.map(e=>function(t){const r={};return Object.keys(t.drawParams).forEach(s=>{["mesh","folder","callback"].includes(s)||(r[s]=t.drawParams[s])}),hi(Ae({},In(t)),{material:Kd(t.material),drawParams:r})}(e))}function IP(i,e){e==null||e.map(t=>function(r,s){if(!s)return;const{drawParams:a}=s;Tr(r,a);const{mesh:n}=a;return Ln(n,s),Qd(r,n.material,s.material),a}(i,t))}function Om(i,e=1e4){const[t,r]=i,[s,a]=Fi("EPSG:4326","EPSG:3857",[t,r]);return new X(s/e,a/e)}function jb(i){return new X(i.offsetX/i.target.clientWidth*2-1,-i.offsetY/i.target.clientHeight*2+1)}function Wb(i){new vt().setFromObject(i).getCenter(i.position),i.translationOriginDiff=i.position.clone(),i.getTransformedVector=e=>{const t=e.clone();return t.sub(i.translationOriginDiff),t.multiply(i.scale),t.applyEuler(i.rotation),t.add(i.position),t},i.traverse(e=>{e.isMesh&&e.position.sub(i.position),e.initTranslate=e.position.clone()}),i.position.set(0,0,0)}function ux(i,e,t=null){const{globalConfig:r}=e,s=i.map(c=>Om(c)),a=new Ho(s),n=new oa;n.path=a,r.geometry.isEmpty?n.holes.push(a):n.curves.push(a);const o=new Pn(n,Ae({depth:20,bevelEnabled:!1},r.geometry.parameters)),l=e.listMaterial||Nr(e.materialType,{color:16777215*Math.random(),transparent:!0}),h=new ue(o,l);(function(c,u){var d,p;if(c.name=(d=u==null?void 0:u.properties)==null?void 0:d.name,u==null?void 0:u.properties.center){const f=Om(u.properties.center);u.properties.centerCoord3=new S(f.x,f.y,0)}if((p=u==null?void 0:u.properties)!=null&&p.centroid){const f=Om(u.properties.centroid);u.properties.centroidCoord3=new S(f.x,f.y,0)}c.geoInfo=u})(h,t),Gb(h),e.attach(h)}function ag(i,e,t){e.labelGroup={};const{type:r,color:s,fontSize:a,fontWeight:n,px:o,py:l,pz:h,rx:c,ry:u,rz:d,ss:p,sx:f,sy:v,sz:m}=t;e.children.forEach(g=>{var _,y,x,M,b,w,T,R,I;if((_=g.geoInfo)!=null&&_.properties.name&&!e.labelGroup[g.geoInfo.properties.name]){if(!((y=g.geoInfo)!=null&&y.properties.centroidCoord3)&&!((x=g.geoInfo)!=null&&x.properties.centerCoord3))return;const E=(((M=g.geoInfo)==null?void 0:M.properties.centroidCoord3)||((b=g.geoInfo)==null?void 0:b.properties.centerCoord3)).add(g.position).sub(g.initTranslate),L=e.getTransformedVector(E),D=document.createElement("div");D.innerText=((T=(w=g.geoInfo)==null?void 0:w.properties)==null?void 0:T.name)||"",D.style.color=s,D.style.fontSize=a+"px",D.style.fontWeight=n;const U=r==="2D"?new ZM(D):new KM(D);U._position=L,U.position.set(U._position.x+o,U._position.y+l,U._position.z+h),U.rotation.set(c,u,d),U.scale.set(f,v,m),U.scale.setScalar(p),i.add(U),D.style.pointerEvents="none",e.labelGroup[(I=(R=g.geoInfo)==null?void 0:R.properties)==null?void 0:I.name]=U}})}function Xb(i,e){const{commonFrames:t}=i,{globalConfig:r}=e;if(!r.useGlobalConfig)return;const{mesh:s,material:a}=r;if(e.children.forEach(n=>{n.castShadow=s.castShadow,n.receiveShadow=s.receiveShadow}),a.mapUrl){const n=new is().load(a.mapUrl);n.wrapS=jt,n.wrapT=jt,n.repeat.set(a.map.repeat.x,a.map.repeat.y),n.offset.set(a.map.offset.x,a.map.offset.y),n.center.set(a.map.center.x,a.map.center.y),n.rotation=a.map.rotation,e.texture=n,e.commonAnimateRender=function(){this.texture.offset.x+=this.globalConfig.material.textureAnimation.offset.x,this.texture.offset.y+=this.globalConfig.material.textureAnimation.offset.y,this.texture.rotation+=this.globalConfig.material.textureAnimation.rotation},t.push(e)}e.RootMaterials.forEach(n=>{n.color.set(a.color),n.wireframe=a.wireframe,n.transparent=a.transparent,n.opacity=a.opacity,["",""].includes(e.materialType)&&(n.metalness=a.metalness,n.roughness=a.roughness),e.materialType!==""&&(n.emissive.set(a.emissive),n.emissiveIntensity=a.emissiveIntensity),e.materialType===""&&(n.clearcoat=a.clearcoat,n.clearcoatRoughness=a.clearcoatRoughness,n.sheen=a.sheen,n.sheenRoughness=a.sheenRoughness,n.sheenColor.set(a.sheenColor),n.transmission=a.transmission),n.envMap=a.envMap?i.envBackground:null,n.envMapIntensity=a.envMapIntensity,n.reflectivity=a.reflectivity,n.map=e.texture,n.needsUpdate=!0}),e.parent.envMapChangeUseList.push(()=>e.RootMaterials.forEach(n=>n.envMap=e.parent.envBackground))}function LP(i,e,t){const{globalConfig:r}=e;t.add(r,"isSaveChildren").name(""),t.add(r,"isSaveMaterials").name(""),t.add(r,"useGlobalConfig").name("()");const s=t.addFolder("( )");s.add(r.mesh,"castShadow").name("").onChange(()=>e.children.forEach(a=>a.castShadow=r.mesh.castShadow)),s.add(r.mesh,"receiveShadow").name("").onChange(()=>e.children.forEach(a=>a.receiveShadow=r.mesh.receiveShadow)),qb(i,e,t.addFolder("()")),function(a,n){const{globalConfig:o}=a;let l=null;function h(){l&&clearTimeout(l),l=setTimeout(()=>{a.children.forEach(c=>{c.geometry.dispose(),o.geometry.isEmpty?(c.geometry.parameters.shapes.holes=[c.geometry.parameters.shapes.path],c.geometry.parameters.shapes.curves=[]):(c.geometry.parameters.shapes.curves=[c.geometry.parameters.shapes.path],c.geometry.parameters.shapes.holes=[]),c.geometry=new Pn(c.geometry.parameters.shapes,o.geometry.parameters),c.geometry.center()}),l=null},200)}n.add(o.geometry,"isEmpty").name("").onChange(h),n.add(o.geometry.parameters,"depth").name("").onChange(h).min(.001),n.add(o.geometry.parameters,"bevelEnabled").name("").onChange(h),n.add(o.geometry.parameters,"bevelThickness").name("").onChange(h).min(0),n.add(o.geometry.parameters,"bevelSize").name("").onChange(h).min(0),n.add(o.geometry.parameters,"bevelOffset").name("").onChange(h).min(0)}(e,t.addFolder(""))}function qb(i,e,t){const{globalConfig:r}=e,{material:s}=r;t.addColor(s,"color").name("").onChange(a=>e.RootMaterials.forEach(n=>n.color.set(a))),t.add(s,"wireframe").name("").onChange(a=>e.RootMaterials.forEach(n=>n.wireframe=a)),t.add(s,"transparent").name("").onChange(a=>e.RootMaterials.forEach(n=>n.transparent=a)),t.add(s,"opacity",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.opacity=a)),["",""].includes(e.materialType)&&(t.add(s,"metalness",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.metalness=a)),t.add(s,"roughness",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.roughness=a))),e.materialType!==""&&(t.addColor(s,"emissive").name("").onChange(a=>e.RootMaterials.forEach(n=>n.emissive.set(a))),t.add(s,"emissiveIntensity",0).name("").onChange(a=>e.RootMaterials.forEach(n=>n.emissiveIntensity=a))),e.materialType!==""&&(t.add(s,"envMap").name("").onChange(a=>e.RootMaterials.forEach(n=>n.envMap=a?i.envBackground:null)),t.add(s,"envMapIntensity",0).name("").onChange(a=>e.RootMaterials.forEach(n=>n.envMapIntensity=a)),t.add(s,"reflectivity",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.reflectivity=a))),e.materialType===""&&(t.add(s,"clearcoat",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.clearcoat=a)),t.add(s,"clearcoatRoughness",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.clearcoatRoughness=a)),t.add(s,"sheen",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.sheen=a)),t.add(s,"sheenRoughness",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.sheenRoughness=a)),t.addColor(s,"sheenColor").name("").onChange(a=>e.RootMaterials.forEach(n=>n.sheenColor.set(a))),t.add(s,"transmission",0,1).name("").onChange(a=>e.RootMaterials.forEach(n=>n.transmission=a))),t.addFn(()=>e.RootMaterials.forEach(a=>a.needsUpdate=!0)).name(""),function(a,n,o){const{material:l}=n.globalConfig;function h(d){n.RootMaterials.forEach(p=>{p.map&&(p.map[d]=l.map[d])})}function c(){const{mapUrl:d,map:p}=l;if(!d)return;const f=new is().load(d);f.wrapS=jt,f.wrapT=jt,f.repeat.set(p.repeat.x,p.repeat.y),f.offset.set(p.offset.x,p.offset.y),f.center.set(p.center.x,p.center.y),f.rotation=p.rotation,n.texture=f,n.RootMaterials.forEach(v=>{v.map=f,v.needsUpdate=!0})}function u(d){d?(n.commonAnimateRender=function(){this.texture.offset.x+=this.globalConfig.material.textureAnimation.offset.x,this.texture.offset.y+=this.globalConfig.material.textureAnimation.offset.y,this.texture.rotation+=this.globalConfig.material.textureAnimation.rotation},a.push(n)):delete n.texture.commonAnimateRender}o.add(l,"mapUrl").name(""),o.add(l.map.repeat,"x").name("").onChange(d=>h("repeat")),o.add(l.map.repeat,"y").name("").onChange(d=>h("repeat")),o.add(l.map.offset,"x").name("").onChange(d=>h("offset")),o.add(l.map.offset,"y").name("").onChange(d=>h("offset")),o.add(l.map,"rotation",0,2*Math.PI).name("").onChange(d=>h("rotation")),o.add(l.map.center,"x").name("").onChange(d=>h("center")),o.add(l.map.center,"y").name("").onChange(d=>h("center")),o.add(l.textureAnimation,"isTextureAnimation").name("").onChange(d=>u(d)),o.add(l.textureAnimation.offset,"x").name(""),o.add(l.textureAnimation.offset,"y").name(""),o.add(l.textureAnimation,"rotation",0,2*Math.PI).name(""),o.addFn(()=>c()).name("")}(i.commonFrames,e,t.addFolder(""))}function NP(i,e){return Rr(this,null,function*(){var t;if(!e)return;const r=new vi;return r.url=e.url,r.materialType=e.materialType,r.globalConfig=e.globalConfig,r.isListMaterial=e.isListMaterial,r.edgeMaterialType=e.edgeMaterialType,yield b0(i,r),Ln(r,e),Xb(i,r),r.globalConfig.isSaveChildren&&tp(r.children,e.children),r.globalConfig.isSaveMaterials&&r.RootMaterials.forEach((s,a)=>f0(s,e.RootMaterials[a])),(t=r.listMaterial)==null||t.forEach((s,a)=>Qd(i,s,e.listMaterial[a])),function(s,a){const{label:n}=a.globalConfig;n.show&&ag(s,a,n)}(i,r),r})}function b0(i,e){return Rr(this,null,function*(){let t=null;return t=typeof e.url=="string"?yield fetch(e.url).then(r=>r.json()):e.url,function(r,s){if(s.isListMaterial){const{materialType:a,edgeMaterialType:n}=s;s.listMaterial=[Nr(a,{color:16777215*Math.random(),transparent:!0}),Nr(n,{color:16777215*Math.random(),transparent:!0})]}r.forEach(a=>{a.geometry.type==="MultiPolygon"?a.geometry.coordinates.forEach(n=>n.forEach(o=>ux(o,s,a))):a.geometry.type==="Polygon"&&a.geometry.coordinates.forEach(n=>ux(n,s,a))})}(t.features,e),Wb(e),e.RootMaterials=$d(e),e.rotation.x=-Math.PI/2,e.isGeoGroup=!0,i.add(e),e})}function dx(i,e,t){var r;t.add(e,"url").name(""),Ns(e,t.addFolder("")),LP(i,e,t.addFolder("")),function(s,a,n){const{label:o}=a.globalConfig;function l(c){if(!a.labelGroup)return;const u=Object.values(a.labelGroup);switch(c){case"type":h(),ag(s,a,o);break;case"color":u.forEach(d=>d.element.style.color=o[c]);break;case"fontSize":u.forEach(d=>d.element.style.fontSize=o[c]+"px");break;case"fontWeight":u.forEach(d=>d.element.style.fontWeight=o[c]);break;case"px":u.forEach(d=>d.position.x=d._position.x+o[c]);break;case"py":u.forEach(d=>d.position.y=d._position.y+o[c]);break;case"pz":u.forEach(d=>d.position.z=d._position.z+o[c]);break;case"rx":u.forEach(d=>d.rotation.x=o[c]);break;case"ry":u.forEach(d=>d.rotation.y=o[c]);break;case"rz":u.forEach(d=>d.rotation.z=o[c]);break;case"ss":u.forEach(d=>d.scale.setScalar(o[c]));break;case"sx":u.forEach(d=>d.scale.x=o[c]);break;case"sy":u.forEach(d=>d.scale.y=o[c]);break;case"sz":u.forEach(d=>d.scale.z=o[c])}}function h(){a.labelGroup&&Object.keys(a.labelGroup).forEach(c=>{s.remove(a.labelGroup[c]),delete a.labelGroup[c]})}n.add(o,"show").name("").onChange(c=>c?ag(s,a,o):h()),n.add(o,"type",["2D","3D"]).name("").onChange(c=>l("type")),n.addColor(o,"color").name("").onChange(c=>l("color")),n.add(o,"fontSize",0).name("").onChange(c=>l("fontSize")),n.add(o,"fontWeight",["400","500","600","700","800","900"]).name("").onChange(c=>l("fontWeight")),n.add(o,"px").name("X").onChange(c=>l("px")),n.add(o,"py").name("Y").onChange(c=>l("py")),n.add(o,"pz").name("Z").onChange(c=>l("pz")),n.add(o,"rx",0,2*Math.PI).name("X").onChange(c=>l("rx")),n.add(o,"ry",0,2*Math.PI).name("Y").onChange(c=>l("ry")),n.add(o,"rz",0,2*Math.PI).name("Z").onChange(c=>l("rz")),n.add(o,"ss").name("").onChange(c=>l("ss")),n.add(o,"sx").name("X").onChange(c=>l("sx")),n.add(o,"sy").name("Y").onChange(c=>l("sy")),n.add(o,"sz").name("Z").onChange(c=>l("sz"))}(i,e,t.addFolder("")),(r=e.listMaterial)==null||r.forEach((s,a)=>Jd(i,s,t.addFolder(a?"":""))),t.addFn(()=>{t.parent.removeFolder(t),i.remove(e)}).name("")}function DP(i,e,t){const r=t.addFolder("");return r.open(),t.add(i,"url").name(""),t.add(i,"materialType",Eo).name(""),t.add(i,"isListMaterial").name(""),t.add(i,"edgeMaterialType",Eo).name(""),t.addFn(()=>Rr(this,null,function*(){if(!i.url)return;const{url:s,materialType:a,isListMaterial:n,edgeMaterialType:o}=i,l=yield b0(e,function(h,c,u,d){const p=new vi;return p.url=h,p.materialType=c,p.isListMaterial=u,p.edgeMaterialType=d,function(f){f.globalConfig||(f.globalConfig={useGlobalConfig:!1,isSaveChildren:!0,isSaveMaterials:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{color:16777215,wireframe:!1,transparent:!0,opacity:1,metalness:0,roughness:0,emissive:0,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,sheen:0,sheenRoughness:0,sheenColor:0,transmission:0,envMap:!1,envMapIntensity:1,reflectivity:.98,mapUrl:"",textureAnimation:{isTextureAnimation:!1,offset:{x:0,y:.01},rotation:0},map:{repeat:{x:1,y:1},offset:{x:0,y:0},center:{x:0,y:0},rotation:0}},geometry:{geometryType:"",isEmpty:!1,parameters:{depth:16,bevelEnabled:!1,bevelThickness:0,bevelSize:0,bevelOffset:0}},label:{show:!1,type:"2D",color:"#fff",fontSize:12,fontWeight:400,px:0,py:0,pz:0,rx:0,ry:0,rz:0,ss:1,sx:1,sy:1,sz:1}})}(p),p}(s,a,n,o));dx(e,l,r.addFolder(Qi(l)))})).name(""),e.children.forEach(s=>s.isGeoGroup&&dx(e,s,r.addFolder(Qi(s)))),t}function OP(i){return i.map(e=>function(t){const{url:r,globalConfig:s,materialType:a,isListMaterial:n,edgeMaterialType:o,listMaterial:l,children:h,RootMaterials:c}=t;return hi(Ae({},In(t)),{url:r,globalConfig:s,materialType:a,isListMaterial:n,edgeMaterialType:o,listMaterial:l==null?void 0:l.map(u=>Kd(u)),RootMaterials:s.isSaveMaterials?c.map(u=>m0(u)):void 0,children:s.isSaveChildren?ep(h):void 0})}(e))}function px(i,e,t){Fb(e,t.addFolder(""));const{globalConfig:r}=e;t.add(r,"isSaveChildren").name(""),t.add(r,"isSaveMaterials").name(""),t.add(r,"useGlobalConfig").name("");const s=t.addFolder("");s.add(r.mesh,"castShadow").name("").onChange(()=>e.children.forEach(a=>a.castShadow=r.mesh.castShadow)),s.add(r.mesh,"receiveShadow").name("").onChange(()=>e.children.forEach(a=>a.receiveShadow=r.mesh.receiveShadow)),function(a,n){const{globalConfig:o}=a,{geometry:l}=o;let h=null;function c(){h&&clearTimeout(h),h=setTimeout(()=>{a.children.forEach(u=>{u.geometry.dispose(),u.geometry=new Cs(u.curve,(u.curve.points.length-1)*l.tubularSegmentsMultiple,l.radius,l.radialSegments,l.closed),u.geometry.center()}),h=null},200)}n.add(l,"tubularSegmentsMultiple",1).name("").onChange(c).step(1),n.add(l,"radius",.01).name("").onChange(c),n.add(l,"radialSegments",2).name("").onChange(c).step(1),n.add(l,"closed").name("").onChange(c)}(e,t.addFolder("")),qb(i,e,t.addFolder("")),t.addFn(()=>{t.parent.removeFolder(t),i.remove(e)}).name("")}function Yb(i,e,t=0){const r=new vi;return r.materialType=e,r.url=i,r.dlength=t,function(s){s.globalConfig={useGlobalConfig:!1,isSaveMaterials:!0,isSaveChildren:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{color:16777215,wireframe:!1,transparent:!0,opacity:1,metalness:0,roughness:0,emissive:0,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,sheen:0,sheenRoughness:0,sheenColor:0,transmission:0,envMap:!1,envMapIntensity:1,reflectivity:.98,mapUrl:"",textureAnimation:{isTextureAnimation:!1,offset:{x:0,y:.01},rotation:0},map:{repeat:{x:1,y:1},offset:{x:0,y:0},center:{x:0,y:0},rotation:0}},geometry:{radialSegments:4,radius:2,closed:!1,tubularSegmentsMultiple:1}}}(r),fetch(i).then(s=>s.json()).then(s=>{const{features:a}=s;return a.forEach(n=>{n.geometry.type==="MultiPolygon"?n.geometry.coordinates.forEach(o=>o.forEach(l=>Um(r,l))):n.geometry.type==="Polygon"?n.geometry.coordinates.forEach(o=>Um(r,o)):n.geometry.type==="LineString"&&n.geometry.coordinates.length>1&&Um(r,n.geometry.coordinates)}),Wb(r),r.RootMaterials=$d(r),r.rotation.x=-Math.PI/2,r.isBorderGroup=!0,r})}function Um(i,e){if(e.length<i.dlength)return;const t=e.map(o=>function(l,h=1e4){const[c,u]=l,[d,p]=Fi("EPSG:4326","EPSG:3857",[c,u]);return new S(d/h,p/h,0)}(o)),r=new Fd(t),s=new Cs(r,t.length-1,2,4,!1),a=Nr(i.materialType,{color:16777215*Math.random(),transparent:!0,alphaHash:!0}),n=new ue(s,a);n.curve=r,Gb(n),i.attach(n)}function UP(i){return i.map(e=>function(t){const{children:r,RootMaterials:s}=t;return hi(Ae({},_0(t)),{globalConfig:t.globalConfig,url:t.url,dlength:t.dlength,materialType:t.materialType,RootMaterials:t.globalConfig.isSaveMaterials?s.map(a=>m0(a)):void 0,children:t.globalConfig.isSaveChildren?ep(r):void 0})}(e))}function FP(i,e){e&&e.forEach(t=>function(r,s){return Rr(this,null,function*(){if(!s)return;const a=yield Yb(s.url,s.materialType,s.dlength);a.globalConfig=s.globalConfig;const{geometry:n}=a.globalConfig;return a.children.forEach(o=>{o.geometry.dispose(),o.geometry=new Cs(o.curve,(o.curve.points.length-1)*n.tubularSegmentsMultiple,n.radius,n.radialSegments,n.closed),o.geometry.center()}),r.add(a),y0(a,s),Xb(r,a),a.globalConfig.isSaveChildren&&tp(a.children,s.children),a.globalConfig.isSaveMaterials&&a.RootMaterials.forEach((o,l)=>f0(o,s.RootMaterials[l])),a})}(i,t))}function Zb(i,e,t){const r=Kb(t),s=function(n,o){const{uniforms:l,fragmentFunc:h,fragmentBody:c,key:u,render:d}=function(f,v,m=""){const{name:g,customUniforms:_,key:y,fragment:x,render:M}=tb[v],b={uniforms:Ae({},hd(f,["pointTexture-texture-sampler2D-"+m,"size-number-float-100","discardVal-number-float-0.5","opacity-number-float-1","isdecaySize-bool-bool-true","hasUv-bool-bool-true","iTime-number-float-0","speed-number-float-0.01","intensity-number-float-1","mixRatio-number-float-1","mixColor-color-vec3-0xffffff","iResolution-dom-vec2-0,0"])),fragmentFunc:"",fragmentBody:"",key:y,shaderProgramsCodeName:g};if(_&&Object.assign(b.uniforms,hd(f,_)),x.search("<SPLIT_PLACEHOLDER>")!==-1){const[w,T]=x.split("<SPLIT_PLACEHOLDER>");b.fragmentFunc=w,b.fragmentBody=T.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;")}else b.fragmentBody=x.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;");return b.render=M==="iTime+speed"?()=>b.uniforms.iTime.value+=b.uniforms.speed.value:new Function(M).bind(b.uniforms),b}(n,o.shaderCodeName,o.mapUrl),p=new tt({uniforms:l,vertexShader:`

            uniform float size;

            uniform bool isdecaySize;

            void main() {

                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

                gl_PointSize = isdecaySize ? size * ( 300.0 / -mvPosition.z ) : size;

                gl_Position = projectionMatrix * mvPosition;

            } 

        `,fragmentShader:Object.keys(l).map(f=>"uniform "+l[f].unit+" "+f+`;
`).join("")+`${h}void main() {

            vec2 vUv = gl_PointCoord.xy - .5;

            ${c}
            
            vec3 useColor = ${u};

            vec4 textureColor = texture2D( pointTexture, gl_PointCoord );

            if (textureColor.a < discardVal) discard;

            else useColor *= textureColor.rgb;

            gl_FragColor = vec4( mix( mixColor, useColor * vec3( intensity, intensity, intensity), mixRatio ) , opacity );
            
        }`,transparent:!0,depthTest:!0,blending:As});return p.materialRender=d,p}(e,t),a=new na(r,s);return a.parameters=t,a.commonAnimateRender=()=>{var n,o,l,h;(o=(n=a.geometry).geometryRender)==null||o.call(n),(h=(l=a.material).materialRender)==null||h.call(l)},a.isParticleMesh=!0,i.add(a),i.commonFrames.push(a),a}function Kb(i){if(i.outer-i.inner<1)return new Re;const e=new Float32Array(3*i.particlesSum),t=new Float32Array(3*i.particlesSum),r={:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]+=Math.abs((Math.random()-.5)*i.maxVelocity/1e5),t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]-=Math.abs((Math.random()-.5)*i.maxVelocity/1e5),t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},:n=>{t[3*n]=0,t[3*n+1]+=i.maxVelocity/2/1e5,t[3*n+2]=0},:n=>{t[3*n]=0,t[3*n+1]-=i.maxVelocity/2/1e5,t[3*n+2]=0}}[i.sportType];function s(){let n,o,l;do n=2*Math.random()*i.outer-i.outer,o=2*Math.random()*i.outer-i.outer,l=2*Math.random()*i.outer-i.outer;while(Math.abs(n)<=i.inner&&Math.abs(o)<=i.inner&&Math.abs(l)<=i.inner);return[n,o,l]}for(let n=0;n<i.particlesSum;n++)e.set(s(),3*n);const a=new Re;return a.setAttribute("position",new Ze(e,3)),a.geometryRender=()=>{for(let n=0;n<i.particlesSum;n++)if(r(n),e[3*n]+=t[3*n],e[3*n+1]+=t[3*n+1],e[3*n+2]+=t[3*n+2],Math.abs(e[3*n])>i.outer||Math.abs(e[3*n+1])>i.outer||Math.abs(e[3*n+2])>i.outer||Math.abs(e[3*n])<i.inner&&Math.abs(e[3*n+1])<i.inner&&Math.abs(e[3*n+2])<i.inner){const[o,l,h]=s();e[3*n]=o,e[3*n+1]=l,e[3*n+2]=h,t[3*n]=0,t[3*n+1]=0,t[3*n+2]=0}a.attributes.position.needsUpdate=!0},a}function mx(i,e,t){Ns(e,t.addFolder("")),function(r,s){let a=null;function n(){a||(r.geometry.dispose(),r.geometry=new Re,a=setTimeout(()=>{r.geometry=Kb(r.parameters),a=null},200))}s.add(r.parameters,"particlesSum",1).name("").onChange(n),s.add(r.parameters,"inner",0).name("").onChange(n),s.add(r.parameters,"outer",500).name("").onChange(n),s.add(r.parameters,"maxVelocity").name("").onChange(n),s.add(r.parameters,"sportType",["","","","",""]).name("").onChange(n)}(e,t.addFolder("")),function(r,s){s.add(r,"depthTest").name("").onChange(()=>r.needsUpdate=!0),s.add(r,"blending",u0).name("").onChange(a=>(r.blending=Number(a),r.needsUpdate=!0)),ku(r.uniforms,s.addFolder(""))}(e.material,t.addFolder("")),t.addFn(()=>i.transformControls.attach(e)).name(""),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("")}function kP(i){return i.map(e=>function(t){const{material:r}=t,{uniforms:s,blending:a,depthTest:n}=r;return hi(Ae({},In(t)),{parameters:t.parameters,material:{uniforms:ib(s),blending:a,depthTest:n}})}(e))}function BP(i,e,t){t==null||t.map(r=>function(s,a,n){if(!n)return;const o=Zb(s,a,n.parameters);Ln(o,n);const{material:l}=n;return o.material.blending=l.blending,o.material.depthTest=l.depthTest,rb(o.material.uniforms,l.uniforms),l.needsUpdate=!0,o}(i,e,r))}function fx(i,e,t){Ns(e,t.addFolder("")),function(r,s){const{geometry:a}=r,{parameters:n}=a,{options:o}=n;let l=null;function h(){l&&clearTimeout(l),l=setTimeout(()=>{r.geometry.dispose(),r.geometry=new Bb(r.text,o),l=null},200)}s.add(r,"text").onChange(h).name(""),s.add(o,"size").onChange(h).name(""),s.add(o,"depth").onChange(h).name(""),s.add(o,"height").onChange(h).name(""),s.add(o,"curveSegments").onChange(h).name("").step(1).min(1),s.add(o,"bevelEnabled").onChange(h).name(""),s.add(o,"bevelThickness").onChange(h).name(""),s.add(o,"bevelSize").onChange(h).name(""),s.add(o,"bevelSegments").onChange(h).name("").step(1).min(0)}(e,t.addFolder("")),Jd(i,e.material,t.addFolder("")),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("")}function zP(i){return i.map(e=>function(t){const{material:r,geometry:s}=t,{parameters:a}=s,{options:n}=a;return hi(Ae({},In(t)),{fontLink:t.fontLink,text:t.text,geometry:{geometryType:"TextGeometry",parameters:{size:n.size,depth:n.depth,height:n.height,curveSegments:n.curveSegments,bevelEnabled:n.bevelEnabled,bevelThickness:n.bevelThickness,bevelSize:n.bevelSize,bevelSegments:n.bevelSegments}},material:Kd(r)})}(e))}function VP(i,e){e==null||e.forEach(t=>function(r,s){return Rr(this,null,function*(){if(!s)return;const{geometry:a,material:n}=s,{parameters:o}=a,l=yield zb(s.fontLink,s.text,o),h=Nr(n.materialType),c=new ue(l,h);return c.fontLink=s.fontLink,c.text=s.text,c.isTextMesh=!0,r.add(c),Qd(r,c.material,n),Ln(c,s),c})}(i,t))}const HP={name:"",initParameters:{url:"http://guangfu/channels/lightMap.png",size:.25},initPanel:function(i){i.add(this.initParameters,"url").name(""),i.add(this.initParameters,"size").name("")},create:function({},i){const e=Ae(Ae({},this.initParameters),i==null?void 0:i.initParameters),t=new Rt(e.size||.3,e.size||.3,20,6),r=new Wt({color:16572044,transparent:!0,opacity:.5,side:Mt}),s=new ue(t,r);r.blending=As;const a=new is().load(e.url);a.wrapS=jt,a.wrapT=jt;const n=new as(1.5,20),o=new Wt({transparent:!0,opacity:.3,side:Mt,map:a});o.blending=As,o.depthTest=!1;const l=new ue(n,o),h=l.clone();h.rotation.y=Math.PI/3;const c=l.clone();c.rotation.y=-Math.PI/3,s.add(c),s.add(l),s.add(h),s.position.y=10;const u=new vi;return u.RootMaterials=[r,o],u.add(s),u.initParameters=e,u},changePanel(i,e,{}){const[t,r]=i.RootMaterials;e.add(i.initParameters,"url").name(""),e.addHexColor(t.color).name(""),e.add(t,"opacity",0,1).name(""),e.addHexColor(r.color).name(""),e.add(r,"opacity",0,1).name(""),e.addFn(()=>{const{url:s}=i.initParameters;if(!s)return;const a=new is().load(s);a.wrapS=jt,a.wrapT=jt,i.children[0].children.forEach(n=>{n.material.map=a})}).name("")},getStorage:function(i){const{initParameters:e}=i,[t,r]=i.RootMaterials;return{initParameters:e,RootMaterials:[{color:t.color.getHex(),opacity:t.opacity},{color:r.color.getHex(),opacity:r.opacity}]}},setStorage:function(i,e){if(!e)return;const[t,r]=i.RootMaterials,[s,a]=e.RootMaterials;t.color.setHex(s.color),t.opacity=s.opacity,r.color.setHex(a.color),r.opacity=a.opacity}};class ip extends ue{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Gt;const r=this,s=t.color!==void 0?new oe(t.color):new oe(8355711),a=t.textureWidth||512,n=t.textureHeight||512,o=t.clipBias||0,l=t.shader||ip.ReflectorShader,h=t.multisample!==void 0?t.multisample:4,c=new Cr,u=new S,d=new S,p=new S,f=new me,v=new S(0,0,-1),m=new Ve,g=new S,_=new S,y=new Ve,x=new me,M=this.camera,b=new ht(a,n,{samples:h,type:Ht}),w=new tt({name:l.name!==void 0?l.name:"unspecified",uniforms:Kt.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});w.uniforms.tDiffuse.value=b.texture,w.uniforms.color.value=s,w.uniforms.textureMatrix.value=x,this.material=w,this.onBeforeRender=function(T,R,I){if(d.setFromMatrixPosition(r.matrixWorld),p.setFromMatrixPosition(I.matrixWorld),f.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),g.subVectors(d,p),g.dot(u)>0)return;g.reflect(u).negate(),g.add(d),f.extractRotation(I.matrixWorld),v.set(0,0,-1),v.applyMatrix4(f),v.add(p),_.subVectors(d,v),_.reflect(u).negate(),_.add(d),M.position.copy(g),M.up.set(0,1,0),M.up.applyMatrix4(f),M.up.reflect(u),M.lookAt(_),M.far=I.far,M.updateMatrixWorld(),M.projectionMatrix.copy(I.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(M.projectionMatrix),x.multiply(M.matrixWorldInverse),x.multiply(r.matrixWorld),c.setFromNormalAndCoplanarPoint(u,d),c.applyMatrix4(M.matrixWorldInverse),m.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const E=M.projectionMatrix;y.x=(Math.sign(m.x)+E.elements[8])/E.elements[0],y.y=(Math.sign(m.y)+E.elements[9])/E.elements[5],y.z=-1,y.w=(1+E.elements[10])/E.elements[14],m.multiplyScalar(2/m.dot(y)),E.elements[2]=m.x,E.elements[6]=m.y,E.elements[10]=m.z+1-o,E.elements[14]=m.w,r.visible=!1;const L=T.getRenderTarget(),D=T.xr.enabled,U=T.shadowMap.autoUpdate;T.xr.enabled=!1,T.shadowMap.autoUpdate=!1,T.setRenderTarget(b),T.state.buffers.depth.setMask(!0),T.autoClear===!1&&T.clear(),T.render(R,M),T.xr.enabled=D,T.shadowMap.autoUpdate=U,T.setRenderTarget(L);const H=I.viewport;H!==void 0&&T.state.viewport(H),r.visible=!0},this.getRenderTarget=function(){return b},this.dispose=function(){b.dispose(),r.material.dispose()}}}ip.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const GP={name:"",disBlendShader:!0,initParameters:{clipBias:.01,color:12700619},initPanel:function(i){i.add(this.initParameters,"clipBias").name(""),i.addColor(this.initParameters,"color").name("")},create:function(i,e){const t=Ae(Ae({},this.initParameters),e==null?void 0:e.initParameters),{DOM:r,renderer:s}=i,a=new ip(new as(100,100),Ae({clipBias:.01,textureWidth:r.clientWidth*s.getPixelRatio(),textureHeight:r.clientHeight*s.getPixelRatio(),color:12700619},t));return a.initParameters=t,a.rotateX(-Math.PI/2),a},changePanel:function(i,e){const{material:t}=i;e.add(t,"visible").name(""),e.add(t,"wireframe").name(""),e.addHexColor(t.uniforms.color.value).name("")},getStorage:function(i){const{material:e,initParameters:t}=i;return{initParameters:t,material:{wireframe:e.wireframe,color:e.uniforms.color.value.getHex()}}},setStorage:function(i,e){if(!e)return;const{material:t}=i;t.wireframe=e.material.wireframe,t.uniforms.color.value.setHex(e.material.color)}},Qb=Object.values(Object.assign({"../../Addons/DesignMesh/LightColumn.js":HP,"../../Addons/DesignMesh/Mirror.js":GP})),ec=i=>Qb.find(e=>e.name===i);function gx(i,e,t){var r;const{scene:s,transformControls:a}=t,n=ec(i.designType);Ns(i,e.addFolder("")),(r=n.changePanel)==null||r.call(n,i,e.addFolder(""),t),e.addFn(()=>a.attach(i)).name(""),e.addFn(()=>{s.remove(i),e.parent.removeFolder(e)}).name("")}function Jb(i,e,t){const r=i.create(e,t);if(r)return r.isDesignMesh=!0,r.designType=i.name,i.disBlendShader&&(r.disBlendShader=!0),r}function jP(i){return i.map(e=>function(t){var r;const{designType:s}=t,a=ec(s);return Ae(Ae({designType:s},In(t)),(r=a.getStorage)==null?void 0:r.call(a,t))}(e))}function WP(i,e){e==null||e.forEach(t=>function(r,s){var a;if(!s)return;const{scene:n}=r,o=ec(s.designType),l=Jb(o,r,s);n.add(l),Ln(l,s),(a=o.setStorage)==null||a.call(o,l,s,r)}(i,t))}function vx(i,e){var t;const r=ec(i);r&&((t=r.initPanel)==null||t.call(r,e))}function XP(){return{modelCore:{rootFolder:null,insertModel:null,progressList:[],url:"",modelAnimationPlay:x0},innerMeshCore:{geometryType:"",materialType:""},drawCore:{mode:"",pointMode:"",pointModeList:["","",""],modeList:["","","",""],materialType:"",drawEventCall:null,currentDrawFolder:null,sceneEventCall:function(i,e){var t,r,s,a,n;switch(this.pointMode){case"":return(t=this.drawEventCall)==null?void 0:t.call(this,i);case"":return(r=e.geoInfo)!=null&&r.properties.centroidCoord3?(s=this.drawEventCall)==null?void 0:s.call(this,e.parent.getTransformedVector(e.geoInfo.properties.centroidCoord3.clone().add(e.position).sub(e.initTranslate))):void 0;case"":return(a=e.geoInfo)!=null&&a.properties.centerCoord3?(n=this.drawEventCall)==null?void 0:n.call(this,e.parent.getTransformedVector(e.geoInfo.properties.centerCoord3.clone().add(e.position).sub(e.initTranslate))):void 0}}},chartsMapCore:{url:"https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json",materialType:"",isListMaterial:!0,edgeMaterialType:"",progressList:[],createGeoGroup:b0},particleCore:{particlesSum:1e5,inner:0,outer:2e3,maxVelocity:50,mapUrl:"http://guangfu/icon/snow.png",sportType:"",shaderCodeName:""},textMeshCore:{fontLink:"http://guangfu/font/cn.json",text:"",materialType:""},designMeshCore:{type:""},borderGroupCore:{url:"https://geo.datav.aliyun.com/areas_v3/bound/100000.json",materialType:"",dlength:0}}}function qP(i){const e={lightList:[],modelList:[],innerMeshList:[],drawMeshList:[],geoGroupList:[],borderGroupList:[],particleList:[],textMeshList:[],designMeshList:[]};return i.children.forEach(t=>{t.isLight?e.lightList.push(t):t.rootInfo?e.modelList.push(t):t.isInnerMesh?e.innerMeshList.push(t):t.isDrawMesh?e.drawMeshList.push(t):t.isGeoGroup?e.geoGroupList.push(t):t.isParticleMesh?e.particleList.push(t):t.isTextMesh?e.textMeshList.push(t):t.isBorderGroup?e.borderGroupList.push(t):t.isDesignMesh&&e.designMeshList.push(t)}),{lighting:iR(e.lightList),modelList:xP(e.modelList),innerMeshList:MP(e.innerMeshList),drawMeshList:PP(e.drawMeshList),geoGroupList:OP(e.geoGroupList),particleList:kP(e.particleList),textMeshList:zP(e.textMeshList),borderGroupList:UP(e.borderGroupList),designMeshList:jP(e.designMeshList)}}function YP(i,e,t){if(!t)return;const{scene:r,DOM:s}=i,{modelCore:a,chartsMapCore:n}=e;(function(o,l){l&&l.forEach(h=>{const c=v0(h.type);tR(c,h),c.target&&o.add(c.target),o.add(c)})})(r,t.lighting),function(o,l){l&&(o.progressList=l.map(h=>o.insertModel(h.rootInfo,h.group)))}(a,t.modelList),bP(r,t.innerMeshList),IP(r,t.drawMeshList),function(o,l,h){h&&(o.progressList=h.map(c=>NP(l,c)))}(n,r,t.geoGroupList),FP(r,t.borderGroupList),BP(r,s,t.particleList),VP(r,t.textMeshList),WP(i,t.designMeshList)}function ZP(i,e,t){const{scene:r,DOM:s}=i,{modelCore:a,innerMeshCore:n,drawCore:o,chartsMapCore:l,borderGroupCore:h,particleCore:c,textMeshCore:u,designMeshCore:d}=e,p={:()=>function(f,v){const m={lightList:{:"AmbientLight",:"DirectionalLight",:"PointLight",:"SpotLight",:"HemisphereLight",:"RectAreaLight"},lightType:"AmbientLight",findKey(g){return Object.keys(this.lightList).find(_=>this.lightList[_]===g)}};return v.add(m,"lightType",m.lightList).name(""),v.addFn(function(){const g=v0(m.lightType);g.target&&f.add(g.target),f.attach_add(g),Gy(g,v.addFolder(m.findKey(g.type)+"-"+g.id),f.transformControls)}).name(""),f.children.forEach(g=>{g instanceof Ls&&Gy(g,v.addFolder(m.findKey(g.type)+"-"+g.id),f.transformControls)}),v}(r,t.addCoreDragFolder("")),:()=>function(f,v){return f.rootFolder=v,v.add(f,"url").name(""),v.addFn(()=>{const m=function(g){if(!g)return;const _=g.split(".").pop().toUpperCase();return _&&["FBX","GLB","GLTF","OBJ"].includes(_)?{url:g,type:_==="GLB"?"GLTF":_}:void 0}(f.url);m&&f.insertModel(m)}).name(""),f.scene.children.forEach(m=>{m.rootInfo&&kb(f.controls,f.transformControls,f.effectComposer,m,v.addFolder(Qi(m)))}),v}(a,t.addCoreDragFolder("")),:()=>wP(n,r,t.addCoreDragFolder("")),:()=>function(f,v,m){return m.add(f,"mode",f.modeList).name(""),m.add(f,"pointMode",f.pointModeList).name(""),m.add(f,"materialType",Eo).name(""),m.addFn(()=>{f.currentDrawFolder&&f.currentDrawFolder.close(),f.currentDrawFolder=m.addDateFolder(f.mode),hx(f,v,f.currentDrawFolder),f.currentDrawFolder.open()}).name(""),v.children.forEach(g=>g.isDrawMesh&&hx(f,v,m.addFolder(Qi(g)),g.drawParams)),m}(o,r,t.addCoreDragFolder("")),:()=>DP(l,r,t.addCoreDragFolder("")),:()=>function(f,v,m){const g=m.addFolder("");return g.open(),m.add(f,"url").name(""),m.add(f,"materialType",Eo).name(""),m.add(f,"dlength",0).name(""),m.addFn(()=>{Yb(f.url,f.materialType,f.dlength).then(_=>{v.attach_add(_),px(v,_,g.addFolder(Qi(_)))})}).name(""),v.children.forEach(_=>{_.isBorderGroup&&px(v,_,g.addFolder(Qi(_)))}),m}(h,r,t.addCoreDragFolder("")),:()=>function(f,v,m,g){const _=g.addFolder("");_.open();const y=g.addFolder("");return y.open(),y.add(f,"particlesSum").name(""),y.add(f,"inner").name(""),y.add(f,"outer").name(""),y.add(f,"maxVelocity").name(""),y.add(f,"mapUrl").name(""),y.add(f,"shaderCodeName",Object.keys(tb)).name(""),y.add(f,"sportType",["","","","",""]).name(""),g.addFn(()=>{const{particlesSum:x,inner:M,outer:b,maxVelocity:w,sportType:T,mapUrl:R,shaderCodeName:I}=f,E=Zb(v,m,{particlesSum:x,inner:M,outer:b,maxVelocity:w,sportType:T,mapUrl:R,shaderCodeName:I});mx(v,E,_.addFolder(Qi(E)))}).name(""),v.children.forEach(x=>x.isParticleMesh&&mx(v,x,_.addFolder(Qi(x)))),g}(c,r,s,t.addCoreDragFolder("")),:()=>function(f,v,m){const g=m.addFolder("");return g.open(),m.add(f,"fontLink").name(""),m.add(f,"materialType",Eo).name(""),m.add(f,"text").name(""),m.addFn(()=>{f.text&&zb(f.fontLink,f.text).then(_=>{const y=Nr(f.materialType),x=new ue(_,y);x.fontLink=f.fontLink,x.text=f.text,x.isTextMesh=!0,v.attach_add(x),fx(v,x,g.addFolder(x.text.slice(0,8)+" "+x.id))})}).name(""),v.children.forEach(_=>_.isTextMesh&&fx(v,_,g.addFolder(_.text.slice(0,8)+" "+_.id))),m}(u,r,t.addCoreDragFolder("")),:()=>function(f,v,m){const{scene:g}=v,_=m.addFolder("");let y;m.add(f,"type",Qb.map(x=>x.name)).name("").onChange(x=>{y.parent.removeFolder(y),y=m.addFolder(x+""),vx(x,y),y.open()}),m.addFn(()=>{const x=ec(f.type),M=Jb(x,v);M&&(g.attach_add(M),gx(M,_.addFolder(`${x.name}-${M.id}`),v))}).name(""),y=m.addFolder(f.type+""),vx(f.type,y),g.children.forEach(x=>x.isDesignMesh&&gx(x,_.addFolder(x.designType+"-"+Qi(x)),v))}(d,i,t.addCoreDragFolder(""))};for(const f in p)t.add(p,f);return{folder:t,panels:p}}function _x(i,e,t){t.add(e,"name").name(""),t.addFn(()=>function(r,s){r.target.set(s.target.x,s.target.y,s.target.z),r.object.position.set(s.position.x,s.position.y,s.position.z),r.update()}(i,e)).name(""),t.addFn(()=>{ud(i.target,e.target),ud(i.object.position,e.position)}).name(""),t.addFn(()=>{const r=i.viewAngleList.indexOf(e);r!==-1&&i.viewAngleList.splice(r,1),t.parent.removeFolder(t)}).name("")}function KP(i,e,t){const r=function(a){a.open();const n={mode:"to",query:{duration:2,ease:"none",repeat:0,yoyo:!1}};return a.add(n,"mode",["to","from","fromTo"]).name(""),a.add(n.query,"duration",0,10).name(""),a.add(n.query,"ease",["none","power1","power2","power3","power4","back","elastic","bounce"]).name(""),a.add(n.query,"repeat",0).name(""),a.add(n.query,"yoyo").name(""),n}(t.addFolder(""));let s=null;return t.addFn(function(){const{currentInfo:a}=i;if(!a)return;let n;i.mode==""?n=a.currentModel:i.mode==""?n=a.currentRootModel:i.mode==""&&(n=i.isTransformChildren?a.currentModel:a.currentRootModel),s&&t.removeFolder(s),s=t.addFolder(Qi(n)+""),e.attach(n),function(o,l,h){const c=h.addFolder("");o._transformInfo=go(o),o.transformAnimationList?o.transformAnimationList.forEach((u,d)=>yx(o,u,c.addFolder("["+Date.now()+d+"]"))):o.transformAnimationList=[],h.addFn(()=>cd(o,o._transformInfo)).name(""),h.addFn(()=>o._transformInfo=go(o)).name(""),h.addFn(()=>cb(o,o._transformInfo,go(o),l)).name(""),h.addFn(()=>{const u=function(d,p){const{mode:f,query:v}=p;return{name:"",_transformInfo:d._transformInfo,transformInfo_:go(d),gsapParams:{mode:f,query:Ae({},v)}}}(o,l);o.transformAnimationList.push(u),c.open(),yx(o,u,c.addFolder("["+Date.now()+"]"))}).name("")}(n,r,s)}).name(""),t}function yx(i,e,t){t.add(e,"name").name("");const r={play:()=>{const{gsapParams:s,_transformInfo:a,transformInfo_:n}=e;cb(i,a,n,s)},del:()=>{i.transformAnimationList.splice(i.transformAnimationList.indexOf(e),1),t.parent.removeFolder(t)}};t.add(r,"play").name(""),t.add(r,"del").name("")}function QP(i,e,t,r,s,a,n){const o={:()=>function(l,h){const c=h.addFolder("");return l.viewAngleList?l.viewAngleList.forEach((u,d)=>_x(l,u,c.addFolder((u.name||"")+"["+Date.now()+d+"]"))):l.viewAngleList=[],h.addFn(()=>{const u=function(d){return{name:"",target:{x:d.target.x,y:d.target.y,z:d.target.z},position:{x:d.object.position.x,y:d.object.position.y,z:d.object.position.z}}}(l);l.viewAngleList.push(u),_x(l,u,c.addFolder(u.name||"["+Date.now()+"]")),c.open()}).name(""),h}(r,n.addCoreDragFolder("")),:()=>KP(t,s,n.addCoreDragFolder("")),:()=>function(l,h,c,u){const d=u.addFolder("");return d.open(),u.add(c,"clipPlaneSize",0).name(""),u.addFn(()=>{const p=bb();wb(p,c.clipPlaneSize),Vy(l,h,c,p,d.addDateFolder("")),l.add(p.helper),h.clippingPlanes.push(p)}).name(""),h.clippingPlanes.forEach((p,f)=>Vy(l,h,c,p,d.addFolder(`${f}`))),u}(i,e,a,n.addCoreDragFolder(""))};for(const l in o)n.add(o,l);return{folder:n,panels:o}}function JP(i,e){const t=hi(Ae({},XP()),{handler:{mode:"",openKey:!1,selectPanelEnable:!1,keyDown:null,keyDownCallback:null,modeList:["","","","",""],isTransformChildren:!1,handlerHistory:null,helpers:{axes:{showAxes:!0,axesLength:1e3,axesHelper:null},grid:{showGrid:!0,size:1e3,divisions:15,colorCenterLine:4473924,colorGrid:8947848,gridHelper:null},box3:{useBox3:!0,color:16776960}}},animateCore:{clipPlaneSize:20}}),r=function(c,u){const{scene:d,transformControls:p,effectComposer:f,stats:v,DOM:m}=c,{outlinePass:g}=f.effectPass,{handler:_}=u,{shaderLibrary:y,setObjectBlendShader:x}=aC(d,m);return YC(d,v,_,p,g),function(M,b){const{scene:w,controls:T,transformControls:R,effectComposer:I}=M,{modelCore:E}=b;yP(E,w,T,R,I)}(c,u),{shaderLibrary:y,setObjectBlendShader:x}}(i,t),s={};xx(i,t,e);const{scene:a,transformControls:n,effectComposer:o,css3DRender:l,css2DRender:h}=i;return Ae(hi(Ae(hi(Ae({},t),{addons:s}),r),{saveSceneEdit:()=>(n.detach(),o.effectPass.outlinePass.selectedObjects=[],function(c,u){const{scene:d,camera:p,renderer:f,controls:v,transformControls:m,effectComposer:g}=c,{handler:_}=u;return hi(Ae(Ae({},VC(d,p,f,v,m,g)),qP(d)),{handler:ZC(_)})}(i,t)),resetEditorStorage:c=>{a.resetFrames(),a.children.filter(u=>!u.isTransformControls&&!u.isPerspectiveCamera).forEach(u=>(a.remove(u),db(u))),a.resetEnv(),l.reset(),h.reset(),xx(i,t,c)}}),$P(i,t))}function xx(i,e,t){if(!t)return;const{scene:r,camera:s,renderer:a,controls:n,transformControls:o,effectComposer:l,stats:h}=i,{handler:c}=e;HC(r,s,a,n,o,l,t),KC(r,o,h,c,t.handler),YP(i,e,t)}function $P(i,e){const{scene:t,camera:r,renderer:s,controls:a,transformControls:n,effectComposer:o,stats:l}=i,{handler:h,animateCore:c}=e,u=bC();return MC(t,u),{GUI:u,openControlPanel:function(){u.__folders.||function(...d){const p=gC({style:"max-width: 500px;",tabButtonActiveColor:"rgba(255, 255, 255, 0.1)",tabButtonHoverColor:"none",tabButtonRowColor:"black",tabButtonBorderStyle:"none",tabButtonRowStyleOverrides:{display:"flex","justify-content":"space-evenly",color:"white","background-color":"none"},tabButtonStyleOverrides:{padding:"0.4em 0.8em",color:"#ffffff","font-size":"13px"}},d.reduce((x,M)=>(M.folder.open(),hi(Ae({},x),{[M.folder.name]:zy(M.folder.domElement)})),{})),f=Xe.state(220),v=Xe.state("auto"),m=Xe.state(window.innerWidth-220),g=Xe.state(20),_=Xe.state(!1);try{const x=localStorage.getItem("threeEditor_Panel");if(x){const M=JSON.parse(x);d.forEach((b,w)=>b.folder.closed=M.panels[w].closed),m.val=M.x,g.val=M.y}}catch{}Xe.derive(()=>{if(g.val>window.innerHeight-100&&setTimeout(()=>g.val=window.innerHeight-200,100),g.val<0&&setTimeout(()=>g.val=0,100),m.val>window.innerWidth-100&&setTimeout(()=>m.val=window.innerWidth-200,100),m.val<0&&setTimeout(()=>m.val=0,100),_.val){const x=d.map(M=>{const{parent:b}=M.folder,w=M.folder.name;return delete b.__folders[w],b.load&&b.load.folders&&b.load.folders[w]&&delete b.load.folders[w],{closed:M.folder.closed}});localStorage.setItem("threeEditor_Panel",JSON.stringify({panels:x,x:m.val,y:g.val}))}});const y=fd(Ae({title:"3D-",x:m,y:g,closed:_,width:f,height:v,zIndex:99999,customStacking:!0},Oh),zy({style:`
            
                border: 1px solid rgba(255, 255, 255, 0.2);
                
                border-radius: 3px;

                padding: 5px 0px 5px 0px;
            
            `},p));Xe.add(document.body,y)}(GC(t,r,s,a,n,o,u.addFolder("")),QC(t,n,l,h,u.addFolder("")),ZP(i,e,u.addFolder("")),QP(t,s,h,a,n,c,u.addFolder("")))}}}function e3(){const i=new xf;i.ssrList=[],function(t){t.commonFrames=[],t.mixerFrames=[],t.shaderFrames=[],t.renderFrames=function(){t.mixerFrames.forEach(r=>r.mixerAnimateRender()),t.shaderFrames.forEach(r=>r.shaderAnimateRender()),t.commonFrames.forEach(r=>{var s;return(s=r.commonAnimateRender)==null?void 0:s.call(r)})},t.resetFrames=function(){["mixerFrames","shaderFrames","commonFrames"].forEach(r=>t[r].length=0)},t.removeFrames=function(r){(r instanceof ue||r instanceof vi||r.instanceOf===na)&&["commonFrames","mixerFrames","shaderFrames"].forEach(s=>{const a=t[s].indexOf(r);a!==-1&&t[s].splice(a,1)})}}(i),function(t){t.environmentEnabled=!1,t.envBackground=null,t.envMapChangeUseList=[];let r=null;Object.defineProperty(t,"envBackground",{get:()=>r,set:s=>{r=s,t.environmentEnabled?t.environment=t.envBackground:t.environment=null,t==null||t.envMapChangeUseList.forEach(a=>a())}}),t.setSceneBackground=function(s){var a;const n=new Cf().load(s);t.background=n,t.backgroundUrls=s,(a=t.backgroundLoadCallback)==null||a.call(t,n)},t.setEnvBackground=function(s){const a=new Cf().load(s);t.envBackground=a,t.envBackgroundUrls=s},t.resetEnv=function(){var s,a;t.envMapChangeUseList=[],(s=t.envBackground)==null||s.dispose(),t.envBackground=null,(a=t.background)==null||a.dispose(),t.background=null}}(i),i.setClassifyScene=function(t=""){i.children.forEach(r=>{(["Group","Mesh"].includes(r.type)||r.isLight)&&(t===""||t.some(s=>r.name.indexOf(s)!==-1)?r.visible=!0:r.visible=!1)})},i.attach_add=function(t){i.add(t),i.transformControls.attach(t)};const e=i.remove;return i.remove=function(t){var r;i.removeFrames(t),i.transformControls.object===t&&i.transformControls.detach(),e.call(i,t),(r=i.removeCall)==null||r.call(i,t)},i}var rh=function(){var i=0,e=document.createElement("div");function t(c){return e.appendChild(c.dom),c}function r(c){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===c?"block":"none";i=c}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(c){c.preventDefault(),r(++i%e.children.length)},!1);var s=(performance||Date).now(),a=s,n=0,o=t(new rh.Panel("FPS","#0ff","#002")),l=t(new rh.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new rh.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){n++;var c=(performance||Date).now();if(l.update(c-s,200),c>=a+1e3&&(o.update(1e3*n/(c-a),100),a=c,n=0,h)){var u=performance.memory;h.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return c},update:function(){s=this.end()},domElement:e,setMode:r}};rh.Panel=function(i,e,t){var r=1/0,s=0,a=Math.round,n=a(window.devicePixelRatio||1),o=80*n,l=48*n,h=3*n,c=2*n,u=3*n,d=15*n,p=74*n,f=30*n,v=document.createElement("canvas");v.width=o,v.height=l,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*n+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=t,m.fillRect(0,0,o,l),m.fillStyle=e,m.fillText(i,h,c),m.fillRect(u,d,p,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u,d,p,f),{dom:v,update:function(g,_){r=Math.min(r,g),s=Math.max(s,g),m.fillStyle=t,m.globalAlpha=1,m.fillRect(0,0,o,d),m.fillStyle=e,m.fillText(a(g)+" "+i+" ("+a(r)+"-"+a(s)+")",h,c),m.drawImage(v,u+n,d,p-n,f,u,d,p-n,f),m.fillRect(u+p-n,d,n,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u+p-n,d,n,a((1-g/_)*f))}}};const Mx={type:"change"},Fm={type:"start"},bx={type:"end"},_u=new Rn,wx=new Cr,t3=Math.cos(70*ti.DEG2RAD);class i3 extends ts{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new S,this.cursor=new S,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:qa.ROTATE,MIDDLE:qa.DOLLY,RIGHT:qa.PAN},this.touches={ONE:Ya.ROTATE,TWO:Ya.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(z){z.addEventListener("keydown",se),this._domElementKeyEvents=z},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",se),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(Mx),r.update(),a=s.NONE},this.update=function(){const z=new S,W=new Ke().setFromUnitVectors(e.up,new S(0,1,0)),ee=W.clone().invert(),ge=new S,Le=new Ke,Fe=new S,Se=2*Math.PI;return function(ke=null){const He=r.object.position;z.copy(He).sub(r.target),z.applyQuaternion(W),o.setFromVector3(z),r.autoRotate&&a===s.NONE&&E(function(ze){return ze!==null?2*Math.PI/60*r.autoRotateSpeed*ze:2*Math.PI/60/60*r.autoRotateSpeed}(ke)),r.enableDamping?(o.theta+=l.theta*r.dampingFactor,o.phi+=l.phi*r.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let it=r.minAzimuthAngle,Ce=r.maxAzimuthAngle;isFinite(it)&&isFinite(Ce)&&(it<-Math.PI?it+=Se:it>Math.PI&&(it-=Se),Ce<-Math.PI?Ce+=Se:Ce>Math.PI&&(Ce-=Se),o.theta=it<=Ce?Math.max(it,Math.min(Ce,o.theta)):o.theta>(it+Ce)/2?Math.max(it,o.theta):Math.min(Ce,o.theta)),o.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,o.phi)),o.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(c,r.dampingFactor):r.target.add(c),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let st=!1;if(r.zoomToCursor&&b||r.object.isOrthographicCamera)o.radius=ve(o.radius);else{const ze=o.radius;o.radius=ve(o.radius*h),st=ze!=o.radius}if(z.setFromSpherical(o),z.applyQuaternion(ee),He.copy(r.target).add(z),r.object.lookAt(r.target),r.enableDamping===!0?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,c.multiplyScalar(1-r.dampingFactor)):(l.set(0,0,0),c.set(0,0,0)),r.zoomToCursor&&b){let ze=null;if(r.object.isPerspectiveCamera){const Nt=z.length();ze=ve(Nt*h);const Oi=Nt-ze;r.object.position.addScaledVector(x,Oi),r.object.updateMatrixWorld(),st=!!Oi}else if(r.object.isOrthographicCamera){const Nt=new S(M.x,M.y,0);Nt.unproject(r.object);const Oi=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),r.object.updateProjectionMatrix(),st=Oi!==r.object.zoom;const ns=new S(M.x,M.y,0);ns.unproject(r.object),r.object.position.sub(ns).add(Nt),r.object.updateMatrixWorld(),ze=z.length()}else r.zoomToCursor=!1;ze!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(ze).add(r.object.position):(_u.origin.copy(r.object.position),_u.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(_u.direction))<t3?e.lookAt(r.target):(wx.setFromNormalAndCoplanarPoint(r.object.up,r.target),_u.intersectPlane(wx,r.target))))}else if(r.object.isOrthographicCamera){const ze=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/h)),ze!==r.object.zoom&&(r.object.updateProjectionMatrix(),st=!0)}return h=1,b=!1,!!(st||ge.distanceToSquared(r.object.position)>n||8*(1-Le.dot(r.object.quaternion))>n||Fe.distanceToSquared(r.target)>n)&&(r.dispatchEvent(Mx),ge.copy(r.object.position),Le.copy(r.object.quaternion),Fe.copy(r.target),!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",ae),r.domElement.removeEventListener("pointerdown",K),r.domElement.removeEventListener("pointercancel",B),r.domElement.removeEventListener("wheel",A),r.domElement.removeEventListener("pointermove",O),r.domElement.removeEventListener("pointerup",B),r.domElement.getRootNode().removeEventListener("keydown",k,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",se),r._domElementKeyEvents=null)};const r=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=s.NONE;const n=1e-6,o=new Lf,l=new Lf;let h=1;const c=new S,u=new X,d=new X,p=new X,f=new X,v=new X,m=new X,g=new X,_=new X,y=new X,x=new S,M=new X;let b=!1;const w=[],T={};let R=!1;function I(z){const W=Math.abs(.01*z);return Math.pow(.95,r.zoomSpeed*W)}function E(z){l.theta-=z}function L(z){l.phi-=z}const D=function(){const z=new S;return function(W,ee){z.setFromMatrixColumn(ee,0),z.multiplyScalar(-W),c.add(z)}}(),U=function(){const z=new S;return function(W,ee){r.screenSpacePanning===!0?z.setFromMatrixColumn(ee,1):(z.setFromMatrixColumn(ee,0),z.crossVectors(r.object.up,z)),z.multiplyScalar(W),c.add(z)}}(),H=function(){const z=new S;return function(W,ee){const ge=r.domElement;if(r.object.isPerspectiveCamera){const Le=r.object.position;z.copy(Le).sub(r.target);let Fe=z.length();Fe*=Math.tan(r.object.fov/2*Math.PI/180),D(2*W*Fe/ge.clientHeight,r.object.matrix),U(2*ee*Fe/ge.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(D(W*(r.object.right-r.object.left)/r.object.zoom/ge.clientWidth,r.object.matrix),U(ee*(r.object.top-r.object.bottom)/r.object.zoom/ge.clientHeight,r.object.matrix)):r.enablePan=!1}}();function Z(z){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?h/=z:r.enableZoom=!1}function te(z){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?h*=z:r.enableZoom=!1}function ie(z,W){if(!r.zoomToCursor)return;b=!0;const ee=r.domElement.getBoundingClientRect(),ge=z-ee.left,Le=W-ee.top,Fe=ee.width,Se=ee.height;M.x=ge/Fe*2-1,M.y=-Le/Se*2+1,x.set(M.x,M.y,1).unproject(r.object).sub(r.object.position).normalize()}function ve(z){return Math.max(r.minDistance,Math.min(r.maxDistance,z))}function be(z){u.set(z.clientX,z.clientY)}function J(z){f.set(z.clientX,z.clientY)}function ne(z){if(w.length===1)u.set(z.pageX,z.pageY);else{const W=ce(z),ee=.5*(z.pageX+W.x),ge=.5*(z.pageY+W.y);u.set(ee,ge)}}function de(z){if(w.length===1)f.set(z.pageX,z.pageY);else{const W=ce(z),ee=.5*(z.pageX+W.x),ge=.5*(z.pageY+W.y);f.set(ee,ge)}}function re(z){const W=ce(z),ee=z.pageX-W.x,ge=z.pageY-W.y,Le=Math.sqrt(ee*ee+ge*ge);g.set(0,Le)}function N(z){if(w.length==1)d.set(z.pageX,z.pageY);else{const ee=ce(z),ge=.5*(z.pageX+ee.x),Le=.5*(z.pageY+ee.y);d.set(ge,Le)}p.subVectors(d,u).multiplyScalar(r.rotateSpeed);const W=r.domElement;E(2*Math.PI*p.x/W.clientHeight),L(2*Math.PI*p.y/W.clientHeight),u.copy(d)}function P(z){if(w.length===1)v.set(z.pageX,z.pageY);else{const W=ce(z),ee=.5*(z.pageX+W.x),ge=.5*(z.pageY+W.y);v.set(ee,ge)}m.subVectors(v,f).multiplyScalar(r.panSpeed),H(m.x,m.y),f.copy(v)}function j(z){const W=ce(z),ee=z.pageX-W.x,ge=z.pageY-W.y,Le=Math.sqrt(ee*ee+ge*ge);_.set(0,Le),y.set(0,Math.pow(_.y/g.y,r.zoomSpeed)),Z(y.y),g.copy(_),ie(.5*(z.pageX+W.x),.5*(z.pageY+W.y))}function K(z){r.enabled!==!1&&(w.length===0&&(r.domElement.setPointerCapture(z.pointerId),r.domElement.addEventListener("pointermove",O),r.domElement.addEventListener("pointerup",B)),function(W){for(let ee=0;ee<w.length;ee++)if(w[ee]==W.pointerId)return!0;return!1}(z)||(function(W){w.push(W.pointerId)}(z),z.pointerType==="touch"?V(z):function(W){let ee;switch(W.button){case 0:ee=r.mouseButtons.LEFT;break;case 1:ee=r.mouseButtons.MIDDLE;break;case 2:ee=r.mouseButtons.RIGHT;break;default:ee=-1}switch(ee){case qa.DOLLY:if(r.enableZoom===!1)return;(function(ge){ie(ge.clientX,ge.clientX),g.set(ge.clientX,ge.clientY)})(W),a=s.DOLLY;break;case qa.ROTATE:if(W.ctrlKey||W.metaKey||W.shiftKey){if(r.enablePan===!1)return;J(W),a=s.PAN}else{if(r.enableRotate===!1)return;be(W),a=s.ROTATE}break;case qa.PAN:if(W.ctrlKey||W.metaKey||W.shiftKey){if(r.enableRotate===!1)return;be(W),a=s.ROTATE}else{if(r.enablePan===!1)return;J(W),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(Fm)}(z)))}function O(z){r.enabled!==!1&&(z.pointerType==="touch"?function(W){switch(xe(W),a){case s.TOUCH_ROTATE:if(r.enableRotate===!1)return;N(W),r.update();break;case s.TOUCH_PAN:if(r.enablePan===!1)return;P(W),r.update();break;case s.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(ee){r.enableZoom&&j(ee),r.enablePan&&P(ee)})(W),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;(function(ee){r.enableZoom&&j(ee),r.enableRotate&&N(ee)})(W),r.update();break;default:a=s.NONE}}(z):function(W){switch(a){case s.ROTATE:if(r.enableRotate===!1)return;(function(ee){d.set(ee.clientX,ee.clientY),p.subVectors(d,u).multiplyScalar(r.rotateSpeed);const ge=r.domElement;E(2*Math.PI*p.x/ge.clientHeight),L(2*Math.PI*p.y/ge.clientHeight),u.copy(d),r.update()})(W);break;case s.DOLLY:if(r.enableZoom===!1)return;(function(ee){_.set(ee.clientX,ee.clientY),y.subVectors(_,g),y.y>0?Z(I(y.y)):y.y<0&&te(I(y.y)),g.copy(_),r.update()})(W);break;case s.PAN:if(r.enablePan===!1)return;(function(ee){v.set(ee.clientX,ee.clientY),m.subVectors(v,f).multiplyScalar(r.panSpeed),H(m.x,m.y),f.copy(v),r.update()})(W)}}(z))}function B(z){switch(function(W){delete T[W.pointerId];for(let ee=0;ee<w.length;ee++)if(w[ee]==W.pointerId)return void w.splice(ee,1)}(z),w.length){case 0:r.domElement.releasePointerCapture(z.pointerId),r.domElement.removeEventListener("pointermove",O),r.domElement.removeEventListener("pointerup",B),r.dispatchEvent(bx),a=s.NONE;break;case 1:const W=w[0],ee=T[W];V({pointerId:W,pageX:ee.x,pageY:ee.y})}}function A(z){r.enabled!==!1&&r.enableZoom!==!1&&a===s.NONE&&(z.preventDefault(),r.dispatchEvent(Fm),function(W){ie(W.clientX,W.clientY),W.deltaY<0?te(I(W.deltaY)):W.deltaY>0&&Z(I(W.deltaY)),r.update()}(function(W){const ee=W.deltaMode,ge={clientX:W.clientX,clientY:W.clientY,deltaY:W.deltaY};switch(ee){case 1:ge.deltaY*=16;break;case 2:ge.deltaY*=100}return W.ctrlKey&&!R&&(ge.deltaY*=10),ge}(z)),r.dispatchEvent(bx))}function k(z){z.key==="Control"&&(R=!0,r.domElement.getRootNode().addEventListener("keyup",F,{passive:!0,capture:!0}))}function F(z){z.key==="Control"&&(R=!1,r.domElement.getRootNode().removeEventListener("keyup",F,{passive:!0,capture:!0}))}function se(z){r.enabled!==!1&&r.enablePan!==!1&&function(W){let ee=!1;switch(W.code){case r.keys.UP:W.ctrlKey||W.metaKey||W.shiftKey?L(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):H(0,r.keyPanSpeed),ee=!0;break;case r.keys.BOTTOM:W.ctrlKey||W.metaKey||W.shiftKey?L(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):H(0,-r.keyPanSpeed),ee=!0;break;case r.keys.LEFT:W.ctrlKey||W.metaKey||W.shiftKey?E(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):H(r.keyPanSpeed,0),ee=!0;break;case r.keys.RIGHT:W.ctrlKey||W.metaKey||W.shiftKey?E(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):H(-r.keyPanSpeed,0),ee=!0}ee&&(W.preventDefault(),r.update())}(z)}function V(z){switch(xe(z),w.length){case 1:switch(r.touches.ONE){case Ya.ROTATE:if(r.enableRotate===!1)return;ne(z),a=s.TOUCH_ROTATE;break;case Ya.PAN:if(r.enablePan===!1)return;de(z),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(r.touches.TWO){case Ya.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(W){r.enableZoom&&re(W),r.enablePan&&de(W)})(z),a=s.TOUCH_DOLLY_PAN;break;case Ya.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;(function(W){r.enableZoom&&re(W),r.enableRotate&&ne(W)})(z),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(Fm)}function ae(z){r.enabled!==!1&&z.preventDefault()}function xe(z){let W=T[z.pointerId];W===void 0&&(W=new X,T[z.pointerId]=W),W.set(z.pageX,z.pageY)}function ce(z){const W=z.pointerId===w[0]?w[1]:w[0];return T[W]}r.domElement.addEventListener("contextmenu",ae),r.domElement.addEventListener("pointerdown",K),r.domElement.addEventListener("pointercancel",B),r.domElement.addEventListener("wheel",A,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",k,{passive:!0,capture:!0}),this.update()}}const Xa=new Xd,Mi=new S,Ws=new S,_t=new Ke,Sx={X:new S(1,0,0),Y:new S(0,1,0),Z:new S(0,0,1)},km={type:"change"},Tx={type:"mouseDown",mode:null},Ax={type:"mouseUp",mode:null},Ex={type:"objectChange"};class r3 extends Ue{constructor(e,t){super(),t===void 0&&(t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new h3;this._gizmo=r,this.add(r);const s=new c3;this._plane=s,this.add(s);const a=this;function n(g,_){let y=_;Object.defineProperty(a,g,{get:function(){return y!==void 0?y:_},set:function(x){y!==x&&(y=x,s[g]=x,r[g]=x,a.dispatchEvent({type:g+"-changed",value:x}),a.dispatchEvent(km))}}),a[g]=_,s[g]=_,r[g]=_}n("camera",e),n("object",void 0),n("enabled",!0),n("axis",null),n("mode","translate"),n("translationSnap",null),n("rotationSnap",null),n("scaleSnap",null),n("space","world"),n("size",1),n("dragging",!1),n("showX",!0),n("showY",!0),n("showZ",!0);const o=new S,l=new S,h=new Ke,c=new Ke,u=new S,d=new Ke,p=new S,f=new S,v=new S,m=new S;n("worldPosition",o),n("worldPositionStart",l),n("worldQuaternion",h),n("worldQuaternionStart",c),n("cameraPosition",u),n("cameraQuaternion",d),n("pointStart",p),n("pointEnd",f),n("rotationAxis",v),n("rotationAngle",0),n("eye",m),this._offset=new S,this._startNorm=new S,this._endNorm=new S,this._cameraScale=new S,this._parentPosition=new S,this._parentQuaternion=new Ke,this._parentQuaternionInv=new Ke,this._parentScale=new S,this._worldScaleStart=new S,this._worldQuaternionInv=new Ke,this._worldScale=new S,this._positionStart=new S,this._quaternionStart=new Ke,this._scaleStart=new S,this._getPointer=s3.bind(this),this._onPointerDown=n3.bind(this),this._onPointerHover=a3.bind(this),this._onPointerMove=o3.bind(this),this._onPointerUp=l3.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null||this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Xa.setFromCamera(e,this.camera);const t=Bm(this._gizmo.picker[this.mode],Xa);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&(e==null||e.button===0)&&this.axis!==null){e!==null&&Xa.setFromCamera(e,this.camera);const t=Bm(this._plane,Xa,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Tx.mode=this.mode,this.dispatchEvent(Tx)}}pointerMove(e){const t=this.axis,r=this.mode,s=this.object;let a=this.space;if(r==="scale"?a="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(a="world"),s===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Xa.setFromCamera(e,this.camera);const n=Bm(this._plane,Xa,!0);if(n){if(this.pointEnd.copy(n.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(s.position.applyQuaternion(_t.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),a==="world"&&(s.parent&&s.position.add(Mi.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Mi.setFromMatrixPosition(s.parent.matrixWorld))));else if(r==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),Ws.set(o,o,o)}else Mi.copy(this.pointStart),Ws.copy(this.pointEnd),Mi.applyQuaternion(this._worldQuaternionInv),Ws.applyQuaternion(this._worldQuaternionInv),Ws.divide(Mi),t.search("X")===-1&&(Ws.x=1),t.search("Y")===-1&&(Ws.y=1),t.search("Z")===-1&&(Ws.z=1);s.scale.copy(this._scaleStart).multiply(Ws),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Mi.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Mi.copy(this.rotationAxis).cross(this.eye))*o):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(Sx[t]),Mi.copy(Sx[t]),a==="local"&&Mi.applyQuaternion(this.worldQuaternion),Mi.cross(this.eye),Mi.length()===0?l=!0:this.rotationAngle=this._offset.dot(Mi.normalize())*o),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(_t.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(_t.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(km),this.dispatchEvent(Ex)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(Ax.mode=this.mode,this.dispatchEvent(Ax)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(km),this.dispatchEvent(Ex),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Xa}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function s3(i){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:i.button};{const e=this.domElement.getBoundingClientRect();return{x:(i.clientX-e.left)/e.width*2-1,y:-(i.clientY-e.top)/e.height*2+1,button:i.button}}}function a3(i){if(this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(i))}}function n3(i){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(i)),this.pointerDown(this._getPointer(i)))}function o3(i){this.enabled&&this.pointerMove(this._getPointer(i))}function l3(i){this.enabled&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(i)))}function Bm(i,e,t){const r=e.intersectObject(i,!0);for(let s=0;s<r.length;s++)if(r[s].object.visible||t)return r[s];return!1}const yu=new yt,ut=new S(0,1,0),Cx=new S(0,0,0),Rx=new me,xu=new Ke,zu=new Ke,Gr=new S,Px=new me,Hl=new S(1,0,0),Ja=new S(0,1,0),Gl=new S(0,0,1),Mu=new S,Ll=new S,Nl=new S;class h3 extends Ue{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Wt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Bt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const s=t.clone();s.opacity=.5;const a=e.clone();a.color.setHex(16711680);const n=e.clone();n.color.setHex(65280);const o=e.clone();o.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const u=e.clone();u.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const f=new Rt(0,.04,.1,12);f.translate(0,.05,0);const v=new St(.08,.08,.08);v.translate(0,.04,0);const m=new Re;m.setAttribute("position",new _e([0,0,0,1,0,0],3));const g=new Rt(.0075,.0075,.5,3);function _(D,U){const H=new qr(D,.0075,3,64,U*Math.PI*2);return H.rotateY(Math.PI/2),H.rotateX(Math.PI/2),H}g.translate(0,.25,0);const y={X:[[new ue(f,a),[.5,0,0],[0,0,-Math.PI/2]],[new ue(f,a),[-.5,0,0],[0,0,Math.PI/2]],[new ue(g,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ue(f,n),[0,.5,0]],[new ue(f,n),[0,-.5,0],[Math.PI,0,0]],[new ue(g,n)]],Z:[[new ue(f,o),[0,0,.5],[Math.PI/2,0,0]],[new ue(f,o),[0,0,-.5],[-Math.PI/2,0,0]],[new ue(g,o),null,[Math.PI/2,0,0]]],XYZ:[[new ue(new bs(.1,0),u.clone()),[0,0,0]]],XY:[[new ue(new St(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new ue(new St(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ue(new St(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},x={X:[[new ue(new Rt(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new ue(new Rt(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ue(new Rt(.2,0,.6,4),r),[0,.3,0]],[new ue(new Rt(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ue(new Rt(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new ue(new Rt(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ue(new bs(.2,0),r)]],XY:[[new ue(new St(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new ue(new St(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ue(new St(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new ue(new bs(.01,2),s),null,null,null,"helper"]],END:[[new ue(new bs(.01,2),s),null,null,null,"helper"]],DELTA:[[new oi(function(){const D=new Re;return D.setAttribute("position",new _e([0,0,0,1,1,1],3)),D}(),s),null,null,null,"helper"]],X:[[new oi(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new oi(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new oi(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},b={XYZE:[[new ue(_(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new ue(_(.5,.5),a)]],Y:[[new ue(_(.5,.5),n),null,[0,0,-Math.PI/2]]],Z:[[new ue(_(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new ue(_(.75,1),d),null,[0,Math.PI/2,0]]]},w={AXIS:[[new oi(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},T={XYZE:[[new ue(new Tn(.25,10,8),r)]],X:[[new ue(new qr(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ue(new qr(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ue(new qr(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ue(new qr(.75,.1,2,24),r)]]},R={X:[[new ue(v,a),[.5,0,0],[0,0,-Math.PI/2]],[new ue(g,a),[0,0,0],[0,0,-Math.PI/2]],[new ue(v,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ue(v,n),[0,.5,0]],[new ue(g,n)],[new ue(v,n),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ue(v,o),[0,0,.5],[Math.PI/2,0,0]],[new ue(g,o),[0,0,0],[Math.PI/2,0,0]],[new ue(v,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ue(new St(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new ue(new St(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ue(new St(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ue(new St(.1,.1,.1),u.clone())]]},I={X:[[new ue(new Rt(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new ue(new Rt(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ue(new Rt(.2,0,.6,4),r),[0,.3,0]],[new ue(new Rt(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ue(new Rt(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new ue(new Rt(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ue(new St(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new ue(new St(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ue(new St(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ue(new St(.2,.2,.2),r),[0,0,0]]]},E={X:[[new oi(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new oi(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new oi(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function L(D){const U=new Ue;for(const H in D)for(let Z=D[H].length;Z--;){const te=D[H][Z][0].clone(),ie=D[H][Z][1],ve=D[H][Z][2],be=D[H][Z][3],J=D[H][Z][4];te.name=H,te.tag=J,ie&&te.position.set(ie[0],ie[1],ie[2]),ve&&te.rotation.set(ve[0],ve[1],ve[2]),be&&te.scale.set(be[0],be[1],be[2]),te.updateMatrix();const ne=te.geometry.clone();ne.applyMatrix4(te.matrix),te.geometry=ne,te.renderOrder=1/0,te.position.set(0,0,0),te.rotation.set(0,0,0),te.scale.set(1,1,1),U.add(te)}return U}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=L(y)),this.add(this.gizmo.rotate=L(b)),this.add(this.gizmo.scale=L(R)),this.add(this.picker.translate=L(x)),this.add(this.picker.rotate=L(T)),this.add(this.picker.scale=L(I)),this.add(this.helper.translate=L(M)),this.add(this.helper.rotate=L(w)),this.add(this.helper.scale=L(E)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:zu;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let s=0;s<r.length;s++){const a=r[s];let n;a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(n*this.size/4),a.tag!=="helper"?(a.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(a.name==="X"&&Math.abs(ut.copy(Hl).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Y"&&Math.abs(ut.copy(Ja).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Z"&&Math.abs(ut.copy(Gl).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XY"&&Math.abs(ut.copy(Gl).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="YZ"&&Math.abs(ut.copy(Hl).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XZ"&&Math.abs(ut.copy(Ja).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1)):this.mode==="rotate"&&(xu.copy(t),ut.copy(this.eye).applyQuaternion(_t.copy(t).invert()),a.name.search("E")!==-1&&a.quaternion.setFromRotationMatrix(Rx.lookAt(this.eye,Cx,Ja)),a.name==="X"&&(_t.setFromAxisAngle(Hl,Math.atan2(-ut.y,ut.z)),_t.multiplyQuaternions(xu,_t),a.quaternion.copy(_t)),a.name==="Y"&&(_t.setFromAxisAngle(Ja,Math.atan2(ut.x,ut.z)),_t.multiplyQuaternions(xu,_t),a.quaternion.copy(_t)),a.name==="Z"&&(_t.setFromAxisAngle(Gl,Math.atan2(ut.y,ut.x)),_t.multiplyQuaternions(xu,_t),a.quaternion.copy(_t))),a.visible=a.visible&&(a.name.indexOf("X")===-1||this.showX),a.visible=a.visible&&(a.name.indexOf("Y")===-1||this.showY),a.visible=a.visible&&(a.name.indexOf("Z")===-1||this.showZ),a.visible=a.visible&&(a.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),a.material._color=a.material._color||a.material.color.clone(),a.material._opacity=a.material._opacity||a.material.opacity,a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled&&this.axis&&(a.name===this.axis||this.axis.split("").some(function(o){return a.name===o}))&&(a.material.color.setHex(16776960),a.material.opacity=1)):(a.visible=!1,a.name==="AXIS"?(a.visible=!!this.axis,this.axis==="X"&&(_t.setFromEuler(yu.set(0,0,0)),a.quaternion.copy(t).multiply(_t),Math.abs(ut.copy(Hl).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Y"&&(_t.setFromEuler(yu.set(0,0,Math.PI/2)),a.quaternion.copy(t).multiply(_t),Math.abs(ut.copy(Ja).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Z"&&(_t.setFromEuler(yu.set(0,Math.PI/2,0)),a.quaternion.copy(t).multiply(_t),Math.abs(ut.copy(Gl).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="XYZE"&&(_t.setFromEuler(yu.set(0,Math.PI/2,0)),ut.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(Rx.lookAt(Cx,ut,Ja)),a.quaternion.multiply(_t),a.visible=this.dragging),this.axis==="E"&&(a.visible=!1)):a.name==="START"?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):a.name==="END"?(a.position.copy(this.worldPosition),a.visible=this.dragging):a.name==="DELTA"?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),Mi.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Mi.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(Mi),a.visible=this.dragging):(a.quaternion.copy(t),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=this.axis.search(a.name)!==-1)))}super.updateMatrixWorld(e)}}class c3 extends ue{constructor(){super(new as(1e5,1e5,2,2),new Wt({visible:!1,wireframe:!0,side:Mt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Mu.copy(Hl).applyQuaternion(t==="local"?this.worldQuaternion:zu),Ll.copy(Ja).applyQuaternion(t==="local"?this.worldQuaternion:zu),Nl.copy(Gl).applyQuaternion(t==="local"?this.worldQuaternion:zu),ut.copy(Ll),this.mode){case"translate":case"scale":switch(this.axis){case"X":ut.copy(this.eye).cross(Mu),Gr.copy(Mu).cross(ut);break;case"Y":ut.copy(this.eye).cross(Ll),Gr.copy(Ll).cross(ut);break;case"Z":ut.copy(this.eye).cross(Nl),Gr.copy(Nl).cross(ut);break;case"XY":Gr.copy(Nl);break;case"YZ":Gr.copy(Mu);break;case"XZ":ut.copy(Nl),Gr.copy(Ll);break;case"XYZ":case"E":Gr.set(0,0,0)}break;default:Gr.set(0,0,0)}Gr.length()===0?this.quaternion.copy(this.cameraQuaternion):(Px.lookAt(Mi.set(0,0,0),Gr,ut),this.quaternion.setFromRotationMatrix(Px)),super.updateMatrixWorld(e)}}const Ts={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Ds{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const u3=new wn(-1,1,1,-1,0,1),d3=new class extends Re{constructor(){super(),this.setAttribute("position",new _e([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _e([0,2,0,0,2,0],2))}};class tl{constructor(e){this._mesh=new ue(d3,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,u3)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class w0 extends Ds{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof tt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Kt.clone(e.uniforms),this.material=new tt({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new tl(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class Ix extends Ds{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const s=e.getContext(),a=e.state;let n,o;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(n=0,o=1):(n=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.buffers.stencil.setFunc(s.ALWAYS,n,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.color.setMask(!0),a.buffers.depth.setMask(!0),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(s.EQUAL,1,4294967295),a.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.buffers.stencil.setLocked(!0)}}class p3 extends Ds{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class m3{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new X);this._width=r.width,this._height=r.height,(t=new ht(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ht})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new w0(Ts),this.copyPass.material.blending=0,this.clock=new _h}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let s=0,a=this.passes.length;s<a;s++){const n=this.passes[s];if(n.enabled!==!1){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),n.needsSwap){if(r){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}Ix!==void 0&&(n instanceof Ix?r=!0:n instanceof p3&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new X);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(r,s),this.renderTarget2.setSize(r,s);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class f3 extends Ds{constructor(e,t,r=null,s=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=s,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new oe}render(e,t,r){const s=e.autoClear;let a,n;e.autoClear=!1,this.overrideMaterial!==null&&(n=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(a=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==1&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(a),this.overrideMaterial!==null&&(this.scene.overrideMaterial=n),e.autoClear=s}}class aa extends Ds{constructor(e,t,r,s){super(),this.renderScene=t,this.renderCamera=r,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new oe(1,1,1),this.hiddenEdgeColor=new oe(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new X(e.x,e.y):new X(256,256);const a=Math.round(this.resolution.x/this.downSampleRatio),n=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new ht(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Od,this.depthMaterial.side=Mt,this.depthMaterial.depthPacking=xg,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Mt,this.prepareMaskMaterial.fragmentShader=function(l,h){const c=h.isPerspectiveCamera?"perspective":"orthographic";return l.replace(/DEPTH_TO_VIEW_Z/g,c+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new ht(this.resolution.x,this.resolution.y,{type:Ht}),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new ht(a,n,{type:Ht}),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new ht(a,n,{type:Ht}),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new ht(Math.round(a/2),Math.round(n/2),{type:Ht}),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new ht(a,n,{type:Ht}),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new ht(Math.round(a/2),Math.round(n/2),{type:Ht}),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,n),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(n/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const o=Ts;this.copyUniforms=Kt.clone(o.uniforms),this.materialCopy=new tt({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:0,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new oe,this.oldClearAlpha=1,this.fsQuad=new tl(null),this.tempPulseColor1=new oe,this.tempPulseColor2=new oe,this.textureMatrix=new me}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let r=Math.round(e/this.downSampleRatio),s=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,s),this.renderTargetBlurBuffer1.setSize(r,s),this.renderTargetEdgeBuffer1.setSize(r,s),this.separableBlurMaterial1.uniforms.texSize.value.set(r,s),r=Math.round(r/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(r,s),this.renderTargetEdgeBuffer2.setSize(r,s),this.separableBlurMaterial2.uniforms.texSize.value.set(r,s)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function r(s){s.isMesh&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(r)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,r=[];function s(a){a.isMesh&&r.push(a)}for(let a=0;a<this.selectedObjects.length;a++)this.selectedObjects[a].traverse(s);this.renderScene.traverse(function(a){if(a.isMesh||a.isSprite){let n=!1;for(let o=0;o<r.length;o++)if(r[o].id===a.id){n=!0;break}if(n===!1){const o=a.visible;e!==!1&&t.get(a)!==!0||(a.visible=e),t.set(a,o)}}else(a.isPoints||a.isLine)&&(e===!0?a.visible=t.get(a):(t.set(a,a.visible),a.visible=e))})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,r,s,a){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,a&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=aa.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=aa.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=aa.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=aa.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new tt({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new X(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new tt({uniforms:{maskTexture:{value:null},texSize:{value:new X(.5,.5)},visibleEdgeColor:{value:new S(1,1,1)},hiddenEdgeColor:{value:new S(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new tt({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new X(.5,.5)},direction:{value:new X(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new tt({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:As,depthTest:!1,depthWrite:!1,transparent:!0})}}aa.BlurDirectionX=new X(1,0),aa.BlurDirectionY=new X(0,1);const g3={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class v3 extends Ds{constructor(){super();const e=g3;this.uniforms=Kt.clone(e.uniforms),this.material=new Ng({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new tl(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},rt.getTransfer(this._outputColorSpace)===mt&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===wd?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===Sd?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===Td?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===Ad?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===Ed?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===hg&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const _3={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new oe(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class Qo extends Ds{constructor(e,t,r,s){super(),this.strength=t!==void 0?t:1,this.radius=r,this.threshold=s,this.resolution=e!==void 0?new X(e.x,e.y):new X(256,256),this.clearColor=new oe(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);this.renderTargetBright=new ht(a,n,{type:Ht}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let c=0;c<this.nMips;c++){const u=new ht(a,n,{type:Ht});u.texture.name="UnrealBloomPass.h"+c,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);const d=new ht(a,n,{type:Ht});d.texture.name="UnrealBloomPass.v"+c,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),a=Math.round(a/2),n=Math.round(n/2)}const o=_3;this.highPassUniforms=Kt.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new tt({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);for(let c=0;c<this.nMips;c++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[c])),this.separableBlurMaterials[c].uniforms.invSize.value=new X(1/a,1/n),a=Math.round(a/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new S(1,1,1),new S(1,1,1),new S(1,1,1),new S(1,1,1),new S(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const h=Ts;this.copyUniforms=Kt.clone(h.uniforms),this.blendMaterial=new tt({uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:As,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new oe,this.oldClearAlpha=1,this.basic=new Wt,this.fsQuad=new tl(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(r,s);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(r,s),this.renderTargetsVertical[a].setSize(r,s),this.separableBlurMaterials[a].uniforms.invSize.value=new X(1/r,1/s),r=Math.round(r/2),s=Math.round(s/2)}render(e,t,r,s,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let o=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[l].uniforms.direction.value=Qo.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=Qo.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}getSeperableBlurMaterial(e){const t=[];for(let r=0;r<e;r++)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return new tt({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new X(.5,.5)},direction:{value:new X(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new tt({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}Qo.BlurDirectionX=new X(1,0),Qo.BlurDirectionY=new X(0,1);class y3 extends w0{constructor(){super({name:"ScreenMaskShader",uniforms:{tDiffuse:{value:null},opacity:{value:1},intensity:{value:1},maskColor:{value:new oe(1,1,1)},R:{value:.2},sr:{value:1.2}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
      `,fragmentShader:`
        uniform float opacity;
        uniform float intensity;
        uniform sampler2D tDiffuse;
        uniform vec3 maskColor;
        uniform float R;
        uniform float sr;
        varying vec2 vUv;
        void main() {
          // 
          vec4 texel = texture2D( tDiffuse, vUv );
          // 
          float dist = sqrt((vUv.x-0.5)*(vUv.x-0.5)+(vUv.y-0.5)*(vUv.y-0.5));
          // , sr 
          float rr = (sr - smoothstep(R, R + 0.5, dist));
          // 
          texel *= vec4(maskColor * rr * vec3(intensity,intensity,intensity), 1.0);
          gl_FragColor = opacity * texel;
        }
      `})}}const x3={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new X(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

		//----------------------------------------------------------------------------------
		// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
		// SDK Version: v3.00
		// Email:       gameworks@nvidia.com
		// Site:        http://developer.nvidia.com/
		//
		// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
		//
		// Redistribution and use in source and binary forms, with or without
		// modification, are permitted provided that the following conditions
		// are met:
		//  * Redistributions of source code must retain the above copyright
		//    notice, this list of conditions and the following disclaimer.
		//  * Redistributions in binary form must reproduce the above copyright
		//    notice, this list of conditions and the following disclaimer in the
		//    documentation and/or other materials provided with the distribution.
		//  * Neither the name of NVIDIA CORPORATION nor the names of its
		//    contributors may be used to endorse or promote products derived
		//    from this software without specific prior written permission.
		//
		// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
		// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
		// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
		// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
		// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
		// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
		// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
		// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
		// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
		// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
		// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		//
		//----------------------------------------------------------------------------------

		#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
		#endif

		/*--------------------------------------------------------------------------*/
		#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
		#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
		/*--------------------------------------------------------------------------*/

		#define NUM_SAMPLES 5

		// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
		float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
		}

		/*============================================================================

									FXAA3 QUALITY - PC

		============================================================================*/

		/*--------------------------------------------------------------------------*/
		vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
		) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
				if(earlyExit) FxaaDiscard;
			#else
				if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
				// locate the edge
				vec2 dirToEdge;
				dirToEdge.x = contrastE > contrastW ? 1. : -1.;
				dirToEdge.y = contrastS > contrastN ? 1. : -1.;
				// . 2 .      . 1 .
				// 1 0 2  ~=  0 0 1
				// . 1 .      . 0 .

				// tap 2 pixels and see which ones are "outside" the edge, to
				// determine if the edge is vertical or horizontal

				vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongH = contrast( rgbaM, rgbaAlongH );
				// . 1 .
				// 0 0 1
				// . 0 H

				vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongV = contrast( rgbaM, rgbaAlongV );
				// V 1 .
				// 0 0 1
				// . 0 .

				relativeVContrast = matchAlongV - matchAlongH;
				relativeVContrast *= fxaaQualityinvEdgeThreshold;

				if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
					// 1 1 .
					// 0 0 1
					// . 0 1

					// do a simple blur
					return mix(
						rgbaM,
						(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
						.4
					);
				}

				horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
				iterationsUsed = i;

				float increment = float(i + 1);

				if(!doneN) {
					nDist += increment;
					posN = posM + offNP * nDist;
					vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
					doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
					iterationsUsedN = i;
				}

				if(!doneP) {
					pDist += increment;
					posP = posM - offNP * pDist;
					vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
					doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
					iterationsUsedP = i;
				}

				if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
				doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
				doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
				rgbaM,
				rgbaN,
				dist * .5
			);
		}

		void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
				vUv,
				tDiffuse,
				resolution,
				edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
				invEdgeDetectionQuality
			);

		}
	`},bu={name:"SAOShader",defines:{NUM_SAMPLES:7,NUM_RINGS:4,DIFFUSE_TEXTURE:0,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new X(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new me},cameraInverseProjectionMatrix:{value:new me},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		#include <common>

		varying vec2 vUv;

		#if DIFFUSE_TEXTURE == 1
		uniform sampler2D tDiffuse;
		#endif

		uniform highp sampler2D tDepth;
		uniform highp sampler2D tNormal;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float scale;
		uniform float intensity;
		uniform float bias;
		uniform float kernelRadius;
		uniform float minResolution;
		uniform vec2 size;
		uniform float randomSeed;

		// RGBA depth

		#include <packing>

		vec4 getDefaultColor( const in vec2 screenPosition ) {
			#if DIFFUSE_TEXTURE == 1
			return texture2D( tDiffuse, vUv );
			#else
			return vec4( 1.0 );
			#endif
		}

		float getDepth( const in vec2 screenPosition ) {
			return texture2D( tDepth, screenPosition ).x;
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {
			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];
			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );
			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;
		}

		vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {
			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );
		}

		float scaleDividedByCameraFar;
		float minResolutionMultipliedByCameraFar;

		float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {
			vec3 viewDelta = sampleViewPosition - centerViewPosition;
			float viewDistance = length( viewDelta );
			float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;

			return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );
		}

		// moving costly divides into consts
		const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );
		const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );

		float getAmbientOcclusion( const in vec3 centerViewPosition ) {
			// precompute some variables require in getOcclusion.
			scaleDividedByCameraFar = scale / cameraFar;
			minResolutionMultipliedByCameraFar = minResolution * cameraFar;
			vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );

			// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/
			float angle = rand( vUv + randomSeed ) * PI2;
			vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;
			vec2 radiusStep = radius;

			float occlusionSum = 0.0;
			float weightSum = 0.0;

			for( int i = 0; i < NUM_SAMPLES; i ++ ) {
				vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;
				radius += radiusStep;
				angle += ANGLE_STEP;

				float sampleDepth = getDepth( sampleUv );
				if( sampleDepth >= ( 1.0 - EPSILON ) ) {
					continue;
				}

				float sampleViewZ = getViewZ( sampleDepth );
				vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );
				occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );
				weightSum += 1.0;
			}

			if( weightSum == 0.0 ) discard;

			return occlusionSum * ( intensity / weightSum );
		}

		void main() {
			float centerDepth = getDepth( vUv );
			if( centerDepth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = getViewZ( centerDepth );
			vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );

			float ambientOcclusion = getAmbientOcclusion( viewPosition );

			gl_FragColor = getDefaultColor( vUv );
			gl_FragColor.xyz *=  1.0 - ambientOcclusion;
		}`},Xs={name:"DepthLimitedBlurShader",defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new X(512,512)},sampleUvOffsets:{value:[new X(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:`

		#include <common>

		uniform vec2 size;

		varying vec2 vUv;
		varying vec2 vInvSize;

		void main() {
			vUv = uv;
			vInvSize = 1.0 / size;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		#include <common>
		#include <packing>

		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform float depthCutoff;

		uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];
		uniform float sampleWeights[ KERNEL_RADIUS + 1 ];

		varying vec2 vUv;
		varying vec2 vInvSize;

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		void main() {
			float depth = getDepth( vUv );
			if( depth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = -getViewZ( depth );
			bool rBreak = false, lBreak = false;

			float weightSum = sampleWeights[0];
			vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;

			for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {

				float sampleWeight = sampleWeights[i];
				vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;

				vec2 sampleUv = vUv + sampleUvOffset;
				float viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;

				if( ! rBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

				sampleUv = vUv - sampleUvOffset;
				viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;

				if( ! lBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

			}

			gl_FragColor = diffuseSum / weightSum;
		}`},vd={createSampleWeights:function(i,e){const t=[];for(let r=0;r<=i;r++)t.push(M3(r,e));return t},createSampleOffsets:function(i,e){const t=[];for(let r=0;r<=i;r++)t.push(e.clone().multiplyScalar(r));return t},configure:function(i,e,t,r){i.defines.KERNEL_RADIUS=e,i.uniforms.sampleUvOffsets.value=vd.createSampleOffsets(e,r),i.uniforms.sampleWeights.value=vd.createSampleWeights(e,t),i.needsUpdate=!0}};function M3(i,e){return Math.exp(-i*i/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}class Fh extends Ds{constructor(e,t,r=new X(256,256)){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.originalClearColor=new oe,this._oldClearColor=new oe,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new X(r.x,r.y),this.saoRenderTarget=new ht(this.resolution.x,this.resolution.y,{type:Ht}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();const s=new jh;s.format=fa,s.type=ma,this.normalRenderTarget=new ht(this.resolution.x,this.resolution.y,{minFilter:nt,magFilter:nt,type:Ht,depthTexture:s}),this.normalMaterial=new jd,this.normalMaterial.blending=0,this.saoMaterial=new tt({defines:Object.assign({},bu.defines),fragmentShader:bu.fragmentShader,vertexShader:bu.vertexShader,uniforms:Kt.clone(bu.uniforms)}),this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=s,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,this.vBlurMaterial=new tt({uniforms:Kt.clone(Xs.uniforms),defines:Object.assign({},Xs.defines),vertexShader:Xs.vertexShader,fragmentShader:Xs.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=0,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=s,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new tt({uniforms:Kt.clone(Xs.uniforms),defines:Object.assign({},Xs.defines),vertexShader:Xs.vertexShader,fragmentShader:Xs.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=0,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=s,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,this.materialCopy=new tt({uniforms:Kt.clone(Ts.uniforms),vertexShader:Ts.vertexShader,fragmentShader:Ts.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=Ro,this.materialCopy.blendSrc=zh,this.materialCopy.blendDst=Po,this.materialCopy.blendEquation=Ji,this.materialCopy.blendSrcAlpha=Bh,this.materialCopy.blendDstAlpha=Po,this.materialCopy.blendEquationAlpha=Ji,this.fsQuad=new tl(null)}render(e,t,r){this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const s=e.autoClear;e.autoClear=!1,this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(vd.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new X(0,1)),vd.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new X(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));const n=this.materialCopy;this.params.output===Fh.OUTPUT.Normal?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===Fh.OUTPUT.Default?n.blending=Ro:n.blending=0,this.renderPass(e,n,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=s}renderPass(e,t,r,s,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,s,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}}Fh.OUTPUT={Default:0,SAO:1,Normal:2};const jr={name:"SSRShader",defines:{MAX_STEP:0,PERSPECTIVE_CAMERA:!0,DISTANCE_ATTENUATION:!0,FRESNEL:!0,INFINITE_THICK:!1,SELECTIVE:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new X},cameraProjectionMatrix:{value:new me},cameraInverseProjectionMatrix:{value:new me},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},thickness:{value:.018}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float thickness;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef PERSPECTIVE_CAMERA
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef SELECTIVE
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef PERSPECTIVE_CAMERA
				vec3 viewIncidentDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#else
				vec3 viewIncidentDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidentDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef PERSPECTIVE_CAMERA
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<float(MAX_STEP);i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef PERSPECTIVE_CAMERA
					// https://comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
				#endif

				// if(viewReflectRayZ>vZ) continue; // will cause "npm run make-screenshot webgl_postprocessing_ssr" high probability hang.
				// https://github.com/mrdoob/three.js/pull/21539#issuecomment-821061164
				if(viewReflectRayZ<=vZ){

					bool hit;
					#ifdef INFINITE_THICK
						hit=true;
					#else
						float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

						float minThickness;
						vec2 xyNeighbor=xy;
						xyNeighbor.x+=1.;
						vec2 uvNeighbor=xyNeighbor/resolution;
						vec3 vPNeighbor=getViewPosition(uvNeighbor,d,cW);
						minThickness=vPNeighbor.x-vP.x;
						minThickness*=3.;
						float tk=max(minThickness,thickness);

						hit=away<=tk;
					#endif

					if(hit){
						vec3 vN=getViewNormal( uv );
						if(dot(viewReflectDir,vN)>=0.) continue;
						float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
						if(distance>maxDistance) break;
						float op=opacity;
						#ifdef DISTANCE_ATTENUATION
							float ratio=1.-(distance/maxDistance);
							float attenuation=ratio*ratio;
							op=opacity*attenuation;
						#endif
						#ifdef FRESNEL
							float fresnelCoe=(dot(viewIncidentDir,viewReflectDir)+1.)/2.;
							op*=fresnelCoe;
						#endif
						vec4 reflectColor=texture2D(tDiffuse,uv);
						gl_FragColor.xyz=reflectColor.xyz;
						gl_FragColor.a=op;
						break;
					}
				}
			}
		}
	`},wu={name:"SSRDepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
			gl_FragColor = vec4( vec3( d ), 1.0 );

		}

	`},qs={name:"SSRBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new X},opacity:{value:.5}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;
		void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

			vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`};class ys extends Ds{constructor({renderer:e,scene:t,camera:r,width:s,height:a,selects:n,bouncing:o=!1,groundReflector:l}){super(),this.width=s!==void 0?s:512,this.height=a!==void 0?a:512,this.clear=!0,this.renderer=e,this.scene=t,this.camera=r,this.groundReflector=l,this.opacity=jr.uniforms.opacity.value,this.output=0,this.maxDistance=jr.uniforms.maxDistance.value,this.thickness=jr.uniforms.thickness.value,this.tempColor=new oe,this._selects=n,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(c){this._selects!==c&&(this._selects=c,Array.isArray(c)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=o,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(c){this._bouncing!==c&&(this._bouncing=c,this.ssrMaterial.uniforms.tDiffuse.value=c?this.prevRenderTarget.texture:this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=jr.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(c){this._distanceAttenuation!==c&&(this._distanceAttenuation=c,this.ssrMaterial.defines.DISTANCE_ATTENUATION=c,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=jr.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(c){this._fresnel!==c&&(this._fresnel=c,this.ssrMaterial.defines.FRESNEL=c,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=jr.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(c){this._infiniteThick!==c&&(this._infiniteThick=c,this.ssrMaterial.defines.INFINITE_THICK=c,this.ssrMaterial.needsUpdate=!0)}});const h=new jh;h.type=Lo,h.minFilter=nt,h.magFilter=nt,this.beautyRenderTarget=new ht(this.width,this.height,{minFilter:nt,magFilter:nt,type:Ht,depthTexture:h,depthBuffer:!0}),this.prevRenderTarget=new ht(this.width,this.height,{minFilter:nt,magFilter:nt}),this.normalRenderTarget=new ht(this.width,this.height,{minFilter:nt,magFilter:nt,type:Ht}),this.metalnessRenderTarget=new ht(this.width,this.height,{minFilter:nt,magFilter:nt,type:Ht}),this.ssrRenderTarget=new ht(this.width,this.height,{minFilter:nt,magFilter:nt}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new tt({defines:Object.assign({},jr.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:Kt.clone(jr.uniforms),vertexShader:jr.vertexShader,fragmentShader:jr.fragmentShader,blending:0}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new jd,this.normalMaterial.blending=0,this.metalnessOnMaterial=new Wt({color:"white"}),this.metalnessOffMaterial=new Wt({color:"black"}),this.blurMaterial=new tt({defines:Object.assign({},qs.defines),uniforms:Kt.clone(qs.uniforms),vertexShader:qs.vertexShader,fragmentShader:qs.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new tt({defines:Object.assign({},qs.defines),uniforms:Kt.clone(qs.uniforms),vertexShader:qs.vertexShader,fragmentShader:qs.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new tt({defines:Object.assign({},wu.defines),uniforms:Kt.clone(wu.uniforms),vertexShader:wu.vertexShader,fragmentShader:wu.fragmentShader,blending:0}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new tt({uniforms:Kt.clone(Ts.uniforms),vertexShader:Ts.vertexShader,fragmentShader:Ts.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:ca,blendDst:ua,blendEquation:Ji,blendSrcAlpha:ca,blendDstAlpha:ua,blendEquationAlpha:Ji}),this.fsQuad=new tl(null),this.originalClearColor=new oe}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),e.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(e,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(e,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.renderPass(e,this.blurMaterial2,this.blurRenderTarget2)),this.output){case ys.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t));break;case ys.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.prevRenderTarget));break;case ys.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case ys.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case ys.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case ys.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)}}renderPass(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderMetalness(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.traverseVisible(l=>{l._SSRPassBackupMaterial=l.material,this._selects.includes(l)?l.material=this.metalnessOnMaterial:l.material=this.metalnessOffMaterial}),e.render(this.scene,this.camera),this.scene.traverseVisible(l=>{l.material=l._SSRPassBackupMaterial}),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.width=e,this.height=t,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(e*e+t*t),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(e,t),this.prevRenderTarget.setSize(e,t),this.ssrRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.metalnessRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.blurRenderTarget2.setSize(e,t),this.ssrMaterial.uniforms.resolution.value.set(e,t),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t),this.blurMaterial2.uniforms.resolution.value.set(e,t)}}function b3(i,e,t,r){const s=new m3(t),a=t.getPixelRatio();s.setSize(r.clientWidth,r.clientHeight),s.setPixelRatio(a),s.setRenderWay=function(o=""){this.effectComposerRender=o===""?()=>t.render(i,e):()=>this.render(),this.renderWay=o},s.effectPass={},s.setRenderWay();const n=new f3(i,e);return s.addPass(n),function(o,l,h){const c=new Fh(l,h);c.enabled=!1,c.params.saoIntensity=.01,c.params.saoScale=100,o.addPass(c),o.effectPass.saoPass=c}(s,i,e),function(o,l){const h=new Qo(new X(l.clientWidth,l.clientHeight),1.5,.4,.85);h.enabled=!1,o.addPass(h),o.effectPass.unrealBloomPass=h}(s,r),function(o,l,h,c,u){const d=new ys({renderer:o,scene:l,camera:h,width:u.clientWidth,height:u.clientHeight,selects:l.ssrList});d.thickness=.018,d.infiniteThick=!1,d.maxDistance=.01,d.opacity=.5,d.enabled=!1,c.addPass(d),c.effectPass.ssrPass=d}(t,i,e,s,r),function(o,l,h,c){const u=new aa(new X(c.clientWidth,c.clientHeight),l,h);u.renderToScreen=!0,u.edgeStrength=3,u.edgeGlow=0,u.edgeThickness=1,u.pulsePeriod=0,u.usePatternTexture=!1,u.visibleEdgeColor.set(16449071),u.hiddenEdgeColor.set(16449071),u.overlayMaterial.blending=Ro,u.overlayMaterial.blendSrc=kh,o.addPass(u),o.effectPass.outlinePass=u}(s,i,e,r),function(o){const l=new v3;o.addPass(l),o.effectPass.outputPass=l}(s),function(o,l,h){const c=new w0(x3);c.multPixel=1,c.resize=function(){c.material.uniforms.resolution.value.x=c.multPixel/(l.clientWidth*h),c.material.uniforms.resolution.value.y=c.multPixel/(l.clientHeight*h)},c.resize(),o.addPass(c),o.effectPass.fxaaPass=c}(s,r,a),function(o){const l=new y3;l.enabled=!1,o.addPass(l),o.effectPass.screenMaskPass=l}(s),s.resize=function(){const{unrealBloomPass:o,fxaaPass:l}=s.effectPass;s.setSize(r.clientWidth,r.clientHeight),o.setSize(r.clientWidth,r.clientHeight),l.resize()},s}function w3(i,e={}){const t=e3(),r=function(f,v){const m=new Gt(50,v.clientWidth/v.clientHeight,.1,1e5);return m.position.set(10,10,10),m.name="PerspectiveCamera",f.add(m),m}(t,i),s=function({webglRenderParams:f,pixelRatio:v},m){const g=new Jx(Ae({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0},f));return g.setSize(m.clientWidth,m.clientHeight),g.setPixelRatio(v||window.devicePixelRatio),m.appendChild(g.domElement),g}(e,i),a=function(f,v){const m=new i3(f,v.domElement);return m.enableDamping=!0,m.dampingFactor=.05,m.minDistance=.01,m.maxDistance=1e6,m.maxPolarAngle=Math.PI,m}(r,s),n=function(f,v,m,g){const _=new r3(v,m.domElement);f.transformControls=_,_.name="TransformControls",_.traverse(x=>x.isTransformControls=!0),f.add(_);const y=new vt;return _.addEventListener("dragging-changed",x=>{var M;g.enabled=!x.value,_.drag_change_callback(x.value),(M=_.dragChangeCallback)==null||M.call(_,x.value)}),_.addEventListener("change",()=>{var x;_.box3Helper&&(["Group","Mesh"].includes((x=_==null?void 0:_.object)==null?void 0:x.type)?(_.box3Helper.box=y.setFromObject(_.object),_.box3Helper.visible=!0):_.box3Helper.visible=!1)}),_}(t,r,s,a),o=b3(t,r,s,i),l=function(f){const v=new B2;return v.resize=()=>{v.setSize(f.clientWidth,f.clientHeight),v.domElement.style.zIndex=0,v.domElement.style.position="relative",v.domElement.style.top=-f.clientHeight+"px",v.domElement.style.height=f.clientHeight+"px",v.domElement.style.width=f.clientWidth+"px",v.domElement.style.pointerEvents="none"},v.reset=()=>v.domElement.childNodes.forEach(m=>m.remove()),v.resize(),f.appendChild(v.domElement),v}(i),h=function(f){const v=new U2;return v.resize=()=>{v.setSize(f.clientWidth,f.clientHeight),v.domElement.style.zIndex=0,v.domElement.style.position="relative",v.domElement.style.top=2*-f.clientHeight+"px",v.domElement.style.height=f.clientHeight+"px",v.domElement.style.width=f.clientWidth+"px",v.domElement.style.pointerEvents="none"},v.reset=()=>v.domElement.childNodes.forEach(m=>m.remove()),v.resize(),f.appendChild(v.domElement),v}(i),c=function(f){const v=new rh;return v.setMode(0),v.style={offsetTop:0,offsetLeft:0},v.domElement.style.position="relative",v.domElement.style.zIndex="auto",v.domElement.style.width="80px",v.domElement.style.height="48px",v.resize=()=>{const{offsetTop:m,offsetLeft:g}=v.style;v.domElement.style.top=m-3*f.getBoundingClientRect().height+"px",v.domElement.style.left=g+"px"},v.resize(),v.setOffset=(m,g)=>{v.style.offsetTop=m,v.style.offsetLeft=g,v.resize()},v.showStats=!1,v.statsMode=0,v.created=()=>!f.contains(v.domElement)&&f.appendChild(v.domElement),v.destroy=()=>f.contains(v.domElement)&&f.removeChild(v.domElement),v}(i),u=JP({scene:t,camera:r,renderer:s,controls:a,transformControls:n,effectComposer:o,css3DRender:l,css2DRender:h,stats:c,DOM:i},e.sceneParams),d=function(f){const v=new _h;if(!f)return _=>_(v.getDelta());const m=1/f;let g=0;return _=>{const y=v.getDelta();g+=y,g>m&&(_(y),g=0)}}(e.fps);let p=null;return function f(){d(()=>{c.update(),a.update(),t.renderFrames(),o.effectComposerRender(),l.render(t,r),h.render(t,r)}),p=requestAnimationFrame(f)}(),Ae({scene:t,camera:r,renderer:s,controls:a,transformControls:n,stats:c,effectComposer:o,css3DRender:l,css2DRender:h,renderSceneResize:function(){r.aspect=i.clientWidth/i.clientHeight,r.updateProjectionMatrix(),s.setSize(i.clientWidth,i.clientHeight),o.resize(),t.shaderFrames.forEach(f=>f.uniforms.iResolution&&(f.uniforms.iResolution.value=new X(i.clientWidth,i.clientHeight))),l.resize(),h.resize(),c.resize()},destroySceneRender:function(){cancelAnimationFrame(p),ub(t),s.dispose();for(let f in this)delete this[f];for(;i.children.length;)i.removeChild(i.firstChild);(function(){const f=document.body.getElementsByClassName("vanui-window");for(let v=f.length-1;v>=0;v--)f[v].parentNode.removeChild(f[v])})()}},u)}function S3(i,e,t){var r,s;const{scene:a,camera:n,handler:o,drawCore:l,transformControls:h,effectComposer:c,GUI:u}=i,{outlinePass:d}=c.effectPass;h.detach();const p=function(y,x,M){const b=new Xd;return b.setFromCamera(y,x),b.intersectObjects(M.children).filter(w=>!w.object.isTransformControls&&w.object.isMesh&&w.object.visible)}(jb(e),n,a),f=p.find(y=>y.object.visible&&Ly(y.object).visible);if(!f)return;const{object:v,point:m}=f,g=Ly(v);switch(o.mode){case"":d.selectedObjects=[],o.isTransformChildren?h.attach(v):h.attach(g);break;case"":d.selectedObjects=[v],o.selectPanelEnable&&((r=u==null?void 0:u.createSelectPanel)==null||r.call(u,v));break;case"":d.selectedObjects=[g],o.selectPanelEnable&&((s=u==null?void 0:u.createSelectPanel)==null||s.call(u,g));break;case"":l.sceneEventCall(m,v)}const _={currentModel:v,currentRootModel:g,point:m,mode:o.mode};i.currentInfo=_,o.currentInfo=_,t(_)}ys.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};class ng{constructor(...e){Object.assign(this,w3(...e))}setCss2dDOM(e,t){e.style.pointerEvents="auto";const{scene:r}=this,s=new ZM(e);return s.position.copy(t),r.add(s),s.destroy=()=>r.remove(s),s}setCss3dDOM(e,t){const{scene:r}=this,s=new KM(e);return s.position.copy(t),r.add(s),s.destroy=()=>r.remove(s),s}setLight(...e){const t=v0(...e);return t.target&&this.scene.add(t.target),this.scene.add(t),t}getSceneEvent(e,t){S3(this,e,r=>t==null?void 0:t(r))}getRawSceneEvent(){return function(e){const t=new Xd;return{raycaster:t,getIntersects:(r,s)=>(t.setFromCamera(jb(r),e),t.intersectObjects(s))}}(this.camera)}setOutlinePass(e=[]){return this.effectComposer.effectPass.outlinePass.selectedObjects=e}getSceneEditorImage(e){return this.renderer.render(this.scene,this.camera),this.effectComposer.render(),this.renderer.domElement.toDataURL(...e)}setModelAnimationPlay(e){if(e!=null&&e.animationPlayParams)return this.modelCore.modelAnimationPlay(e,e.animationPlayParams)}getSceneCurveList(){return this.scene.children.filter(e=>e.isCurveMesh).map(e=>{var t,r;return{path:e.curvePath||((r=(t=e.geometry)==null?void 0:t.parameters)==null?void 0:r.path),mesh:e}})}setCurveAnimation(e,t=1){if(e)return function(r,s=1,a){return{id:Date.now(),curve:r,time:0,pause:!1,speed:s,start:function(){a.indexOf(this)>-1||(a.push(this),this.pause=!1)},destroy:function(){const n=a.indexOf(this);n>-1&&a.splice(n,1),delete this.start,delete this.destroy},frameCallback:null,frameEndCallback:null,commonAnimateRender:function(){var n,o;if(!this.pause){if(this.time+=this.speed/1e3,this.time>1||this.time<0)return this.time=this.time>1?1:0,this.pause=!0,(n=this.frameEndCallback)==null?void 0:n.call(this,"end");(o=this.frameCallback)==null||o.call(this,this.curve.getPointAt(this.time))}}}}(e,t,this.scene.commonFrames)}}V0(ng,"dracoPath","/draco/"),V0(ng,"styleOverrides",Oh);export{T3 as R,ng as d};
