(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f11448b6","chunk-97940564","chunk-2d0dd850"],{"0323":function(t,e,r){"use strict";var n=r("335e"),i=n("toStringTag"),o={};o[i]="z",t.exports="[object z]"===String(o)},"09d1":function(t,e,r){"use strict";var n=r("24bf"),i=r("3b65"),o=r("b792"),a=n.aTypedArray,s=n.exportTypedArrayMethod;s("at",(function(t){var e=a(this),r=i(e),n=o(t),s=n>=0?n:r+n;return s<0||s>=r?void 0:e[s]}))},"18bb":function(t,e,r){"use strict";var n=r("28ca"),i=r("2796");t.exports=function(t){if("Function"===n(t))return i(t)}},"1e51":function(t,e,r){"use strict";var n=r("ee4c"),i=r("7a79"),o=r("24bf"),a=r("3b65"),s=r("d1c6"),l=r("7db5"),c=r("a067"),u=n.RangeError,f=n.Int8Array,h=f&&f.prototype,d=h&&h.set,p=o.aTypedArray,g=o.exportTypedArrayMethod,m=!c((function(){var t=new Uint8ClampedArray(2);return i(d,t,{length:1,0:3},1),3!==t[1]})),v=m&&o.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var t=new f(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));g("set",(function(t){p(this);var e=s(arguments.length>1?arguments[1]:void 0,1),r=l(t);if(m)return i(d,this,r,e);var n=this.length,o=a(r),c=0;if(o+e>n)throw new u("Wrong length");while(c<o)this[e+c]=r[c++]}),!m||v)},"1e9e":function(t,e,r){"use strict";var n=r("6225");t.exports=function(t){var e=n(t);return"BigInt64Array"===e||"BigUint64Array"===e}},"226e":function(t,e,r){"use strict";var n=r("156d"),i=r("7db5"),o=r("6403"),a=r("3b65"),s=TypeError,l="Reduce of empty array with no initial value",c=function(t){return function(e,r,c,u){var f=i(e),h=o(f),d=a(f);if(n(r),0===d&&c<2)throw new s(l);var p=t?d-1:0,g=t?-1:1;if(c<2)while(1){if(p in h){u=h[p],p+=g;break}if(p+=g,t?p<0:d<=p)throw new s(l)}for(;t?p>=0:d>p;p+=g)p in h&&(u=r(u,h[p],p,f));return u}};t.exports={left:c(!1),right:c(!0)}},2399:function(t,e,r){"use strict";var n=r("2796"),i=r("156d");t.exports=function(t,e,r){try{return n(i(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(o){}}},"24bf":function(t,e,r){"use strict";var n,i,o,a=r("91ab"),s=r("8be2"),l=r("ee4c"),c=r("8d47"),u=r("3bd3"),f=r("898f"),h=r("6225"),d=r("4f63"),p=r("25bc"),g=r("f847"),m=r("fba5"),v=r("5d92"),y=r("3cd6"),w=r("3462"),b=r("335e"),x=r("3cda"),T=r("33d6"),M=T.enforce,S=T.get,A=l.Int8Array,E=A&&A.prototype,C=l.Uint8ClampedArray,I=C&&C.prototype,B=A&&y(A),P=E&&y(E),R=Object.prototype,D=l.TypeError,O=b("toStringTag"),k=x("TYPED_ARRAY_TAG"),F="TypedArrayConstructor",N=a&&!!w&&"Opera"!==h(l.opera),L=!1,z={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},j=function(t){if(!u(t))return!1;var e=h(t);return"DataView"===e||f(z,e)||f(U,e)},_=function(t){var e=y(t);if(u(e)){var r=S(e);return r&&f(r,F)?r[F]:_(e)}},V=function(t){if(!u(t))return!1;var e=h(t);return f(z,e)||f(U,e)},G=function(t){if(V(t))return t;throw new D("Target is not a typed array")},W=function(t){if(c(t)&&(!w||v(B,t)))return t;throw new D(d(t)+" is not a typed array constructor")},H=function(t,e,r,n){if(s){if(r)for(var i in z){var o=l[i];if(o&&f(o.prototype,t))try{delete o.prototype[t]}catch(a){try{o.prototype[t]=e}catch(c){}}}P[t]&&!r||g(P,t,r?e:N&&E[t]||e,n)}},X=function(t,e,r){var n,i;if(s){if(w){if(r)for(n in z)if(i=l[n],i&&f(i,t))try{delete i[t]}catch(o){}if(B[t]&&!r)return;try{return g(B,t,r?e:N&&B[t]||e)}catch(o){}}for(n in z)i=l[n],!i||i[t]&&!r||g(i,t,e)}};for(n in z)i=l[n],o=i&&i.prototype,o?M(o)[F]=i:N=!1;for(n in U)i=l[n],o=i&&i.prototype,o&&(M(o)[F]=i);if((!N||!c(B)||B===Function.prototype)&&(B=function(){throw new D("Incorrect invocation")},N))for(n in z)l[n]&&w(l[n],B);if((!N||!P||P===R)&&(P=B.prototype,N))for(n in z)l[n]&&w(l[n].prototype,P);if(N&&y(I)!==P&&w(I,P),s&&!f(P,O))for(n in L=!0,m(P,O,{configurable:!0,get:function(){return u(this)?this[k]:void 0}}),z)l[n]&&p(l[n],k,n);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:N,TYPED_ARRAY_TAG:L&&k,aTypedArray:G,aTypedArrayConstructor:W,exportTypedArrayMethod:H,exportTypedArrayStaticMethod:X,getTypedArrayConstructor:_,isView:j,isTypedArray:V,TypedArray:B,TypedArrayPrototype:P}},2895:function(t,e,r){"use strict";r("6c79")},"28e1":function(t,e,r){"use strict";var n=r("a067");t.exports=!n((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},"2b44":function(t,e,r){"use strict";var n=r("8be2"),i=r("fba5"),o=r("5cab"),a=ArrayBuffer.prototype;n&&!("detached"in a)&&i(a,"detached",{configurable:!0,get:function(){return o(this)}})},"2ef8":function(t,e,r){"use strict";var n=r("24bf"),i=r("a64c").findLastIndex,o=n.aTypedArray,a=n.exportTypedArrayMethod;a("findLastIndex",(function(t){return i(o(this),t,arguments.length>1?arguments[1]:void 0)}))},3462:function(t,e,r){"use strict";var n=r("2399"),i=r("dfc5"),o=r("f72c");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{t=n(Object.prototype,"__proto__","set"),t(r,[]),e=r instanceof Array}catch(a){}return function(r,n){return i(r),o(n),e?t(r,n):r.__proto__=n,r}}():void 0)},"3b90":function(t,e,r){"use strict";var n=r("4529"),i=TypeError;t.exports=function(t){var e=n(t,"number");if("number"==typeof e)throw new i("Can't convert number to bigint");return BigInt(e)}},"3cd6":function(t,e,r){"use strict";var n=r("898f"),i=r("8d47"),o=r("7db5"),a=r("119d"),s=r("28e1"),l=a("IE_PROTO"),c=Object,u=c.prototype;t.exports=s?c.getPrototypeOf:function(t){var e=o(t);if(n(e,l))return e[l];var r=e.constructor;return i(r)&&e instanceof r?r.prototype:e instanceof c?u:null}},"47cb":function(t,e,r){"use strict";var n=r("2399"),i=r("28ca"),o=TypeError;t.exports=n(ArrayBuffer.prototype,"byteLength","get")||function(t){if("ArrayBuffer"!==i(t))throw new o("ArrayBuffer expected");return t.byteLength}},"4ae5":function(t,e,r){"use strict";var n=r("e0ed"),i=r("ba33");t.exports=!n&&!i&&"object"==typeof window&&"object"==typeof document},"4e1f":function(t,e,r){"use strict";r.d(e,"A",(function(){return C})),r.d(e,"l",(function(){return I})),r.d(e,"r",(function(){return B})),r.d(e,"H",(function(){return P})),r.d(e,"i",(function(){return R})),r.d(e,"d",(function(){return D})),r.d(e,"z",(function(){return O})),r.d(e,"f",(function(){return k})),r.d(e,"G",(function(){return F})),r.d(e,"a",(function(){return N})),r.d(e,"k",(function(){return L})),r.d(e,"u",(function(){return z})),r.d(e,"m",(function(){return U})),r.d(e,"w",(function(){return j})),r.d(e,"g",(function(){return _})),r.d(e,"v",(function(){return V})),r.d(e,"y",(function(){return G})),r.d(e,"x",(function(){return W})),r.d(e,"n",(function(){return H})),r.d(e,"b",(function(){return X})),r.d(e,"q",(function(){return Q})),r.d(e,"B",(function(){return Y})),r.d(e,"E",(function(){return Z})),r.d(e,"D",(function(){return K})),r.d(e,"C",(function(){return J})),r.d(e,"e",(function(){return q})),r.d(e,"s",(function(){return $})),r.d(e,"j",(function(){return tt})),r.d(e,"t",(function(){return et})),r.d(e,"h",(function(){return rt})),r.d(e,"c",(function(){return nt})),r.d(e,"F",(function(){return it})),r.d(e,"p",(function(){return ot})),r.d(e,"o",(function(){return at}));r("2b12"),r("c54c"),r("09d1"),r("7492"),r("2ef8"),r("1e51"),r("d553"),r("98d4"),r("e6c6"),r("d5891"),r("2895"),r("e864");var n=r("6aa4"),i=r("2745"),o=r("3d4c");const a={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tgl_FragColor = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor.a *= opacity;\n\n\n\t\t}"};class s{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const l=new i["OrthographicCamera"](-1,1,1,-1,0,1),c=new i["BufferGeometry"];c.setAttribute("position",new i["Float32BufferAttribute"]([-1,3,0,-1,-1,0,3,-1,0],3)),c.setAttribute("uv",new i["Float32BufferAttribute"]([0,2,0,0,2,0],2));class u{constructor(t){this._mesh=new i["Mesh"](c,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,l)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class f extends s{constructor(t,e){super(),this.textureID=void 0!==e?e:"tDiffuse",t instanceof i["ShaderMaterial"]?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=i["UniformsUtils"].clone(t.uniforms),this.material=new i["ShaderMaterial"]({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new u(this.material)}render(t,e,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class h extends s{constructor(t,e){super(),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,e,r){const n=t.getContext(),i=t.state;let o,a;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0),this.inverse?(o=0,a=1):(o=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),i.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),t.setRenderTarget(r),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(n.EQUAL,1,4294967295),i.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),i.buffers.stencil.setLocked(!0)}}class d extends s{constructor(){super(),this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class p{constructor(t,e){if(this.renderer=t,void 0===e){const r=t.getSize(new i["Vector2"]);this._pixelRatio=t.getPixelRatio(),this._width=r.width,this._height=r.height,e=new i["WebGLRenderTarget"](this._width*this._pixelRatio,this._height*this._pixelRatio),e.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===a&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===f&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new f(a),this.clock=new i["Clock"]}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());const e=this.renderer.getRenderTarget();let r=!1;for(let n=0,i=this.passes.length;n<i;n++){const e=this.passes[n];if(!1!==e.enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,r),e.needsSwap){if(r){const e=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(e.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),r.setFunc(e.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==h&&(e instanceof h?r=!0:e instanceof d&&(r=!1))}}this.renderer.setRenderTarget(e)}reset(t){if(void 0===t){const e=this.renderer.getSize(new i["Vector2"]);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,t=this.renderTarget1.clone(),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,e){this._width=t,this._height=e;const r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new i["OrthographicCamera"](-1,1,1,-1,0,1);const g=new i["BufferGeometry"];g.setAttribute("position",new i["Float32BufferAttribute"]([-1,3,0,-1,-1,0,3,-1,0],3)),g.setAttribute("uv",new i["Float32BufferAttribute"]([0,2,0,0,2,0],2));class m extends s{constructor(t,e,r,n,o){super(),this.scene=t,this.camera=e,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==o?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new i["Color"]}render(t,e,r){const n=t.autoClear;let i,o;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:r),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=n}}class v extends s{constructor(t,e,r,n){super(),this.renderScene=e,this.renderCamera=r,this.selectedObjects=void 0!==n?n:[],this.visibleEdgeColor=new i["Color"](1,1,1),this.hiddenEdgeColor=new i["Color"](.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==t?new i["Vector2"](t.x,t.y):new i["Vector2"](256,256);const o=Math.round(this.resolution.x/this.downSampleRatio),s=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new i["WebGLRenderTarget"](this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new i["MeshDepthMaterial"],this.depthMaterial.side=i["DoubleSide"],this.depthMaterial.depthPacking=i["RGBADepthPacking"],this.depthMaterial.blending=i["NoBlending"],this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=i["DoubleSide"],this.prepareMaskMaterial.fragmentShader=h(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new i["WebGLRenderTarget"](this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new i["WebGLRenderTarget"](o,s),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new i["WebGLRenderTarget"](o,s),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new i["WebGLRenderTarget"](Math.round(o/2),Math.round(s/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new i["WebGLRenderTarget"](o,s),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new i["WebGLRenderTarget"](Math.round(o/2),Math.round(s/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const l=4,c=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(l),this.separableBlurMaterial1.uniforms["texSize"].value.set(o,s),this.separableBlurMaterial1.uniforms["kernelRadius"].value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(c),this.separableBlurMaterial2.uniforms["texSize"].value.set(Math.round(o/2),Math.round(s/2)),this.separableBlurMaterial2.uniforms["kernelRadius"].value=c,this.overlayMaterial=this.getOverlayMaterial(),void 0===a&&console.error("THREE.OutlinePass relies on CopyShader");const f=a;function h(t,e){const r=e.isPerspectiveCamera?"perspective":"orthographic";return t.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}this.copyUniforms=i["UniformsUtils"].clone(f.uniforms),this.copyUniforms["opacity"].value=1,this.materialCopy=new i["ShaderMaterial"]({uniforms:this.copyUniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader,blending:i["NoBlending"],depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new i["Color"],this.oldClearAlpha=1,this.fsQuad=new u(null),this.tempPulseColor1=new i["Color"],this.tempPulseColor2=new i["Color"],this.textureMatrix=new i["Matrix4"]}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(t,e){this.renderTargetMaskBuffer.setSize(t,e),this.renderTargetDepthBuffer.setSize(t,e);let r=Math.round(t/this.downSampleRatio),n=Math.round(e/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,n),this.renderTargetBlurBuffer1.setSize(r,n),this.renderTargetEdgeBuffer1.setSize(r,n),this.separableBlurMaterial1.uniforms["texSize"].value.set(r,n),r=Math.round(r/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(r,n),this.renderTargetEdgeBuffer2.setSize(r,n),this.separableBlurMaterial2.uniforms["texSize"].value.set(r,n)}changeVisibilityOfSelectedObjects(t){const e=this._visibilityCache;function r(r){r.isMesh&&(!0===t?r.visible=e.get(r):(e.set(r,r.visible),r.visible=t))}for(let n=0;n<this.selectedObjects.length;n++){const t=this.selectedObjects[n];t.traverse(r)}}changeVisibilityOfNonSelectedObjects(t){const e=this._visibilityCache,r=[];function n(t){t.isMesh&&r.push(t)}for(let o=0;o<this.selectedObjects.length;o++){const t=this.selectedObjects[o];t.traverse(n)}function i(n){if(n.isMesh||n.isSprite){let i=!1;for(let t=0;t<r.length;t++){const e=r[t].id;if(e===n.id){i=!0;break}}if(!1===i){const r=n.visible;!1!==t&&!0!==e.get(n)||(n.visible=t),e.set(n,r)}}else(n.isPoints||n.isLine)&&(!0===t?n.visible=e.get(n):(e.set(n,n.visible),n.visible=t))}this.renderScene.traverse(i)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(t,e,r,n,i){if(this.selectedObjects.length>0){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const e=t.autoClear;t.autoClear=!1,i&&t.state.buffers.stencil.setTest(!1),t.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const n=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,t.setRenderTarget(this.renderTargetDepthBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms["cameraNearFar"].value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms["depthTexture"].value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms["textureMatrix"].value=this.textureMatrix,t.setRenderTarget(this.renderTargetMaskBuffer),t.clear(),t.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=n,this.fsQuad.material=this.materialCopy,this.copyUniforms["tDiffuse"].value=this.renderTargetMaskBuffer.texture,t.setRenderTarget(this.renderTargetMaskDownSampleBuffer),t.clear(),this.fsQuad.render(t),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const t=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(t),this.tempPulseColor2.multiplyScalar(t)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms["maskTexture"].value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms["texSize"].value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms["visibleEdgeColor"].value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms["hiddenEdgeColor"].value=this.tempPulseColor2,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms["colorTexture"].value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms["direction"].value=v.BlurDirectionX,this.separableBlurMaterial1.uniforms["kernelRadius"].value=this.edgeThickness,t.setRenderTarget(this.renderTargetBlurBuffer1),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial1.uniforms["colorTexture"].value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms["direction"].value=v.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer1),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms["colorTexture"].value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms["direction"].value=v.BlurDirectionX,t.setRenderTarget(this.renderTargetBlurBuffer2),t.clear(),this.fsQuad.render(t),this.separableBlurMaterial2.uniforms["colorTexture"].value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms["direction"].value=v.BlurDirectionY,t.setRenderTarget(this.renderTargetEdgeBuffer2),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms["maskTexture"].value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms["edgeTexture1"].value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms["edgeTexture2"].value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms["patternTexture"].value=this.patternTexture,this.overlayMaterial.uniforms["edgeStrength"].value=this.edgeStrength,this.overlayMaterial.uniforms["edgeGlow"].value=this.edgeGlow,this.overlayMaterial.uniforms["usePatternTexture"].value=this.usePatternTexture,i&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(r),this.fsQuad.render(t),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=e}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms["tDiffuse"].value=r.texture,t.setRenderTarget(null),this.fsQuad.render(t))}getPrepareMaskMaterial(){return new i["ShaderMaterial"]({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new i["Vector2"](.5,.5)},textureMatrix:{value:null}},vertexShader:"#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tuniform mat4 textureMatrix;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t\t#include <skinning_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t\tvPosition = mvPosition;\n\t\t\t\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t\t\t\t\tprojTexCoord = textureMatrix * worldPosition;\n\n\t\t\t\t}",fragmentShader:"#include <packing>\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tuniform sampler2D depthTexture;\n\t\t\t\tuniform vec2 cameraNearFar;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\n\t\t\t\t\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\n\t\t\t\t\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\n\t\t\t\t\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\n\n\t\t\t\t}"})}getEdgeDetectionMaterial(){return new i["ShaderMaterial"]({uniforms:{maskTexture:{value:null},texSize:{value:new i["Vector2"](.5,.5)},visibleEdgeColor:{value:new i["Vector3"](1,1,1)},hiddenEdgeColor:{value:new i["Vector3"](1,1,1)}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec3 visibleEdgeColor;\n\t\t\t\tuniform vec3 hiddenEdgeColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\n\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\n\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\n\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\n\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\n\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\n\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\n\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\n\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\n\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\n\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\n\t\t\t\t}"})}getSeperableBlurMaterial(t){return new i["ShaderMaterial"]({defines:{MAX_RADIUS:t},uniforms:{colorTexture:{value:null},texSize:{value:new i["Vector2"](.5,.5)},direction:{value:new i["Vector2"](.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float kernelRadius;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat sigma = kernelRadius/2.0;\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, sigma);\n\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\n\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\n\t\t\t\t\tvec2 uvOffset = delta;\n\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = kernelRadius * float(i) / float(MAX_RADIUS);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, sigma);\n\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\t\t\tuvOffset += delta;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\n\t\t\t\t}"})}getOverlayMaterial(){return new i["ShaderMaterial"]({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture1;\n\t\t\t\tuniform sampler2D edgeTexture2;\n\t\t\t\tuniform sampler2D patternTexture;\n\t\t\t\tuniform float edgeStrength;\n\t\t\t\tuniform float edgeGlow;\n\t\t\t\tuniform bool usePatternTexture;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\n\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\n\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\n\t\t\t\t\tif(usePatternTexture)\n\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\n\t\t\t\t\tgl_FragColor = finalColor;\n\t\t\t\t}",blending:i["AdditiveBlending"],depthTest:!1,depthWrite:!1,transparent:!0})}}v.BlurDirectionX=new i["Vector2"](1,0),v.BlurDirectionY=new i["Vector2"](0,1);const y={uniforms:{tDiffuse:{value:null}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 tex = texture2D( tDiffuse, vUv );\n\n\t\t\tgl_FragColor = LinearTosRGB( tex );\n\n\t\t}"};var w=r("8277"),b=r("37f3");const x={uniforms:{tDiffuse:{value:null},resolution:{value:new i["Vector2"](1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\tprecision highp float;\n\n\tuniform sampler2D tDiffuse;\n\n\tuniform vec2 resolution;\n\n\tvarying vec2 vUv;\n\n\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n\t//----------------------------------------------------------------------------------\n\t// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n\t// SDK Version: v3.00\n\t// Email:       gameworks@nvidia.com\n\t// Site:        http://developer.nvidia.com/\n\t//\n\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n\t//\n\t// Redistribution and use in source and binary forms, with or without\n\t// modification, are permitted provided that the following conditions\n\t// are met:\n\t//  * Redistributions of source code must retain the above copyright\n\t//    notice, this list of conditions and the following disclaimer.\n\t//  * Redistributions in binary form must reproduce the above copyright\n\t//    notice, this list of conditions and the following disclaimer in the\n\t//    documentation and/or other materials provided with the distribution.\n\t//  * Neither the name of NVIDIA CORPORATION nor the names of its\n\t//    contributors may be used to endorse or promote products derived\n\t//    from this software without specific prior written permission.\n\t//\n\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY\n\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n\t// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t//\n\t//----------------------------------------------------------------------------------\n\n\t#ifndef FXAA_DISCARD\n\t\t\t//\n\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t//\n\t\t\t// 1 = Use discard on pixels which don't need AA.\n\t\t\t//     For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t// 0 = Return unchanged color on pixels which don't need AA.\n\t\t\t//\n\t\t\t#define FXAA_DISCARD 0\n\t#endif\n\n\t/*--------------------------------------------------------------------------*/\n\t#define FxaaTexTop(t, p) texture2D(t, p, -100.0)\n\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)\n\t/*--------------------------------------------------------------------------*/\n\n\t#define NUM_SAMPLES 5\n\n\t// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha\n\tfloat contrast( vec4 a, vec4 b ) {\n\t\t\tvec4 diff = abs( a - b );\n\t\t\treturn max( max( max( diff.r, diff.g ), diff.b ), diff.a );\n\t}\n\n\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\tFXAA3 QUALITY - PC\n\n\t============================================================================*/\n\n\t/*--------------------------------------------------------------------------*/\n\tvec4 FxaaPixelShader(\n\t\t\tvec2 posM,\n\t\t\tsampler2D tex,\n\t\t\tvec2 fxaaQualityRcpFrame,\n\t\t\tfloat fxaaQualityEdgeThreshold,\n\t\t\tfloat fxaaQualityinvEdgeThreshold\n\t) {\n\t\t\tvec4 rgbaM = FxaaTexTop(tex, posM);\n\t\t\tvec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\t// . S .\n\t\t\t// W M E\n\t\t\t// . N .\n\n\t\t\tbool earlyExit = max( max( max(\n\t\t\t\t\tcontrast( rgbaM, rgbaN ),\n\t\t\t\t\tcontrast( rgbaM, rgbaS ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaE ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaW ) )\n\t\t\t\t\t< fxaaQualityEdgeThreshold;\n\t\t\t// . 0 .\n\t\t\t// 0 0 0\n\t\t\t// . 0 .\n\n\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\tif(earlyExit) FxaaDiscard;\n\t\t\t#else\n\t\t\t\t\tif(earlyExit) return rgbaM;\n\t\t\t#endif\n\n\t\t\tfloat contrastN = contrast( rgbaM, rgbaN );\n\t\t\tfloat contrastS = contrast( rgbaM, rgbaS );\n\t\t\tfloat contrastE = contrast( rgbaM, rgbaE );\n\t\t\tfloat contrastW = contrast( rgbaM, rgbaW );\n\n\t\t\tfloat relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );\n\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\tbool horzSpan = relativeVContrast > 0.;\n\t\t\t// . 1 .\n\t\t\t// 0 0 0\n\t\t\t// . 1 .\n\n\t\t\t// 45 deg edge detection and corners of objects, aka V/H contrast is too similar\n\t\t\tif( abs( relativeVContrast ) < .3 ) {\n\t\t\t\t\t// locate the edge\n\t\t\t\t\tvec2 dirToEdge;\n\t\t\t\t\tdirToEdge.x = contrastE > contrastW ? 1. : -1.;\n\t\t\t\t\tdirToEdge.y = contrastS > contrastN ? 1. : -1.;\n\t\t\t\t\t// . 2 .      . 1 .\n\t\t\t\t\t// 1 0 2  ~=  0 0 1\n\t\t\t\t\t// . 1 .      . 0 .\n\n\t\t\t\t\t// tap 2 pixels and see which ones are \"outside\" the edge, to\n\t\t\t\t\t// determine if the edge is vertical or horizontal\n\n\t\t\t\t\tvec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongH = contrast( rgbaM, rgbaAlongH );\n\t\t\t\t\t// . 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 H\n\n\t\t\t\t\tvec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\t\tfloat matchAlongV = contrast( rgbaM, rgbaAlongV );\n\t\t\t\t\t// V 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 .\n\n\t\t\t\t\trelativeVContrast = matchAlongV - matchAlongH;\n\t\t\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\t\t\tif( abs( relativeVContrast ) < .3 ) { // 45 deg edge\n\t\t\t\t\t\t\t// 1 1 .\n\t\t\t\t\t\t\t// 0 0 1\n\t\t\t\t\t\t\t// . 0 1\n\n\t\t\t\t\t\t\t// do a simple blur\n\t\t\t\t\t\t\treturn mix(\n\t\t\t\t\t\t\t\t\trgbaM,\n\t\t\t\t\t\t\t\t\t(rgbaN + rgbaS + rgbaE + rgbaW) * .25,\n\t\t\t\t\t\t\t\t\t.4\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\thorzSpan = relativeVContrast > 0.;\n\t\t\t}\n\n\t\t\tif(!horzSpan) rgbaN = rgbaW;\n\t\t\tif(!horzSpan) rgbaS = rgbaE;\n\t\t\t// . 0 .      1\n\t\t\t// 1 0 1  ->  0\n\t\t\t// . 0 .      1\n\n\t\t\tbool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );\n\t\t\tif(!pairN) rgbaN = rgbaS;\n\n\t\t\tvec2 offNP;\n\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\n\t\t\tbool doneN = false;\n\t\t\tbool doneP = false;\n\n\t\t\tfloat nDist = 0.;\n\t\t\tfloat pDist = 0.;\n\n\t\t\tvec2 posN = posM;\n\t\t\tvec2 posP = posM;\n\n\t\t\tint iterationsUsed = 0;\n\t\t\tint iterationsUsedN = 0;\n\t\t\tint iterationsUsedP = 0;\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i++ ) {\n\t\t\t\t\titerationsUsed = i;\n\n\t\t\t\t\tfloat increment = float(i + 1);\n\n\t\t\t\t\tif(!doneN) {\n\t\t\t\t\t\t\tnDist += increment;\n\t\t\t\t\t\t\tposN = posM + offNP * nDist;\n\t\t\t\t\t\t\tvec4 rgbaEndN = FxaaTexTop(tex, posN.xy);\n\t\t\t\t\t\t\tdoneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );\n\t\t\t\t\t\t\titerationsUsedN = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(!doneP) {\n\t\t\t\t\t\t\tpDist += increment;\n\t\t\t\t\t\t\tposP = posM - offNP * pDist;\n\t\t\t\t\t\t\tvec4 rgbaEndP = FxaaTexTop(tex, posP.xy);\n\t\t\t\t\t\t\tdoneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );\n\t\t\t\t\t\t\titerationsUsedP = i;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(doneN || doneP) break;\n\t\t\t}\n\n\n\t\t\tif ( !doneP && !doneN ) return rgbaM; // failed to find end of edge\n\n\t\t\tfloat dist = min(\n\t\t\t\t\tdoneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,\n\t\t\t\t\tdoneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.\n\t\t\t);\n\n\t\t\t// hacky way of reduces blurriness of mostly diagonal edges\n\t\t\t// but reduces AA quality\n\t\t\tdist = pow(dist, .5);\n\n\t\t\tdist = 1. - dist;\n\n\t\t\treturn mix(\n\t\t\t\t\trgbaM,\n\t\t\t\t\trgbaN,\n\t\t\t\t\tdist * .5\n\t\t\t);\n\t}\n\n\tvoid main() {\n\t\t\tconst float edgeDetectionQuality = .2;\n\t\t\tconst float invEdgeDetectionQuality = 1. / edgeDetectionQuality;\n\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\t\tvUv,\n\t\t\t\t\ttDiffuse,\n\t\t\t\t\tresolution,\n\t\t\t\t\tedgeDetectionQuality, // [0,1] contrast needed, otherwise early discard\n\t\t\t\t\tinvEdgeDetectionQuality\n\t\t\t);\n\n\t}\n\t"};function T(t,e=!1){const r=null!==t[0].index,n=new Set(Object.keys(t[0].attributes)),o=new Set(Object.keys(t[0].morphAttributes)),a={},s={},l=t[0].morphTargetsRelative,c=new i["BufferGeometry"];let u=0;for(let i=0;i<t.length;++i){const f=t[i];let h=0;if(r!==(null!==f.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const t in f.attributes){if(!n.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+'. All geometries must have compatible attributes; make sure "'+t+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[t]&&(a[t]=[]),a[t].push(f.attributes[t]),h++}if(h!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". Make sure all geometries have the same number of attributes."),null;if(l!==f.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const t in f.morphAttributes){if(!o.has(t))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[t]&&(s[t]=[]),s[t].push(f.morphAttributes[t])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(f.userData),e){let t;if(r)t=f.index.count;else{if(void 0===f.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+i+". The geometry must have either an index or a position attribute"),null;t=f.attributes.position.count}c.addGroup(u,t,i),u+=t}}if(r){let e=0;const r=[];for(let n=0;n<t.length;++n){const i=t[n].index;for(let t=0;t<i.count;++t)r.push(i.getX(t)+e);e+=t[n].attributes.position.count}c.setIndex(r)}for(const i in a){const t=M(a[i]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+i+" attribute."),null;c.setAttribute(i,t)}for(const i in s){const t=s[i][0].length;if(0===t)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[i]=[];for(let e=0;e<t;++e){const t=[];for(let n=0;n<s[i].length;++n)t.push(s[i][n][e]);const r=M(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+i+" morphAttribute."),null;c.morphAttributes[i].push(r)}}return c}function M(t){let e,r,n,o=0;for(let i=0;i<t.length;++i){const a=t[i];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===e&&(e=a.array.constructor),e!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=a.itemSize),r!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=a.normalized),n!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;o+=a.array.length}const a=new e(o);let s=0;for(let i=0;i<t.length;++i)a.set(t[i].array,s),s+=t[i].array.length;return new i["BufferAttribute"](a,r,n)}function S(t,e=1e-4){e=Math.max(e,Number.EPSILON);const r={},n=t.getIndex(),o=t.getAttribute("position"),a=n?n.count:o.count;let s=0;const l=Object.keys(t.attributes),c={},u={},f=[],h=["getX","getY","getZ","getW"];for(let i=0,m=l.length;i<m;i++){const e=l[i];c[e]=[];const r=t.morphAttributes[e];r&&(u[e]=new Array(r.length).fill().map(()=>[]))}const d=Math.log10(1/e),p=Math.pow(10,d);for(let i=0;i<a;i++){const e=n?n.getX(i):i;let o="";for(let r=0,n=l.length;r<n;r++){const n=l[r],i=t.getAttribute(n),a=i.itemSize;for(let t=0;t<a;t++)o+=~~(i[h[t]](e)*p)+","}if(o in r)f.push(r[o]);else{for(let r=0,n=l.length;r<n;r++){const n=l[r],i=t.getAttribute(n),o=t.morphAttributes[n],a=i.itemSize,s=c[n],f=u[n];for(let t=0;t<a;t++){const r=h[t];if(s.push(i[r](e)),o)for(let t=0,n=o.length;t<n;t++)f[t].push(o[t][r](e))}}r[o]=s,f.push(s),s++}}const g=t.clone();for(let m=0,v=l.length;m<v;m++){const e=l[m],r=t.getAttribute(e),n=new r.array.constructor(c[e]),o=new i["BufferAttribute"](n,r.itemSize,r.normalized);if(g.setAttribute(e,o),e in u)for(let a=0;a<u[e].length;a++){const r=t.morphAttributes[e][a],n=new r.array.constructor(u[e][a]),o=new i["BufferAttribute"](n,r.itemSize,r.normalized);g.morphAttributes[e][a]=o}}return g.setIndex(f),g}var A=function(){var t=0,e=document.createElement("div");function r(t){return e.appendChild(t.dom),t}function n(r){for(var n=0;n<e.children.length;n++)e.children[n].style.display=n===r?"block":"none";t=r}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",(function(r){r.preventDefault(),n(++t%e.children.length)}),!1);var i=(performance||Date).now(),o=i,a=0,s=r(new A.Panel("FPS","#0ff","#002")),l=r(new A.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=r(new A.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:r,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-i,200),t>=o+1e3&&(s.update(1e3*a/(t-o),100),o=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){i=this.end()},domElement:e,setMode:n}};A.Panel=function(t,e,r){var n=1/0,i=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,l=48*a,c=3*a,u=2*a,f=3*a,h=15*a,d=74*a,p=30*a,g=document.createElement("canvas");g.width=s,g.height=l,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=r,m.fillRect(0,0,s,l),m.fillStyle=e,m.fillText(t,c,u),m.fillRect(f,h,d,p),m.fillStyle=r,m.globalAlpha=.9,m.fillRect(f,h,d,p),{dom:g,update:function(l,v){n=Math.min(n,l),i=Math.max(i,l),m.fillStyle=r,m.globalAlpha=1,m.fillRect(0,0,s,h),m.fillStyle=e,m.fillText(o(l)+" "+t+" ("+o(n)+"-"+o(i)+")",c,u),m.drawImage(g,f+a,h,d-a,p,f,h,d-a,p),m.fillRect(f+d-a,h,a,p),m.fillStyle=r,m.globalAlpha=.9,m.fillRect(f+d-a,h,a,o((1-l/v)*p))}}};var E=A;const C=(t,e="#ff00ff")=>{const r=t.material;t.material=new i["MeshBasicMaterial"]({color:e}),t.resetMaterial=()=>t.material=r};function I(t){const e=t.map(t=>{const e=S(t.geometry);return e.applyMatrix4(t.matrixWorld),e}),r=T(e,!0),n=new i["MeshBasicMaterial"]({color:"orange"}),o=new i["Mesh"](r,n);return o.position.y+=20,o}const B=(t="model/西宿舍楼/xisushelou02.FBX",e)=>{const r=new w["a"];r.load(t,t=>{t.traverse(t=>{if(t.castShadow=!0,t.receiveShadow=!0,t.material){function e(t){t.side=i["DoubleSide"],t.vertexColors=!1}Array.isArray(t.material)?t.material.map(t=>e(t)):e(t.material)}}),e(t)})},P=(t,e,r)=>{e.aspect=t.value.clientWidth/t.value.clientHeight,e.updateProjectionMatrix(),r.setSize(t.value.clientWidth,t.value.clientHeight)};function R(t,e,r=500,n){return new n.Tween(t.object.position).to({x:e.x,y:e.y+10,z:e.z+10},r).onStart(()=>{t.target.x=e.x,t.target.y=e.y,t.target.z=e.z}).start()}function D(t,e){n["a"].to(t.object.position,{x:e.x,y:e.y+10,z:e.z+10,duration:2,ease:"power1.inout",repeat:0,yoyo:!0,onUpdate:()=>{},onComplete:()=>{console.log("动画完成")},onStart:()=>{t.target.x=e.x,t.target.y=e.y,t.target.z=e.z}})}const O=(t,e)=>{const r=new i["AxesHelper"](e);t.add(r)},k=()=>{const t=new i["SphereBufferGeometry"](35e4,32,32),e=new i["MeshBasicMaterial"]({map:(new i["TextureLoader"]).load("/model/skyClouds.jpg"),side:i["BackSide"]});e.map.encoding=i["sRGBEncoding"];const r=new i["Mesh"](t,e);return r},F=()=>{const t="\n    varying vec3 vWorldPosition;\n    void main() {\n      vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n      vWorldPosition = worldPosition.xyz;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",e="\n    uniform vec3 topColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    varying vec3 vWorldPosition;\n    void main() {\n        float h = normalize( vWorldPosition + offset ).y;\n        gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );\n    }",r={topColor:{value:new i["Color"](30719)},bottomColor:{value:new i["Color"]("aliceblue")},offset:{value:400},exponent:{value:.6}},n=new i["SphereGeometry"](4e3,32,15),o=new i["ShaderMaterial"]({uniforms:r,vertexShader:t,fragmentShader:e,side:i["BackSide"]});return new i["Mesh"](n,o)},N=t=>{const e=(new i["CubeTextureLoader"]).setPath("/texture/Park3Med/").load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"]);e.encoding=i["sRGBEncoding"],t.background=e},L=()=>{const t=(new i["TextureLoader"]).load("/texture/floor.jpg"),e=new i["CircleGeometry"](700,700),r=new i["MeshPhongMaterial"]({color:16777215,map:t,side:i["DoubleSide"]}),n=new i["Mesh"](e,r);return n.rotation.x=-Math.PI/2,n.material.map.repeat.set(64,64),n.position.y=-8,n.material.map.wrapS=i["RepeatWrapping"],n.material.map.wrapT=i["RepeatWrapping"],n.material.map.encoding=i["sRGBEncoding"],n},z=(t,e,r="https://img0.baidu.com/it/u=2178066304,2757406948&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1672938000&t=979acb6bf43f5969b8c5a1a97907cec6")=>Array(e).fill("").map(()=>{const e=new i["BoxGeometry"](10,10,10),n=new i["TextureLoader"],o=n.load(r),a=new i["MeshBasicMaterial"]({side:i["DoubleSide"],map:o}),s=new i["Mesh"](e,a);return["x","y","z"].map(t=>s.position[t]=100-~~(200*Math.random())),t.add(s),s});function U(t){let e=new i["Box3"];e.setFromObject(t);let r=e.max.x-e.min.x,n=e.max.y-e.min.y,o=e.max.z-e.min.z,a=e.min.x+r/2,s=e.min.y+n/2,l=e.min.z+o/2;return new i["Vector3"](a,s,l)}const j=(t,e,r=65280,n=1)=>{const o=new i["BoxGeometry"](n,n,n),a=new i["MeshBasicMaterial"]({color:r}),s=new i["Mesh"](o,a);return s.position.set(e.x,e.y,e.z),t.add(s),s};function _(t,e="张先生",r={x:0,y:0,z:0},n=10){let o=document.createElement("canvas");o.width=124,o.height=124;let a=o.getContext("2d");const s=new Image;s.src="/logo.png",s.onload=function(){let l=124,c=(o.width-l)/2;a.drawImage(s,c,0,l,l),a.fillStyle="#ffffff",a.font="Bold 18px Arial";let u=a.measureText(e).width;a.fillText(e,(o.width-u)/2,24);let f=new i["Texture"](o);f.needsUpdate=!0,f.encoding=i["sRGBEncoding"];let h=new i["SpriteMaterial"]({map:f});h.sizeAttenuation=!1;let d=new i["Sprite"](h);d.name="Sprite_"+e,d.center=new i["Vector2"](.5,0),d.scale.set(n,n,n),d.position.set(r.x,r.y,r.z),t.add(d)}}function V(t,e="pointFace"){if("pointFace"===e){const e=t.map((t,e,r)=>{if(e>=2)return[r[0],r[e-1],r[e]]}).filter(t=>t).reduce((t,e)=>[...t,...e],[]);return e.reduce((t,e)=>[...t,...e],[])}{const e=t.map((t,e,r)=>{if(e>=2)return[0,e-1,e]}).filter(t=>t).reduce((t,e)=>[...t,...e],[]),r=t.reduce((t,e)=>[...t,...e],[]),n=t.map((t,e)=>[[0,0],[0,1],[1,1],[1,0]][e%4]).reduce((t,e)=>[...t,...e],[]);return{indexGroup:e,faceGroup:r,uvGroup:n}}}function G(t,e,r,n){const o=new i["BufferGeometry"],a=new Float32Array(t);if(o.setAttribute("position",new i["BufferAttribute"](a,3)),e){let t=new Uint16Array(e);o.index=new i["BufferAttribute"](t,1)}r&&(o.attributes.uv=new i["Float32BufferAttribute"](r,2));const s=new i["TextureLoader"],l=s.load(n||"/texture.png");l.wrapS=i["RepeatWrapping"],l.wrapT=i["RepeatWrapping"],l.repeat.set(2,2);const c=new i["MeshBasicMaterial"]({side:i["DoubleSide"],map:l,transparent:!0,opacity:.8}),u=new i["Mesh"](o,c);return u}function W(t,e){const r=[];r.push(new i["Vector3"](...t)),r.push(new i["Vector3"](...e));const n=(new i["BufferGeometry"]).setFromPoints(r),o=new i["LineBasicMaterial"]({color:255}),a=new i["Line"](n,o);return a}function H(t,e){return new i["Vector2"](t.offsetX/e.value.clientWidth*2-1,-t.offsetY/e.value.clientHeight*2+1)}function X(t,e,r){const n=new i["Raycaster"];n.setFromCamera(t,e);const o=n.intersectObjects(r.children);return o.length>0?o[0]:null}function Q(t,e={x:0,y:0,z:10},r=.1,n=1e6){const o=new i["PerspectiveCamera"](50,t.value.clientWidth/t.value.clientHeight);return o.position.set(e.x,e.y,e.z),o.far=n,o.near=r,o.updateProjectionMatrix(),o}function Y(t,e){const r=new o["a"](t,e.domElement);return r.enableDamping=!0,r.dampingFactor=.1,r.minZoom=1e3,r.maxPolarAngle=Math.PI/2.5,r}function Z(t){const e=new i["WebGLRenderer"]({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0});return e.setSize(t.value.clientWidth,t.value.clientHeight),e.setPixelRatio(2*window.devicePixelRatio),e.shadowMap.enabled=!0,e.shadowMap.type=i["PCFSoftShadowMap"],e.setClearColor(16119286),e.outputEncoding=i["sRGBEncoding"],e}function K(t,e,r,n,o=[]){const a=new p(r);a.setSize(n.offsetWidth,n.offsetHeight),a.setPixelRatio(2*window.devicePixelRatio);const s=new m(t,e);a.addPass(s);const l=new f(y);a.addPass(l);const c=new f(x),u=r.getPixelRatio();c.material.uniforms["resolution"].value.x=1/(n.offsetWidth*u),c.material.uniforms["resolution"].value.y=1/(n.offsetHeight*u);const h=new v(new i["Vector2"](n.offsetWidth,n.offsetHeight),t,e,o);return h.renderToScreen=!0,h.edgeStrength=2,h.edgeGlow=2,h.edgeThickness=1.5,h.pulsePeriod=1,h.usePatternTexture=!1,h.visibleEdgeColor.set("#4169E1"),h.hiddenEdgeColor.set("#F0F8FF"),a.addPass(h),{Composer:a,outlinePass:h}}function J(t=144){const e=new i["Clock"],r=1/t;let n=0;return t=>{const i=e.getDelta();n+=i,n>r&&(t(),n=0)}}function q(t,e="red",r=10){let n=new i["BufferGeometry"];n.setFromPoints(t);let o=new i["LineBasicMaterial"]({color:e,linewidth:r});return new i["Line"](n,o)}const $=(t="",e=(()=>{}))=>{const r=new b["a"];r.load(t,t=>e(t.scene),t=>{},t=>{})},tt=(t,e,r=1e-4,n="go",i=(()=>{}),o=(()=>{}))=>{let a="go"===n?1e-4:1;return"go"===n?()=>{a+=r,a>1&&(a=1);const n=t.getPointAt(a);if(i(e,n,a),e.position.set(n.x,n.y,n.z),1===a)return o()}:()=>{a-=r,a<0&&(a=0);const n=t.getPoint(a);if(i(e,n,a),e.position.copy(n),0===a)return o()}};function et(t){const e=new i["Clock"],r=new i["AnimationMixer"](t);let n=t.animations;const o=(t,e=1,n=0)=>{const o=r.clipAction(t);return o.loop=i["LoopOnce"],o.time=n,o.timeScale=e,o.clampWhenFinished=!0,o},a=()=>{const t=e.getDelta();r.update(t)};return{mixer:r,actions:n,runAction:o,mixerRender:a}}function rt(t,e,r=1,n=10,o=640,a=80,s=!1){const l=new i["TubeGeometry"](t,o,n,a,s),c=new i["TextureLoader"],u=c.load(e);u.wrapS=i["RepeatWrapping"],u.wrapT=i["RepeatWrapping"],u.repeat.x=10,u.repeat.y=4,u.offset.y=.9;const f=new i["MeshPhongMaterial"]({map:u,transparent:!0,side:i["DoubleSide"],opacity:r}),h=new i["Mesh"](l,f);return h}const nt=t=>new i["CatmullRomCurve3"](t.map(t=>new i["Vector3"](...t)),!1);function it(){let t=new E;return t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",document.body.appendChild(t.domElement),t}function ot(t){return new i["Vector2"](t.offsetX/t.target.clientWidth*2-1,-t.offsetY/t.target.clientHeight*2+1)}function at(t,e=null){const r=new i["Vector3"];t.getWorldPosition(r);let{max:n,min:o}=(new i["Box3"]).setFromObject(t),a=new i["Vector3"](n.x,n.y,n.z),s=new i["Vector3"](o.x,n.y,n.z),l=new i["Vector3"](n.x,n.y,o.z),c=new i["Vector3"](n.x,o.y,n.z),u=new i["Vector3"](o.x,o.y,o.z),f=new i["Vector3"](o.x,n.y,o.z),h=new i["Vector3"](o.x,o.y,n.z),d=new i["Vector3"](n.x,o.y,o.z),p=[a,s,l,c,u,f,h,d];const g=st([p[0],p[1],p[5],p[2]],"top_plane","red"),m=st([p[3],p[6],p[4],p[7]],"bottom_plane","yellow"),v=st([p[1],p[6],p[4],p[5]],"left_plane","blue"),y=st([p[0],p[3],p[7],p[2]],"right_plane","green"),w=st([p[1],p[0],p[3],p[6]],"front_plane","DarkSlateGray"),b=st([p[5],p[2],p[7],p[4]],"back_plane","Indigo"),x=[g,m,v,y,w,b],T=[];T[0]=new i["Plane"](new i["Vector3"](0,-1,0),n.y),T[1]=new i["Plane"](new i["Vector3"](0,1,0),-o.y),T[2]=new i["Plane"](new i["Vector3"](1,0,0),-o.x),T[3]=new i["Plane"](new i["Vector3"](-1,0,0),n.x),T[4]=new i["Plane"](new i["Vector3"](0,0,-1),n.z),T[5]=new i["Plane"](new i["Vector3"](0,0,1),-o.z);const M={x:{clip:T[2],width:n.x-o.x,end:T[2].constant},_x:{clip:T[3],width:n.x-o.x,end:T[3].constant},y:{clip:T[1],width:n.y-o.y,end:T[1].constant},_y:{clip:T[0],width:n.y-o.y,end:T[0].constant},z:{clip:T[4],width:n.z-o.z,end:T[4].constant},_z:{clip:T[5],width:n.z-o.z,end:T[5].constant},reset:()=>{["x","y","z"].forEach(t=>{M[t].clip.constant=M[t].end,M["_"+t].clip.constant=M["_"+t].end})}},S=t=>(M.reset(),M[t].clip.constant-=M[t].width,(e,r)=>{M[t].clip.constant+e>M[t].end?r():M[t].clip.constant+=e});return Array.isArray(t.material)?t.material=t.material.map(t=>t.clone()):t.material=t.material.clone(),t.material.clippingPlanes=T,e&&(x.forEach(t=>e.add(t)),p.map(t=>{const r=new i["BoxGeometry"](10,10,10),n=new i["MeshBasicMaterial"]({color:"red"}),o=new i["Mesh"](r,n);e.add(o)}),T.forEach(t=>e.add(new i["PlaneHelper"](t,300,16776960)))),{max:n,min:o,plane_arr:x,ponit_arr:p,clipFace_arr:T,clipFace_Way:M,pipeAnimation:S,position:r}}function st(t,e,r){const n=t.map((t,e,r)=>e>=2&&[r[0],r[e-1],r[e]]).filter(t=>t).reduce((t,e)=>[...t,...e],[]).reduce((t,e)=>[e.x,e.y,e.z,...t],[]),o=new i["BufferGeometry"],a=new Float32Array(n);o.setAttribute("position",new i["BufferAttribute"](a,3));const s=new i["MeshBasicMaterial"]({side:i["DoubleSide"],color:r,transparent:!0,opacity:.6}),l=new i["Mesh"](o,s);return l.name=e,l}},"5cab":function(t,e,r){"use strict";var n=r("2796"),i=r("47cb"),o=n(ArrayBuffer.prototype.slice);t.exports=function(t){if(0!==i(t))return!1;try{return o(t,0,0),!1}catch(e){return!0}}},6225:function(t,e,r){"use strict";var n=r("0323"),i=r("8d47"),o=r("28ca"),a=r("335e"),s=a("toStringTag"),l=Object,c="Arguments"===o(function(){return arguments}()),u=function(t,e){try{return t[e]}catch(r){}};t.exports=n?o:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(e=l(t),s))?r:c?o(e):"Object"===(n=o(e))&&i(e.callee)?"Arguments":n}},"6c06":function(t,e,r){"use strict";var n=r("18bb"),i=r("156d"),o=r("55f2"),a=n(n.bind);t.exports=function(t,e){return i(t),void 0===e?t:o?a(t,e):function(){return t.apply(e,arguments)}}},"6c79":function(t,e,r){"use strict";var n=r("6982"),i=r("9a55");i&&n({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},7492:function(t,e,r){"use strict";var n=r("24bf"),i=r("a64c").findLast,o=n.aTypedArray,a=n.exportTypedArrayMethod;a("findLast",(function(t){return i(o(this),t,arguments.length>1?arguments[1]:void 0)}))},"7ccf":function(t,e,r){},8063:function(t,e,r){"use strict";var n=r("ba33");t.exports=function(t){try{if(n)return Function('return require("'+t+'")')()}catch(e){}}},8265:function(t,e,r){"use strict";var n=r("b792"),i=r("23f3"),o=RangeError;t.exports=function(t){if(void 0===t)return 0;var e=n(t),r=i(e);if(e!==r)throw new o("Wrong length or index");return r}},8277:function(t,e,r){"use strict";r.d(e,"a",(function(){return je}));var n={};r.r(n),r.d(n,"Deflate",(function(){return Et})),r.d(n,"AsyncDeflate",(function(){return Ct})),r.d(n,"deflate",(function(){return It})),r.d(n,"deflateSync",(function(){return Bt})),r.d(n,"Inflate",(function(){return Pt})),r.d(n,"AsyncInflate",(function(){return Rt})),r.d(n,"inflate",(function(){return Dt})),r.d(n,"inflateSync",(function(){return Ot})),r.d(n,"Gzip",(function(){return kt})),r.d(n,"AsyncGzip",(function(){return Ft})),r.d(n,"gzip",(function(){return Nt})),r.d(n,"gzipSync",(function(){return Lt})),r.d(n,"Gunzip",(function(){return zt})),r.d(n,"AsyncGunzip",(function(){return Ut})),r.d(n,"gunzip",(function(){return jt})),r.d(n,"gunzipSync",(function(){return _t})),r.d(n,"Zlib",(function(){return Vt})),r.d(n,"AsyncZlib",(function(){return Gt})),r.d(n,"zlib",(function(){return Wt})),r.d(n,"zlibSync",(function(){return Ht})),r.d(n,"Unzlib",(function(){return Xt})),r.d(n,"AsyncUnzlib",(function(){return Qt})),r.d(n,"unzlib",(function(){return Yt})),r.d(n,"unzlibSync",(function(){return Zt})),r.d(n,"compress",(function(){return Nt})),r.d(n,"AsyncCompress",(function(){return Ft})),r.d(n,"compressSync",(function(){return Lt})),r.d(n,"Compress",(function(){return kt})),r.d(n,"Decompress",(function(){return Kt})),r.d(n,"AsyncDecompress",(function(){return Jt})),r.d(n,"decompress",(function(){return qt})),r.d(n,"decompressSync",(function(){return $t})),r.d(n,"DecodeUTF8",(function(){return oe})),r.d(n,"EncodeUTF8",(function(){return ae})),r.d(n,"strToU8",(function(){return se})),r.d(n,"strFromU8",(function(){return le})),r.d(n,"ZipPassThrough",(function(){return me})),r.d(n,"ZipDeflate",(function(){return ve})),r.d(n,"AsyncZipDeflate",(function(){return ye})),r.d(n,"Zip",(function(){return we})),r.d(n,"zip",(function(){return be})),r.d(n,"zipSync",(function(){return xe})),r.d(n,"UnzipPassThrough",(function(){return Te})),r.d(n,"UnzipInflate",(function(){return Me})),r.d(n,"AsyncUnzipInflate",(function(){return Se})),r.d(n,"Unzip",(function(){return Ae})),r.d(n,"unzip",(function(){return Ee})),r.d(n,"unzipSync",(function(){return Ce}));var i=r("2745"),o={},a=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},s=function(t){return new Worker(t)};
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/try{URL.revokeObjectURL(a(""))}catch(cr){a=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},s=function(t){return new Worker(t,{type:"module"})}}var l=function(t,e,r,n,i){var l=s(o[e]||(o[e]=a(t)));return l.onerror=function(t){return i(t.error,null)},l.onmessage=function(t){return i(null,t.data)},l.postMessage(r,n),l},c=Uint8Array,u=Uint16Array,f=Uint32Array,h=new c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),d=new c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p=new c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=function(t,e){for(var r=new u(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];var i=new f(r[30]);for(n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return[r,i]},m=g(h,2),v=m[0],y=m[1];v[28]=258,y[258]=28;for(var w=g(d,0),b=w[0],x=w[1],T=new u(32768),M=0;M<32768;++M){var S=(43690&M)>>>1|(21845&M)<<1;S=(52428&S)>>>2|(13107&S)<<2,S=(61680&S)>>>4|(3855&S)<<4,T[M]=((65280&S)>>>8|(255&S)<<8)>>>1}var A=function(t,e,r){for(var n=t.length,i=0,o=new u(e);i<n;++i)++o[t[i]-1];var a,s=new u(e);for(i=0;i<e;++i)s[i]=s[i-1]+o[i-1]<<1;if(r){a=new u(1<<e);var l=15-e;for(i=0;i<n;++i)if(t[i])for(var c=i<<4|t[i],f=e-t[i],h=s[t[i]-1]++<<f,d=h|(1<<f)-1;h<=d;++h)a[T[h]>>>l]=c}else for(a=new u(n),i=0;i<n;++i)t[i]&&(a[i]=T[s[t[i]-1]++]>>>15-t[i]);return a},E=new c(288);for(M=0;M<144;++M)E[M]=8;for(M=144;M<256;++M)E[M]=9;for(M=256;M<280;++M)E[M]=7;for(M=280;M<288;++M)E[M]=8;var C=new c(32);for(M=0;M<32;++M)C[M]=5;var I=A(E,9,0),B=A(E,9,1),P=A(C,5,0),R=A(C,5,1),D=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},O=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&r},k=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},F=function(t){return(t/8|0)+(7&t&&1)},N=function(t,e,r){(null==e||e<0)&&(e=0),(null==r||r>t.length)&&(r=t.length);var n=new(t instanceof u?u:t instanceof f?f:c)(r-e);return n.set(t.subarray(e,r)),n},L=function(t,e,r){var n=t.length;if(!n||r&&!r.l&&n<5)return e||new c(0);var i=!e||r,o=!r||r.i;r||(r={}),e||(e=new c(3*n));var a=function(t){var r=e.length;if(t>r){var n=new c(Math.max(2*r,t));n.set(e),e=n}},s=r.f||0,l=r.p||0,u=r.b||0,f=r.l,g=r.d,m=r.m,y=r.n,w=8*n;do{if(!f){r.f=s=O(t,l,1);var x=O(t,l+1,3);if(l+=3,!x){var T=F(l)+4,M=t[T-4]|t[T-3]<<8,S=T+M;if(S>n){if(o)throw"unexpected EOF";break}i&&a(u+M),e.set(t.subarray(T,S),u),r.b=u+=M,r.p=l=8*S;continue}if(1==x)f=B,g=R,m=9,y=5;else{if(2!=x)throw"invalid block type";var E=O(t,l,31)+257,C=O(t,l+10,15)+4,I=E+O(t,l+5,31)+1;l+=14;for(var P=new c(I),L=new c(19),z=0;z<C;++z)L[p[z]]=O(t,l+3*z,7);l+=3*C;var U=D(L),j=(1<<U)-1,_=A(L,U,1);for(z=0;z<I;){var V=_[O(t,l,j)];l+=15&V;T=V>>>4;if(T<16)P[z++]=T;else{var G=0,W=0;16==T?(W=3+O(t,l,3),l+=2,G=P[z-1]):17==T?(W=3+O(t,l,7),l+=3):18==T&&(W=11+O(t,l,127),l+=7);while(W--)P[z++]=G}}var H=P.subarray(0,E),X=P.subarray(E);m=D(H),y=D(X),f=A(H,m,1),g=A(X,y,1)}if(l>w){if(o)throw"unexpected EOF";break}}i&&a(u+131072);for(var Q=(1<<m)-1,Y=(1<<y)-1,Z=l;;Z=l){G=f[k(t,l)&Q];var K=G>>>4;if(l+=15&G,l>w){if(o)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(K<256)e[u++]=K;else{if(256==K){Z=l,f=null;break}var J=K-254;if(K>264){z=K-257;var q=h[z];J=O(t,l,(1<<q)-1)+v[z],l+=q}var $=g[k(t,l)&Y],tt=$>>>4;if(!$)throw"invalid distance";l+=15&$;X=b[tt];if(tt>3){q=d[tt];X+=k(t,l)&(1<<q)-1,l+=q}if(l>w){if(o)throw"unexpected EOF";break}i&&a(u+131072);for(var et=u+J;u<et;u+=4)e[u]=e[u-X],e[u+1]=e[u+1-X],e[u+2]=e[u+2-X],e[u+3]=e[u+3-X];u=et}}r.l=f,r.p=Z,r.b=u,f&&(s=1,r.m=m,r.d=g,r.n=y)}while(!s);return u==e.length?e:N(e,0,u)},z=function(t,e,r){r<<=7&e;var n=e/8|0;t[n]|=r,t[n+1]|=r>>>8},U=function(t,e,r){r<<=7&e;var n=e/8|0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},j=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,o=r.slice();if(!i)return[Q,0];if(1==i){var a=new c(r[0].s+1);return a[r[0].s]=1,[a,1]}r.sort((function(t,e){return t.f-e.f})),r.push({s:-1,f:25001});var s=r[0],l=r[1],f=0,h=1,d=2;r[0]={s:-1,f:s.f+l.f,l:s,r:l};while(h!=i-1)s=r[r[f].f<r[d].f?f++:d++],l=r[f!=h&&r[f].f<r[d].f?f++:d++],r[h++]={s:-1,f:s.f+l.f,l:s,r:l};var p=o[0].s;for(n=1;n<i;++n)o[n].s>p&&(p=o[n].s);var g=new u(p+1),m=_(r[h-1],g,0);if(m>e){n=0;var v=0,y=m-e,w=1<<y;for(o.sort((function(t,e){return g[e.s]-g[t.s]||t.f-e.f}));n<i;++n){var b=o[n].s;if(!(g[b]>e))break;v+=w-(1<<m-g[b]),g[b]=e}v>>>=y;while(v>0){var x=o[n].s;g[x]<e?v-=1<<e-g[x]++-1:++n}for(;n>=0&&v;--n){var T=o[n].s;g[T]==e&&(--g[T],++v)}m=e}return[new c(g),m]},_=function(t,e,r){return-1==t.s?Math.max(_(t.l,e,r+1),_(t.r,e,r+1)):e[t.s]=r},V=function(t){var e=t.length;while(e&&!t[--e]);for(var r=new u(++e),n=0,i=t[0],o=1,a=function(t){r[n++]=t},s=1;s<=e;++s)if(t[s]==i&&s!=e)++o;else{if(!i&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(i),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}while(o--)a(i);o=1,i=t[s]}return[r.subarray(0,n),e]},G=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},W=function(t,e,r){var n=r.length,i=F(e+2);t[i]=255&n,t[i+1]=n>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var o=0;o<n;++o)t[i+o+4]=r[o];return 8*(i+4+n)},H=function(t,e,r,n,i,o,a,s,l,c,f){z(e,f++,r),++i[256];for(var g=j(i,15),m=g[0],v=g[1],y=j(o,15),w=y[0],b=y[1],x=V(m),T=x[0],M=x[1],S=V(w),B=S[0],R=S[1],D=new u(19),O=0;O<T.length;++O)D[31&T[O]]++;for(O=0;O<B.length;++O)D[31&B[O]]++;for(var k=j(D,7),F=k[0],N=k[1],L=19;L>4&&!F[p[L-1]];--L);var _,H,X,Q,Y=c+5<<3,Z=G(i,E)+G(o,C)+a,K=G(i,m)+G(o,w)+a+14+3*L+G(D,F)+(2*D[16]+3*D[17]+7*D[18]);if(Y<=Z&&Y<=K)return W(e,f,t.subarray(l,l+c));if(z(e,f,1+(K<Z)),f+=2,K<Z){_=A(m,v,0),H=m,X=A(w,b,0),Q=w;var J=A(F,N,0);z(e,f,M-257),z(e,f+5,R-1),z(e,f+10,L-4),f+=14;for(O=0;O<L;++O)z(e,f+3*O,F[p[O]]);f+=3*L;for(var q=[T,B],$=0;$<2;++$){var tt=q[$];for(O=0;O<tt.length;++O){var et=31&tt[O];z(e,f,J[et]),f+=F[et],et>15&&(z(e,f,tt[O]>>>5&127),f+=tt[O]>>>12)}}}else _=I,H=E,X=P,Q=C;for(O=0;O<s;++O)if(n[O]>255){et=n[O]>>>18&31;U(e,f,_[et+257]),f+=H[et+257],et>7&&(z(e,f,n[O]>>>23&31),f+=h[et]);var rt=31&n[O];U(e,f,X[rt]),f+=Q[rt],rt>3&&(U(e,f,n[O]>>>5&8191),f+=d[rt])}else U(e,f,_[n[O]]),f+=H[n[O]];return U(e,f,_[256]),f+H[256]},X=new f([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Q=new c(0),Y=function(t,e,r,n,i,o){var a=t.length,s=new c(n+a+5*(1+Math.ceil(a/7e3))+i),l=s.subarray(n,s.length-i),p=0;if(!e||a<8)for(var g=0;g<=a;g+=65535){var m=g+65535;m<a?p=W(l,p,t.subarray(g,m)):(l[g]=o,p=W(l,p,t.subarray(g,a)))}else{for(var v=X[e-1],w=v>>>13,b=8191&v,T=(1<<r)-1,M=new u(32768),S=new u(T+1),A=Math.ceil(r/3),E=2*A,C=function(e){return(t[e]^t[e+1]<<A^t[e+2]<<E)&T},I=new f(25e3),B=new u(288),P=new u(32),R=0,D=0,O=(g=0,0),k=0,L=0;g<a;++g){var z=C(g),U=32767&g,j=S[z];if(M[U]=j,S[z]=U,k<=g){var _=a-g;if((R>7e3||O>24576)&&_>423){p=H(t,l,0,I,B,P,D,O,L,g-L,p),O=R=D=0,L=g;for(var V=0;V<286;++V)B[V]=0;for(V=0;V<30;++V)P[V]=0}var G=2,Y=0,Z=b,K=U-j&32767;if(_>2&&z==C(g-K)){var J=Math.min(w,_)-1,q=Math.min(32767,g),$=Math.min(258,_);while(K<=q&&--Z&&U!=j){if(t[g+G]==t[g+G-K]){for(var tt=0;tt<$&&t[g+tt]==t[g+tt-K];++tt);if(tt>G){if(G=tt,Y=K,tt>J)break;var et=Math.min(K,tt-2),rt=0;for(V=0;V<et;++V){var nt=g-K+V+32768&32767,it=M[nt],ot=nt-it+32768&32767;ot>rt&&(rt=ot,j=nt)}}}U=j,j=M[U],K+=U-j+32768&32767}}if(Y){I[O++]=268435456|y[G]<<18|x[Y];var at=31&y[G],st=31&x[Y];D+=h[at]+d[st],++B[257+at],++P[st],k=g+G,++R}else I[O++]=t[g],++B[t[g]]}}p=H(t,l,o,I,B,P,D,O,L,g-L,p),!o&&7&p&&(p=W(l,p+1,Q))}return N(s,0,n+F(p)+i)},Z=function(){for(var t=new f(256),e=0;e<256;++e){var r=e,n=9;while(--n)r=(1&r&&3988292384)^r>>>1;t[e]=r}return t}(),K=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=Z[255&r^e[n]]^r>>>8;t=r},d:function(){return~t}}},J=function(){var t=1,e=0;return{p:function(r){for(var n=t,i=e,o=r.length,a=0;a!=o;){for(var s=Math.min(a+2655,o);a<s;++a)i+=n+=r[a];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}t=n,e=i},d:function(){return t%=65521,e%=65521,(255&t)<<24|t>>>8<<16|(255&e)<<8|e>>>8}}},q=function(t,e,r,n,i){return Y(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,r,n,!i)},$=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},tt=function(t,e,r){for(var n=t(),i=t.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var s=n[a],l=o[a];if("function"==typeof s){e+=";"+l+"=";var c=s.toString();if(s.prototype)if(-1!=c.indexOf("[native code]")){var u=c.indexOf(" ",8)+1;e+=c.slice(u,c.indexOf("(",u))}else for(var f in e+=c,s.prototype)e+=";"+l+".prototype."+f+"="+s.prototype[f].toString();else e+=c}else r[l]=s}return[e,r]},et=[],rt=function(t){var e=[];for(var r in t)(t[r]instanceof c||t[r]instanceof u||t[r]instanceof f)&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e},nt=function(t,e,r,n){var i;if(!et[r]){for(var o="",a={},s=t.length-1,c=0;c<s;++c)i=tt(t[c],o,a),o=i[0],a=i[1];et[r]=tt(t[s],o,a)}var u=$({},et[r][1]);return l(et[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",r,u,rt(u),n)},it=function(){return[c,u,f,h,d,p,v,b,B,R,T,A,D,O,k,F,N,L,Ot,ut,ft]},ot=function(){return[c,u,f,h,d,p,y,x,I,E,P,C,T,X,Q,A,z,U,j,_,V,G,W,H,F,N,Y,q,Bt,ut]},at=function(){return[wt,Tt,yt,K,Z]},st=function(){return[bt,xt]},lt=function(){return[Mt,yt,J]},ct=function(){return[St]},ut=function(t){return postMessage(t,[t.buffer])},ft=function(t){return t&&t.size&&new c(t.size)},ht=function(t,e,r,n,i,o){var a=nt(r,n,i,(function(t,e){a.terminate(),o(t,e)}));return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}},dt=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},pt=function(t,e,r,n,i){var o,a=nt(t,n,i,(function(t,r){t?(a.terminate(),e.ondata.call(e,t)):(r[1]&&a.terminate(),e.ondata.call(e,t,r[0],r[1]))}));a.postMessage(r),e.push=function(t,r){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([t,o=r],[t.buffer])},e.terminate=function(){a.terminate()}},gt=function(t,e){return t[e]|t[e+1]<<8},mt=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},vt=function(t,e){return mt(t,e)+4294967296*mt(t,e+4)},yt=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},wt=function(t,e){var r=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&yt(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),r){t[3]=8;for(var n=0;n<=r.length;++n)t[n+10]=r.charCodeAt(n)}},bt=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],r=10;4&e&&(r+=t[10]|2+(t[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(2&e)},xt=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Tt=function(t){return 10+(t.filename&&t.filename.length+1||0)},Mt=function(t,e){var r=e.level,n=0==r?0:r<6?1:9==r?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)},St=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function At(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var Et=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(q(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}(),Ct=function(){function t(t,e){pt([ot,function(){return[dt,Et]}],this,At.call(this,t,e),(function(t){var e=new Et(t.data);onmessage=dt(e)}),6)}return t}();function It(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return ht(t,e,[ot],(function(t){return ut(Bt(t.data[0],t.data[1]))}),0,r)}function Bt(t,e){return q(t,e||{},0,0)}var Pt=function(){function t(t){this.s={},this.p=new c(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,r=new c(e+t.length);r.set(this.p),r.set(t,e),this.p=r},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,r=L(this.p,this.o,this.s);this.ondata(N(r,e,this.s.b),this.d),this.o=N(r,this.s.b-32768),this.s.b=this.o.length,this.p=N(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}(),Rt=function(){function t(t){this.ondata=t,pt([it,function(){return[dt,Pt]}],this,0,(function(){var t=new Pt;onmessage=dt(t)}),7)}return t}();function Dt(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return ht(t,e,[it],(function(t){return ut(Ot(t.data[0],ft(t.data[1])))}),1,r)}function Ot(t,e){return L(t,e)}var kt=function(){function t(t,e){this.c=K(),this.l=0,this.v=1,Et.call(this,t,e)}return t.prototype.push=function(t,e){Et.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var r=q(t,this.o,this.v&&Tt(this.o),e&&8,!e);this.v&&(wt(r,this.o),this.v=0),e&&(yt(r,r.length-8,this.c.d()),yt(r,r.length-4,this.l)),this.ondata(r,e)},t}(),Ft=function(){function t(t,e){pt([ot,at,function(){return[dt,Et,kt]}],this,At.call(this,t,e),(function(t){var e=new kt(t.data);onmessage=dt(e)}),8)}return t}();function Nt(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return ht(t,e,[ot,at,function(){return[Lt]}],(function(t){return ut(Lt(t.data[0],t.data[1]))}),2,r)}function Lt(t,e){e||(e={});var r=K(),n=t.length;r.p(t);var i=q(t,e,Tt(e),8),o=i.length;return wt(i,e),yt(i,o-8,r.d()),yt(i,o-4,n),i}var zt=function(){function t(t){this.v=1,Pt.call(this,t)}return t.prototype.push=function(t,e){if(Pt.prototype.e.call(this,t),this.v){var r=this.p.length>3?bt(this.p):4;if(r>=this.p.length&&!e)return;this.p=this.p.subarray(r),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Pt.prototype.c.call(this,e)},t}(),Ut=function(){function t(t){this.ondata=t,pt([it,st,function(){return[dt,Pt,zt]}],this,0,(function(){var t=new zt;onmessage=dt(t)}),9)}return t}();function jt(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return ht(t,e,[it,st,function(){return[_t]}],(function(t){return ut(_t(t.data[0]))}),3,r)}function _t(t,e){return L(t.subarray(bt(t),-8),e||new c(xt(t)))}var Vt=function(){function t(t,e){this.c=J(),this.v=1,Et.call(this,t,e)}return t.prototype.push=function(t,e){Et.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var r=q(t,this.o,this.v&&2,e&&4,!e);this.v&&(Mt(r,this.o),this.v=0),e&&yt(r,r.length-4,this.c.d()),this.ondata(r,e)},t}(),Gt=function(){function t(t,e){pt([ot,lt,function(){return[dt,Et,Vt]}],this,At.call(this,t,e),(function(t){var e=new Vt(t.data);onmessage=dt(e)}),10)}return t}();function Wt(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return ht(t,e,[ot,lt,function(){return[Ht]}],(function(t){return ut(Ht(t.data[0],t.data[1]))}),4,r)}function Ht(t,e){e||(e={});var r=J();r.p(t);var n=q(t,e,2,4);return Mt(n,e),yt(n,n.length-4,r.d()),n}var Xt=function(){function t(t){this.v=1,Pt.call(this,t)}return t.prototype.push=function(t,e){if(Pt.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Pt.prototype.c.call(this,e)},t}(),Qt=function(){function t(t){this.ondata=t,pt([it,ct,function(){return[dt,Pt,Xt]}],this,0,(function(){var t=new Xt;onmessage=dt(t)}),11)}return t}();function Yt(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return ht(t,e,[it,ct,function(){return[Zt]}],(function(t){return ut(Zt(t.data[0],ft(t.data[1])))}),5,r)}function Zt(t,e){return L((St(t),t.subarray(2,-4)),e)}var Kt=function(){function t(t){this.G=zt,this.I=Pt,this.Z=Xt,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var r=new c(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var n=this,i=function(){n.ondata.apply(n,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(i):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,e),this.p=null}}},t}(),Jt=function(){function t(t){this.G=Ut,this.I=Rt,this.Z=Qt,this.ondata=t}return t.prototype.push=function(t,e){Kt.prototype.push.call(this,t,e)},t}();function qt(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?jt(t,e,r):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Dt(t,e,r):Yt(t,e,r)}function $t(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?_t(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Ot(t,e):Zt(t,e)}var te=function(t,e,r,n){for(var i in t){var o=t[i],a=e+i;o instanceof c?r[a]=[o,n]:Array.isArray(o)?r[a]=[o[0],$(n,o[1])]:te(o,a+"/",r,n)}},ee="undefined"!=typeof TextEncoder&&new TextEncoder,re="undefined"!=typeof TextDecoder&&new TextDecoder,ne=0;try{re.decode(Q,{stream:!0}),ne=1}catch(cr){}var ie=function(t){for(var e="",r=0;;){var n=t[r++],i=(n>127)+(n>223)+(n>239);if(r+i>t.length)return[e,N(t,r-1)];i?3==i?(n=((15&n)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&i?String.fromCharCode((31&n)<<6|63&t[r++]):String.fromCharCode((15&n)<<12|(63&t[r++])<<6|63&t[r++]):e+=String.fromCharCode(n)}},oe=function(){function t(t){this.ondata=t,ne?this.t=new TextDecoder:this.p=Q}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var r=new c(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length);var n=ie(r),i=n[0],o=n[1];if(e){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(i,e)}},t}(),ae=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(se(t),this.d=e||!1)},t}();function se(t,e){if(e){for(var r=new c(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(ee)return ee.encode(t);var i=t.length,o=new c(t.length+(t.length>>1)),a=0,s=function(t){o[a++]=t};for(n=0;n<i;++n){if(a+5>o.length){var l=new c(a+8+(i-n<<1));l.set(o),o=l}var u=t.charCodeAt(n);u<128||e?s(u):u<2048?(s(192|u>>6),s(128|63&u)):u>55295&&u<57344?(u=65536+(1047552&u)|1023&t.charCodeAt(++n),s(240|u>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|63&u)):(s(224|u>>12),s(128|u>>6&63),s(128|63&u))}return N(o,0,a)}function le(t,e){if(e){for(var r="",n=0;n<t.length;n+=16384)r+=String.fromCharCode.apply(null,t.subarray(n,n+16384));return r}if(re)return re.decode(t);var i=ie(t),o=i[0],a=i[1];if(a.length)throw"invalid utf-8 data";return o}var ce=function(t){return 1==t?3:t<6?2:9==t?1:0},ue=function(t,e){return e+30+gt(t,e+26)+gt(t,e+28)},fe=function(t,e,r){var n=gt(t,e+28),i=le(t.subarray(e+46,e+46+n),!(2048&gt(t,e+8))),o=e+46+n,a=mt(t,e+20),s=r&&4294967295==a?he(t,o):[a,mt(t,e+24),mt(t,e+42)],l=s[0],c=s[1],u=s[2];return[gt(t,e+10),l,c,i,o+gt(t,e+30)+gt(t,e+32),u]},he=function(t,e){for(;1!=gt(t,e);e+=4+gt(t,e+2));return[vt(t,e+12),vt(t,e+4),vt(t,e+20)]},de=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;if(n>65535)throw"extra field too long";e+=n+4}return e},pe=function(t,e,r,n,i,o,a,s){var l=n.length,c=r.extra,u=s&&s.length,f=de(c);yt(t,e,null!=a?33639248:67324752),e+=4,null!=a&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(null==o&&8),t[e++]=i&&8,t[e++]=255&r.compression,t[e++]=r.compression>>8;var h=new Date(null==r.mtime?Date.now():r.mtime),d=h.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(yt(t,e,d<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,null!=o&&(yt(t,e,r.crc),yt(t,e+4,o),yt(t,e+8,r.size)),yt(t,e+12,l),yt(t,e+14,f),e+=16,null!=a&&(yt(t,e,u),yt(t,e+6,r.attrs),yt(t,e+10,a),e+=14),t.set(n,e),e+=l,f)for(var p in c){var g=c[p],m=g.length;yt(t,e,+p),yt(t,e+2,m),t.set(g,e+4),e+=4+m}return u&&(t.set(s,e),e+=u),e},ge=function(t,e,r,n,i){yt(t,e,101010256),yt(t,e+8,r),yt(t,e+10,r),yt(t,e+12,n),yt(t,e+16,i)},me=function(){function t(t){this.filename=t,this.c=K(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),ve=function(){function t(t,e){var r=this;e||(e={}),me.call(this,t),this.d=new Et(e,(function(t,e){r.ondata(null,t,e)})),this.compression=8,this.flag=ce(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(cr){this.ondata(cr,null,e)}},t.prototype.push=function(t,e){me.prototype.push.call(this,t,e)},t}(),ye=function(){function t(t,e){var r=this;e||(e={}),me.call(this,t),this.d=new Ct(e,(function(t,e,n){r.ondata(t,e,n)})),this.compression=8,this.flag=ce(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){me.prototype.push.call(this,t,e)},t}(),we=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var r=se(t.filename),n=r.length,i=t.comment,o=i&&se(i),a=n!=t.filename.length||o&&i.length!=o.length,s=n+de(t.extra)+30;if(n>65535)throw"filename too long";var l=new c(s);pe(l,0,t,r,a);var u=[l],f=function(){for(var t=0,r=u;t<r.length;t++){var n=r[t];e.ondata(null,n,!1)}u=[]},h=this.d;this.d=0;var d=this.u.length,p=$(t,{f:r,u:a,o:o,t:function(){t.terminate&&t.terminate()},r:function(){if(f(),h){var t=e.u[d+1];t?t.r():e.d=1}h=1}}),g=0;t.ondata=function(r,n,i){if(r)e.ondata(r,n,i),e.terminate();else if(g+=n.length,u.push(n),i){var o=new c(16);yt(o,0,134695760),yt(o,4,t.crc),yt(o,8,g),yt(o,12,t.size),u.push(o),p.c=g,p.b=s+g+16,p.crc=t.crc,p.size=t.size,h&&p.r(),h=1}else h&&f()},this.u.push(p)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,r=0,n=0,i=this.u;n<i.length;n++){var o=i[n];r+=46+o.f.length+de(o.extra)+(o.o?o.o.length:0)}for(var a=new c(r+22),s=0,l=this.u;s<l.length;s++){o=l[s];pe(a,t,o,o.f,o.u,o.c,e,o.o),t+=46+o.f.length+de(o.extra)+(o.o?o.o.length:0),e+=o.b}ge(a,t,this.u.length,r,e),this.ondata(null,a,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++){var r=e[t];r.t()}this.d=2},t}();function be(t,e,r){if(r||(r=e,e={}),"function"!=typeof r)throw"no callback";var n={};te(t,"",n,e);var i=Object.keys(n),o=i.length,a=0,s=0,l=o,u=new Array(o),f=[],h=function(){for(var t=0;t<f.length;++t)f[t]()},d=function(){var t=new c(s+22),e=a,n=s-a;s=0;for(var i=0;i<l;++i){var o=u[i];try{var f=o.c.length;pe(t,s,o,o.f,o.u,f);var h=30+o.f.length+de(o.extra),d=s+h;t.set(o.c,d),pe(t,a,o,o.f,o.u,f,s,o.m),a+=16+h+(o.m?o.m.length:0),s=d+f}catch(cr){return r(cr,null)}}ge(t,a,u.length,n,e),r(null,t)};o||d();for(var p=function(t){var e=i[t],l=n[e],c=l[0],p=l[1],g=K(),m=c.length;g.p(c);var v=se(e),y=v.length,w=p.comment,b=w&&se(w),x=b&&b.length,T=de(p.extra),M=0==p.level?0:8,S=function(n,i){if(n)h(),r(n,null);else{var l=i.length;u[t]=$(p,{size:m,crc:g.d(),c:i,f:v,m:b,u:y!=e.length||b&&w.length!=x,compression:M}),a+=30+y+T+l,s+=76+2*(y+T)+(x||0)+l,--o||d()}};if(y>65535&&S("filename too long",null),M)if(m<16e4)try{S(null,Bt(c,p))}catch(cr){S(cr,null)}else f.push(It(c,p,S));else S(null,c)},g=0;g<l;++g)p(g);return h}function xe(t,e){e||(e={});var r={},n=[];te(t,"",r,e);var i=0,o=0;for(var a in r){var s=r[a],l=s[0],u=s[1],f=0==u.level?0:8,h=se(a),d=h.length,p=u.comment,g=p&&se(p),m=g&&g.length,v=de(u.extra);if(d>65535)throw"filename too long";var y=f?Bt(l,u):l,w=y.length,b=K();b.p(l),n.push($(u,{size:l.length,crc:b.d(),c:y,f:h,m:g,u:d!=a.length||g&&p.length!=m,o:i,compression:f})),i+=30+d+v+w,o+=76+2*(d+v)+(m||0)+w}for(var x=new c(o+22),T=i,M=o-i,S=0;S<n.length;++S){h=n[S];pe(x,h.o,h,h.f,h.u,h.c.length);var A=30+h.f.length+de(h.extra);x.set(h.c,h.o+A),pe(x,i,h,h.f,h.u,h.c.length,h.o,h.m),i+=16+A+(h.m?h.m.length:0)}return ge(x,i,n.length,M,T),x}var Te=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}(),Me=function(){function t(){var t=this;this.i=new Pt((function(e,r){t.ondata(null,e,r)}))}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(cr){this.ondata(cr,t,e)}},t.compression=8,t}(),Se=function(){function t(t,e){var r=this;e<32e4?this.i=new Pt((function(t,e){r.ondata(null,t,e)})):(this.i=new Rt((function(t,e,n){r.ondata(t,e,n)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=N(t,0)),this.i.push(t,e)},t.compression=8,t}(),Ae=function(){function t(t){this.onfile=t,this.k=[],this.o={0:Te},this.p=Q}return t.prototype.push=function(t,e){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var n=Math.min(this.c,t.length),i=t.subarray(0,n);if(this.c-=n,this.d?this.d.push(i,!this.c):this.k[0].push(i),t=t.subarray(n),t.length)return this.push(t,e)}else{var o=0,a=0,s=void 0,l=void 0;this.p.length?t.length?(l=new c(this.p.length+t.length),l.set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var u=l.length,f=this.c,h=f&&this.d,d=function(){var t,e=mt(l,a);if(67324752==e){o=1,s=a,p.d=null,p.c=0;var n=gt(l,a+6),i=gt(l,a+8),c=2048&n,h=8&n,d=gt(l,a+26),g=gt(l,a+28);if(u>a+30+d+g){var m=[];p.k.unshift(m),o=2;var v,y=mt(l,a+18),w=mt(l,a+22),b=le(l.subarray(a+30,a+=30+d),!c);4294967295==y?(t=h?[-2]:he(l,a),y=t[0],w=t[1]):h&&(y=-1),a+=g,p.c=y;var x={name:b,compression:i,start:function(){if(!x.ondata)throw"no callback";if(y){var t=r.o[i];if(!t)throw"unknown compression type "+i;v=y<0?new t(b):new t(b,y,w),v.ondata=function(t,e,r){x.ondata(t,e,r)};for(var e=0,n=m;e<n.length;e++){var o=n[e];v.push(o,!1)}r.k[0]==m&&r.c?r.d=v:v.push(Q,!0)}else x.ondata(null,Q,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(x.size=y,x.originalSize=w),p.onfile(x)}return"break"}if(f){if(134695760==e)return s=a+=12+(-2==f&&8),o=3,p.c=0,"break";if(33639248==e)return s=a-=4,o=3,p.c=0,"break"}},p=this;a<u-4;++a){var g=d();if("break"===g)break}if(this.p=Q,f<0){var m=o?l.subarray(0,s-12-(-2==f&&8)-(134695760==mt(l,s-16)&&4)):l.subarray(0,a);h?h.push(m,!!o):this.k[+(2==o)].push(m)}if(2&o)return this.push(l.subarray(a),e);this.p=l.subarray(a)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();function Ee(t,e){if("function"!=typeof e)throw"no callback";for(var r=[],n=function(){for(var t=0;t<r.length;++t)r[t]()},i={},o=t.length-22;101010256!=mt(t,o);--o)if(!o||t.length-o>65558)return void e("invalid zip file",null);var a=gt(t,o+8);a||e(null,{});var s=a,l=mt(t,o+16),u=4294967295==l;if(u){if(o=mt(t,o-12),101075792!=mt(t,o))return void e("invalid zip file",null);s=a=mt(t,o+32),l=mt(t,o+48)}for(var f=function(s){var f=fe(t,l,u),h=f[0],d=f[1],p=f[2],g=f[3],m=f[4],v=f[5],y=ue(t,v);l=m;var w=function(t,r){t?(n(),e(t,null)):(i[g]=r,--a||e(null,i))};if(h)if(8==h){var b=t.subarray(y,y+d);if(d<32e4)try{w(null,Ot(b,new c(p)))}catch(o){w(o,null)}else r.push(Dt(b,{size:p},w))}else w("unknown compression type "+h,null);else w(null,N(t,y,y+d))},h=0;h<s;++h)f(h);return n}function Ce(t){for(var e={},r=t.length-22;101010256!=mt(t,r);--r)if(!r||t.length-r>65558)throw"invalid zip file";var n=gt(t,r+8);if(!n)return{};var i=mt(t,r+16),o=4294967295==i;if(o){if(r=mt(t,r-12),101075792!=mt(t,r))throw"invalid zip file";n=mt(t,r+32),i=mt(t,r+48)}for(var a=0;a<n;++a){var s=fe(t,i,o),l=s[0],u=s[1],f=s[2],h=s[3],d=s[4],p=s[5],g=ue(t,p);if(i=d,l){if(8!=l)throw"unknown compression type "+l;e[h]=Ot(t.subarray(g,g+u),new c(f))}else e[h]=N(t,g,g+u)}return e}function Ie(t,e,r){const n=r.length-t-1;if(e>=r[n])return n-1;if(e<=r[t])return t;let i=t,o=n,a=Math.floor((i+o)/2);while(e<r[a]||e>=r[a+1])e<r[a]?o=a:i=a,a=Math.floor((i+o)/2);return a}function Be(t,e,r,n){const i=[],o=[],a=[];i[0]=1;for(let s=1;s<=r;++s){o[s]=e-n[t+1-s],a[s]=n[t+s]-e;let r=0;for(let t=0;t<s;++t){const e=a[t+1],n=o[s-t],l=i[t]/(e+n);i[t]=r+e*l,r=n*l}i[s]=r}return i}function Pe(t,e,r,n){const o=Ie(t,n,e),a=Be(o,n,t,e),s=new i["Vector4"](0,0,0,0);for(let i=0;i<=t;++i){const e=r[o-t+i],n=a[i],l=e.w*n;s.x+=e.x*l,s.y+=e.y*l,s.z+=e.z*l,s.w+=e.w*n}return s}function Re(t,e,r,n,i){const o=[];for(let f=0;f<=r;++f)o[f]=0;const a=[];for(let f=0;f<=n;++f)a[f]=o.slice(0);const s=[];for(let f=0;f<=r;++f)s[f]=o.slice(0);s[0][0]=1;const l=o.slice(0),c=o.slice(0);for(let f=1;f<=r;++f){l[f]=e-i[t+1-f],c[f]=i[t+f]-e;let r=0;for(let t=0;t<f;++t){const e=c[t+1],n=l[f-t];s[f][t]=e+n;const i=s[t][f-1]/s[f][t];s[t][f]=r+e*i,r=n*i}s[f][f]=r}for(let f=0;f<=r;++f)a[0][f]=s[f][r];for(let f=0;f<=r;++f){let t=0,e=1;const i=[];for(let n=0;n<=r;++n)i[n]=o.slice(0);i[0][0]=1;for(let o=1;o<=n;++o){let n=0;const l=f-o,c=r-o;f>=o&&(i[e][0]=i[t][0]/s[c+1][l],n=i[e][0]*s[l][c]);const u=l>=-1?1:-l,h=f-1<=c?o-1:r-f;for(let r=u;r<=h;++r)i[e][r]=(i[t][r]-i[t][r-1])/s[c+1][l+r],n+=i[e][r]*s[l+r][c];f<=c&&(i[e][o]=-i[t][o-1]/s[c+1][f],n+=i[e][o]*s[f][c]),a[o][f]=n;const d=t;t=e,e=d}}let u=r;for(let f=1;f<=n;++f){for(let t=0;t<=r;++t)a[f][t]*=u;u*=r-f}return a}function De(t,e,r,n,o){const a=o<t?o:t,s=[],l=Ie(t,n,e),c=Re(l,n,t,a,e),u=[];for(let i=0;i<r.length;++i){const t=r[i].clone(),e=t.w;t.x*=e,t.y*=e,t.z*=e,u[i]=t}for(let i=0;i<=a;++i){const e=u[l-t].clone().multiplyScalar(c[i][0]);for(let r=1;r<=t;++r)e.add(u[l-t+r].clone().multiplyScalar(c[i][r]));s[i]=e}for(let f=a+1;f<=o+1;++f)s[f]=new i["Vector4"](0,0,0);return s}function Oe(t,e){let r=1;for(let i=2;i<=t;++i)r*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=t-e;++i)n*=i;return r/n}function ke(t){const e=t.length,r=[],n=[];for(let a=0;a<e;++a){const e=t[a];r[a]=new i["Vector3"](e.x,e.y,e.z),n[a]=e.w}const o=[];for(let i=0;i<e;++i){const t=r[i].clone();for(let e=1;e<=i;++e)t.sub(o[i-e].clone().multiplyScalar(Oe(i,e)*n[e]));o[i]=t.divideScalar(n[0])}return o}function Fe(t,e,r,n,i){const o=De(t,e,r,n,i);return ke(o)}class Ne extends i["Curve"]{constructor(t,e,r,n,o){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=n||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<r.length;++a){const t=r[a];this.controlPoints[a]=new i["Vector4"](t.x,t.y,t.z,t.w)}}getPoint(t,e=new i["Vector3"]){const r=e,n=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=Pe(this.degree,this.knots,this.controlPoints,n);return 1!==o.w&&o.divideScalar(o.w),r.set(o.x,o.y,o.z)}getTangent(t,e=new i["Vector3"]){const r=e,n=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),o=Fe(this.degree,this.knots,this.controlPoints,n,1);return r.copy(o[1]).normalize(),r}}let Le,ze,Ue;class je extends i["Loader"]{constructor(t){super(t)}load(t,e,r,n){const o=this,a=""===o.path?i["LoaderUtils"].extractUrlBase(t):o.path,s=new i["FileLoader"](this.manager);s.setPath(o.path),s.setResponseType("arraybuffer"),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(t,(function(r){try{e(o.parse(r,a))}catch(cr){n?n(cr):console.error(cr),o.manager.itemError(t)}}),r,n)}parse(t,e){if(Ye(t))Le=(new He).parse(t);else{const e=or(t);if(!Ze(e))throw new Error("THREE.FBXLoader: Unknown format.");if(Ke(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ke(e));Le=(new We).parse(e)}const r=new i["TextureLoader"](this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new _e(r,this.manager).parse(Le)}}class _e{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){ze=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),r=this.parseMaterials(e),n=this.parseDeformers(),i=(new Ve).parse(n);return this.parseScene(n,i,r),Ue}parseConnections(){const t=new Map;if("Connections"in Le){const e=Le.Connections.connections;e.forEach((function(e){const r=e[0],n=e[1],i=e[2];t.has(r)||t.set(r,{parents:[],children:[]});const o={ID:n,relationship:i};t.get(r).parents.push(o),t.has(n)||t.set(n,{parents:[],children:[]});const a={ID:r,relationship:i};t.get(n).children.push(a)}))}return t}parseImages(){const t={},e={};if("Video"in Le.Objects){const r=Le.Objects.Video;for(const n in r){const i=r[n],o=parseInt(n);if(t[o]=i.RelativeFilename||i.Filename,"Content"in i){const t=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,o="string"===typeof i.Content&&""!==i.Content;if(t||o){const t=this.parseImage(r[n]);e[i.RelativeFilename||i.Filename]=t}}}}for(const r in t){const n=t[r];void 0!==e[n]?t[r]=e[n]:t[r]=t[r].split("\\").pop()}return t}parseImage(t){const e=t.Content,r=t.RelativeFilename||t.Filename,n=r.slice(r.lastIndexOf(".")+1).toLowerCase();let i;switch(n){case"bmp":i="image/bmp";break;case"jpg":case"jpeg":i="image/jpeg";break;case"png":i="image/png";break;case"tif":i="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),i="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"===typeof e)return"data:"+i+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:i}))}}parseTextures(t){const e=new Map;if("Texture"in Le.Objects){const r=Le.Objects.Texture;for(const n in r){const i=this.parseTexture(r[n],t);e.set(parseInt(n),i)}}return e}parseTexture(t,e){const r=this.loadTexture(t,e);r.ID=t.id,r.name=t.attrName;const n=t.WrapModeU,o=t.WrapModeV,a=void 0!==n?n.value:0,s=void 0!==o?o.value:0;if(r.wrapS=0===a?i["RepeatWrapping"]:i["ClampToEdgeWrapping"],r.wrapT=0===s?i["RepeatWrapping"]:i["ClampToEdgeWrapping"],"Scaling"in t){const e=t.Scaling.value;r.repeat.x=e[0],r.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;r.offset.x=e[0],r.offset.y=e[1]}return r}loadTexture(t,e){let r;const n=this.textureLoader.path,o=ze.get(t.id).children;let a;void 0!==o&&o.length>0&&void 0!==e[o[0].ID]&&(r=e[o[0].ID],0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const s=t.FileName.slice(-3).toLowerCase();if("tga"===s){const e=this.manager.getHandler(".tga");null===e?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),a=new i["Texture"]):(e.setPath(this.textureLoader.path),a=e.load(r))}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),a=new i["Texture"]):a=this.textureLoader.load(r);return this.textureLoader.setPath(n),a}parseMaterials(t){const e=new Map;if("Material"in Le.Objects){const r=Le.Objects.Material;for(const n in r){const i=this.parseMaterial(r[n],t);null!==i&&e.set(parseInt(n),i)}}return e}parseMaterial(t,e){const r=t.id,n=t.attrName;let o=t.ShadingModel;if("object"===typeof o&&(o=o.value),!ze.has(r))return null;const a=this.parseParameters(t,e,r);let s;switch(o.toLowerCase()){case"phong":s=new i["MeshPhongMaterial"];break;case"lambert":s=new i["MeshLambertMaterial"];break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),s=new i["MeshPhongMaterial"];break}return s.setValues(a),s.name=n,s}parseParameters(t,e,r){const n={};t.BumpFactor&&(n.bumpScale=t.BumpFactor.value),t.Diffuse?n.color=(new i["Color"]).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(n.color=(new i["Color"]).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(n.displacementScale=t.DisplacementFactor.value),t.Emissive?n.emissive=(new i["Color"]).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(n.emissive=(new i["Color"]).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(n.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(n.opacity=parseFloat(t.Opacity.value)),n.opacity<1&&(n.transparent=!0),t.ReflectionFactor&&(n.reflectivity=t.ReflectionFactor.value),t.Shininess&&(n.shininess=t.Shininess.value),t.Specular?n.specular=(new i["Color"]).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(n.specular=(new i["Color"]).fromArray(t.SpecularColor.value));const o=this;return ze.get(r).children.forEach((function(t){const r=t.relationship;switch(r){case"Bump":n.bumpMap=o.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":n.aoMap=o.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=o.getTexture(e,t.ID),void 0!==n.map&&(n.map.encoding=i["sRGBEncoding"]);break;case"DisplacementColor":n.displacementMap=o.getTexture(e,t.ID);break;case"EmissiveColor":n.emissiveMap=o.getTexture(e,t.ID),void 0!==n.emissiveMap&&(n.emissiveMap.encoding=i["sRGBEncoding"]);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=o.getTexture(e,t.ID);break;case"ReflectionColor":n.envMap=o.getTexture(e,t.ID),void 0!==n.envMap&&(n.envMap.mapping=i["EquirectangularReflectionMapping"],n.envMap.encoding=i["sRGBEncoding"]);break;case"SpecularColor":n.specularMap=o.getTexture(e,t.ID),void 0!==n.specularMap&&(n.specularMap.encoding=i["sRGBEncoding"]);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=o.getTexture(e,t.ID),n.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r);break}})),n}getTexture(t,e){return"LayeredTexture"in Le.Objects&&e in Le.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=ze.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in Le.Objects){const r=Le.Objects.Deformer;for(const n in r){const i=r[n],o=ze.get(parseInt(n));if("Skin"===i.attrType){const e=this.parseSkeleton(o,r);e.ID=n,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),e.geometryID=o.parents[0].ID,t[n]=e}else if("BlendShape"===i.attrType){const t={id:n};t.rawTargets=this.parseMorphTargets(o,r),t.id=n,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[n]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const r=[];return t.children.forEach((function(t){const n=e[t.ID];if("Cluster"!==n.attrType)return;const o={ID:t.ID,indices:[],weights:[],transformLink:(new i["Matrix4"]).fromArray(n.TransformLink.a)};"Indexes"in n&&(o.indices=n.Indexes.a,o.weights=n.Weights.a),r.push(o)})),{rawBones:r,bones:[]}}parseMorphTargets(t,e){const r=[];for(let n=0;n<t.children.length;n++){const i=t.children[n],o=e[i.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;a.geoID=ze.get(parseInt(i.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,r.push(a)}return r}parseScene(t,e,r){Ue=new i["Group"];const n=this.parseModels(t.skeletons,e,r),o=Le.Objects.Model,a=this;n.forEach((function(t){const e=o[t.ID];a.setLookAtProperties(t,e);const r=ze.get(t.ID).parents;r.forEach((function(e){const r=n.get(e.ID);void 0!==r&&r.add(t)})),null===t.parent&&Ue.add(t)})),this.bindSkeleton(t.skeletons,e,n),this.createAmbientLight(),Ue.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=rr(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const s=(new Ge).parse();1===Ue.children.length&&Ue.children[0].isGroup&&(Ue.children[0].animations=s,Ue=Ue.children[0]),Ue.animations=s}parseModels(t,e,r){const n=new Map,o=Le.Objects.Model;for(const a in o){const s=parseInt(a),l=o[a],c=ze.get(s);let u=this.buildSkeleton(c,t,s,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,e,r);break;case"NurbsCurve":u=this.createCurve(c,e);break;case"LimbNode":case"Root":u=new i["Bone"];break;case"Null":default:u=new i["Group"];break}u.name=l.attrName?i["PropertyBinding"].sanitizeNodeName(l.attrName):"",u.ID=s}this.getTransformData(u,l),n.set(s,u)}return n}buildSkeleton(t,e,r,n){let o=null;return t.parents.forEach((function(t){for(const a in e){const s=e[a];s.rawBones.forEach((function(e,a){if(e.ID===t.ID){const t=o;o=new i["Bone"],o.matrixWorld.copy(e.transformLink),o.name=n?i["PropertyBinding"].sanitizeNodeName(n):"",o.ID=r,s.bones[a]=o,null!==t&&o.add(t)}}))}})),o}createCamera(t){let e,r;if(t.children.forEach((function(t){const e=Le.Objects.NodeAttribute[t.ID];void 0!==e&&(r=e)})),void 0===r)e=new i["Object3D"];else{let t=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(t=1);let n=1;void 0!==r.NearPlane&&(n=r.NearPlane.value/1e3);let o=1e3;void 0!==r.FarPlane&&(o=r.FarPlane.value/1e3);let a=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,s=r.AspectHeight.value);const l=a/s;let c=45;void 0!==r.FieldOfView&&(c=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(t){case 0:e=new i["PerspectiveCamera"](c,l,n,o),null!==u&&e.setFocalLength(u);break;case 1:e=new i["OrthographicCamera"](-a/2,a/2,s/2,-s/2,n,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),e=new i["Object3D"];break}}return e}createLight(t){let e,r;if(t.children.forEach((function(t){const e=Le.Objects.NodeAttribute[t.ID];void 0!==e&&(r=e)})),void 0===r)e=new i["Object3D"];else{let t;t=void 0===r.LightType?0:r.LightType.value;let n=16777215;void 0!==r.Color&&(n=(new i["Color"]).fromArray(r.Color.value));let o=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(o=0);let a=0;void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const s=1;switch(t){case 0:e=new i["PointLight"](n,o,a,s);break;case 1:e=new i["DirectionalLight"](n,o);break;case 2:let t=Math.PI/3;void 0!==r.InnerAngle&&(t=i["MathUtils"].degToRad(r.InnerAngle.value));let l=0;void 0!==r.OuterAngle&&(l=i["MathUtils"].degToRad(r.OuterAngle.value),l=Math.max(l,1)),e=new i["SpotLight"](n,o,a,t,l,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),e=new i["PointLight"](n,o);break}void 0!==r.CastShadows&&1===r.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,r){let n,o=null,a=null;const s=[];return t.children.forEach((function(t){e.has(t.ID)&&(o=e.get(t.ID)),r.has(t.ID)&&s.push(r.get(t.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new i["MeshPhongMaterial"]({color:13421772}),s.push(a)),"color"in o.attributes&&s.forEach((function(t){t.vertexColors=!0})),o.FBX_Deformer?(n=new i["SkinnedMesh"](o,a),n.normalizeSkinWeights()):n=new i["Mesh"](o,a),n}createCurve(t,e){const r=t.children.reduce((function(t,r){return e.has(r.ID)&&(t=e.get(r.ID)),t}),null),n=new i["LineBasicMaterial"]({color:3342591,linewidth:1});return new i["Line"](r,n)}getTransformData(t,e){const r={};"InheritType"in e&&(r.inheritType=parseInt(e.InheritType.value)),r.eulerOrder="RotationOrder"in e?nr(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(r.translation=e.Lcl_Translation.value),"PreRotation"in e&&(r.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(r.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(r.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(r.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(r.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(r.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(r.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(r.rotationPivot=e.RotationPivot.value),t.userData.transformData=r}setLookAtProperties(t,e){if("LookAtProperty"in e){const e=ze.get(t.ID).children;e.forEach((function(e){if("LookAtProperty"===e.relationship){const r=Le.Objects.Model[e.ID];if("Lcl_Translation"in r){const e=r.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),Ue.add(t.target)):t.lookAt((new i["Vector3"]).fromArray(e))}}}))}}bindSkeleton(t,e,r){const n=this.parsePoseNodes();for(const o in t){const a=t[o],s=ze.get(parseInt(a.ID)).parents;s.forEach((function(t){if(e.has(t.ID)){const e=t.ID,o=ze.get(e);o.parents.forEach((function(t){if(r.has(t.ID)){const e=r.get(t.ID);e.bind(new i["Skeleton"](a.bones),n[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in Le.Objects){const e=Le.Objects.Pose;for(const r in e)if("BindPose"===e[r].attrType&&e[r].NbPoseNodes>0){const n=e[r].PoseNode;Array.isArray(n)?n.forEach((function(e){t[e.Node]=(new i["Matrix4"]).fromArray(e.Matrix.a)})):t[n.Node]=(new i["Matrix4"]).fromArray(n.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Le&&"AmbientColor"in Le.GlobalSettings){const t=Le.GlobalSettings.AmbientColor.value,e=t[0],r=t[1],n=t[2];if(0!==e||0!==r||0!==n){const t=new i["Color"](e,r,n);Ue.add(new i["AmbientLight"](t,1))}}}}class Ve{parse(t){const e=new Map;if("Geometry"in Le.Objects){const r=Le.Objects.Geometry;for(const n in r){const i=ze.get(parseInt(n)),o=this.parseGeometry(i,r[n],t);e.set(parseInt(n),o)}}return e}parseGeometry(t,e,r){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,r);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,r){const n=r.skeletons,i=[],o=t.parents.map((function(t){return Le.Objects.Model[t.ID]}));if(0===o.length)return;const a=t.children.reduce((function(t,e){return void 0!==n[e.ID]&&(t=n[e.ID]),t}),null);t.children.forEach((function(t){void 0!==r.morphTargets[t.ID]&&i.push(r.morphTargets[t.ID])}));const s=o[0],l={};"RotationOrder"in s&&(l.eulerOrder=nr(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);const c=rr(l);return this.genGeometry(e,a,i,c)}genGeometry(t,e,r,n){const o=new i["BufferGeometry"];t.attrName&&(o.name=t.attrName);const a=this.parseGeoNode(t,e),s=this.genBuffers(a),l=new i["Float32BufferAttribute"](s.vertex,3);if(l.applyMatrix4(n),o.setAttribute("position",l),s.colors.length>0&&o.setAttribute("color",new i["Float32BufferAttribute"](s.colors,3)),e&&(o.setAttribute("skinIndex",new i["Uint16BufferAttribute"](s.weightsIndices,4)),o.setAttribute("skinWeight",new i["Float32BufferAttribute"](s.vertexWeights,4)),o.FBX_Deformer=e),s.normal.length>0){const t=(new i["Matrix3"]).getNormalMatrix(n),e=new i["Float32BufferAttribute"](s.normal,3);e.applyNormalMatrix(t),o.setAttribute("normal",e)}if(s.uvs.forEach((function(t,e){let r="uv"+(e+1).toString();0===e&&(r="uv"),o.setAttribute(r,new i["Float32BufferAttribute"](s.uvs[e],2))})),a.material&&"AllSame"!==a.material.mappingType){let t=s.materialIndex[0],e=0;if(s.materialIndex.forEach((function(r,n){r!==t&&(o.addGroup(e,n-e,t),t=r,e=n)})),o.groups.length>0){const e=o.groups[o.groups.length-1],r=e.start+e.count;r!==s.materialIndex.length&&o.addGroup(r,s.materialIndex.length-r,t)}0===o.groups.length&&o.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(o,t,r,n),o}parseGeoNode(t,e){const r={};if(r.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],r.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(r.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(r.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(r.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){r.uv=[];let e=0;while(t.LayerElementUV[e])t.LayerElementUV[e].UV&&r.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return r.weightTable={},null!==e&&(r.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:e,weight:t.weights[i]})}))}))),r}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,n=0,i=!1,o=[],a=[],s=[],l=[],c=[],u=[];const f=this;return t.vertexIndices.forEach((function(h,d){let p,g=!1;h<0&&(h^=-1,g=!0);let m=[],v=[];if(o.push(3*h,3*h+1,3*h+2),t.color){const e=$e(d,r,h,t.color);s.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[h]&&t.weightTable[h].forEach((function(t){v.push(t.weight),m.push(t.id)})),v.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);const t=[0,0,0,0],e=[0,0,0,0];v.forEach((function(r,n){let i=r,o=m[n];e.forEach((function(e,r,n){if(i>e){n[r]=i,i=e;const a=t[r];t[r]=o,o=a}}))})),m=t,v=e}while(v.length<4)v.push(0),m.push(0);for(let t=0;t<4;++t)c.push(v[t]),u.push(m[t])}if(t.normal){const e=$e(d,r,h,t.normal);a.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(p=$e(d,r,h,t.material)[0]),t.uv&&t.uv.forEach((function(t,e){const n=$e(d,r,h,t);void 0===l[e]&&(l[e]=[]),l[e].push(n[0]),l[e].push(n[1])})),n++,g&&(f.genFace(e,t,o,p,a,s,l,c,u,n),r++,n=0,o=[],a=[],s=[],l=[],c=[],u=[])})),e}genFace(t,e,r,n,i,o,a,s,l,c){for(let u=2;u<c;u++)t.vertex.push(e.vertexPositions[r[0]]),t.vertex.push(e.vertexPositions[r[1]]),t.vertex.push(e.vertexPositions[r[2]]),t.vertex.push(e.vertexPositions[r[3*(u-1)]]),t.vertex.push(e.vertexPositions[r[3*(u-1)+1]]),t.vertex.push(e.vertexPositions[r[3*(u-1)+2]]),t.vertex.push(e.vertexPositions[r[3*u]]),t.vertex.push(e.vertexPositions[r[3*u+1]]),t.vertex.push(e.vertexPositions[r[3*u+2]]),e.skeleton&&(t.vertexWeights.push(s[0]),t.vertexWeights.push(s[1]),t.vertexWeights.push(s[2]),t.vertexWeights.push(s[3]),t.vertexWeights.push(s[4*(u-1)]),t.vertexWeights.push(s[4*(u-1)+1]),t.vertexWeights.push(s[4*(u-1)+2]),t.vertexWeights.push(s[4*(u-1)+3]),t.vertexWeights.push(s[4*u]),t.vertexWeights.push(s[4*u+1]),t.vertexWeights.push(s[4*u+2]),t.vertexWeights.push(s[4*u+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[4*(u-1)]),t.weightsIndices.push(l[4*(u-1)+1]),t.weightsIndices.push(l[4*(u-1)+2]),t.weightsIndices.push(l[4*(u-1)+3]),t.weightsIndices.push(l[4*u]),t.weightsIndices.push(l[4*u+1]),t.weightsIndices.push(l[4*u+2]),t.weightsIndices.push(l[4*u+3])),e.color&&(t.colors.push(o[0]),t.colors.push(o[1]),t.colors.push(o[2]),t.colors.push(o[3*(u-1)]),t.colors.push(o[3*(u-1)+1]),t.colors.push(o[3*(u-1)+2]),t.colors.push(o[3*u]),t.colors.push(o[3*u+1]),t.colors.push(o[3*u+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(n),t.materialIndex.push(n),t.materialIndex.push(n)),e.normal&&(t.normal.push(i[0]),t.normal.push(i[1]),t.normal.push(i[2]),t.normal.push(i[3*(u-1)]),t.normal.push(i[3*(u-1)+1]),t.normal.push(i[3*(u-1)+2]),t.normal.push(i[3*u]),t.normal.push(i[3*u+1]),t.normal.push(i[3*u+2])),e.uv&&e.uv.forEach((function(e,r){void 0===t.uvs[r]&&(t.uvs[r]=[]),t.uvs[r].push(a[r][0]),t.uvs[r].push(a[r][1]),t.uvs[r].push(a[r][2*(u-1)]),t.uvs[r].push(a[r][2*(u-1)+1]),t.uvs[r].push(a[r][2*u]),t.uvs[r].push(a[r][2*u+1])}))}addMorphTargets(t,e,r,n){if(0===r.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const i=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const o=Le.Objects.Geometry[r.geoID];void 0!==o&&i.genMorphGeometry(t,e,o,n,r.name)}))}))}genMorphGeometry(t,e,r,n,o){const a=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],l=void 0!==r.Indexes?r.Indexes.a:[],c=3*t.attributes.position.count,u=new Float32Array(c);for(let i=0;i<l.length;i++){const t=3*l[i];u[t]=s[3*i],u[t+1]=s[3*i+1],u[t+2]=s[3*i+2]}const f={vertexIndices:a,vertexPositions:u},h=this.genBuffers(f),d=new i["Float32BufferAttribute"](h.vertex,3);d.name=o||r.attrName,d.applyMatrix4(n),t.morphAttributes.position.push(d)}parseNormals(t){const e=t.MappingInformationType,r=t.ReferenceInformationType,n=t.Normals.a;let i=[];return"IndexToDirect"===r&&("NormalIndex"in t?i=t.NormalIndex.a:"NormalsIndex"in t&&(i=t.NormalsIndex.a)),{dataSize:3,buffer:n,indices:i,mappingType:e,referenceType:r}}parseUVs(t){const e=t.MappingInformationType,r=t.ReferenceInformationType,n=t.UV.a;let i=[];return"IndexToDirect"===r&&(i=t.UVIndex.a),{dataSize:2,buffer:n,indices:i,mappingType:e,referenceType:r}}parseVertexColors(t){const e=t.MappingInformationType,r=t.ReferenceInformationType,n=t.Colors.a;let i=[];return"IndexToDirect"===r&&(i=t.ColorIndex.a),{dataSize:4,buffer:n,indices:i,mappingType:e,referenceType:r}}parseMaterialIndices(t){const e=t.MappingInformationType,r=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const n=t.Materials.a,i=[];for(let o=0;o<n.length;++o)i.push(o);return{dataSize:1,buffer:n,indices:i,mappingType:e,referenceType:r}}parseNurbsGeometry(t){if(void 0===Ne)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new i["BufferGeometry"];const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new i["BufferGeometry"];const r=e-1,n=t.KnotVector.a,o=[],a=t.Points.a;for(let f=0,h=a.length;f<h;f+=4)o.push((new i["Vector4"]).fromArray(a,f));let s,l;if("Closed"===t.Form)o.push(o[0]);else if("Periodic"===t.Form){s=r,l=n.length-1-s;for(let t=0;t<r;++t)o.push(o[t])}const c=new Ne(r,n,o,s,l),u=c.getPoints(12*o.length);return(new i["BufferGeometry"]).setFromPoints(u)}}class Ge{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const r in e){const n=e[r],i=this.addClip(n);t.push(i)}return t}parseClips(){if(void 0===Le.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t),r=this.parseAnimStacks(e);return r}parseAnimationCurveNodes(){const t=Le.Objects.AnimationCurveNode,e=new Map;for(const r in t){const n=t[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const t={id:n.id,attr:n.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=Le.Objects.AnimationCurve;for(const r in e){const n={id:e[r].id,times:e[r].KeyTime.a.map(Je),values:e[r].KeyValueFloat.a},i=ze.get(n.id);if(void 0!==i){const e=i.parents[0].ID,r=i.parents[0].relationship;r.match(/X/)?t.get(e).curves["x"]=n:r.match(/Y/)?t.get(e).curves["y"]=n:r.match(/Z/)?t.get(e).curves["z"]=n:r.match(/d|DeformPercent/)&&t.has(e)&&(t.get(e).curves["morph"]=n)}}}parseAnimationLayers(t){const e=Le.Objects.AnimationLayer,r=new Map;for(const n in e){const e=[],o=ze.get(parseInt(n));if(void 0!==o){const a=o.children;a.forEach((function(r,n){if(t.has(r.ID)){const o=t.get(r.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===e[n]){const t=ze.get(r.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const o=Le.Objects.Model[t.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const a={modelName:o.attrName?i["PropertyBinding"].sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ue.traverse((function(t){t.ID===o.id&&(a.transform=t.matrix,t.userData.transformData&&(a.eulerOrder=t.userData.transformData.eulerOrder))})),a.transform||(a.transform=new i["Matrix4"]),"PreRotation"in o&&(a.preRotation=o.PreRotation.value),"PostRotation"in o&&(a.postRotation=o.PostRotation.value),e[n]=a}}e[n]&&(e[n][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===e[n]){const t=ze.get(r.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,o=ze.get(t).parents[0].ID,a=ze.get(o).parents[0].ID,s=ze.get(a).parents[0].ID,l=Le.Objects.Model[s],c={modelName:l.attrName?i["PropertyBinding"].sanitizeNodeName(l.attrName):"",morphName:Le.Objects.Deformer[t].attrName};e[n]=c}e[n][o.attr]=o}}})),r.set(parseInt(n),e)}}return r}parseAnimStacks(t){const e=Le.Objects.AnimationStack,r={};for(const n in e){const i=ze.get(parseInt(n)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=t.get(i[0].ID);r[n]={name:e[n].attrName,layer:o}}return r}addClip(t){let e=[];const r=this;return t.layer.forEach((function(t){e=e.concat(r.generateTracks(t))})),new i["AnimationClip"](t.name,-1,e)}generateTracks(t){const e=[];let r=new i["Vector3"],n=new i["Quaternion"],o=new i["Vector3"];if(t.transform&&t.transform.decompose(r,n,o),r=r.toArray(),n=(new i["Euler"]).setFromQuaternion(n,t.eulerOrder).toArray(),o=o.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.T.curves,r,"position");void 0!==n&&e.push(n)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const r=this.generateRotationTrack(t.modelName,t.R.curves,n,t.preRotation,t.postRotation,t.eulerOrder);void 0!==r&&e.push(r)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const r=this.generateVectorTrack(t.modelName,t.S.curves,o,"scale");void 0!==r&&e.push(r)}if(void 0!==t.DeformPercent){const r=this.generateMorphTrack(t);void 0!==r&&e.push(r)}return e}generateVectorTrack(t,e,r,n){const o=this.getTimesForAllAxes(e),a=this.getKeyframeTrackValues(o,e,r);return new i["VectorKeyframeTrack"](t+"."+n,o,a)}generateRotationTrack(t,e,r,n,o,a){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(i["MathUtils"].degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(i["MathUtils"].degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(i["MathUtils"].degToRad));const s=this.getTimesForAllAxes(e),l=this.getKeyframeTrackValues(s,e,r);void 0!==n&&(n=n.map(i["MathUtils"].degToRad),n.push(a),n=(new i["Euler"]).fromArray(n),n=(new i["Quaternion"]).setFromEuler(n)),void 0!==o&&(o=o.map(i["MathUtils"].degToRad),o.push(a),o=(new i["Euler"]).fromArray(o),o=(new i["Quaternion"]).setFromEuler(o).invert());const c=new i["Quaternion"],u=new i["Euler"],f=[];for(let i=0;i<l.length;i+=3)u.set(l[i],l[i+1],l[i+2],a),c.setFromEuler(u),void 0!==n&&c.premultiply(n),void 0!==o&&c.multiply(o),c.toArray(f,i/3*4);return new i["QuaternionKeyframeTrack"](t+".quaternion",s,f)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,r=e.values.map((function(t){return t/100})),n=Ue.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new i["NumberKeyframeTrack"](t.modelName+".morphTargetInfluences["+n+"]",e.times,r)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,r=e[0];for(let n=1;n<e.length;n++){const i=e[n];i!==r&&(e[t]=i,r=i,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,r){const n=r,i=[];let o=-1,a=-1,s=-1;return t.forEach((function(t){if(e.x&&(o=e.x.times.indexOf(t)),e.y&&(a=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==o){const t=e.x.values[o];i.push(t),n[0]=t}else i.push(n[0]);if(-1!==a){const t=e.y.values[a];i.push(t),n[1]=t}else i.push(n[1]);if(-1!==s){const t=e.z.values[s];i.push(t),n[2]=t}else i.push(n[2])})),i}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const r=t.values[e-1],n=t.values[e]-r,i=Math.abs(n);if(i>=180){const o=i/180,a=n/o;let s=r+a;const l=t.times[e-1],c=t.times[e]-l,u=c/o;let f=l+u;const h=[],d=[];while(f<t.times[e])h.push(f),f+=u,d.push(s),s+=a;t.times=lr(t.times,e,h),t.values=lr(t.values,e,d)}}}}class We{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new Qe,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,r=t.split(/[\r\n]+/);return r.forEach((function(t,n){const i=t.match(/^[\s\t]*;/),o=t.match(/^[\s\t]*$/);if(i||o)return;const a=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");a?e.parseNodeBegin(t,a):s?e.parseNodeProperty(t,s,r[++n]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const r=e[1].trim().replace(/^"/,"").replace(/"$/,""),n=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},o=this.parseNodeAttr(n),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in a?("PoseNode"===r?a.PoseNode.push(i):void 0!==a[r].id&&(a[r]={},a[r][a[r].id]=a[r]),""!==o.id&&(a[r][o.id]=i)):"number"===typeof o.id?(a[r]={},a[r][o.id]=i):"Properties70"!==r&&(a[r]="PoseNode"===r?[i]:i),"number"===typeof o.id&&(i.id=o.id),""!==o.name&&(i.attrName=o.name),""!==o.type&&(i.attrType=o.type),this.pushStack(i)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let r="",n="";return t.length>1&&(r=t[1].replace(/^(\w+)::/,""),n=t[2]),{id:e,name:r,type:n}}parseNodeProperty(t,e,r){let n=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode(),a=o.name;if("Properties70"!==a){if("C"===n){const t=i.split(",").slice(1),e=parseInt(t[0]),r=parseInt(t[1]);let a=i.split(",").slice(3);a=a.map((function(t){return t.trim().replace(/^"/,"")})),n="connections",i=[e,r],ar(i,a),void 0===o[n]&&(o[n]=[])}"Node"===n&&(o.id=i),n in o&&Array.isArray(o[n])?o[n].push(i):"a"!==n?o[n]=i:o.a=i,this.setCurrentProp(o,n),"a"===n&&","!==i.slice(-1)&&(o.a=ir(i))}else this.parseNodeSpecialProperty(t,n,i)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=ir(e.a))}parseNodeSpecialProperty(t,e,r){const n=r.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],o=n[1],a=n[2],s=n[3];let l=n[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=ir(l);break}this.getPrevNode()[i]={type:o,type2:a,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),i)}}class He{parse(t){const e=new Xe(t);e.skip(23);const r=e.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const n=new Qe;while(!this.endOfContent(e)){const t=this.parseNode(e,r);null!==t&&n.add(t.name,t)}return n}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const r={},n=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const o=t.getUint8(),a=t.getString(o);if(0===n)return null;const s=[];for(let f=0;f<i;f++)s.push(this.parseProperty(t));const l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",u=s.length>2?s[2]:"";r.singleProperty=1===i&&t.getOffset()===n;while(n>t.getOffset()){const n=this.parseNode(t,e);null!==n&&this.parseSubNode(a,r,n)}return r.propertyList=s,"number"===typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==u&&(r.attrType=u),""!==a&&(r.name=a),r}parseSubNode(t,e,r){if(!0===r.singleProperty){const t=r.propertyList[0];Array.isArray(t)?(e[r.name]=r,r.a=t):e[r.name]=t}else if("Connections"===t&&"C"===r.name){const t=[];r.propertyList.forEach((function(e,r){0!==r&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===r.name){const t=Object.keys(r);t.forEach((function(t){e[t]=r[t]}))}else if("Properties70"===t&&"P"===r.name){let t=r.propertyList[0],n=r.propertyList[1];const i=r.propertyList[2],o=r.propertyList[3];let a;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),a="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],e[t]={type:n,type2:i,flag:o,value:a}}else void 0===e[r.name]?"number"===typeof r.id?(e[r.name]={},e[r.name][r.id]=r):e[r.name]=r:"PoseNode"===r.name?(Array.isArray(e[r.name])||(e[r.name]=[e[r.name]]),e[r.name].push(r)):void 0===e[r.name][r.id]&&(e[r.name][r.id]=r)}parseProperty(t){const e=t.getString(1);let r;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return r=t.getUint32(),t.getArrayBuffer(r);case"S":return r=t.getUint32(),t.getString(r);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=t.getUint32(),o=t.getUint32(),a=t.getUint32();if(0===o)switch(e){case"b":case"c":return t.getBooleanArray(i);case"d":return t.getFloat64Array(i);case"f":return t.getFloat32Array(i);case"i":return t.getInt32Array(i);case"l":return t.getInt64Array(i)}"undefined"===typeof n&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const s=Zt(new Uint8Array(t.getArrayBuffer(a))),l=new Xe(s.buffer);switch(e){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class Xe{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(t){const e=[];for(let r=0;r<t;r++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let r=0;r<t;r++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let r=0;r<t;r++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let r=0;r<t;r++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let r=0;r<t;r++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){let e=[];for(let n=0;n<t;n++)e[n]=this.getUint8();const r=e.indexOf(0);return r>=0&&(e=e.slice(0,r)),i["LoaderUtils"].decodeText(new Uint8Array(e))}}class Qe{add(t,e){this[t]=e}}function Ye(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===or(t,0,e.length)}function Ze(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function n(e){const n=t[e-1];return t=t.slice(r+e),r++,n}for(let i=0;i<e.length;++i){const t=n(1);if(t===e[i])return!1}return!0}function Ke(t){const e=/FBXVersion: (\d+)/,r=t.match(e);if(r){const t=parseInt(r[1]);return t}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Je(t){return t/46186158e3}const qe=[];function $e(t,e,r,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);const o=i*n.dataSize,a=o+n.dataSize;return sr(qe,n.buffer,o,a)}const tr=new i["Euler"],er=new i["Vector3"];function rr(t){const e=new i["Matrix4"],r=new i["Matrix4"],n=new i["Matrix4"],o=new i["Matrix4"],a=new i["Matrix4"],s=new i["Matrix4"],l=new i["Matrix4"],c=new i["Matrix4"],u=new i["Matrix4"],f=new i["Matrix4"],h=new i["Matrix4"],d=new i["Matrix4"],p=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(er.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(i["MathUtils"].degToRad);e.push(t.eulerOrder),r.makeRotationFromEuler(tr.fromArray(e))}if(t.rotation){const e=t.rotation.map(i["MathUtils"].degToRad);e.push(t.eulerOrder),n.makeRotationFromEuler(tr.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(i["MathUtils"].degToRad);e.push(t.eulerOrder),o.makeRotationFromEuler(tr.fromArray(e)),o.invert()}t.scale&&a.scale(er.fromArray(t.scale)),t.scalingOffset&&l.setPosition(er.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(er.fromArray(t.scalingPivot)),t.rotationOffset&&c.setPosition(er.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(er.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h.copy(t.parentMatrix),f.copy(t.parentMatrixWorld));const g=r.clone().multiply(n).multiply(o),m=new i["Matrix4"];m.extractRotation(f);const v=new i["Matrix4"];v.copyPosition(f);const y=v.clone().invert().multiply(f),w=m.clone().invert().multiply(y),b=a,x=new i["Matrix4"];if(0===p)x.copy(m).multiply(g).multiply(w).multiply(b);else if(1===p)x.copy(m).multiply(w).multiply(g).multiply(b);else{const t=(new i["Matrix4"]).scale((new i["Vector3"]).setFromMatrixScale(h)),e=t.clone().invert(),r=w.clone().multiply(e);x.copy(m).multiply(g).multiply(r).multiply(b)}const T=u.clone().invert(),M=s.clone().invert();let S=e.clone().multiply(c).multiply(u).multiply(r).multiply(n).multiply(o).multiply(T).multiply(l).multiply(s).multiply(a).multiply(M);const A=(new i["Matrix4"]).copyPosition(S),E=f.clone().multiply(A);return d.copyPosition(E),S=d.clone().multiply(x),S.premultiply(f.invert()),S}function nr(t){t=t||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===t?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function ir(t){const e=t.split(",").map((function(t){return parseFloat(t)}));return e}function or(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.byteLength),i["LoaderUtils"].decodeText(new Uint8Array(t,e,r))}function ar(t,e){for(let r=0,n=t.length,i=e.length;r<i;r++,n++)t[n]=e[r]}function sr(t,e,r,n){for(let i=r,o=0;i<n;i++,o++)t[o]=e[i];return t}function lr(t,e,r){return t.slice(0,e).concat(r).concat(t.slice(e))}},"8c01":function(t,e,r){"use strict";var n=r("3b65"),i=r("b792"),o=RangeError;t.exports=function(t,e,r,a){var s=n(t),l=i(r),c=l<0?s+l:l;if(c>=s||c<0)throw new o("Incorrect index");for(var u=new e(s),f=0;f<s;f++)u[f]=f===c?a:t[f];return u}},"91ab":function(t,e,r){"use strict";t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},"98d4":function(t,e,r){"use strict";var n=r("24bf"),i=r("2796"),o=r("156d"),a=r("bdfb"),s=n.aTypedArray,l=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,u=i(n.TypedArrayPrototype.sort);c("toSorted",(function(t){void 0!==t&&o(t);var e=s(this),r=a(l(e),e);return u(r,t)}))},"9a55":function(t,e,r){"use strict";var n=r("ee4c"),i=r("2796"),o=r("2399"),a=r("8265"),s=r("5cab"),l=r("47cb"),c=r("b986"),u=r("d589"),f=n.structuredClone,h=n.ArrayBuffer,d=n.DataView,p=n.TypeError,g=Math.min,m=h.prototype,v=d.prototype,y=i(m.slice),w=o(m,"resizable","get"),b=o(m,"maxByteLength","get"),x=i(v.getInt8),T=i(v.setInt8);t.exports=(u||c)&&function(t,e,r){var n,i=l(t),o=void 0===e?i:a(e),m=!w||!w(t);if(s(t))throw new p("ArrayBuffer is detached");if(u&&(t=f(t,{transfer:[t]}),i===o&&(r||m)))return t;if(i>=o&&(!r||m))n=y(t,0,o);else{var v=r&&!m&&b?{maxByteLength:b(t)}:void 0;n=new h(o,v);for(var M=new d(t),S=new d(n),A=g(o,i),E=0;E<A;E++)T(S,E,x(M,E))}return u||c(t),n}},a4d1:function(t,e,r){"use strict";var n=r("3b65");t.exports=function(t,e){for(var r=n(t),i=new e(r),o=0;o<r;o++)i[o]=t[r-o-1];return i}},a64c:function(t,e,r){"use strict";var n=r("6c06"),i=r("6403"),o=r("7db5"),a=r("3b65"),s=function(t){var e=1===t;return function(r,s,l){var c,u,f=o(r),h=i(f),d=a(h),p=n(s,l);while(d-- >0)if(c=h[d],u=p(c,d,f),u)switch(t){case 0:return c;case 1:return d}return e?-1:void 0}};t.exports={findLast:s(0),findLastIndex:s(1)}},b617:function(t,e,r){"use strict";r("7ccf")},b63c:function(t,e,r){"use strict";var n=r("b792"),i=RangeError;t.exports=function(t){var e=n(t);if(e<0)throw new i("The argument can't be less than 0");return e}},b724:function(t,e,r){"use strict";var n=r("3bd3");t.exports=function(t){return n(t)||null===t}},b986:function(t,e,r){"use strict";var n,i,o,a,s=r("ee4c"),l=r("8063"),c=r("d589"),u=s.structuredClone,f=s.ArrayBuffer,h=s.MessageChannel,d=!1;if(c)d=function(t){u(t,{transfer:[t]})};else if(f)try{h||(n=l("worker_threads"),n&&(h=n.MessageChannel)),h&&(i=new h,o=new f(2),a=function(t){i.port1.postMessage(null,[t])},2===o.byteLength&&(a(o),0===o.byteLength&&(d=a)))}catch(p){}t.exports=d},b9d3:function(t,e,r){"use strict";var n=r("6982"),i=r("9a55");i&&n({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},ba33:function(t,e,r){"use strict";var n=r("ee4c"),i=r("28ca");t.exports="process"===i(n.process)},bb4e:function(t,e,r){"use strict";var n=r("a067");t.exports=function(t,e){var r=[][t];return!!r&&n((function(){r.call(null,e||function(){return 1},1)}))}},bdfb:function(t,e,r){"use strict";var n=r("3b65");t.exports=function(t,e,r){var i=0,o=arguments.length>2?r:n(e),a=new t(o);while(o>i)a[i]=e[i++];return a}},c54c:function(t,e,r){"use strict";var n=r("6982"),i=r("226e").left,o=r("bb4e"),a=r("84d1"),s=r("ba33"),l=!s&&a>79&&a<83,c=l||!o("reduce");n({target:"Array",proto:!0,forced:c},{reduce:function(t){var e=arguments.length;return i(this,t,e,e>1?arguments[1]:void 0)}})},cfb2:function(t,e,r){"use strict";r.r(e);r("2b12");var n=r("c553"),i=r("2745"),o=r("4e1f"),a=r("e346");const s={class:"btn"};var l=Object(n["defineComponent"])({__name:"Pipe",setup(t){const e=Object(n["ref"])();let r,l,c,u,f=[],h=[],d=[null,null,null],p={clipSpeed:.03,pipeRadius:8};const g=Object(n["ref"])(!1);function m(){h.map(t=>r.scene.remove(t)),h=[],f=[]}function v(t){r.outlinePass.selectedObjects=[u],d[0]=Object(o["h"])(t,"https://img2.baidu.com/it/u=2867681562,1586644503&fm=253&app=138&size=w931&n=0&f=JPEG&fmt=auto?sec=1677862800&t=ca5f653200ddc4f64f164b75d22b44c2",.85,p.pipeRadius/4),d[0].material=r.scene.getObjectByName("G033").material.clone(),r.scene.add(d[0]);const e=Object(o["o"])(d[0]);c=Object(o["j"])(t,u,p.clipSpeed,"go",(t,r)=>{const n=r.x-t.position.x;e.clipFace_Way["_x"].clip.constant+=n,t.rotation.x+=1,t.lookAt(r)},(function(){d[1]=Object(o["h"])(t,"https://img1.baidu.com/it/u=543378194,3252169155&fm=253&app=120&size=w931&n=0&f=JPEG&fmt=auto?sec=1677862800&t=b08f53a622ceb0c466234f3aff61a379",1,p.pipeRadius),d[1].material=r.scene.getObjectByName("Object023").material.clone(),r.scene.add(d[1]);const e=Object(o["o"])(d[1]);e.clipFace_Way["z"].clip.constant-=e.clipFace_Way["z"].width/5,e.clipFace_Way["x"].clip.constant-=e.clipFace_Way["x"].width,c=Object(o["j"])(t,u,p.clipSpeed,"back",(t,r)=>{const n=r.x-t.position.x;e.clipFace_Way["x"].clip.constant-=n,t.lookAt(r)},(function(){d[2]=Object(o["h"])(t,"https://img1.baidu.com/it/u=2858466579,1111354287&fm=253&fmt=auto&app=138&f=JPEG?w=499&h=375",1,p.pipeRadius/2.5),d[2].material=r.scene.getObjectByName("Object041").material.clone(),r.scene.add(d[2]);const e=Object(o["o"])(d[2]);c=Object(o["j"])(t,u,p.clipSpeed,"back",(t,r)=>{const n=r.x-t.position.x;e.clipFace_Way["x"].clip.constant-=n,t.lookAt(r)},(function(){c=null}))}))}))}let y;Object(n["onMounted"])(()=>r=M(e.value)),Object(n["onUnmounted"])(()=>r.GUI&&r.GUI.destroy());let w=null,b=!0;function x(t){if(b)return;if(2===t.button)return b=!0;const e=Object(o["p"])(t),n=Object(o["b"])(e,r.camera,r.scene);if(n){const{object:t,face:e,point:i}=n;i.z+=p.pipeRadius;const a=Object(o["w"])(r.scene,i);u.lookAt(i),u.position.copy(i),f.push(i),h.push(a)}}function T(t){if(b&&f.length>1)return y=Object(o["c"])(f),void w.geometry.setFromPoints(y.getPoints(100));const e=Object(o["p"])(t),n=Object(o["b"])(e,r.camera,r.scene);if(n){const{point:t}=n;if(t.z+=p.pipeRadius,f.length<1)return;const e=Object(o["c"])([...f,t]),i=e.getPoints(100);w?w.geometry.setFromPoints(i):(w=Object(o["e"])(i,"white",50),r.scene.add(w))}}function M(t){const e=new i["Scene"],n=new i["PerspectiveCamera"](50,t.clientWidth/t.clientHeight,.001,1e5);n.position.set(1e3,1e3,1e3),e.add(n);const s=new i["WebGLRenderer"]({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0});s.setSize(t.clientWidth,t.clientHeight),s.setPixelRatio(2*window.devicePixelRatio),s.shadowMap.enabled=!0,s.shadowMap.type=i["PCFSoftShadowMap"],s.setClearColor(0),s.outputEncoding=i["sRGBEncoding"],s.localClippingEnabled=!0,s.localClippingEnabled=!0,t.appendChild(s.domElement);const f=Object(o["B"])(n,s);f.addEventListener("change",()=>f.target.y<0&&(f.target.y=0));const h=new i["AxesHelper"](5500);e.add(h);const d=Object(a["a"])(i,e,n,f);d.add(p,"pipeRadius").min(1).max(30).name("管子大小"),d.add(p,"clipSpeed").min(.001).max(.1).name("速度"),Object(o["r"])("http://guangfu/resource/chuankuayue.FBX",t=>{const r=d.addFolder("模型["+Date.now()+"]");["x","y","z"].forEach(e=>r.add(t.position,e).min(-500).max(500).name(e+"轴坐标")),["x","y","z"].forEach(e=>r.add(t.scale,e).min(0).max(10).name(e+"缩放")),e.add(t),l=Object(o["t"])(t),l.runAction(l.actions[0],8).play()}),Object(o["s"])("http://guangfu/resource/Soldier.glb",t=>{u=t,t.scale.set(100,100,100),e.add(t)});const{Composer:m,outlinePass:v}=Object(o["D"])(e,n,s,t),y=Object(o["F"])(),w=Object(o["C"])(60);function b(){w(()=>{y&&y.update(),l&&l.mixerRender(),!g.value&&c&&c(),r&&r.outlinePass.selectedObjects.length>0?m.render():s.render(e,n)}),requestAnimationFrame(b)}return b(),window.onresize=()=>{n.aspect=t.clientWidth/t.clientHeight,n.updateProjectionMatrix(),s.setSize(t.clientWidth,t.clientHeight)},{scene:e,camera:n,renderer:s,controls:f,GUI:d,outlinePass:v}}return(t,r)=>{const i=Object(n["resolveComponent"])("el-button");return Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],null,[Object(n["createElementVNode"])("div",{ref_key:"threeDom",ref:e,class:"threeDom",onMousedown:Object(n["withModifiers"])(x,["prevent","stop"]),onMousemove:T},null,544),Object(n["createElementVNode"])("div",s,[Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(i,{onClick:m},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("清除点")]),_:1})]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(i,{onClick:r[0]||(r[0]=t=>v(Object(n["unref"])(y)))},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("根据曲线生成管道")]),_:1})]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(i,{onClick:r[1]||(r[1]=t=>g.value=!g.value)},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("暂停")]),_:1})]),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(i,{onClick:r[2]||(r[2]=t=>Object(n["isRef"])(b)?b.value=!1:b=!1)},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("绘制/继续绘制")]),_:1})])])],64)}}}),c=(r("b617"),r("6b78")),u=r.n(c);const f=u()(l,[["__scopeId","data-v-4dc5f2b8"]]);e["default"]=f},d1c6:function(t,e,r){"use strict";var n=r("b63c"),i=RangeError;t.exports=function(t,e){var r=n(t);if(r%e)throw new i("Wrong offset");return r}},d553:function(t,e,r){"use strict";var n=r("a4d1"),i=r("24bf"),o=i.aTypedArray,a=i.exportTypedArrayMethod,s=i.getTypedArrayConstructor;a("toReversed",(function(){return n(o(this),s(this))}))},d589:function(t,e,r){"use strict";var n=r("ee4c"),i=r("a067"),o=r("84d1"),a=r("4ae5"),s=r("e0ed"),l=r("ba33"),c=n.structuredClone;t.exports=!!c&&!i((function(){if(s&&o>92||l&&o>94||a&&o>97)return!1;var t=new ArrayBuffer(8),e=c(t,{transfer:[t]});return 0!==t.byteLength||8!==e.byteLength}))},d5891:function(t,e,r){"use strict";r("2b44")},e0ed:function(t,e,r){"use strict";t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},e346:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));r("2b12");var n=r("01af");function i(t,e,r,i){const o=new n["a"],a={lightType:"平行光",allLight:{"点光源":"PointLight","聚光灯":"SpotLight","平行光":"DirectionalLight","环境光":"AmbientLight"},hasCastShadow:["点光源","聚光灯","平行光"],axesLong:3e3,rememberLight:[]},s=o.addFolder("基础配置");s.add({fn:()=>{const t=a.rememberLight.map(t=>{const{visible:e,castShadow:r,color:n,position:i,intensity:o}=t.light;return{folderName:t.folderName,lightType:t.lightType,params:{visible:e,castShadow:r,color:n,position:i,intensity:o}}});localStorage.setItem("light",JSON.stringify(t)),localStorage.setItem("camera",JSON.stringify(r.position))}},"fn").name("@保存当前配置"),s.open();const l=s.addFolder("灯光配置");if(l.add(a,"lightType",["点光源","聚光灯","平行光","环境光"]).name("光源类型"),l.add(a,"axesLong").name("灯光最大坐标值"),l.add({fn:()=>{const r=new t[a.allLight[a.lightType]];e.add(r);let n=a.lightType+"["+Date.now()+"]";f(r,n,a.axesLong,a.lightType)}},"fn").name("点击添加光源"),localStorage.getItem("light")&&JSON.parse(localStorage.getItem("light")).map(r=>c(r,t,e)),localStorage.getItem("camera")){const{x:t,y:e,z:n}=JSON.parse(localStorage.getItem("camera"));r.position.x=t,r.position.y=e,r.position.z=n,i.update()}function c(t,e,r){const{params:n,folderName:i,lightType:o}=t,s=new e[a.allLight[o]];s.position.x=n.position.x,s.position.y=n.position.y,s.position.z=n.position.z,s.visible=n.visible,s.castShadow=n.castShadow,s.intensity=n.intensity,s.color.set(n.color),r.add(s),f(s,i,a.axesLong,o)}const u=s.addFolder("相机配置");function f(t,r,n=1e3,i){const s=a.hasCastShadow.includes(i),l=o.addFolder(r+"配置");l.add(t,"visible").name("可见性"),s&&l.add(t,"castShadow").name("投射阴影"),l.add(t,"intensity").min(-1).max(4).name("光照强度"),["x","y","z"].forEach(e=>l.add(t.position,e).min(-n).max(n).name(e+"轴坐标")),l.addColor({color:16777215},"color").onChange(e=>t.color.set(e)).name("光照颜色"),l.add({fn:()=>{o.removeFolder(l),a.rememberLight.splice(a.rememberLight.findIndex(t=>t.folderName===r),1),e.remove(t)}},"fn").name("销毁灯光");const c={folderName:r,lightType:i,light:t};a.rememberLight.push(c)}return u.add(r,"fov").min(0).max(200).name("相机视锥体垂直视野角度"),u.add(r,"near").min(0).max(100).name("相机视锥体近端"),u.add(r,"far").min(1e3).max(1e7).name("相机视锥体远端"),["x","y","z"].forEach(t=>u.add(r.position,t).min(-100).max(100).name(t+"轴坐标")),u.add({fn:()=>r.updateProjectionMatrix()},"fn").name("更新相机矩阵"),o}},e6c6:function(t,e,r){"use strict";var n=r("8c01"),i=r("24bf"),o=r("1e9e"),a=r("b792"),s=r("3b90"),l=i.aTypedArray,c=i.getTypedArrayConstructor,u=i.exportTypedArrayMethod,f=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();u("with",{with:function(t,e){var r=l(this),i=a(t),u=o(r)?s(e):+e;return n(r,c(r),i,u)}}["with"],!f)},e864:function(t,e,r){"use strict";r("b9d3")},f72c:function(t,e,r){"use strict";var n=r("b724"),i=String,o=TypeError;t.exports=function(t){if(n(t))return t;throw new o("Can't set "+i(t)+" as a prototype")}},fba5:function(t,e,r){"use strict";var n=r("401b"),i=r("cac9");t.exports=function(t,e,r){return r.get&&n(r.get,e,{getter:!0}),r.set&&n(r.set,e,{setter:!0}),i.f(t,e,r)}}}]);